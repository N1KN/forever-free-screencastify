"use strict";!function(){window.angular&&angular.module("w69b.es6",[]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,a=arguments[1],o=0;r>o;o++)if(t=n[o],e.call(a,t,o,n))return t}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===this||null===this)throw new TypeError("Cannot convert this value to object");var t=Object(this),n=parseInt(t.length,10)||0;if(0===n)return!1;var r=parseInt(arguments[1],10)||0;if(r>=n)return!1;var a;for(r>=0?a=r:(a=n+r,0>a&&(a=0));n>a;){var o=t[a];if(e===o||e!==e&&o!==o)return!0;a++}return!1}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length),t-=e.length;var r=n.indexOf(e,t);return-1!==r&&r===t}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}),angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(e){var t={};return t.sendMessage=e.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),t.getBackgroundPage=e.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),t.connect=chrome.runtime.connect.bind(chrome.runtime),t.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),t.id=chrome.runtime.id,chrome.runtime.getPlatformInfo&&(t.getPlatformInfo=e.wrapChromeError(chrome.runtime.getPlatformInfo,chrome.runtime)),["onMessage","onMessageExternal","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach(function(e){t[e]={addListener:function(t){chrome.runtime[e].addListener(t)},removeListener:function(t){chrome.runtime[e].removeListener(t)}}}),t}]),angular.module("w69b.chromeStorage",["w69b.promiseTool"]).factory("chromeStorage",["promiseTool",function(e){var t=chrome.storage,n={};return["local","sync","managed"].forEach(function(r){n[r]={},["set","get","remove","clear"].forEach(function(a){n[r][a]=e.wrapChromeError(t[r][a],t[r])}),n[r].setSingle=function(e,t){var a={};return a[e]=t,n[r].set(a)},n[r].getSingle=function(e,t){return n[r].get(e).then(function(n){return n.hasOwnProperty(e)?n[e]:t})}}),n.onChanged=t.onChanged,n}]),angular.module("w69b.chromeTabs",["w69b.promiseTool"]).factory("chromeTabs",["$window","promiseTool","$q",function(e,t,n){if(!e.chrome||!e.chrome.tabs)return null;var r=e.chrome,a={};return a.query=t.wrapChromeError(r.tabs.query,r.tabs),a.getActiveTab=function(){return a.query({active:!0,windowId:r.windows.WINDOW_ID_CURRENT}).then(function(e){return e.length?e[0]:n.reject()})},a.get=t.wrapChromeError(r.tabs.get,r.tabs),a.update=t.wrapChromeError(r.tabs.update,r.tabs),a.remove=t.wrapChromeError(r.tabs.remove,r.tabs),a.create=t.wrapChromeError(r.tabs.create,r.tabs),a.connect=r.tabs.connect.bind(r.tabs),a.setZoomSettings=t.wrapChromeError(r.tabs.setZoomSettings,r.tabs),a.setZoom=t.wrapChromeError(r.tabs.setZoom,r.tabs),a.executeScript=t.wrapChromeError(r.tabs.executeScript,r.tabs),a.insertCSS=t.wrapChromeError(r.tabs.insertCSS,r.tabs),a.sendMessage=t.wrapChromeError(r.tabs.sendMessage,r.tabs),a.onUpdated=r.tabs.onUpdated,a.onActivated=r.tabs.onActivated,a.sendMessageActive=function(e,t){return a.getActiveTab().then(function(n){return a.sendMessage(n.id,e,t)})},a}]).directive("newTab",["chromeTabs",function(e){return{restrict:"A",link:function(t,n,r){n.bind("click",function(t){t.preventDefault(),e.create({url:r.href}).then(function(e){chrome.windows.update(e.windowId,{focused:!0},angular.noop)})})}}}]),angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,t){var n={};return n.wrapChromeError=function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),a=e.defer();return r.push(function(e){chrome.runtime.lastError?a.reject(chrome.runtime.lastError):a.resolve(e)}),t.apply(n,r),a.promise}},n.wrapCallbacks=function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),a=e.defer();return r.push(a.resolve.bind(a)),r.push(a.reject.bind(a)),t.apply(n,r),a.promise}},n.serializer=function(){var t=null;return function(n){var r=e.defer();return(t||e.when())["finally"](function(){var e=n.call();r.resolve(e)}),t=r.promise,t["finally"](function(){t=null}),r.promise}},n.withTimeout=function(n,r,a){a||(a=angular.noop);var o=e.defer(),i=t(function(){var e=a();angular.isDefined(e)?o.resolve(e):o.reject("timeout"),o=null},r),c=n(),u=o.promise;return c["finally"](function(){t.cancel(i),i=null}),c.then(function(){o&&o.resolve.apply(o,arguments)},function(){o&&o.reject.apply(o,arguments)}),u},n}]),angular.module("w69b.uritool",[]).factory("uritool",function(){function e(e){return decodeURIComponent(e.replace(t," "))}var t=/\+/g,n={};return n.parseQuery=function(t,n){"?"==t[0]&&(t=t.substring(1));for(var r,a=/([^&=]+)=?([^&]*)/g,o={};r=a.exec(t);){var i=e(r[1]),c=e(r[2]);n&&o.hasOwnProperty(i)?o[i].push(c):o[i]=n?[c]:c}return o},n.parseUrl=function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,hash:t.hash,path:t.pathname}},n.encodeQuery=function(e){var t=[];return angular.forEach(e,function(e,n){angular.isArray(e)?angular.forEach(e,function(e){t.push(encodeURIComponent(n)+(e===!0?"":"="+encodeURIComponent(e)))}):t.push(encodeURIComponent(n)+(e===!0?"":"="+encodeURIComponent(e)))}),t.length?t.join("&"):""},n}),angular.module("w69b.spawn",[]).factory("spawn",["$q","$log",function(e,t){function n(t,n){function r(e,t){var n;try{n=e(t)}catch(r){return a(r)}return n.done?o(n.value):o(n.value).then(c,u)}var a=n?Promise.reject.bind(Promise):e.reject.bind(e),o=n?Promise.resolve.bind(Promise):e.when.bind(e),i=t(),c=r.bind(null,i.next.bind(i)),u=r.bind(null,i["throw"].bind(i));return c()}return n.wrap=function(e){return function(){var r,a=arguments,o=n((r=e).bind.apply(r,$traceurRuntime.spread([this],a)));return o["catch"](function(e){t.error("unhandled spawn.wrap rejection:",e),e.stack&&console.error(e.stack)}),o}},n}]),angular.module("w69b.uuid",[]).factory("uuid",["$window",function(e){function t(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}function n(){var n=new Uint16Array(8);return e.crypto.getRandomValues(n),t(n[0])+t(n[1])+"-"+t(n[2])+"-4"+t(n[3]).substring(1)+"-y"+t(n[4]).substring(1)+"-"+t(n[5])+t(n[6])+t(n[7])}return n}]),angular.module("w69b.chromeAnalytics",[]).provider("analytics",function(){var e,t;this.setTrackingId=function(t){e=t},this.setApp=function(e,n){t=arguments},this.$get=["$window",function(n){if(!t)throw new Error("make sure to call analyticsProvider.setApp()");if(!n.analytics)throw new Error("chrome-analytics lib not loaded");var r=n.analytics,a=r.getService.apply(r,t),o=a.getTracker(e),i={};return i.tracker=o,i.eventBuilder=function(){return r.EventBuilder.builder()},i.setEnabled=function(e){a.getConfig().addCallback(function(t){t.setTrackingPermitted(e)})},i.send=function(){o.send.apply(o,arguments)},i.trackPageView=function(e){o.sendAppView(e)},i.trackEvent=function(){o.sendEvent.apply(o,arguments)},i.trackTimer=function(e,t,n){var r,a={};return a.start=function(){return r=(new Date).getTime(),a},a.send=function(i,c,u){var s=(new Date).getTime();return o.sendTiming(i||e,c||t,s-r,u||n),a},a.start(),a},i}]}),angular.module("w69b.filesHelper",["w69b.promiseTool"]).factory("filesHelper",["$window","promiseTool","$q",function(e,t,n){function r(e){var t=e.split("/"),n=t.slice(0,-1).join("/"),r=t.slice(-1)[0];return[n,r]}e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem;var a=window.PERSISTENT,o=104857600,i={},c=["readEntries","remove","getFile","getMetadata","moveTo","file","getDirectory","createWriter"];return c.forEach(function(e){i[e]=function(n){var r=[].slice.call(arguments,1);return t.wrapCallbacks(n[e],n).apply(null,r)}}),i.getFileSystem=function(n,r){return angular.isUndefined(n)&&(n=a),r=r||o,t.wrapCallbacks(e.requestFileSystem,e)(n,r)},i.getPersistentQuota=function(){var t=n.defer();return e.navigator.webkitPersistentStorage.queryUsageAndQuota(function(e,n){t.resolve({usage:e,quota:n})},function(e){t.reject(e)}),t.promise},chrome.system&&chrome.system.storage&&(i.getStorageInfo=t.wrapChromeError(chrome.system.storage.getInfo,chrome.system.storage)),i.getDirByPath=function(e,t){function r(e,a){return a.length?i.getDirectory(e,a[0],t||{}).then(function(e){return r(e,a.slice(1))}):n.when(e)}var a=e.split("/");return""===a[0]&&a.splice(0,1),i.getFileSystem().then(function(e){return r(e.root,a,t)})},i.moveFileByPath=function(e,t){var a=r(t),o=a[0],c=a[1];return n.all({file:i.getFileEntryByPath(e),targetDir:i.getDirByPath(o)}).then(function(e){return i.moveTo(e.file,e.targetDir,c)})},i.getFileEntryByPath=function(e,t,n){var a=r(e),o=a[0],c=a[1];return i.getDirByPath(o,n).then(function(e){return i.getFile(e,c,t||{})})},i.getFileByPath=function(e){return i.getFileEntryByPath(e).then(function(e){return i.file(e)})},i.removeByPath=function(e){return i.getFileEntryByPath(e).then(function(e){return i.remove(e)})},i.listByPath=function(e){return i.getDirByPath(e).then(function(e){var t=e.createReader();return i.readEntries(t)})},i.requestPersistentQuota=function(e){return t.wrapCallbacks(navigator.webkitPersistentStorage.requestQuota,navigator.webkitPersistentStorage)(e||o)},i.requestTemporaryQuota=function(e){return t.wrapCallbacks(navigator.webkitTemporaryStorage.requestQuota,navigator.webkitTemporaryStorage)(e||o)},i.writeFile=function(e,t){var r=n.defer();return e.onwriteend=r.resolve.bind(r),e.onerror=r.reject.bind(r),e.write(t),r.promise},i.isSupported=function(){return!!window.requestFileSystem},i}]),angular.module("w69b.asyncResponse",[]).factory("asyncResponse",["$q",function(e){var t={};return t.createSender=function(t){var n={},r=0,a={};return n.sendWithResponse=function(n,o){var i=++r,c=e.defer();return a[i]=c,t({type:n,data:o,msgId:i}),c.promise},n.send=function(e,n){t({type:e,data:n})},n.handleResult=function(e){if(e&&"result"===e.type){var t=a[e.msgId];return delete a[e.msgId],e.hasOwnProperty("error")||e.isError?t.reject(e.error):t.resolve(e.data),!0}return!1},n},t.createRespond=function(t){return function(n,r){e.when(n).then(function(e){t({type:"result",msgId:r.msgId,data:e})},function(e){t({type:"result",msgId:r.msgId,error:e,isError:!0})})}},t}]),angular.module("w69b.originWildcardMatcher",[]).factory("originWildcardMatcher",function(){function e(e){return function(t){if(t===e)return!0;if(t.indexOf("*")>-1){var n=e.split("://"),r=t.split("://");if(n=[n[0]].concat(n[1].split(".")),r=[r[0]].concat(r[1].split(".")),r.length!==n.length)return!1;for(var a=0;a<n.length;++a)if(n[a]!==r[a]&&"*"!==r[a])return!1;return!0}return!1}}return e}),angular.module("castifyExt.connect.connectFrame",["castifyExt.fileDbClient","w69b.filesHelper","w69b.asyncResponse","w69b.chromeRuntime","w69b.promiseTool","w69b.originWildcardMatcher","castifyExt.connect.connectedApps","castifyExt.connect.appRegistry","castifyExt.connect.appPermissions"]).factory("connectFrame",["$location","filesHelper","$window","connectedApps","appPermissions","$q","spawn","appRegistry","asyncResponse","chromeRuntime","promiseTool","fileDbClient","originWildcardMatcher",function(e,t,n,r,a,o,i,c,u,s,l,f,d){function p(e){return i($traceurRuntime.initGeneratorFunction(function n(){var r,a;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,f.getFileDescriptor(e);case 2:r=n.sent,n.state=4;break;case 4:return n.state=6,t.getFileByPath(e+".webm");case 6:a=n.sent,n.state=8;break;case 8:n.returnValue={id:r.id,width:r.width,height:r.height,duration:r.duration,title:r.title,file:a,payload:r.autoShare&&r.autoShare.payload},n.state=-2;break;default:return n.end()}},n,this)}))}function h(e,t){n.parent.postMessage({type:e,data:t},"*")}function g(e){return w?w!==e.origin?o.reject("Origin not allowed: "+e.origin):o.when():o.reject("call setAppId() first")}function m(e,t){var r=t.data.msgId;o.when(e).then(function(e){n.parent.postMessage({type:"result",data:e,msgId:r},t.origin)},function(e){e instanceof Error&&(e=e.message),n.parent.postMessage({type:"result",error:e,msgId:r},t.origin)})}function y(e){function t(){return T.hasOwnProperty(n.type)?T[n.type](n.data,e):n.msgId?E.sendWithResponse(n.type,n.data):E.send(n.type,n.data)}var n=e.data;if(n)if("setAppId"===n.type)m(T.setAppId(n.data,e),e);else{var r=g(e);n&&"result"===n.type?r.then(function(){A.handleResult(n)}):(r=r.then(t),n.msgId&&m(r,e))}}function b(){var e=s.connect({name:"connectFrame"}),t=u.createRespond(e.postMessage.bind(e));E=u.createSender(e.postMessage.bind(e)),E.send("connect",v),e.onMessage.addListener(function(e){if(!E.handleResult(e))if(e.msgId){var n=A.sendWithResponse(e.type,e.data);t(n,e)}else A.send(e.type,e.data)})}var v,w,E,k={},S="access_denied",I=1024,A=u.createSender(function(e){n.parent.postMessage(e,w)}),T={};return T.getFile=function(e){return i($traceurRuntime.initGeneratorFunction(function t(){var n,r,i,c;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:n=a.hasAccess,r=v.id,i=n.call(a,r,e),t.state=6;break;case 6:return t.state=2,i;case 2:c=t.sent,t.state=4;break;case 4:t.state=c?8:7;break;case 7:t.returnValue=o.reject(S),t.state=-2;break;case 8:t.returnValue=p(e),t.state=-2;break;default:return t.end()}},t,this)}))},T.isAppConnected=function(){return r.isConnected(v.id)},T.setUserExpiryDate=function(e){return v.isPaidInstall?null===e||angular.isNumber(e)?r.setUserExpiryDate(v.id,e):o.reject("date has to be null or a Number"):o.reject("only available for paid Apps")},T.setUserShareUrl=function(e){return null===e||angular.isString(e)&&/https?:\/\//.test(e)?r.setUserShareUrl(v.id,e):o.reject("url has to be null or a URL string")},T.setAppId=function(e,t){return v?o.reject("appId already set"):c.getAppInfo(e).then(function(n){return n?n.allowedOrigins.some(d(t.origin))?(w=t.origin,v=n,void b()):o.reject("Origin not allowed for this App: "+t.origin):o.reject("unknown appId "+e)},function(){return o.reject("failed to load app config")})},T.startRecording=function(e){if(document.hidden)return o.reject("tab must be visible to start recording");if(e&&e.payload){if(!angular.isString(e.payload))return o.reject("payload must be a string");if(e.payload.length>I)return o.reject("payload is too long")}return E.sendWithResponse("startRecording",e)},k.install=function(){n.addEventListener("message",y),h("ready")},k}]),angular.module("castifyExt.connect.connectedApps",["w69b.chromeStorage","w69b.spawn","castifyExt.connect.appRegistry"]).factory("connectedApps",["chromeStorage","spawn","appRegistry","$rootScope",function(e,t,n,r){function a(){return e.sync.getSingle(l,[]).then(function(e){return e.map(function(e){return angular.isObject(e)?e:{id:e,hasShareUrl:!0}})})}function o(t){return e.sync.setSingle(l,t)}function i(){return e.sync.getSingle(f)}function c(t){return e.sync.setSingle(f,t)}function u(e,t){return e.some(function(e){return e.id===t})}var s={},l="connectedAppIds",f="connectedAppRecentId";s.getConnected=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,a();case 2:t=n.sent,n.state=4;break;case 4:e&&(t=t.filter(function(t){var n=!0;return angular.forEach(e,function(e,r){n=n&&t[r]===e}),n})),n.state=8;break;case 8:n.returnValue=t.map(function(e){return e.id}),n.state=-2;break;default:return n.end()}},n,this)}))},s.getConnectedAppInfo=t.wrap($traceurRuntime.initGeneratorFunction(function p(){var e,t;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,a();case 2:e=r.sent,r.state=4;break;case 4:return r.state=6,n.getApps(e.map(function(e){return e.id}));case 6:t=r.sent,r.state=8;break;case 8:t=angular.copy(t),t.forEach(function(t){var n=e.find(function(e){return e.id===t.id});angular.extend(t,n)}),r.state=12;break;case 12:r.returnValue=t,r.state=-2;break;default:return r.end()}},p,this)})),s.getConnectedAppInfoForApp=t.wrap($traceurRuntime.initGeneratorFunction(function h(e){var t,n;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,s.getConnectedAppInfo();case 2:t=r.sent,r.state=4;break;case 4:n=t.find(function(t){return t.id===e}),r.state=11;break;case 11:r.state=n?6:5;break;case 5:r.returnValue=null,r.state=-2;break;case 6:r.returnValue=n,r.state=-2;break;default:return r.end()}},h,this)})),s.isConnected=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,a();case 2:t=n.sent,n.state=4;break;case 4:n.returnValue=u(t,e),n.state=-2;break;default:return n.end()}},n,this)}))},s.disconnect=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,a();case 2:t=n.sent,n.state=4;break;case 4:t=t.filter(function(t){return t.id!==e}),n.state=14;break;case 14:return n.state=6,c(null);case 6:n.maybeThrow(),n.state=8;break;case 8:return n.state=10,o(t);case 10:n.maybeThrow(),n.state=12;break;case 12:r.$broadcast("connect:appDisconnected",e),n.state=-2;break;default:return n.end()}},n,this)}))},s.connect=function(e){return t($traceurRuntime.initGeneratorFunction(function i(){var t,s;return $traceurRuntime.createGeneratorInstance(function(i){for(;;)switch(i.state){case 0:return i.state=2,a();case 2:t=i.sent,i.state=4;break;case 4:return i.state=6,n.getAppInfo(e);case 6:s=i.sent,i.state=8;break;case 8:i.state=u(t,e)?12:14;break;case 14:t.push({id:e,hasShareUrl:!!s.shareUrl}),i.state=15;break;case 15:i.state=s.shareUrl?9:12;break;case 9:return i.state=10,c(e);case 10:i.maybeThrow(),i.state=12;break;case 12:return i.state=18,o(t);case 18:i.maybeThrow(),i.state=20;break;case 20:r.$broadcast("connect:appConnected",e,s),i.state=-2;break;default:return i.end()}},i,this)}))};var d=t.wrap($traceurRuntime.initGeneratorFunction(function g(e,t,n){var r,i,c;return $traceurRuntime.createGeneratorInstance(function(u){for(;;)switch(u.state){case 0:return u.state=2,a();case 2:r=u.sent,u.state=4;break;case 4:if(i=r.find(function(t){return t.id===e}),!i)throw new Error("Cannot set user data for non-connected app");c=i[t],null===n||angular.isUndefined(n)?delete i[t]:i[t]=n,u.state=12;break;case 12:return u.state=6,o(r);case 6:u.maybeThrow(),u.state=8;break;case 8:u.returnValue=c,u.state=-2;break;default:return u.end()}},g,this)}));return s.setUserExpiryDate=t.wrap($traceurRuntime.initGeneratorFunction(function m(e,t){var n;return $traceurRuntime.createGeneratorInstance(function(a){for(;;)switch(a.state){case 0:return a.state=2,d(e,"userExpiryDate",t);case 2:n=a.sent,a.state=4;break;case 4:r.$broadcast("connect:userExpiryDateChange",n,t),a.state=-2;break;default:return a.end()}},m,this)})),s.setUserShareUrl=function(e,t){return d(e,"shareUrl",t)},s.clearRecent=function(){return c(null)},s.getRecent=function(){return i()},s}]),angular.module("castifyExt.connect.appRegistry",["w69b.spawn","w69b.chromeStorage"]).factory("appRegistry",["castifyConfig","$http","$q","spawn","chromeStorage",function(e,t,n,r,a){function o(){return a.local.getSingle(h,[])}function i(e){return a.local.setSingle(h,e)}function c(e){return o().then(function(t){return t.filter(function(t){return e.includes(t.id)})})}function u(e,t){var n=Date.now(),r=e.some(function(e){return n>e._fetchTimestamp+g});return!r&&t.length===e.length}function s(e){return e.forEach(function(e){delete e._fetchTimestamp}),e}function l(e,t){return r($traceurRuntime.initGeneratorFunction(function n(){var r;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:e=new Set(e||[]),n.state=10;break;case 10:return n.state=2,o();case 2:r=n.sent,n.state=4;break;case 4:t.forEach(function(t){e.add(t.id)}),r=r.filter(function(t){return!e.has(t.id)}),t.forEach(function(e){e._fetchTimestamp=Date.now()}),r=r.concat(t),n.state=12;break;case 12:return n.state=6,i(r);case 6:n.maybeThrow(),n.state=-2;break;default:return n.end()}},n,this)}))}function f(e){return r($traceurRuntime.initGeneratorFunction(function a(){var r,o,i,f;return $traceurRuntime.createGeneratorInstance(function(a){for(;;)switch(a.state){case 0:a.state=e&&0!==e.length?2:1;break;case 1:a.returnValue=n.when([]),a.state=-2;break;case 2:return a.state=5,c(e);case 5:o=a.sent,a.state=7;break;case 7:a.state=u(o,e)?8:9;break;case 8:a.returnValue=s(o),a.state=-2;break;case 9:a.pushTry(19,null),a.state=22;break;case 22:return a.state=12,t.get(d,{params:{ids:e}});case 12:i=a.sent,a.state=14;break;case 14:r=i.data,a.state=16;break;case 16:a.popTry(),a.state=24;break;case 19:a.popTry(),a.maybeUncatchable(),f=a.storedException,a.state=17;break;case 17:a.returnValue=s(o),a.state=-2;break;case 24:return a.state=27,l(e,r);case 27:a.maybeThrow(),a.state=29;break;case 29:a.returnValue=s(r),a.state=-2;break;default:return a.end()}},a,this)}))}var d=e.API_URL+"/apps",p={},h="appRegistry:cache",g=6e4;return p.getApps=function(e){return f(e)},p.getAppInfo=function(e){return f([e]).then(function(e){return e.length?e[0]:n.reject()})},p}]),angular.module("castifyExt.connect.appPermissions",["w69b.chromeStorage","w69b.spawn"]).factory("appPermissions",["chromeStorage","spawn",function(e,t){function n(e){var t=Date.now();return e.filter(function(e){return e.timeout>=t})}function r(){return e.local.getSingle(o,[]).then(n)}function a(t){return e.local.setSingle(o,t)}var o="appPermissions",i=18e5,c={};return c.hasAccess=function(e,t){return r().then(function(n){return n.some(function(n){return n.appId===e&&n.fileId===t})})},c.allowAccess=function(e,n){return t($traceurRuntime.initGeneratorFunction(function o(){var t;return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:return o.state=2,r();case 2:t=o.sent,o.state=4;break;case 4:t=t.filter(function(t){return t.appId!==e&&t.appId!==n}),t.push({appId:e,fileId:n,timeout:Date.now()+i}),o.state=10;break;case 10:return o.state=6,a(t);case 6:o.maybeThrow(),o.state=-2;break;default:return o.end()}},o,this)}))},c}]),angular.module("castifyExt.connect.connectService",["castifyExt.simpleBgServiceConsumer"]).factory("connectService",["simpleBgServiceConsumer",function(e){return e("connect",["share"])}]),angular.module("castifyExt.licensing",["castifyExt.castifyAuth","w69b.chromeStorage","w69b.chromeRuntime","castifyExt.signInService","w69b.spawn","w69b.promiseTool","castifyExt.connect.connectedApps"]).factory("licensing",["castifyAuth","$http","chromeRuntime","chromeStorage","$q","$rootScope","$log","signInService","castifyConfig","promiseTool","spawn","connectedApps",function(e,t,n,r,a,o,i,c,u,s,l,f){function d(e){return c.getToken(e)}function p(){function e(){var e=window.chrome.identity,t=s.wrapChromeError(e.getAuthToken,e);return t({interactive:!1,scopes:["email","https://www.googleapis.com/auth/chromewebstore.readonly"]})}function o(){return l($traceurRuntime.initGeneratorFunction(function r(){var a,o,i,c,u;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:a=w+n.id,r.state=17;break;case 17:return r.state=2,e();case 2:o=r.sent,r.state=4;break;case 4:return r.state=6,t.get(a,{headers:{Authorization:"Bearer "+o}});case 6:i=r.sent,r.state=8;break;case 8:c=i.data,r.state=19;break;case 19:r.state=c.result&&c.createdTime?11:10;break;case 11:u=new Date(Number(c.createdTime)),r.state=12;break;case 12:r.returnValue=k>u,r.state=-2;break;case 10:r.returnValue=!1,r.state=-2;break;default:return r.end()}},r,this)}))}return C.isTester()?a.when(!0):r.sync.getSingle(A).then(function(e){return angular.isDefined(e)?e:a.reject()})["catch"](function(){return o().then(function(e){return r.sync.setSingle(A,e),e})})["catch"](function(){return!1})}function h(){return t.get(E+"/license",S).then(function(e){return e.data})}function g(){return f.getConnectedAppInfo().then(function(e){var t=Date.now(),n=e.some(function(e){return e.isPaidInstall&&(!e.userExpiryDate||e.userExpiryDate>=t)});return n?{access:"full",type:"app",maxAgeSecs:3600}:null})}function m(){return!$||v&&("tester"===v.access||"full"==v.access)}function y(e,t,n){n.isPaidInstall&&C.updateLicense()}function b(e,t,n){function r(e){return!e||e>=Date.now()}r(t)!=r(n)&&C.updateLicense()}var v,w="https://www.googleapis.com/chromewebstore/v1.1/userlicenses/",E=u.API_URL,k=1413892757176,S=c.AUTH_CONFIG,I="license",A="cws_license",T=600,$=!0,C={};return C.updateLicense=function(){function e(){return a.all([p(),h(),g()]).then(function(e){var t=e[0],n=e[1],r=e[2];return r&&"full"!==n.access?r:(t&&"full"!==n.access&&(n.access="tester",n.maxAgeSecs=3600),n)})}i.debug("updating, current state",C.hasLicense(),C.isPaid());var t=d().then(e,g).then(function(e){return e?(e.validTill=Date.now()+1e3*e.maxAgeSecs,r.sync.setSingle(I,e),i.debug("update completed for",e.user||e.type),e):a.reject("not_signed_in")});return t["catch"](function(e){i.debug("update failed",e),c.getEmail(!1).then(function(e){i.debug("update: chrome user is",e)})}),t},C.shouldLimitLength=function(){return!m()},C.shouldForceBranding=function(){return!(v&&!v.branding||m())},C.isPaid=function(){return!(!v||"full"!==v.access)},C.isTester=function(){return!(!v||"tester"!==v.access)},C.getMaxLength=function(){return m()?Number.POSITIVE_INFINITY:T},C.getVersionName=function(){var e=m()?"Full":"Free";if(v){var t=[v.access];v.type&&t.push(v.type),e+=" ("+t.join(" ")+")"}return e+" v"+n.getManifest().version},C.initialize=function(){return r.sync.getSingle(I).then(function(e){v=e,r.onChanged.addListener(function(e,t){"sync"==t&&e[I]&&(v=e[I].newValue,o.$$phase||o.$digest())}),n.getBackgroundPage(),o.$on("connect:appConnected",y),o.$on("connect:userExpiryDateChange",b)})},C.updateIfNeeded=function(){var e=v;(!e||!e.validTill||e.validTill<Date.now())&&C.updateLicense()},C.getToken=d,C.hasLicense=function(){return $&&!!v},C}]),angular.module("castifyExt.signInService",["castifyExt.castifyAuth"]).factory("signInService",["castifyAuth","chromeRuntime","$rootScope","$log","$http",function(e,t,n,r,a){var o=["https://www.googleapis.com/auth/plus.me","email"],i={googleAuth:!0,googleAuthScopes:o},c="https://www.googleapis.com/plus/v1/people/me",u={SCOPES:o,AUTH_CONFIG:i};return u.getToken=function(t,n){var r={interactive:!!t,scopes:o,validate:n};return e.getAuthToken(r)},u.signIn=function(t){var n={interactive:"select_account",scopes:o,validate:!0};t===!1&&(n.useChromeAccount=!1);var a=e.getAuthToken(n);return a["catch"](function(e){r.warn("Sign in failed",e)}),a},u.getMe=function(){return a.get(c,i).then(function(e){return e.data})},u.getEmail=function(t){return t!==!1?u.getToken(!1).then(e.getChromeAccount):e.getChromeAccount()},u}]),angular.module("castifyExt.helpCenter",["w69b.chromeTabs"]).factory("helpCenter",["chromeTabs",function(e){var t={};return t.tagUrls={},t.registerUrl=function(e,n){t.tagUrls[e]=n},t.hasHelpFor=function(e){return t.tagUrls.hasOwnProperty(e)},t.openHelp=function(n){var r=t.tagUrls[n];if(!r)throw new Error("No help url registered for "+n);e.create({url:r})},t.setNotifyHelp=function(e,n){e.onButtonClicked=e.onClicked=function(){t.openHelp(n),e.clear()}},t}]),angular.module("castifyExt.helpCenterConfig",["castifyExt.helpCenter"]).run(["helpCenter",function(e){e.registerUrl("load_nacl","https://screencastify.uservoice.com/knowledgebase/articles/507908"),e.registerUrl("disk_space","https://screencastify.uservoice.com/knowledgebase/articles/507914"),e.registerUrl("drive_apps","https://screencastify.uservoice.com/knowledgebase/articles/460525"),e.registerUrl("start_recording","https://screencastify.uservoice.com/knowledgebase/articles/448826"),e.registerUrl("change_account","https://screencastify.uservoice.com/knowledgebase/articles/555387"),e.registerUrl("quotaExceeded","https://screencastify.uservoice.com/knowledgebase/articles/870177"),e.registerUrl("youtubeSignupRequired","https://screencastify.uservoice.com/knowledgebase/articles/780183")}]),angular.module("castifyExt.commonConfig",["castifyExt.castifyAuth","w69b.chromeAnalytics","w69b.chromeRuntime","castifyExt.licensing","castifyExt.helpCenterConfig","castifyExt.appOptions"]).config(["$compileProvider","$sceDelegateProvider","analyticsProvider",function(e,t,n){n.setTrackingId("UA-23874345-14"),n.setApp("Screencastify"),t.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**","https://**"]);var r=/^\s*(https?|mailto|blob|chrome-extension|filesystem:chrome-extension):/;e.aHrefSanitizationWhitelist(r),e.imgSrcSanitizationWhitelist(r)}]).run(["$rootScope","analytics","chromeRuntime","licensing","$location","appOptions","$injector",function(e,t,n,r,a,o,i){var c=i.has("$route")?i.get("$route"):null;if(c){var u;e.$on("$viewContentLoaded",function(){var e=a.path();t.tracker.sendAppView(c.current.pageTitle||e),u=e})}e.$watch(function(){return r.hasLicense()?r.isPaid()?"paid":r.isTester()?"tester":"trial":"unknown"},function(e){t.tracker.set("dimension1",e)}),o.loadedPromise.then(function(){t.setEnabled(o.values.enableAnalytics)})}]).value("castifyConfig",{API_URL:"https://www.screencastify.com/api",IS_E2E:window.localStorage.e2e}),angular.module("castifyExt.authConfig",["castifyExt.youtubeAuth","castifyExt.castifyAuth","w69b.chromeRuntime","w69b.googleHttpAuthInterceptor","castifyExt.youtubeAuth"]).config(["$httpProvider","youtubeAuthProvider","googleHttpAuthInterceptorProvider",function(e,t,n){var r="242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com";t.setClientId(r),e.interceptors.push("youtubeHttpAuthInterceptor"),e.interceptors.push("googleHttpAuthInterceptor"),n.enableAuthAutoRetry(!0),n.setAuthProvider("castifyAuth")}]),angular.module("castifyExt.appOptions",["w69b.chromeStorage","castifyExt.enterprisePolicy"]).factory("appOptions",["chromeStorage","$rootScope","$q","enterprisePolicy",function(e,t,n,r){var a={notifyAudio:!0,notifyFramerate:!1,notifyTabFocus:!0,uploadPrivacy:"public",autoOpen:!0,autoPlay:!0,driveSync:!1,enableDiskSpaceWatcher:!0,notifySyncProgress:!0,notifyEditProgress:!0,enableAnalytics:!0,enableCrashReports:!1,showDrawingToolsHint:!0,showEditToolsHint:!0,encoder:null,audioCodec:null},o={micGain:1,micAudioProcessing:!0},i=!1,c={},u=angular.copy(a);return c.localValues=angular.copy(o),c.loadedPromise=n.all({sync:e.sync.getSingle("options"),local:e.local.getSingle("options"),managed:r.loadedPromise}).then(function(e){angular.extend(u,e.sync),angular.extend(c.localValues,e.local),i=!0}),c.values={},Object.keys(a).forEach(function(e){Object.defineProperty(c.values,e,{enumerable:!0,get:function(){return r.has(e)?r.get(e):u[e]},set:function(t){u[e]=t}})}),c.save=function(){return e.sync.setSingle("options",u)},c.saveLocal=function(){return e.local.setSingle("options",c.localValues)},c.isLoaded=function(){return i},c.isSetByEnterprisePolicy=function(e){return r.has(e)},e.onChanged.addListener(function(e,n){"sync"==n&&e.options&&(angular.extend(u,e.options.newValue),t.$$phase||t.$digest()),"local"==n&&e.options&&(angular.extend(c.localValues,e.options.newValue),t.$$phase||t.$digest())}),c}]),angular.module("castifyExt.oauthTokenCache",["w69b.chromeStorage"]).factory("oauthTokenCache",["chromeStorage","$q",function(e,t){function n(n){function r(){return e.local.getSingle(n).then(function(e){return e||{}})}function a(e){var t=o();angular.forEach(e,function(n,r){(!r.expiresAt||r.expiresAt<=t)&&delete e[n]})}function o(){return Math.floor(Date.now()-i)+12e4}var i=0,c={};return c.get=function(e){return r().then(function(n){var r=n[e];return r&&r.expiresAt>o()?t.when(r):t.reject();
})},c.put=function(t,o){return r().then(function(r){return r[t]=o,o.issuedAt&&(i=Date.now()-Number(o.issuedAt)),a(r),e.local.setSingle(n,r)})},c.removeByToken=function(t){return r().then(function(r){return angular.forEach(r,function(e,n){e.accessToken===t&&delete r[n]}),e.local.setSingle(n,r)})},c.remove=function(t){return r().then(function(r){return delete r[t],e.local.setSingle(n,r)})},c.withCache=function(e,t){return c.get(e)["catch"](function(){return t().then(function(t){return c.put(e,t).then(function(){return t})})})},c}return n}]),angular.module("castifyExt.enterprisePolicy",["w69b.chromeStorage"]).provider("enterprisePolicy",function(){var e={};this.setOverride=function(t){e=t},this.$get=["chromeStorage","$rootScope",function(t,n){var r={},a=!1,o={};angular.extend(o,e);var i=["disableSharing","disableSaveToDisk","options"];return i.forEach(function(e){Object.defineProperty(r,e,{get:function(){return o[e]}})}),r.loadedPromise=t.managed.get(i).then(function(t){angular.extend(o,t,e),a=!0}),r.isLoaded=function(){return a},r.has=function(e){return o.hasOwnProperty(e)},r.get=function(e){return o[e]},t.onChanged.addListener(function(e,t){"managed"===t&&(angular.forEach(e,function(e,t){o[t]=e.newValue}),n.$$phase||n.$digest())}),r}]}),angular.module("castifyExt.castifyAuth",["castifyExt.simpleBgServiceConsumer"]).factory("castifyAuth",["simpleBgServiceConsumer",function(e){return e("castifyAuth",["launchWebAuthFlow","getRedirectURL","removeCachedAuthToken","getAuthToken","getChromeAccount"])}]).factory("googleauth",["castifyAuth","$q",function(e,t){var n={};return n.loadClient=function(){return t.when()},n.getAuthToken=function(t){e.getAuthToken(angular.isObject(t)?t:{interactive:!!t})},n}]),angular.module("castifyExt.simpleBgServiceConsumer",["w69b.chromeRuntime"]).factory("simpleBgServiceConsumer",["chromeRuntime","$q",function(e,t){function n(n,r){function a(e){return e.error?t.reject(e.error):e.data}function o(t){return function(){return e.sendMessage({type:"simpleService",fn:t,service:n,data:Array.prototype.concat.apply([],arguments)}).then(a)}}var i={};return r.forEach(function(e){i[e]=o(e)}),i}return n}]),angular.module("castifyExt.backgroundTool",["w69b.chromeRuntime"]).factory("backgroundTool",["chromeRuntime","$q","$log","$rootScope",function(e,t,n,r){function a(){var n=t.defer();return e.onMessage.addListener(function r(t){"bg:loaded"===t&&(e.onMessage.removeListener(r),n.resolve())}),e.sendMessage("bg:load"),n.promise}var o,i={};return i.portHelper=function(n,o){var i,c={};return c.getPort=function(){var r=o===!1?t.when():a();return r.then(function(){return i||(i=e.connect({name:n})),i})},c.postMessage=function(e,t){return c.getPort().then(function(n){return n.postMessage({type:e,data:t})})},c.installHandlers=function(e){function t(t){e.hasOwnProperty(t.type)&&e[t.type](t.data),r.$$phase||r.$apply()}function n(){c.getPort().then(function(e){e.onMessage.removeListener(t)})}return c.getPort().then(function(e){e.onMessage.addListener(t)}),n},c},i.loadBackground=function(){return o||(o=a()),o},i}]),angular.module("castifyExt.fileDbClient",["castifyExt.backgroundTool","castifyExt.appOptions","castifyExt.castifyAuth"]).factory("fileDbClient",["backgroundTool","$q","appOptions","castifyAuth","$log",function(e,t,n,r,a){function o(){return p||(p=t.defer(),l.postMessage("subscribe")),p.promise}function i(e){angular.extend(this,e),this.createdAt&&(this.createdAt=new Date(this.createdAt))}function c(e){var t=f[e.id];return t?(angular.copy(e,t),t):(f[e.id]=e,e)}function u(e){var t=f[e];t&&(t.deleted=!0,delete f[e])}function s(e,t){var n;t&&(n={},angular.forEach(f,function(e,t){n[t]=!0})),angular.forEach(e,function(e,r){c(new i(e)),t&&delete n[r]}),t&&angular.forEach(n,function(e,t){u(t)})}var l=e.portHelper("files",!1),f={},d={},p=null,h=!1,g={},m=0,y=i.prototype;y.getUrl=function(){var e=this;return e.urlRequiresAccessToken?r.getAuthToken({interactive:!1}).then(function(t){var n=e.url;return n+=n.indexOf("?")>=0?"&":"?",n+"access_token="+t}):t.when(e.url)};var b={};return b.filesUpdate=function(e){e.remove&&e.remove.forEach(u),e.add&&s(e.add,!1),e.full?(s(e.full,!0),!h&&p&&(h=!0,p.resolve())):e.error&&(h=!1,p&&(p.reject(),p=null)),m++},b.reloadSuccess=function(e){g[e]&&(g[e].resolve(),delete g[e])},b.reloadError=function(e){g[e]&&(g[e].reject(),delete g[e])},l.installHandlers(b),d.getFileDescriptor=function(e){return o().then(function(){var n=f[e];return n?n:t.reject()})},d.listFiles=function(){return o().then(function(){return f})},d.rename=function(e,t){var n=f[e];n&&(n.title=t),l.postMessage("rename",{id:e,title:t})},d.reload=function(e){return g[e]||(g[e]=t.defer(),l.postMessage("reload",e)),g[e].promise},d.remove=function(e){a.debug("fileDbClient.remove",e),u(e),l.postMessage("remove",e)},d.removeAll=function(e){a.debug("fileDbClient.removeAll"),angular.copy({},f),l.postMessage("removeAll",e)},d.isSyncEnabled=function(){return n.values.driveSync},d.getListVersionId=function(){return m},d}]),angular.module("castifyExt.localFileDb",["w69b.chromeStorage","w69b.filesHelper","w69b.chromeRuntime","castifyExt.chromeEventPublisher"]).factory("localFileDb",["$rootScope","chromeStorage","$q","filesHelper",function(e,t,n,r){function a(e){return l+e}function o(e){var t=a(e),n=s.getSingle(t).then(function(e){return e=i(e)});return n}function i(e){return e||(e={}),e.title||(e.title="Untitled Screencast"),e}function c(e){angular.extend(this,e)}var u={},s=t.local,l="filedb_",f=c.prototype;return c.createFromIdOrFileEntry=function(e){var t,a,i=angular.isString(e)?r.getFileEntryByPath(u.idToFilename(e)):n.when(e);return i.then(function(e){return t=e,a=u.filenameToId(e.name),n.all({metadata:r.getMetadata(t),info:o(a)}).then(function(e){var n=t.toURL(),r={id:a,uuid:a,url:n,createdAt:e.metadata.modificationTime,title:e.info.title,size:e.metadata.size};if(e.info.videoInfo){var o=e.info.videoInfo;angular.extend(r,{duration:o.duration,width:o.size.width,height:o.size.height})}if(e.info.previewImages&&(r.thumbnailUrl=e.info.previewImages[0].url),e.info.driveInfo&&(r.driveInfo=e.info.driveInfo),e.info.youtubeInfo){var i=e.info.youtubeInfo;r.youtubeInfo={id:i.id,channelId:i.channelId}}return e.info.autoShare&&(r.autoShare=e.info.autoShare),new c(r)})})},f.rename=function(e){return u.updateInfo(this.id,{title:e})},f.remove=function(){var e=this.id;return n.all({result:r.removeByPath(u.idToFilename(e)),info:o(e)}).then(function(e){return e.info.previewImages?n.all(e.info.previewImages.map(function(e){return r.removeByPath(e.path)})):void 0}).then(function(){return s.remove(a(e))})},f.updateYoutubeInfo=function(e){return u.updateInfo(this.id,{youtubeInfo:e})},u.listFiles=function(){return r.listByPath("/").then(function(e){var t=[];return e.forEach(function(e){e.isFile&&"."!==e.name[0]&&t.push(c.createFromIdOrFileEntry(e))}),n.all(t).then(function(e){var t={};return e.forEach(function(e){t[e.id]=e}),t})})},u.filenameToId=function(e){if(/\.webm/i.test(e))return e.slice(0,-5);throw new Error("invalid filename: "+e)},u.idToFilename=function(e){return e+".webm"},u.getFileDescriptor=function(e){return c.createFromIdOrFileEntry(e)},u.updateInfo=function(e,t,r){var o,i=a(e);return o=r?n.when(t):s.get(i).then(function(e){return angular.extend(e[i]||{},t)}),o.then(function(e){var t={};return t[i]=e,s.set(t),e})},u}]),angular.module("castifyExt.ConnectApp",["castifyExt.commonConfig","castifyExt.connect.connectFrame"]).run(["connectFrame",function(e){e.install()}])}();