"use strict";!function(){window.angular&&angular.module("w69b.es6",[]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,i=arguments[1],o=0;r>o;o++)if(t=n[o],e.call(i,t,o,n))return t}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===this||null===this)throw new TypeError("Cannot convert this value to object");var t=Object(this),n=parseInt(t.length,10)||0;if(0===n)return!1;var r=parseInt(arguments[1],10)||0;if(r>=n)return!1;var i;for(r>=0?i=r:(i=n+r,0>i&&(i=0));n>i;){var o=t[i];if(e===o||e!==e&&o!==o)return!0;i++}return!1}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length),t-=e.length;var r=n.indexOf(e,t);return-1!==r&&r===t}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}),angular.module("castifyExt.App",["ngRoute","ngAnimate","castifyExt.commonConfig","castifyExt.ui.options","castifyExt.ui.support","w69b.ui.pageTitle","w69b.chromePersistentLogger","w69b.ui.locationChange","castifyExt.ui.fileList","castifyExt.ui.fileDetail","castifyExt.ui.topnav","castifyExt.ui.sidenav","castifyExt.licensing","castifyExt.ui.about","castifyExt.ui.searchHelp","castifyExt.userInfo","castifyExt.ui.syncSetup","castifyExt.ui.syncAuthErrorRedirector","castifyExt.ui.welcome","castifyExt.authConfig","castifyExt.ui.fileEdit","castifyExt.ui.connectedApps","castifyExt.ui.themeConfig","ngMaterial"]).config(["$routeProvider",function(e){e.when("/options",{templateUrl:"components/castifyExt/ui/options/options.html",controller:"OptionsCtrl",pageTitle:"Options"}).when("/files",{templateUrl:"components/castifyExt/ui/file-list/files-list.html",controller:"FileListCtrl",pageTitle:"Your Screencasts"}).when("/files/:fileId",{templateUrl:"components/castifyExt/ui/file-detail/file-detail.html",controller:"FileDetailCtrl",pageTitle:"View Recording"}).when("/edit/:fileId",{templateUrl:"components/castifyExt/ui/file-edit/file-edit.html",controller:"FileEditCtrl",pageTitle:"Edit Recording"}).when("/support",{templateUrl:"components/castifyExt/ui/support/support.html",controller:"SupportCtrl",pageTitle:"Report a Bug"}).when("/credits",{templateUrl:"components/castifyExt/ui/about/credits.html",pageTitle:"Credits"}).when("/about",{templateUrl:"components/castifyExt/ui/about/about.html",pageTitle:"About"}).when("/welcome",{templateUrl:"components/castifyExt/ui/welcome/welcome.html",controller:"WelcomeCtrl",showTopNav:!1,pageTitle:"Welcome"}).when("/getting-started",{templateUrl:"components/castifyExt/ui/getting-started/getting-started.html",pageTitle:"Getting Started",showTopNav:!1}).when("/sync-setup",{templateUrl:"components/castifyExt/ui/sync-setup/sync-setup-view.html",controller:"DriveSyncSetupCtrl",pageTitle:"Google Drive Setup"}).when("/connected-apps",{templateUrl:"components/castifyExt/ui/connected-apps/connected-apps.html",controller:"ConnectedAppsCtrl",pageTitle:"Connected Apps"}).when("/update-notice",{templateUrl:"components/castifyExt/ui/update-notice/update-notice.html",pageTitle:"Screencastify has been updated"}).when("/e2e-signin",{template:'<span id="sign-in-state">{{state}}</span>',controller:["signInService","$scope",function(e,t){t.state="not_signed_in",e.signIn(!1).then(function(){t.state="signed_in"})}]}).otherwise({redirectTo:"/files"})}]).config(["chromePersistentLoggerProvider","$locationProvider",function(e,t){t.html5Mode(!1),e.setStorageKey("app"),e.enableGlobalHandler(!0),e.install()}]).run(["licensing","userInfo","chromeTabs",function(e,t,n){e.initialize(),t.initialize(),n.setZoom(1),n.setZoomSettings({mode:"disabled"})}]),angular.module("castifyExt.ui.micLevel",["w69b.webrtc","castifyExt.audioContextPool","castifyExt.appOptions","w69b.throttle","castifyExt.appOptions"]).factory("micLevelFactory",["webrtc","audioContextPool","$rootScope","appOptions","$q",function(e,t,n,r,i){function o(){function o(e){return function(){var t=arguments,n=i.defer();return(m||i.when())["finally"](function(){var r=e.apply(null,t);n.resolve(r)}),m=n.promise,m["finally"](function(){m=null}),n.promise}}function a(){var e=v.analyser;e&&(d||(d=new Uint8Array(e.frequencyBinCount)),e.getByteFrequencyData(d),b=-1)}function c(){b=Math.max.apply(null,d)/255}function u(e){if(g)throw Error();p=e,g=t.acquire();var n=g,r=n.createMediaStreamSource(e),i=n.createAnalyser(),o=n.createGain();o.gain.value=E,i.smoothingTimeConstant=.3,i.fftSize=32,i.minDecibels=-70,i.maxDecibels=-10;var c=n.createScriptProcessor(2048,2,1);c.onaudioprocess=a,r.connect(o),o.connect(i),i.connect(c),c.connect(n.destination),v.input=r,v.analyser=i,v.capture=c,v.gain=o}function s(){var t={echoCancellation:r.localValues.micAudioProcessing};return h&&(t.sourceId=h),e.getUserMedia({audio:{mandatory:t},video:!1})}function l(){p&&p.getTracks().forEach(function(e){e.stop()}),p=null}function f(e){E=e,v.gain&&(v.gain.gain.value=e)}var d,p,h,g,m,y={},v={},b=0,w=0,E=1,k=angular.noop;return y.start=o(function(){var e=null;return w||(k=n.$watch(function(){return r.localValues.micGain},f),e=s().then(u)),++w,e}),y.setSourceId=o(function(e){return h=e,l(),v.input?s().then(function(e){v.input.disconnect(),v.input=g.createMediaStreamSource(e),v.input.connect(v.gain)}):void 0}),y.stop=o(function(){w&&!--w&&(angular.forEach(v,function(e){e.disconnect()}),v={},l(),b=0,t.release(g),g=null,k())}),y.getVolume=function(){return 0>b&&c(),b},y}return o}]).directive("cfMicLevel",["micLevelFactory","$window","$timeout",function(e,t,n){function r(){var e=Object.create(HTMLCanvasElement.prototype);e.attachedCallback=function(){this.dispatchEvent(new Event("attached"))},e.detachedCallback=function(){this.dispatchEvent(new Event("detached"))},document.registerElement("cf-mic-canvas",{prototype:e,"extends":"canvas"})}function i(t){if(o.has(t))return o.get(t);var n=e();return n.setSourceId(t),o.set(t,n),n}r();var o=new Map;return{restrict:"E",replace:!0,scope:{sourceId:"=?"},template:'<canvas class="cf-mic-level" is="cf-mic-canvas"></canvas>',link:function(e,r,o){function a(){d.clearRect(0,0,f.width,f.height),p?d.fillRect(0,0,Math.round(l.getVolume()*f.width),f.height):d.fillRect(0,f.height,f.width,-Math.round(l.getVolume()*f.height)),s=t.requestAnimationFrame(a)}function c(){g||(g=!0,l.start(),s=t.requestAnimationFrame(a))}function u(){g&&(g=!1,t.cancelAnimationFrame(s),l.stop())}var s,l=i(e.sourceId),f=r[0],d=f.getContext("2d"),p="horizontal"===o.orientation,h=!1,g=!1;n(function(){h||c()},0),r.bind("attached",function(){h=!1,c()}),r.bind("detached",function(){h=!0,u()});var m;m=p?d.createLinearGradient(0,0,f.width,0):d.createLinearGradient(0,f.height,0,0),m.addColorStop(0,"#0f0"),m.addColorStop(.7,"#ff0"),m.addColorStop(1,"#f00"),d.fillStyle=m,r.bind("$destroy",u),e.$watch("sourceId",function(e,t){if(e!==t){console.log("using new id",e);var n=g;u(),l=i(e),n&&c()}})}}}]).directive("cfMicLevelSlider",["appOptions","throttle","$window",function(e,t,n){return{restrict:"E",replace:!0,scope:{},templateUrl:"components/castifyExt/ui/mic-level/mic-level-slider.html",link:function(r){function i(){o.flush()}var o=t(e.saveLocal.bind(e),1e3),a=angular.element(n);r.$watch("micGainRange",function(t){t&&(t=Math.exp(Number(t)),e.localValues.micGain=t,o())}),e.loadedPromise.then(function(){var t=e.localValues.micGain;t=Math.log(t),r.micGainRange=t}),a.bind("unload",i),r.$on("$destroy",function(){a.unbind("unload",i),i()})}}}]),angular.module("castifyExt.appOptions",["w69b.chromeStorage","castifyExt.enterprisePolicy"]).factory("appOptions",["chromeStorage","$rootScope","$q","enterprisePolicy",function(e,t,n,r){var i={notifyAudio:!0,notifyFramerate:!1,notifyTabFocus:!0,uploadPrivacy:"public",autoOpen:!0,autoPlay:!0,driveSync:!1,enableDiskSpaceWatcher:!0,notifySyncProgress:!0,notifyEditProgress:!0,enableAnalytics:!0,enableCrashReports:!1,showDrawingToolsHint:!0,showEditToolsHint:!0,encoder:null,audioCodec:null},o={micGain:1,micAudioProcessing:!0},a=!1,c={},u=angular.copy(i);return c.localValues=angular.copy(o),c.loadedPromise=n.all({sync:e.sync.getSingle("options"),local:e.local.getSingle("options"),managed:r.loadedPromise}).then(function(e){angular.extend(u,e.sync),angular.extend(c.localValues,e.local),a=!0}),c.values={},Object.keys(i).forEach(function(e){Object.defineProperty(c.values,e,{enumerable:!0,get:function(){return r.has(e)?r.get(e):u[e]},set:function(t){u[e]=t}})}),c.save=function(){return e.sync.setSingle("options",u)},c.saveLocal=function(){return e.local.setSingle("options",c.localValues)},c.isLoaded=function(){return a},c.isSetByEnterprisePolicy=function(e){return r.has(e)},e.onChanged.addListener(function(e,n){"sync"==n&&e.options&&(angular.extend(u,e.options.newValue),t.$$phase||t.$digest()),"local"==n&&e.options&&(angular.extend(c.localValues,e.options.newValue),t.$$phase||t.$digest())}),c}]),angular.module("castifyExt.backgroundTool",["w69b.chromeRuntime"]).factory("backgroundTool",["chromeRuntime","$q","$log","$rootScope",function(e,t,n,r){function i(){var n=t.defer();return e.onMessage.addListener(function r(t){"bg:loaded"===t&&(e.onMessage.removeListener(r),n.resolve())}),e.sendMessage("bg:load"),n.promise}var o,a={};return a.portHelper=function(n,o){var a,c={};return c.getPort=function(){var r=o===!1?t.when():i();return r.then(function(){return a||(a=e.connect({name:n})),a})},c.postMessage=function(e,t){return c.getPort().then(function(n){return n.postMessage({type:e,data:t})})},c.installHandlers=function(e){function t(t){e.hasOwnProperty(t.type)&&e[t.type](t.data),r.$$phase||r.$apply()}function n(){c.getPort().then(function(e){e.onMessage.removeListener(t)})}return c.getPort().then(function(e){e.onMessage.addListener(t)}),n},c},a.loadBackground=function(){return o||(o=i()),o},a}]),angular.module("castifyExt.audioContextPool",[]).factory("audioContextPool",["$window",function(e){var t=[],n={};return n.acquire=function(){return t.length?t.pop():new e.AudioContext},n.release=function(e){t.push(e)},n}]),angular.module("castifyExt.setupService",["castifyExt.appOptions","w69b.webrtc","w69b.chromeStorage","w69b.spawn"]).factory("setupService",["webrtc","spawn","chromeStorage","$q","appOptions","$log",function(e,t,n,r,i,o){function a(){return t($traceurRuntime.initGeneratorFunction(function e(){var t,r,o,a,c;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=n.sync.getSingle(s,!1),e.state=19;break;case 19:return e.state=2,i.loadedPromise;case 2:e.maybeThrow(),e.state=4;break;case 4:r=i.isSetByEnterprisePolicy,o=r.call(i,"driveSync"),e.state=15;break;case 15:e.state=o?11:5;break;case 11:c=o,e.state=12;break;case 5:return e.state=6,t;case 6:a=e.sent,e.state=8;break;case 8:c=a,e.state=12;break;case 12:e.returnValue=c,e.state=-2;break;default:return e.end()}},e,this)}))}function c(){return t($traceurRuntime.initGeneratorFunction(function n(){var t,r,i,o,a,c,u,s;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:t=e.hasVideoAccess(),r=e.hasMicrophone(),i=e.hasAudioAccess(),n.state=26;break;case 26:return n.state=2,t;case 2:o=n.sent,n.state=4;break;case 4:n.state=o?20:5;break;case 20:s=o,n.state=21;break;case 5:return n.state=6,r;case 6:a=n.sent,n.state=8;break;case 8:n.state=a?9:15;break;case 15:u=!a,n.state=16;break;case 9:return n.state=10,i;case 10:c=n.sent,n.state=12;break;case 12:u=c,n.state=16;break;case 16:s=u,n.state=21;break;case 21:n.returnValue=s,n.state=-2;break;default:return n.end()}},n,this)}))}var u={},s="setupService:storageDecided";return u.setStorageDecided=function(e){return n.sync.setSingle(s,e)},u.getSetupState=function(){return t($traceurRuntime.initGeneratorFunction(function e(){var t,n,r,i,o;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=c(),e.state=10;break;case 10:return e.state=2,t;case 2:n=e.sent,e.state=4;break;case 4:r=a(),e.state=12;break;case 12:return e.state=6,r;case 6:i=e.sent,e.state=8;break;case 8:o={cam:n,storage:i},e.state=14;break;case 14:e.returnValue=o,e.state=-2;break;default:return e.end()}},e,this)}))},u.isComplete=function(){return t($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:return e.state=2,u.getSetupState();case 2:t=e.sent,e.state=4;break;case 4:o.debug("setupService.isComplete state",t),e.state=8;break;case 8:e.returnValue=t.cam&&t.storage,e.state=-2;break;default:return e.end()}},e,this)}))},u}]),angular.module("castifyExt.ui.support",["w69b.chromePersistentLogger","w69b.chromeRuntime","castifyExt.licensing","castifyExt.signInService","w69b.chromeSystem","w69b.chromeTabs","ngMaterial"]).factory("supportApiService",["$http","castifyConfig",function(e,t){function n(e){var t=e.data.articles||[];return t=t.slice(0,u),t.map(function(e){var t=e.text.replace(/&nbsp;/gi," ");return t.length>c&&(t=t.substr(0,c-3)+"..."),{title:e.title,text:t,externalLink:e.url}})}var r={},i=t.API_URL+"/support/search",o=t.API_URL+"/support/tickets",a={oauth_consumer_key:"1Yb6N1ZB261nNDA1sVuBtA"},c=100,u=5;return r.queryArticles=function(t){return e.get(i,{params:angular.extend({query:t},a)}).then(n)},r.createTicket=function(t){return e.post(o,t,{params:a})},r}]).controller("SupportCtrl",["$scope",function(e){e.category=null;var t={key:"bug",title:"Nothing of the above?",icon:"bug_report",text:"Report a Bug"};e.rootItem={items:[{key:"bug",title:"Report a Bug",text:"Something is not working as expected and you believe it to be broken.",icon:"bug_report",items:[{title:"Audio issues",text:"Issues related to recording audio.",query:"microphone sound audio",buttonItem:t},{title:"Recording does not work",text:"Issues related to recording.",query:"recording",buttonItem:t},{title:"Uploading to Drive or Youtube",text:"You are experiencing troubles uploading a recording.",query:"upload",buttonItem:t}]},{title:"Suggest a new feature",text:"You have an idea how Screencastify can be improved.",icon:"forum",externalLink:"https://screencastify.uservoice.com/"},{key:"contact",title:"Contact Us",text:"You want to talk to us about something else.",icon:"mail"}]},e.reset=function(){e.category=null}}]).controller("SupportMessageCtrl",["$scope","chromePersistentLogger","chromeRuntime","supportApiService","$q","licensing","signInService","$mdToast","chromeSystem",function(e,t,n,r,i,o,a,c,u){function s(){return t.getMergedLogs(["popup","background","app"])}function l(){return n.sendMessage(null,"bg:flushLogs",{}).then(s,s).then(function(e){return e.join("\n")})}function f(){return i.all({platform:n.getPlatformInfo(),ua:window.navigator.userAgent,cpu:u.cpu.getInfo(),memory:u.memory.getInfo()}).then(function(e){return JSON.stringify(e,null,4)})}function d(){return null}function p(){var t=i.all({email:a.getEmail()["catch"](d),logs:l()["catch"](d),version:o.getVersionName(),system:f()["catch"](d)}).then(function(t){y=t,e.logs=t.logs,e.email=t.email});g(t),e.instantAnswer=null,e.submitted=!1,e.$watch("category",function(t){"bug"===t?(e.messageLabel="Describe the issue",e.attachLogs=!0,e.introText="Please describe what went wrong as precisely as possible."):(e.introText="",e.messageLabel="Your Message",e.attachLogs=!0)})}function h(e,t){return{name:e,data:btoa(unescape(encodeURIComponent(t))),content_type:"text/plain"}}function g(t){e.loading=!0,t["finally"](function(){e.loading=!1})}function m(){var t="Support Request [Tool]";"bug"===e.category&&(t="Bug Report [Tool]");var n={email:e.email,ticket:{subject:t,message:e.message,custom_field_values:{version:y.version}}},i=[];return i.push(h("system",y.system)),e.attachLogs&&i.push(h("logs",e.logs)),n.ticket.attachments=i,r.createTicket(n).then(function(){e.submitted=!0})["catch"](function(){c.show(c.simple().content("Oops, we could not send your message."))})}var y,v={key:"confirm",title:"Nothing of the above helpful?",icon:"mail",text:"No, send my message"};e.confirm=function(){e.instantAnswer=null,g(m())},e.submit=function(){if("contact"==e.category){var t=r.queryArticles(e.message).then(function(t){return t.length?void(e.instantAnswer={items:t,buttonItem:v}):m()},m);g(t)}else e.confirm()},e.back=function(){e.instantAnswer?e.instantAnswer=null:e.cfBack()},p()}]).directive("cfSupportMessage",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/support/support-message.html",scope:{category:"=",cfBack:"&"},controller:"SupportMessageCtrl"}}).controller("SupportCategoryCtrl",["$scope","chromeTabs","supportApiService",function(e,t,n){function r(e){/https?:\/\//.test(e)&&t.create({url:e})}function i(t){e.loading=!0,t["finally"](function(){e.loading=!1})}function o(t){e.items=t}e.items=null,e.category=null;var a=[];e.canGoBack=function(){return a.length>1},e.back=function(){a.pop();var t=a[a.length-1];e.items=t.items,e.buttonItem=t.buttonItem},e.select=function(t){if(t.externalLink)r(t.externalLink);else if(t.items)a.push(t),e.buttonItem=t.buttonItem,e.items=t.items;else if(t.query){a.push(t),e.buttonItem=t.buttonItem;var c=n.queryArticles(t.query).then(o);i(c)}else e.cfCategorySelected({key:t.key})},e.$watch("item",function(t){t&&e.select(t)})}]).directive("cfSupportCategory",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/support/support-category.html",scope:{cfCategorySelected:"&",item:"="},controller:"SupportCategoryCtrl"}}),angular.module("castifyExt.ui.fileList",["ngMaterial","w69b.chromeAnalytics","w69b.ui.bgImg","w69b.ui.focus","w69b.ui.bytesFilter","castifyExt.fileDbClient","castifyExt.ui.fileActions","castifyExt.ui.editableText","castifyExt.fileDbClient","castifyExt.ui.fileSyncInfo","castifyExt.ui.syncInfo","castifyExt.ui.editJobsInfo"]).controller("FileListCtrl",["$scope","fileDbClient","$mdDialog","$location","$mdToast",function(e,t,n,r,i){e.loading=!0,t.listFiles().then(function(t){e.$watchCollection(function(){return t},function(){var n=e.files||[];n.length=0,angular.forEach(t,function(e){e.autoShare||n.push(e)}),e.files=n})},function(){i.show(i.simple({hideDelay:0}).content("Failed to load files, please try to reload the page!"))})["finally"](function(){e.loading=!1}),e.showDetail=function(e){r.path("/files/"+e.id)},e.removeAll=function(){var e;e=t.isSyncEnabled()?"Deleting will remove all Screencasts from your device and also from your Drive account.":"Deleting will remove all Screencasts from your device. This cannot be undone.",n.show(n.confirm().title("Delete all Screencasts?").content(e).cancel("Cancel").ok("Delete All")).then(function(){t.removeAll()})}}]),angular.module("castifyExt.ui.fileDetail",["castifyExt.fileDbClient","castifyExt.ui.fileActions","castifyExt.ui.share","castifyExt.ui.pixelResolution","w69b.timeutil","castifyExt.ui.editableText","w69b.ui.focus","castifyExt.ui.uploadInfo","castifyExt.ui.fileSyncInfo","castifyExt.ui.videoPlayer","castifyExt.ui.share.shareUtils","castifyExt.ui.classroomShare","castifyExt.enterprisePolicy","castifyExt.ui.connectShareProgress"]).controller("FileDetailCtrl",["$scope","$routeParams","fileDbClient","$location","$mdDialog","enterprisePolicy","$window","$mdToast","$mdSidenav","shareUtils","$log",function(e,t,n,r,i,o,a,c,u,s,l){function f(){var t=[],n=e.file;n&&(n.youtubeInfo&&t.push({target:"youtube",title:"Youtube",icon:"youtube",link:s.getLink(n,"youtube"),linkShare:!!n.youtubeInfo.channelId}),n.driveInfo&&t.push({target:"drive",title:"Google Drive",icon:"drive",link:s.getLink(n,"drive"),linkShare:!0})),e.sharedItems=t}e.enterprisePolicy=o,e.file=null,e.item={isRenaming:!1};var d=!1;e.openShared=function(e){a.open(e.link)},e.copyShareLink=function(t){d||(d=!0,c.show(c.simple({hideDelay:0,position:"top right"}).content("Enabling link sharing...")),s.enableLinkSharing(e.file,{target:t.target}).then(function(){s.copyLink(t.link,{position:"top right"})})["catch"](function(e){l.warn("enableLinkSharing failed:",e),c.show(c.simple({position:"top right"}).content("Failed to enable link sharing, try the share button instead."))})["finally"](function(){d=!1}))},e.showInfo=function(){u("info").open()},n.getFileDescriptor(t.fileId).then(function(t){e.file=t,e.$root.pageTitle=t.title})["catch"](function(){r.path("/files")}),e.showShareDialog=function(t){var n=e.$new(!0);n.file=e.file;var r=i.show({targetEvent:t,scope:n,templateUrl:"components/castifyExt/ui/share/share-dialog.html",controller:"ShareDialogCtrl"});r.then(function(){e.showInfo()})},e.$watch("file.deleted",function(e){e&&r.path("/files")}),e.editTitle=function(t){t.preventDefault(),e.item.isRenaming=!0},e.$watchGroup(["file.youtubeInfo.id","file.driveInfo"],f),e.rename=function(t){var r=e.$new(!0);r.title=e.file.title,i.show({targetEvent:t,scope:r,preserveScope:!0,controller:["$mdDialog","$scope",function(e,t){t.$mdDialog=e}],templateUrl:"components/castifyExt/ui/file-detail/rename-dialog.html",clickOutsideToClose:!0})["finally"](function(){var t=r.title;t&&n.rename(e.file.id,t)})}}]),angular.module("castifyExt.ui.syncInfo",["castifyExt.syncStatusClient","castifyExt.ui.syncProgressIcon"]).directive("cfSyncInfo",["syncStatusClient",function(e){return{restrict:"E",scope:{},templateUrl:"components/castifyExt/ui/sync-info/sync-info.html",link:function(t){t.state=e.state,t.retry=function(){e.retry()}}}}]),angular.module("castifyExt.ui.options",["castifyExt.appOptions","ngMaterial","w69b.chromeTabs","w69b.throttle","castifyExt.ui.policyHint"]).controller("OptionsCtrl",["$scope","appOptions","chromeTabs","$mdDialog","$location",function(e,t,n,r,i){e.opt=t.values,e.optLocal=t.localValues,e.debug=i.search().hasOwnProperty("debug"),e.$watch("opt",function(e,n){angular.equals(e,n)||(t.values=e,t.save())},!0),e.$watch("optLocal",function(e,n){angular.equals(e,n)||(t.localValues=e,t.saveLocal())},!0),e.openShortcuts=function(){n.create({url:"chrome://extensions/configureCommands"})},e.showDrawingShortcuts=function(e){r.show({targetEvent:e,clickOutsideToClose:!0,templateUrl:"components/castifyExt/ui/options/drawing-shortcuts-dialog.html"})}}]).directive("cfStorageOption",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/options/storage-option.html",scope:{ngModel:"="}}}),angular.module("castifyExt.ui.editableText",[]).directive("editableText",["$timeout",function(e){return{restrict:"EA",template:'<div><div data-ng-hide="isEditing" data-ng-transclude></div><input type="text" class="editable-text-input" data-ng-show="isEditing"/></div>',scope:{text:"=editableText",isEditing:"=",onRenamed:"&"},transclude:!0,link:function(t,n){function r(){var e=a.val();t.isEditing=!1,t.onRenamed({newText:e}),i(),t.$apply()}function i(){t.isEditing=!1,a.unbind("blur keydown"),t.$apply()}function o(){a.bind("blur",r),a.bind("keydown",function(e){switch(e.keyCode){case 13:r();break;case 27:i()}})}var a=n.find("input");t.$watch("isEditing",function(n){n&&(a.val(t.text),e(function(){a[0].select()}),o())})}}}]),angular.module("castifyExt.ui.fileActions",["ngMaterial","w69b.chromeAnalytics","castifyExt.fileDbClient","castifyExt.appOptions","castifyEdit.editJobSchedulerClient"]).controller("FileActionsCtrl",["$scope","fileDbClient","$window","analytics","$mdDialog","$log",function(e,t,n,r,i,o){this.rename=function(e,n){n=n.trim(),n&&(t.rename(e.id,n),r.trackEvent("file","rename","list"))},this.remove=function(e,n){n.stopPropagation();var a;return a=t.isSyncEnabled()?'Deleting will remove "'+e.title+'" from your device and also from your Drive account.':'Deleting will remove "'+e.title+'" from your device.',i.show(i.confirm().title("Delete Screencast?").content(a).cancel("Cancel").content(a).ok("Delete")).then(function(){o.debug("fileActions.remove()",e.id),t.remove(e.id),r.trackEvent("files","remove")})}}]).directive("cfSaveFileButton",["fileDbClient","editJobSchedulerClient","upgradeHelper","$location","$mdDialog",function(e,t,n,r,i){return{restrict:"E",templateUrl:"components/castifyExt/ui/file-actions/save-file-button.html",scope:{file:"=?"},link:function(t){t.loading=!1,t.upgradeHelper=n,t.exportGif=function(e){if(n.isPaid()){var o=t.$new(!0);o.file=t.file;var a=i.show({targetEvent:e,scope:o,templateUrl:"components/castifyExt/ui/file-actions/gif-export-dialog.html",controller:"GifExportDialogCtrl"});a.then(function(e){r.path("/files/")})}},t.save=function(){var n=t.file;n&&(t.loading=!0,e.reload(n.id).then(function(){return n.getUrl()}).then(function(e){var t=angular.element("<a></a>"),r=n.title.replace(/[\/,\\]/g,"");/\.webm$/i.test(r)||(r+=".webm"),t.attr("href",e),t.attr("download",r),t[0].dispatchEvent(new MouseEvent("click"))})["finally"](function(){t.loading=!1}))}}}}]).controller("GifExportDialogCtrl",["$scope","$mdDialog","editJobSchedulerClient",function(e,t,n){var r={width:640,height:480},i=10;e.$mdDialog=t;var o=e.file;e.scale=Math.min(1,r.width/o.width,r.height/o.height),e.minScale=Math.max(i/o.width,i/o.height),e.$watch("scale",function(t){e.exportSize={width:Math.floor(o.width*t),height:Math.floor(o.height*t)},e.canExportGif=n.canExportGif(e.file,e.exportSize)}),e["export"]=function(){var r={meta:{fileId:e.file.id},scale:e.exportSize,outFormat:"gif"};n.clearComplete(),n.addJob(r),t.hide()}}]),angular.module("castifyExt.ui.share",["ngMaterial","w69b.chromeAnalytics","w69b.chromeStorage","castifyExt.uploader","castifyExt.castifyAuth","castifyExt.ui.youtubeChannelChooser","castifyExt.licensing","castifyExt.signInService","castifyExt.ui.connectAppChooser","castifyExt.ui.loadingOverlay","castifyExt.ui.privacyPicker","castifyExt.ui.share.shareUtils","castifyExt.connect.connectService"]).controller("ShareDialogCtrl",["$scope","chromeStorage","uploader","$q","castifyAuth","$log","licensing","signInService","connectService","$mdDialog","$mdToast","shareUtils",function(e,t,n,r,i,o,a,c,u,s,l,f){function d(e){return e&&-1===e.status&&!$&&l.show(l.simple({position:"top right"}).content("Failed to load data, please check your network connection.")),$=!0,r.reject(e)}function p(){var n=e.options;if(n.connectApp){var r=n.connectApp;n.connectApp={id:r.id,title:r.title}}var i={target:n.target,privacy:n.privacy,youtubeChannelId:n.youtubeChannelId,connectApp:n.connectApp};return S=i,t.local.setSingle(k,i)}function h(){var n=e.options,r=angular.extend({},S,{target:n.target,privacy:n.privacy});return S=r,t.local.setSingle(k,r)}function g(t){f.isLinkShareable(t.privacy)?t.shareLink=f.getLink(e.file,t.target):t.shareLink=null}function m(){var t=e.file,n=C,i=[];n.drive.uploaded=!1,n.youtube.uploaded=!1,n.drive.shareLink=null,n.youtube.shareLink=null,t.isSynced&&(n.drive.uploaded=!0),t.driveInfo&&i.push(f.getPrivacy(t,"drive").then(function(e){n.drive.uploaded=!0,n.drive.privacy=e,g(n.drive)})["catch"](d));var o=e.options.youtubeChannelId;return t.youtubeInfo&&o&&i.push(f.getPrivacy(t,"youtube",o).then(function(e){n.youtube.uploaded=!0,n.youtube.privacy=e,g(n.youtube)})),r.all(i)}function y(t,n){return n||(n="loading"),e[n]=!0,t["finally"](function(){e[n]=!1}),t}function v(e,t){var n=C[e];n.privacy=t,g(n)}function b(){var t=e.options.target,n=e.options.privacy,r=e.file,i=f.setPrivacy(r,{target:t,privacy:n,domain:e.me.domain,channelId:e.options.youtubeChannelId});return i.then(function(){v(t,n)}),i}function w(){e.$watch(function(){return n.isQueuedOrActive(e.file.id,"youtube")},function(e){C.youtube.uploading=e}),e.$watch("file.driveInfo.id",function(e,t){e!==t&&y(m())}),e.$watch("file.youtubeInfo.id",function(e,t){e!==t&&y(m())}),e.$watch(function(){return n.getTargetState(e.file.id,"drive")},function(e){C.drive.uploadState=e}),e.$watch(function(){return n.getTargetState(e.file.id,"youtube")},function(e){C.youtube.uploadState=e}),e.$watch(function(){return n.isQueuedOrActive(e.file.id,"drive")},function(e,t){C.drive.uploading=e,t&&!e&&y(m())}),e.$watch("options.youtubeChannelId",function(){y(m())}),e.$watch(function(){var t=e.options.target;return{target:t,status:C[t]}},function(){var t=e.options.target,n=C[t];e.fileStatus=n,n.uploaded?e.options.privacy=n.privacy:e.options.privacy=x},!0)}function E(){p();var t=e.options,n=u.share(t.connectApp.id,e.file.id);s.hide(!0),n["catch"](function(e){o.warn(e)})}var k="uploadOptions";e.options={youtubeChannelId:null},e.me={},e.$mdDialog=s;var x,S,C={drive:{target:"drive"},youtube:{target:"youtube"},connect:{target:"connect"}},$=!1;e.file.youtubeInfo&&e.file.youtubeInfo.channelId&&(e.options.youtubeChannelId=e.file.youtubeInfo.channelId),t.local.getSingle(k).then(function(t){t=t||{target:"youtube",privacy:"public"},S=t,e.options.target=t.target,e.options.youtubeChannelId||(e.options.youtubeChannelId=t.youtubeChannelId),e.options.connectApp=t.connectApp,x=t.privacy,w()}),c.getMe().then(function(t){e.me=t}),e.upload=function(){var t=e.options;if("connect"==t.target)return E();p();var n=f.upload(e.file,{target:t.target,privacy:t.privacy,domain:e.me.domain,channelId:t.youtubeChannelId});y(n),n.then(function(){s.hide(!0)})},e.enableLinkSharing=function(){var t,n=e.fileStatus,r={privacy:n.privacy,target:n.target,domain:e.me.domain,channelId:e.options.youtubeChannelId};n.uploaded?t=f.enableLinkSharing(e.file,r).then(function(t){v(r.target,t.privacy),e.copyLink()}):(r.privacy="unlisted",n.uploading=!0,t=f.upload(e.file,r)),t.then(h),y(t)},e.savePrivacy=function(t){if(e.fileStatus.uploaded){e.options.privacy=t;var n=b();n.then(h),y(n,"savingPrivacy"),n["catch"](function(t){m(),o.warn("failed to set privacy",t);var n="Failed to update your privacy setting. ";e.me.domain&&(n+=" Your domain administrator might have disabled some sharing options."),l.show(l.simple({hideDelay:5e3,position:"top right"}).content(n))})}},e.copyLink=function(){f.copyLink(e.fileStatus.shareLink,{position:"top right"})},e.isValid=function(){var t=e.options;return!e.loading&&("youtube"!==t.target||t.youtubeChannelId)&&("connect"!==t.target||t.connectApp)}}]),angular.module("castifyExt.ui.share.shareUtils",["castifyExt.youtubeUtils","castifyExt.driveUtils","castifyExt.licensing","castifyExt.castifyAuth","castifyExt.uploader","w69b.spawn","w69b.clipboard","ngMaterial"]).factory("shareUtils",["youtubeUtils","driveUtils","spawn","licensing","castifyAuth","uploader","clipboard","$mdToast","$q",function(e,t,n,r,i,o,a,c,u){function s(e){return"drive"===e}function l(e){return"youtube"===e}function f(e,t){return s(t)?!!e.driveInfo:l(t)?!!e.youtubeInfo:!1}var d={},p="Recorded with ScreenCastify (https://www.screencastify.com), the screen video recorder for Chrome";return d.enableLinkSharing=function(e,t){return n($traceurRuntime.initGeneratorFunction(function r(){var n,i,o,a,c,u,s;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:n=t.privacy,r.state=39;break;case 39:r.state=n?8:5;break;case 5:i=d.getPrivacy,o=t.target,a=t.channelId,c=i.call(d,e,o,a),r.state=6;break;case 6:return r.state=2,c;case 2:u=r.sent,r.state=4;break;case 4:n=u,r.state=8;break;case 8:r.state=f(e,t.target)?32:35;break;case 32:r.state=d.isLinkShareable(n)?30:27;break;case 27:r.pushTry(25,null),r.state=28;break;case 28:n="unlisted",r.state=15;break;case 15:return r.state=11,d.setPrivacy(e,angular.extend({},t,{privacy:n}));case 11:r.maybeThrow(),r.state=13;break;case 13:r.popTry(),r.state=30;break;case 25:r.popTry(),r.maybeUncatchable(),s=r.storedException,r.state=24;break;case 24:r.state=t.domain?20:22;break;case 20:n="domain_unlisted",r.state=21;break;case 21:return r.state=17,d.setPrivacy(e,angular.extend({},t,{privacy:n}));case 17:r.maybeThrow(),r.state=30;break;case 22:throw s;case 30:r.returnValue={privacy:n,link:d.getLink(e,t.target)},r.state=-2;break;case 35:throw new Error("not supported yet");default:return r.end()}},r,this)}))},d.upload=function(e,t){var n={fileId:e.id,target:t.target,title:e.title,privacy:t.privacy,domain:t.domain,channelId:t.channelId};return r.shouldForceBranding()&&(n.description=p),
i.getAuthToken({interactive:!0}).then(function(){return o.upload(n)})},d.getPrivacy=function(n,r,i){return s(r)?t.getSimplePrivacy(n.driveInfo.id):l(r)?i||n.youtubeInfo.channelId?e.getPrivacy(n.youtubeInfo.id,i||n.youtubeInfo.channelId):u.reject("channel unknown"):void 0},d.isLinkShareable=function(e){return["public","unlisted","domain_unlisted","domain_public"].includes(e)},d.setPrivacy=function(n,r){if(l(r.target))return e.setPrivacy(n.youtubeInfo.id,r.privacy,r.channelId||n.youtubeInfo.channelId);if(s(r.target))return t.setSimplePrivacy(n.driveInfo.id,r.privacy,r.domain);throw new Error("unknown target")},d.getLink=function(n,r){return l(r)&&n.youtubeInfo?e.getLink(n.youtubeInfo.id):s(r)&&n.driveInfo?t.getLink(n.driveInfo.id):null},d.copyLink=function(e,t){if(a.copy(e),t){var n=navigator.userAgent.includes("Mac")?"CMD":"CTRL";c.show(c.simple(t).content("Shareable link has been copied. Paste it with "+n+"+V."))}},d}]),angular.module("castifyExt.ui.privacyPicker",[]).directive("cfPrivacyPicker",function(){function e(e){return t.filter(function(t){return!t.domainOnly||e}).map(function(t){return angular.extend({},t,{title:t.title.replace("{domain}",e),desc:t.desc.replace("{domain}",e)})})}var t=[{value:"public",icon:"public",title:"Public",desc:"Anyone can find and view the video."},{value:"unlisted",icon:"link",title:"Unlisted",desc:"People who have the link to the video can view it."},{domainOnly:!0,value:"domain_public",icon:"business",title:"Public at {domain}",desc:"Anyone at {domain} can find and view the video."},{domainOnly:!0,value:"domain_unlisted",icon:"link",title:"Unlisted at {domain}",desc:"People at {domain} who have the link to the video can view it."},{value:"private",icon:"account_box",title:"Private",desc:"Only you can view the video."}];return{restrict:"E",templateUrl:"components/castifyExt/ui/privacy-picker/privacy-picker.html",scope:{value:"=",domain:"=",enableDomain:"=?",cfChange:"&",cfDisabled:"="},link:function(t){function n(){t.items?t.selectedItem=t.items.find(function(e){return e.value===t.value}):t.selectedItem=null}t.expanded=!1,t.$watchGroup(["domain","enableDomain"],function(){t.items=e(t.enableDomain&&t.domain),n()}),t.onChange=function(e){t.cfChange({value:e})},t.$watch("value",n)}}}),angular.module("castifyExt.ui.pixelResolution",[]).directive("pixelResolution",function(){return{template:'<span ng-show="resolution.width || resolution.height">{{resolution.width}}&#x2715;{{resolution.height}}</span>',restrict:"A",scope:{resolution:"=pixelResolution"}}}),angular.module("castifyExt.ui.topnav",["ngRoute","ngMaterial"]).directive("cfTopnav",["$mdSidenav",function(e){return{restrict:"E",scope:{},transclude:!0,templateUrl:"components/castifyExt/ui/topnav/topnav.html",link:function(t,n,r){r.hasOwnProperty("popupMode")&&(t.popupMode=!0),t.openMenu=function(){t.popupMode?t.$root.isAppMenuOpen=!0:e("main-menu").toggle()}}}}]),angular.module("castifyExt.ui.sidenav",["castifyExt.userInfo","castifyExt.licensing","castifyExt.connect.connectedApps","castifyExt.upgradeHelper","castifyExt.ui.openInAppTab","w69b.chromeTabs"]).directive("cfSidenav",["licensing","connectedApps","$location","upgradeHelper","$window","$mdSidenav","openInAppTab","chromeTabs","userInfo",function(e,t,n,r,i,o,a,c,u){return{restrict:"E",scope:{isOpen:"=?"},templateUrl:"components/castifyExt/ui/sidenav/sidenav.html",link:function(s,l,f){f.hasOwnProperty("popupMode")&&(s.popupMode=!0),s.licensing=e,s.hasApps=!1,s.userInfo=u,t.getConnected().then(function(e){s.hasApps=e.length>0}),s.upgradeHelper=r,s.open=function(e){s.popupMode?a("#"+e).then(function(){i.close()}):(n.path(e),o("main-menu").close())},s.closeMenu=function(){s.isOpen=!1};var d={feedback:"http://screencastify.uservoice.com/",gplus:"https://google.com/+ScreencastifyChrome"};s.openExternal=function(e){c.create({url:d[e]})}}}}]),angular.module("castifyExt.ui.about",[]).directive("cfCredit",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/about/credit.html",scope:{url:"@",title:"@"},transclude:!0}}),angular.module("castifyExt.ui.searchHelp",["castifyExt.helpCenter"]).directive("cfSearchHelp",["chromeTabs","helpCenter",function(e,t){var n="https://screencastify.uservoice.com/search?filter=articles";return{link:function(r,i,o){i.bind("click",function(r){var i=n,a=o.cfSearchHelp;r.preventDefault(),a&&t.hasHelpFor(a)?t.openHelp(a):(a&&(i=n+"&query="+encodeURIComponent(a)),e.create({url:i}))})}}}]),angular.module("castifyExt.ui.disableContextmenu",[]).directive("disableContextmenu",function(){return{link:function(e,t){t.bind("contextmenu",function(e){e.preventDefault(),e.stopPropagation()})}}}),angular.module("castifyExt.ui.fileSyncInfo",["castifyExt.fileDbClient"]).controller("FileSyncInfoCtrl",["$scope","fileDbClient","uploader",function(e,t,n){function r(){var r=e.file;if(!r)return null;if(!t.isSyncEnabled())return{state:"disabled"};if(r.isSynced)return{state:"synced"};var i=n.getTargetState(r.id,"drive");return i?{state:i.state,progress:i.progress}:{state:"queued"}}e.$watch(r,function(t){e.syncInfo=t},!0)}]).directive("cfFileSyncIcon",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/file-sync-info/file-sync-icon.html",scope:{file:"="},controller:"FileSyncInfoCtrl"}}).directive("cfFileSyncInfo",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/file-sync-info/file-sync-info.html",scope:{file:"="},controller:"FileSyncInfoCtrl"}}),angular.module("castifyExt.ui.uploadInfo",["castifyExt.uploader"]).directive("cfUploadInfo",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/upload-info/upload-info.html",scope:{file:"="},controller:"UploadInfoCtrl"}}).controller("UploadInfoCtrl",["$scope","uploader",function(e,t){e.getHumanTargetName=function(e){return{drive:"Google Drive",youtube:"Youtube"}[e]},e.$watch(function(){return e.file?t.getFileState(e.file.id):null},function(t){t?e.uploads=Object.keys(t).map(function(e){return t[e]}).filter(function(e){return!e.isSyncUpload}):e.uploads=null})}]),angular.module("castifyExt.ui.syncSetup",["castifyExt.castifyAuth","castifyExt.fileDbClient","castifyExt.syncAuthTool","ngMaterial"]).directive("cfSyncSetupAuthPrompt",["castifyAuth","chromeRuntime","$log",function(e,t,n){return{restrict:"E",templateUrl:"components/castifyExt/ui/sync-setup/sync-setup-auth-prompt.html",scope:{authGranted:"&"},link:function(r){r.dialogShown=!1,r.grantAuth=function(){r.dialogShown=!0,e.getAuthToken({interactive:!0,validate:!0}).then(function(){t.sendMessage({type:"event:syncSetupComplete"}),r.authGranted()},function(e){n.warn("sync setup getToken error",e)})["finally"](function(){r.dialogShown=!1})}}}}]).controller("DriveSyncSetupCtrl",["$scope","fileDbClient","castifyAuth","syncAuthTool",function(e,t,n,r){e.state="loading",e.$watch(t.isSyncEnabled,function(t){t?r.hasValidAuthToken().then(function(){e.onAuthGranted()},function(){e.state="authMissing"}):e.state="disabled"}),e.onAuthGranted=function(){e.state="complete"}}]),angular.module("castifyExt.ui.syncAuthErrorRedirector",["castifyExt.chromeEventPublisher"]).directive("cfSyncAuthErrorRedirector",["$location",function(e){var t="/sync-setup";return{restrict:"EA",link:function(n){n.$on("event:syncAuthError",function(){e.path()!==t&&e.path(t)})}}}]),angular.module("castifyExt.ui.videoPlayer",["castifyExt.castifyAuth","castifyExt.fileDbClient","castifyExt.ui.disableContextmenu"]).directive("cfVideoPlayer",["$q","$document","appOptions",function(e,t,n){return{restrict:"E",replace:!1,templateUrl:"components/castifyExt/ui/video-player/video-player.html",scope:{file:"=?"},link:function(e,r){function i(){c.paused?c.play():c.pause()}function o(e){32===e.which&&e.target===s&&(i(),e.preventDefault())}var a=r.find("video"),c=a[0],u=0;e.loading=!0,a.bind("canplay",function(){e.loading=!1,e.$digest()}),a.bind("loadedmetadata",function(){c.currentTime!==u&&(c.currentTime=u)}),a.bind("loadstart seeking",function(){e.loading=!0,e.$digest()}),a.bind("timeupdate",function(){e.loading||(u=c.currentTime)}),n.values.autoPlay&&a.bind("canplay",function l(){a[0].play(),a.unbind("canplay",l)});var s=t.find("body")[0];r.bind("click",i),t.bind("keydown",o),e.$on("$destroy",function(){t.unbind("keydown",o)})}}}]).directive("cfVideoLoad",["fileDbClient","$log",function(e,t){return{restrict:"A",scope:{file:"=cfVideoLoad"},link:function(n,r){var i=r[0];n.$watchGroup(["file.url","file.urlRequiresAccessToken"],function(){n.loading=!0,n.file&&n.file.getUrl().then(function(e){i.src=e})}),r.bind("error",function(r){t.warn("video playback error",r.target.error),e.reload(n.file.id),n.$apply()})}}}]),angular.module("castifyExt.ui.welcome",["castifyExt.requestMicPermission","castifyExt.syncAuthTool","castifyExt.appOptions","castifyExt.ui.syncSetup","castifyExt.ui.options","castifyExt.ui.policyHint","castifyExt.setupService","castifyExt.optionalPermissions","w69b.spawn"]).controller("WelcomeCtrl",["$scope","$log","requestMicPermission","syncAuthTool","appOptions","setupService","spawn","optionalPermissions",function(e,t,n,r,i,o,a,c){function u(){return r.hasValidAuthToken().then(function(){return!0},function(){return!1})}function s(){a($traceurRuntime.initGeneratorFunction(function n(){var r,i,a,s,l,f;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,o.getSetupState();case 2:r=n.sent,n.state=4;break;case 4:i=u(),n.state=10;break;case 10:return n.state=6,i;case 6:a=n.sent,n.state=8;break;case 8:r.signIn=a,n.state=12;break;case 12:s=c.hasLiteTabPermissions,l=s.call(c),n.state=18;break;case 18:return n.state=14,l;case 14:f=n.sent,n.state=16;break;case 16:r.tab=f,n.state=20;break;case 20:e.setupState=r,t.debug("welcome: setup state is",r),n.state=-2;break;default:return n.end()}},n,this)}))["catch"](t.error.bind(t))}e.setupState={},e.setupCam=function(){n().then(function(){e.setupState.cam=!0},function(){e.setupState.cam=!1})},e.appOptions=i,e.$watchGroup(["driveSync","setupState.signIn"],function(t,n){!angular.equals(t,n)&&angular.isDefined(e.driveSync)&&(e.driveSync&&!e.setupState.signIn||(e.setupState.storage=!0,o.setStorageDecided(!0),i.values.driveSync!==e.driveSync&&(i.values.driveSync=e.driveSync,i.save())))}),e.setupTabPermissions=a.wrap($traceurRuntime.initGeneratorFunction(function l(){var t,n,r;return $traceurRuntime.createGeneratorInstance(function(i){for(;;)switch(i.state){case 0:t=c.requestTabPermissions,n=t.call(c),i.state=6;break;case 6:return i.state=2,n;case 2:r=i.sent,i.state=4;break;case 4:i.state=r?7:-2;break;case 7:e.setupState.tab=!0,i.state=-2;break;default:return i.end()}},l,this)})),e.$watch("!appOptions.isLoaded() || setupState.cam == null || setupState.signIn == null",function(t){e.loading=t}),e.$watch("setupState.cam && setupState.storage && (!driveSync || setupState.signIn)",function(t){e.setupComplete=t}),e.onSignedIn=function(){e.setupState.signIn=!0},s()}]),angular.module("castifyExt.ui.syncProgressIcon",[]).directive("cfSyncProgressIcon",function(){return{replace:!0,restrict:"E",templateUrl:"components/castifyExt/ui/sync-progress-icon/sync-progress-icon.html",scope:{progress:"=value"}}}),angular.module("castifyExt.ui.youtubeChannelChooser",["castifyExt.youtubeAuth"]).directive("cfYoutubeChannelChooser",["youtubeAuth",function(e){return{restrict:"E",require:"ngModel",templateUrl:"components/castifyExt/ui/youtube-channel-chooser/youtube-channel-chooser.html",scope:{},link:function(t,n,r,i){function o(){var e=(t.channels||[]).filter(function(e){return e.id===i.$viewValue});t.selected=e.length?e[0]:u}function a(e){return t.loading=!0,e["finally"](function(){t.loading=!1}),e}function c(){return e.listChannels().then(function(e){t.channels=e,s=!0,i.$validate()})}var u={title:"Please Select",id:null},s=!1;i.$render=o,i.$validators.validChannel=function(e,n){var r=e||n;return!s||t.channels.some(function(e){return e.id===r})},t.select=function(e){t.selected=e,i.$setViewValue(e.id)},t.remove=function(n,r){r.stopPropagation(),r.preventDefault(),i.$setViewValue(null),t.channels.splice(t.channels.indexOf(n),1),e.removeChannel(n.id)},t.openOrAdd=function(e,n){n(e),t.channels.length?t.isDropdownOpen=!0:t.addChannel(),e.stopPropagation(),e.preventDefault()},t.addChannel=function(){var n=e.addChannel().then(function(e){return t.select(e),c()});a(n)},t.$watchCollection("channels",o),t.channels=[],t.loading=!1,t.isDropdownOpen=!1,a(c())}}}]),angular.module("castifyExt.ui.policyHint",["castifyExt.appOptions"]).directive("cfPolicyHint",["appOptions",function(e){return{restrict:"E",replace:!0,scope:{},templateUrl:"components/castifyExt/ui/policy-hint/policy-hint.html",link:function(t,n,r){t.$watch(function(){return e.isSetByEnterprisePolicy(r.key)},function(e){t.show=e})}}}]),angular.module("castifyEdit.ui.trimSlider",["ngMaterial"]).directive("cfTrimSlider",function(){return{restrict:"E",scope:{range:"=?",previewCtrl:"=?"},templateUrl:"components/castifyEdit/ui/trim-slider/trim-slider.html",require:"^cfTimeLine",link:function(e,t,n,r){function i(t){for(;!t.classList.contains("handle")&&t;)t=t.parentElement;var n=a(e.range),r=t.classList;return r.contains("start")?{moving:n.start,counter:n.end,isStart:!0}:r.contains("end")?{moving:n.end,counter:n.start}:void 0}function o(){var t=a(e.range);l(t)}function a(e){return null===e?{start:0,end:r.getWidth()}:{start:r.timeToPos(e.start),end:r.timeToPos(e.end)}}function c(e){return{start:r.posToTime(e.start),end:r.posToTime(e.end)}}function u(e){e.start=Math.min(Math.max(e.start,0),r.getWidth()),e.end=Math.min(Math.max(e.end,0),r.getWidth())}function s(e,t){return{start:Math.min(e,t),end:Math.max(e,t)}}function l(e){b.css("transform","translateZ(0) translateX("+e.start+"px)"),w.css("transform","translateZ(0) translateX("+e.end+"px)"),E.css("width",e.start+"px"),k.css("left",e.end+"px");var t=c(e);x.time=t.start,S.time=t.end,r.redrawCanvas()}function f(e){var t=e.end;return t=Math.abs(t-r.getTimeSpan())>.001?r.roundTime(t):r.getTimeSpan(),{start:r.roundTime(e.start),end:t}}function d(t){e.previewCtrl.pause(),e.previewCtrl.seekThrottled(t)}function p(t,n){var r=e.previewCtrl;n?(r.seek(t.start),r.play()):(r.seek(Math.max(0,t.start,t.end-C)),r.play())}function h(e){return a(f(c(e)))}function g(t){t.preventDefault(),m||(m=i(t.target));var n=m.moving;n+=t.deltaX;var o=s(n,m.counter);if(u(o),o=h(o),l(o),d(r.roundTime(r.posToTime(n))),t.isFinal){var a=f(c(o));0===a.start&&a.end===r.getTimeSpan()?a=null:p(a,m.isStart),e.range=a,m=null,e.$apply()}}var m,y=t[0],v=[],b=angular.element(y.querySelector(".handle.start")),w=angular.element(y.querySelector(".handle.end")),E=angular.element(y.querySelector(".overlay.start")),k=angular.element(y.querySelector(".overlay.end"));e.range=null;var x=r.addTick({time:0}),S=r.addTick({time:0}),C=1.5;e.$on("timeLine:resize",o),e.$on("videoPreview:loaded",o),angular.forEach(y.querySelectorAll(".handle"),function(e){var t=new Hammer.Manager(e);t.add(new Hammer.Pan({threshold:0,pointers:0})),t.on("pan",g),v.push(t)}),e.$on("$destroy",function(){v.forEach(function(e){e.destroy()})}),o()}}}),angular.module("castifyEdit.ui.timeLine",["castifyEdit.ui.timeLineCanvas"]).directive("cfTimeLine",["$window",function(e){function t(t,n){function r(){n.ticks.push({time:0}),n.ticks.push({time:n.previewCtrl.duration}),i()}function i(){l=c.getBoundingClientRect().width-2*f,u.css("width",s.getWidth()+"px"),n.$broadcast("timeLine:resize")}var o=t,a=t[0],c=a.querySelector(".scroll-container"),u=angular.element(a.querySelector(".scroll-content")),s=this,l=0,f=20;n.zoom=1,n.ticks=[],this.init=function(){i(),n.$on("videoPreview:loaded",r),n.$watch("zoom",i),e.addEventListener("resize",i),o.bind("$destroy",function(){e.removeEventListener("resize",i)})},s.scrollToCenter=function(e){c.scrollLeft=e.offsetLeft-l/2},s.posToTime=function(e){return e/s.getWidth()*n.previewCtrl.duration},s.timeToPos=function(e){return e/n.previewCtrl.duration*s.getWidth()},s.getWidth=function(){return l*n.zoom},s.getTimeSpan=function(){return n.previewCtrl.duration},s.getPadding=function(){return f},s.addTick=function(e){return n.ticks.push(e),e},s.roundTime=function(e){return Math.round(10*e)/10},s.redrawCanvas=function(){n.$broadcast("timeLine:redrawCanvas")}}return t.$inject=["$element","$scope"],{restrict:"E",templateUrl:"components/castifyEdit/ui/time-line/time-line.html",transclude:!0,scope:{previewCtrl:"="},controller:t,link:function(e,t,n,r){r.init()}}}]),angular.module("castifyEdit.ui.videoEditor",["castifyEdit.ui.videoCanvas","castifyEdit.ui.cropCanvas","castifyEdit.ui.videoControls","castifyEdit.ui.trimSlider","castifyEdit.ui.timeLine","castifyEdit.ui.videoPreview","castifyExt.ui.videoPlayer","castifyExt.upgradeHelper","castifyExt.ui.upgradeButton","castifyExt.appOptions"]).directive("cfVideoEditor",["$mdToast","upgradeHelper","appOptions",function(e,t,n){return{restrict:"E",templateUrl:"components/castifyEdit/ui/video-editor.html",scope:{file:"=cfFile",cfCancel:"&",cfSave:"&"},controller:["$scope",function(e){this.registerVideoPreview=function(t){e.previewCtrl=t},this.getScope=function(){return e},this.init=function(){}}],link:function(r,i,o,a){if(a.init(),r.config={meta:{copy:!0}},n.values.showEditToolsHint){var c=e.simple().content("Draw a box to crop your video, move scissors to trim.").position("top right").hideDelay(0).action("Got it");c._options.parent="cf-video-editor",e.show(c).then(function(e){"ok"===e&&(n.values.showEditToolsHint=!1,n.save())})}r.upgradeHelper=t,r.canSave=function(){return(r.config.crop||r.config.trim)&&t.isPaid()},r.save=function(e){var t=r.config;t.meta.copy=e,r.cfSave({config:t})}}}}]),angular.module("castifyEdit.ui.videoCanvas",[]).directive("cfVideoCanvas",["$window","$timeout",function(e,t){return{restrict:"E",transclude:!0,controller:["$scope","$element",function(t,n){this.init=function(){function r(e,t){var n=Math.min(t.width/e.width,t.height/e.height);return{width:e.width*n,height:e.height*n}}function i(e){return e&&e.videoWidth?{width:e.videoWidth,height:e.videoHeight}:null}function o(e,t){if(!e)return null;var n={};return["width","height","top","left"].forEach(function(r){e.hasOwnProperty(r)&&(n[r]=e[r]*t)}),n}function a(){if(c=i(l[0])){var e=u[0].getBoundingClientRect(),n=r(c,e);s=n.width/c.width;var o=Math.floor((e.width-n.width)/2),a=Math.floor((e.height-n.height)/2),f={width:n.width+"px",height:n.height+"px",top:a+"px",left:o+"px",position:"absolute"};l.css(f),l.removeClass("ng-hide");var d=u.children().eq(1);d.css(f),t.$broadcast("videoCanvas:resize")}}var c,u=n,s=1,l=u.find("video");this.toCanvasCoordinates=function(e){return o(e,s)},this.toVideoCoordinates=function(e){return o(e,1/s)},this.scaleDimToCanvas=function(e){return e*s},this.getVideoSize=function(){return c},u.css("position","relative"),t.$on("videoPreview:loaded",a),l.addClass("ng-hide"),e.addEventListener("resize",a),u.bind("$destroy",function(){e.removeEventListener("resize",a)}),a()}}],link:function(e,t,n,r,i){if(i(function(e){t.append(e)}),2!=t.children().length)throw Error();r.init()}}}]),angular.module("castifyEdit.ui.cropCanvas",[]).directive("cfCropCanvas",function(){function e(e,t,n,r){function i(t){var n=r.toCanvasCoordinates(e.box);n.bottom=n.top+n.height,n.right=n.left+n.width;var i={left:n.left,top:n.top},o={left:n.right,top:n.top},a={left:n.left,top:n.bottom},c={left:n.right,top:n.bottom},u=t.classList;return u.contains("top-left")?{corner:i,counter:c}:u.contains("top-right")?{corner:o,counter:a}:u.contains("bottom-left")?{corner:a,counter:o}:u.contains("bottom-right")?{corner:c,counter:i}:void 0}function o(e,t){return{left:e.left-t.left,top:e.top-t.top}}function a(e,t){return{left:e.left+t.left,top:e.top+t.top}}function c(e,t,n){if(!n)return u(e,t);var r=o(t,e),i=n,c=n;return c=Math.abs(r.left)<=Math.abs(r.top*i)?{left:r.left,top:Math.abs(r.left/i)*Math.sign(r.top)}:{left:Math.abs(r.top*i)*Math.sign(r.left),top:r.top},u(e,a(e,c))}function u(e,t){var n=Math.min(e.left,t.left),r=Math.min(e.top,t.top),i=Math.max(e.top,t.top),o=Math.max(e.left,t.left);return{top:r,left:n,width:o-n,height:i-r}}function s(e){var t=r.scaleDimToCanvas(R);e.width=Math.max(e.width,t),e.height=Math.max(e.height,t)}function l(e){e.left=Math.min(Math.max(e.left,0),M.width),e.top=Math.min(Math.max(e.top,0),M.height)}function f(e){var t=v(r.toVideoCoordinates(e));return b(t),y(t,r.getVideoSize()),t}function d(t){var n=null;return(e.options&&e.options.lockAspectYt||t.ctrlKey)&&(n=B),n}function p(e,t,n){var r=angular.copy(t);r.top+=n.deltaY,r.left+=n.deltaX;var i=d(n.srcEvent);h(e,r,i,n.isFinal)}function h(t,n,r,i){l(n);var o=c(t,n,r);s(o),m(o),o=w(o),$(o);var a=f(o);A(a,o),i&&(e.box=a,e.$apply())}function g(e){e.preventDefault(),P||(P=i(e.target)),p(P.counter,P.corner,e),e.isFinal&&(P=null)}function m(e){y(e,M)}function y(e,t){var n=e.left+e.width-t.width;n>0&&(e.left-=n);var r=e.top+e.height-t.height;r>0&&(e.top-=r),e.left=Math.max(0,e.left),e.top=Math.max(0,e.top)}function v(e){return{left:Math.round(e.left),top:Math.round(e.top),width:Math.round(e.width),height:Math.round(e.height)}}function b(e){e.width-=e.width%2,e.height-=e.height%2}function w(e){return e=r.toVideoCoordinates(e),e=v(e),b(e),e=r.toCanvasCoordinates(e)}function E(t){t.preventDefault(),D||(D=r.toCanvasCoordinates(e.box));var n=angular.copy(D);n.top+=t.deltaY,n.left+=t.deltaX,l(n),m(n),n=w(n),$(n),t.isFinal&&(D=null,e.box=f(n),e.$apply())}function k(e){L&&(e.preventDefault(),L.hasPanned=!0,p(L.start,L.start,e),e.isFinal&&(L=null))}function x(e){var t=e.x,n=e.y;return e.touches&&e.touches.length&&(t=e.touches[0].clientX,n=e.touches[0].clientY),{left:t-M.left,top:n-M.top}}function S(e){e.preventDefault(),document.removeEventListener("mouseup",S,!0),L&&L.hasPanned&&h(L.start,x(e),d(e),!0),L=null}function C(e){if(!_[0].contains(e.target)){var t=x(e);L={start:t},document.addEventListener("mouseup",S,!0)}}function $(e){_.toggleClass("ng-hide",!e),e&&(e=v(e),e.bottom=e.top+e.height,e.right=e.left+e.width,F.css("height",e.top+"px"),q.css("top",e.bottom+"px"),O.css("top",e.top+"px"),O.css("width",e.left+"px"),O.css("height",e.height+"px"),V.css("top",e.top+"px"),V.css("left",e.right+"px"),V.css("height",e.height+"px"),_.css({top:e.top+"px",left:e.left+"px",width:e.width+"px",height:e.height+"px"}))}function A(e,t){return e&&(t||(t=r.toCanvasCoordinates(e)),t=v(t),t.width>z.width&&t.height>z.height)?void j.text(t.width+"\u2715"+t.height+" px"):(j.toggleClass("ng-hide",!1),void j.text(""))}function T(){if(e.initialized=!0,M=t[0].getBoundingClientRect(),e.box){var n=r.toCanvasCoordinates(e.box);$(n)}else $()}function I(e,t){var n=new Hammer.Manager(e);n.add(new Hammer.Pan({threshold:0,pointers:0})),n.on("pan",t),H.push(n)}var P,D,L,M,R=16,U=t[0],F=angular.element(U.querySelector(".overlay.top")),q=angular.element(U.querySelector(".overlay.bottom")),O=angular.element(U.querySelector(".overlay.left")),V=angular.element(U.querySelector(".overlay.right")),_=angular.element(U.querySelector(".crop-box")),G=angular.element(U.querySelector(".move-handle")),j=angular.element(U.querySelector(".dimension-info")),H=[],B=16/9,z={width:100,height:20};e.$watch("box",function(t){if(t){var n=r.getVideoSize();A(t),0===t.top&&0===t.left&&t.width===n.width&&t.height===n.height?e.crop=null:e.crop=t}},!0),e.$on("videoCanvas:resize",T),e.initialized=!1,angular.forEach(U.querySelectorAll(".handle"),function(e){I(e,g)}),I(G[0],E),I(t[0],k),t.bind("mousedown touchstart",C),e.$on("$destroy",function(){H.forEach(function(e){e.destroy()})}),T()}return{restrict:"E",require:"^cfVideoCanvas",templateUrl:"components/castifyEdit/ui/crop-canvas/crop-canvas.html",scope:{crop:"=",initialized:"=?",options:"="},link:e}}),angular.module("castifyEdit.ui.videoControls",["w69b.throttle"]).directive("cfVideoControls",["$document","throttle",function(e,t){function n(e){e.play=function(){e.previewCtrl.play()},e.pause=function(){e.previewCtrl.pause()}}return{restrict:"E",templateUrl:"components/castifyEdit/ui/video-controls/video-controls.html",scope:{previewCtrl:"="},link:n}}]),angular.module("castifyEdit.ui.timeLineCanvas",["w69b.timeutil"]).directive("cfTimeLineCanvas",["timeutil","$window",function(e,t){function n(t,n,r){function i(){var e=window.devicePixelRatio;g=n.getWidth()+2*n.getPadding(),m=r.height,t.width=g*e,t.height=m*e,t.style.width=g+"px",t.style.height=m+"px",d.scale(e,e)}function o(e,t){return t[0]<=e&&e<=t[1]}function a(e,t){return o(e[0],t)||o(e[0],t)||o(t[0],e)}function c(e){return!p.some(function(t){return a(e,t)})}function u(e){p.push(e)}function s(){d.fillStyle=r.labelColor,d.font=r.labelFont}function l(){d.translate(0,20)}var f={},d=t.getContext("2d",{alpha:!1}),p=[],h=[];f.ctx=d,f.options=r;var g,m;return f.setLineStyle=function(){d.strokeStyle=r.color,d.lineWidth=r.lineWidth},f.renderLabelIfFree=function(t,i){d.save(),i||(i=e.formatDuration(t));var o=n.timeToPos(t);s();var a=d.measureText(i),p=Math.max(o-a.width/2,-f.getPadding()),h=p+a.width-(f.getWidth()+f.getPadding());h>0&&(p-=h);var g=[p,p+a.width];return c(g)?(l(),d.fillText(i,p,0),g[0]-=r.labelMargin,g[1]+=r.labelMargin,u(g),d.restore(),!0):(d.restore(),!1)},f.getLineCenterY=function(){return m-r.lineWidth-r.lineMargin},f.transformLineCenter=function(){d.translate(0,f.getLineCenterY())},f.render=function(){i(),d.fillStyle=r.background,d.fillRect(0,0,g+1,m+1),p=[],d.translate(f.getPadding(),0),h.forEach(function(e){d.save(),e.render(),d.restore()})},f.addItem=function(e){h.push(e)},f.timeToPos=function(e){return n.timeToPos(e)},f.posToTime=function(e){return n.posToTime(e)},f.getPadding=function(){return n.getPadding()},f.getWidth=function(){return n.getWidth()},f}function r(e){function t(){var t=new Path2D;return t.moveTo(0,0),t.lineTo(e.getWidth(),0),t}var n={};return n.render=function(){e.transformLineCenter(),e.setLineStyle(),e.ctx.stroke(t())},n}function i(e,t){function n(t){if(o.save(),e.renderLabelIfFree(t.time,t.label)){var n=e.timeToPos(t.time);e.transformLineCenter(),o.translate(n,-a.tickHeight/2),e.setLineStyle(),o.stroke(r())}o.restore()}function r(){var e=new Path2D;return e.moveTo(0,0),e.lineTo(0,a.tickHeight),e}var i={},o=e.ctx,a=e.options;return i.render=function(){t.forEach(n)},i}function o(e,t,n){function r(){var e=new Path2D;return e.arc(0,0,g.seekHandleSize/2,0,2*Math.PI),e}function i(e){return Math.min(Math.max(n.getTrimmedStartTime(),e),n.getTrimmedEndTime())}function o(e){e.preventDefault(),document.removeEventListener("mouseup",o,!0),document.removeEventListener("touchend",o,!0),"touchend"!==e.type&&u(a(e)),d=null}function a(t){var n=t.x;return t.touches&&t.touches.length&&(n=t.touches[0].clientX),n-(f[0].getBoundingClientRect().left+2*e.getPadding())}function c(e){if(e.preventDefault(),!d){var t=a(e);d={start:t},u(t),document.addEventListener("mouseup",o,!0),document.addEventListener("touchend",o,!0)}}function u(t){t=Math.min(Math.max(t,0),e.getWidth());var r=e.posToTime(t);r=i(r),m=r,n.pause(),n.seekThrottled(r),y!==m&&e.render()}function s(e){e.preventDefault(),d&&(u(d.start+e.deltaX),e.isFinal&&(d=null))}function l(){f=angular.element('<div class="seek-event-target"></div>'),f.css("left",-e.getPadding()+"px"),f.css("right",-e.getPadding()+"px"),t.append(f);var n=new Hammer.Manager(f[0]);n.add(new Hammer.Pan({threshold:0,pointers:0})),n.on("pan",s),f.bind("mousedown touchstart",c),t.bind("$destroy",function(){n.destroy(),f.unbind("mousedown touchstart",c)})}var f,d,p={},h=e.ctx,g=e.options,m=0,y=0;return p.render=function(){var t=n.currentTime;d&&(t=m),y=t,e.renderLabelIfFree(t);var i=e.timeToPos(t);e.transformLineCenter(),h.fillStyle=g.seekHandleColor,h.translate(i,0),h.fill(r())},l(),p}return{restrict:"E",require:"^cfTimeLine",template:"<canvas></canvas>",scope:{ticks:"=",previewCtrl:"=?"},link:function(e,a,c,u){function s(e){var n=angular.element("<div></div>");n.addClass(e),a.append(n);var r=t.getComputedStyle(n[0]).color;return n.remove(),r}function l(){d.render()}var f=a.find("canvas"),d=n(f[0],u,{items:["TimeLineSeekItem"],color:s("default-color"),labelColor:s("label-color"),labelFont:"12px Roboto",background:"white",lineWidth:2,lineMargin:8,tickHeight:10,labelMargin:4,seekHandleSize:16,seekHandleColor:s("seek-handle-color"),height:42});d.addItem(new r(d)),d.addItem(new i(d,e.ticks)),d.addItem(new o(d,a,e.previewCtrl)),a.css("margin-left",-u.getPadding()+"px"),a.css("margin-right",-u.getPadding()+"px"),e.$on("timeLine:resize",l),e.$on("timeLine:redrawCanvas",l),e.$on("videoPreview:loaded",l),e.$on("videoPreview:timeUpdate",l)}}}]),angular.module("castifyEdit.ui.videoPreview",["w69b.throttle"]).directive("cfVideoPreview",["throttle","$interval","$document",function(e,t,n){return{restrict:"E",template:'<video autoplay cf-video-load="file"></video>',scope:{editConfig:"=",file:"="},require:["^cfVideoEditor","cfVideoPreview"],controller:["$scope",function(r){function i(e){e=e||0,p.duration-p.currentTime<=e&&(e=0);var t=r.editConfig.trim;return t&&t.end&&p.currentTime>=t.end-e}function o(){var e=r.editConfig.trim;!i(.05)||g.paused||g.ended||(p.pause(),g.seek(e.end))}function a(){g.currentTime!==y&&(o(),y=g.currentTime,h.$broadcast("videoPreview:timeUpdate"))}function c(){o(),g.paused&&(t.cancel(m),m=!1)}function u(){g.paused||m||(m=t(c,10,0,!1))}function s(){p.paused?g.play():g.pause()}function l(e){32===e.which&&e.target===b&&(s(),e.preventDefault())}function f(e){return Math.round(10*e)/10}function d(e){e=f(e),e!==p.currentTime&&(p.currentTime=f(e))}var p,h,g=this,m=null;g.loading=!1,g.duration=0;var y=g.currentTime,v=null,b=n.find("body")[0];Object.defineProperties(g,{ended:{get:function(){return p.ended||i()}},paused:{get:function(){return p.paused}},currentTime:{get:function(){return p.currentTime}},loading:{get:function(){return!v||p.seeking}}}),g.init=function(e,t){p=e[0],h=t,g.video=p,e.bind("timeupdate",a),e.bind("loadedmetadata",function i(){g.duration=p.duration,h.$broadcast("videoPreview:loaded"),e.unbind("loadedmetadata",i),r.$apply()}),e.bind("playing pause ended",function(){u(),r.$apply()}),e.bind("seeking seeked",function(e){r.$apply()}),e.bind("loadstart",function o(){v=!1,e.unbind("loadstart",o),r.$apply()}),e.bind("canplay",function c(){v=!0,e.unbind("canplay",c),r.$apply()}),n.bind("keydown",l),t.$on("$destroy",function(){n.unbind("keydown",l)})};var w=e(function(e){d(e)},100);g.pause=function(){p.pause()},g.play=function(){g.ended&&g.seekToStart(),p.play()},g.seekToStart=function(){var e=r.editConfig.trim;g.seek(e&&e.start||0)},g.seek=function(e){w.flush(),d(e)},g.getTrimmedEndTime=function(){var e=r.editConfig.trim;return e&&e.end||g.duration},g.getTrimmedStartTime=function(){var e=r.editConfig.trim;return e&&e.start||0},g.seekThrottled=function(e){e!==p.currentTime&&w(e)}}],link:function(e,t,n,r){var i=r[0],o=r[1];o.init(t.find("video"),i.getScope()),i.registerVideoPreview(o)}}}]),angular.module("castifyEdit.ui.timeLineSeekItem",[]).factory("TimeLineSeekItem",function(){function e(e){var t={};return t}return e}),angular.module("castifyEdit.editJobSchedulerClient",["castifyExt.backgroundTool"]).factory("editJobSchedulerClient",["backgroundTool","$timeout",function(e,t){var n,r=723517440,i=e.portHelper("editor",!1),o=!0,a={};a.jobs=[];var c={jobsList:function(e){a.jobs.length=0,a.jobs.push.apply(a.jobs,e),n&&t.cancel(n),n=null,o&&a.getJobsByState("running").length&&(n=t(a.getJobs,1e3))}};return i.installHandlers(c),a.addJob=function(e){i.postMessage("addJob",e)},a.cancel=function(e){i.postMessage("cancel",e)},a.getJobs=function(){i.postMessage("getJobs")},a.clearComplete=function(){i.postMessage("clearComplete")},a.getJobsByState=function(e){return a.jobs.filter(function(t){return t.state===e})},a.getLastCompleteExportJob=function(){var e=a.jobs.filter(function(e){return"done"===e.state&&e.result.url}).sort(function(e,t){return t.id-e.id});return e.length?e[0]:null},a.canExportGif=function(e,t){if(!e||!e.width||!e.height)return!0;var n=8,i=Math.min(1,t.width/e.width,t.height/e.height),o=5*i*e.width*i*e.height*n*e.duration;return r>o},a}]),angular.module("castifyExt.ui.fileEdit",["castifyEdit.ui.videoEditor","castifyEdit.editJobSchedulerClient","castifyExt.licensing"]).controller("FileEditCtrl",["$scope","$routeParams","fileDbClient","$location","editJobSchedulerClient","licensing",function(e,t,n,r,i,o){
e.fileId=t.fileId,n.getFileDescriptor(e.fileId).then(function(t){e.file=t}),e.onSave=function(t){o.isPaid()&&(t.meta.fileId=e.fileId,i.addJob(t),r.path("/files/"))},e.onCancel=function(){r.replace().path("/files/"+e.fileId)}}]),angular.module("castifyExt.ui.editJobsInfo",["castifyEdit.editJobSchedulerClient"]).directive("cfEditJobsInfo",["editJobSchedulerClient",function(e){return{restrict:"E",scope:{},templateUrl:"components/castifyExt/ui/edit-jobs-info/edit-jobs-info.html",link:function(t){t.scheduler=e,t.$watch(function(){return e.getJobsByState("queued").length},function(e){t.numQueued=e}),t.$watch(e.getLastCompleteExportJob,function(e){t.lastCompleteExportJob=e}),t.saveGif=function(t){var n=angular.element("<a></a>"),r=t.fileTitle.replace(/[\/,\\]/g,"");r+=".gif",n.attr("href",t.result.url),n.attr("download",r),n[0].dispatchEvent(new MouseEvent("click")),e.clearComplete()},e.getJobs()}}}]),angular.module("castifyExt.ui.connectAppChooser",["castifyExt.connect.connectedApps","castifyExt.connect.appRegistry"]).directive("cfConnectAppChooser",["connectedApps","appRegistry","$q",function(e,t,n){return{restrict:"E",transclude:!0,require:"?ngModel",templateUrl:"components/castifyExt/ui/connect-app-chooser/connect-app-chooser.html",scope:{onSelected:"&",onDisconnected:"&"},link:function(r,i,o,a){function c(){var e=(r.apps||[]).filter(function(e){return a.$viewValue&&e.id===a.$viewValue.id});return e.length?e[0]:null}function u(e){return r.loading=!0,e["finally"](function(){r.loading=!1}),e}function s(){return e.getConnected({hasShareUrl:!0}).then(t.getApps).then(function(e){r.apps=e,a&&a.$setViewValue(c())})}function l(){e.getConnected({hasShareUrl:!0}).then(function(e){r.hasApps=e.length>0})}function f(){return d?n.when():(d=!0,u(s()))}a&&(a.$render=angular.noop),r.select=function(e){r.selected=e,a&&a.$setViewValue(e),r.onSelected({app:e})},r.showMenu=function(e,t){f().then(function(){t(e)})},r.apps=[],r.loading=!1;var d=!1;l()}}}]),angular.module("castifyExt.ui.connectShareProgress",["castifyExt.syncDownloaderClient"]).directive("cfConnectShareProgress",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/connect-share-progress/connect-share-progress.html",replace:!1,scope:{fileId:"="},controller:"ConnectShareProgressCtrl"}}).controller("ConnectShareProgressCtrl",["$scope","syncDownloaderClient",function(e,t){var n=t.downloads;e.$watch(function(){return[e.fileId,n[e.fileId]]},function(){e.download=n[e.fileId]},!0),t.update()}]),angular.module("castifyExt.ui.connectedApps",["castifyExt.connect.connectedApps","ngMaterial"]).controller("ConnectedAppsCtrl",["$scope","connectedApps","$mdDialog",function(e,t,n){function r(){return t.getConnectedAppInfo().then(function(t){e.apps=t})}function i(t){return e.loading=!0,t["finally"](function(){e.loading=!1}),t}e.remove=function(r,i){n.show(n.confirm("Disconnect App").content('Do you want to disconnect "'+r.title+'" from Screencastify?').ok("Disconnect App").cancel("Cancel").targetEvent(i)).then(function(){e.apps.splice(e.apps.indexOf(r),1),t.disconnect(r.id)})},i(r())}]),angular.module("castifyExt.ui.themeConfig",["ngMaterial"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("orange",{"default":"800","hue-1":"300","hue-2":"600","hue-3":"900"}).accentPalette("pink")}]).config(["$mdIconProvider",function(e){e.defaultIconSet("gen/icons.svg")}]),angular.module("castifyExt.ui.loadingOverlay",[]).directive("cfLoadingBackdrop",function(){return{restrict:"E",template:'<md-progress-circular md-mode="indeterminate"></md-progress-circular>'}}).directive("cfLoadingOverlay",["$compile",function(e){return{restrict:"A",link:function(t,n,r){var i=null;t.$watch(r.cfLoadingOverlay,function(r){r?(i=e("<cf-loading-backdrop></cf-loading-backdrop>")(t),n.append(i)):i&&(i.remove(),i=null)})}}}]),angular.module("castifyExt.ui.openInAppTab",["w69b.chromeTabs","w69b.chromeWindows"]).service("openInAppTab",["chromeTabs","chromeRuntime","chromeWindows","$q",function(e,t,n,r){return function(n){var r="chrome-extension://"+t.id+"/app.html";0===n.lastIndexOf("#",0)&&(n=r+n),e.create({active:!0,url:n})}}]).directive("openInAppTab",["$window","openInAppTab",function(e,t){return{restrict:"A",link:function(n,r,i){r.bind("click",function(n){var r=angular.element(n.target),o=i.href||r.attr("href");o&&(n.preventDefault(),t(o).then(function(){e.close()}))})}}}]),angular.module("castifyExt.ui.upgradeButton",["castifyExt.upgradeHelper","w69b.chromeRuntime"]).directive("cfUpgradeButton",["upgradeHelper","chromeRuntime",function(e,t){return{restrict:"E",scope:{},template:'<md-button ng-click="action()" ng-disabled="loading">{{text}}</md-button>',link:function(n,r,i){n.loading=!1,n.$watch(e.isPaid,function(e){r.toggleClass("ng-hide",e)}),r.children().addClass(i["class"]),n.$watch(e.hasLicense,function(e){e?n.text="Upgrade":n.text="Sign In"}),n.action=function(){e.hasLicense()?e.openBuy(i.medium,i.campain):t.sendMessage(null,"bg:signInLicense",{}).then(function(){n.loading=!0,n.$apply()})}}}}]),angular.module("castifyExt.ui.classroomShare",["w69b.scriptloader"]).directive("cfClassroomShare",["scriptloader","$window",function(e,t){function n(){return e.load(r)}var r="https://apis.google.com/js/platform.js";return t.___gcfg={parsetags:"explicit"},{restrict:"E",scope:{url:"=",title:"="},template:"<div></div>",link:function(e,r){function i(){n().then(function(){var n=t.gapi;n.sharetoclassroom.render(o[0],{url:e.url,size:24,title:e.title})})}var o=r.children().eq(0);e.$watchGroup(["url","title"],function(){e.url?i():o.children().remove()})}}}]),angular.module("castifyExt.connect.appRegistry",["w69b.spawn","w69b.chromeStorage"]).factory("appRegistry",["castifyConfig","$http","$q","spawn","chromeStorage",function(e,t,n,r,i){function o(){return i.local.getSingle(h,[])}function a(e){return i.local.setSingle(h,e)}function c(e){return o().then(function(t){return t.filter(function(t){return e.includes(t.id)})})}function u(e,t){var n=Date.now(),r=e.some(function(e){return n>e._fetchTimestamp+g});return!r&&t.length===e.length}function s(e){return e.forEach(function(e){delete e._fetchTimestamp}),e}function l(e,t){return r($traceurRuntime.initGeneratorFunction(function n(){var r;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:e=new Set(e||[]),n.state=10;break;case 10:return n.state=2,o();case 2:r=n.sent,n.state=4;break;case 4:t.forEach(function(t){e.add(t.id)}),r=r.filter(function(t){return!e.has(t.id)}),t.forEach(function(e){e._fetchTimestamp=Date.now()}),r=r.concat(t),n.state=12;break;case 12:return n.state=6,a(r);case 6:n.maybeThrow(),n.state=-2;break;default:return n.end()}},n,this)}))}function f(e){return r($traceurRuntime.initGeneratorFunction(function i(){var r,o,a,f;return $traceurRuntime.createGeneratorInstance(function(i){for(;;)switch(i.state){case 0:i.state=e&&0!==e.length?2:1;break;case 1:i.returnValue=n.when([]),i.state=-2;break;case 2:return i.state=5,c(e);case 5:o=i.sent,i.state=7;break;case 7:i.state=u(o,e)?8:9;break;case 8:i.returnValue=s(o),i.state=-2;break;case 9:i.pushTry(19,null),i.state=22;break;case 22:return i.state=12,t.get(d,{params:{ids:e}});case 12:a=i.sent,i.state=14;break;case 14:r=a.data,i.state=16;break;case 16:i.popTry(),i.state=24;break;case 19:i.popTry(),i.maybeUncatchable(),f=i.storedException,i.state=17;break;case 17:i.returnValue=s(o),i.state=-2;break;case 24:return i.state=27,l(e,r);case 27:i.maybeThrow(),i.state=29;break;case 29:i.returnValue=s(r),i.state=-2;break;default:return i.end()}},i,this)}))}var d=e.API_URL+"/apps",p={},h="appRegistry:cache",g=6e4;return p.getApps=function(e){return f(e)},p.getAppInfo=function(e){return f([e]).then(function(e){return e.length?e[0]:n.reject()})},p}]),angular.module("castifyExt.connect.connectedApps",["w69b.chromeStorage","w69b.spawn","castifyExt.connect.appRegistry"]).factory("connectedApps",["chromeStorage","spawn","appRegistry","$rootScope",function(e,t,n,r){function i(){return e.sync.getSingle(l,[]).then(function(e){return e.map(function(e){return angular.isObject(e)?e:{id:e,hasShareUrl:!0}})})}function o(t){return e.sync.setSingle(l,t)}function a(){return e.sync.getSingle(f)}function c(t){return e.sync.setSingle(f,t)}function u(e,t){return e.some(function(e){return e.id===t})}var s={},l="connectedAppIds",f="connectedAppRecentId";s.getConnected=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,i();case 2:t=n.sent,n.state=4;break;case 4:e&&(t=t.filter(function(t){var n=!0;return angular.forEach(e,function(e,r){n=n&&t[r]===e}),n})),n.state=8;break;case 8:n.returnValue=t.map(function(e){return e.id}),n.state=-2;break;default:return n.end()}},n,this)}))},s.getConnectedAppInfo=t.wrap($traceurRuntime.initGeneratorFunction(function p(){var e,t;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,i();case 2:e=r.sent,r.state=4;break;case 4:return r.state=6,n.getApps(e.map(function(e){return e.id}));case 6:t=r.sent,r.state=8;break;case 8:t=angular.copy(t),t.forEach(function(t){var n=e.find(function(e){return e.id===t.id});angular.extend(t,n)}),r.state=12;break;case 12:r.returnValue=t,r.state=-2;break;default:return r.end()}},p,this)})),s.getConnectedAppInfoForApp=t.wrap($traceurRuntime.initGeneratorFunction(function h(e){var t,n;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,s.getConnectedAppInfo();case 2:t=r.sent,r.state=4;break;case 4:n=t.find(function(t){return t.id===e}),r.state=11;break;case 11:r.state=n?6:5;break;case 5:r.returnValue=null,r.state=-2;break;case 6:r.returnValue=n,r.state=-2;break;default:return r.end()}},h,this)})),s.isConnected=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,i();case 2:t=n.sent,n.state=4;break;case 4:n.returnValue=u(t,e),n.state=-2;break;default:return n.end()}},n,this)}))},s.disconnect=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,i();case 2:t=n.sent,n.state=4;break;case 4:t=t.filter(function(t){return t.id!==e}),n.state=14;break;case 14:return n.state=6,c(null);case 6:n.maybeThrow(),n.state=8;break;case 8:return n.state=10,o(t);case 10:n.maybeThrow(),n.state=12;break;case 12:r.$broadcast("connect:appDisconnected",e),n.state=-2;break;default:return n.end()}},n,this)}))},s.connect=function(e){return t($traceurRuntime.initGeneratorFunction(function a(){var t,s;return $traceurRuntime.createGeneratorInstance(function(a){for(;;)switch(a.state){case 0:return a.state=2,i();case 2:t=a.sent,a.state=4;break;case 4:return a.state=6,n.getAppInfo(e);case 6:s=a.sent,a.state=8;break;case 8:a.state=u(t,e)?12:14;break;case 14:t.push({id:e,hasShareUrl:!!s.shareUrl}),a.state=15;break;case 15:a.state=s.shareUrl?9:12;break;case 9:return a.state=10,c(e);case 10:a.maybeThrow(),a.state=12;break;case 12:return a.state=18,o(t);case 18:a.maybeThrow(),a.state=20;break;case 20:r.$broadcast("connect:appConnected",e,s),a.state=-2;break;default:return a.end()}},a,this)}))};var d=t.wrap($traceurRuntime.initGeneratorFunction(function g(e,t,n){var r,a,c;return $traceurRuntime.createGeneratorInstance(function(u){for(;;)switch(u.state){case 0:return u.state=2,i();case 2:r=u.sent,u.state=4;break;case 4:if(a=r.find(function(t){return t.id===e}),!a)throw new Error("Cannot set user data for non-connected app");c=a[t],null===n||angular.isUndefined(n)?delete a[t]:a[t]=n,u.state=12;break;case 12:return u.state=6,o(r);case 6:u.maybeThrow(),u.state=8;break;case 8:u.returnValue=c,u.state=-2;break;default:return u.end()}},g,this)}));return s.setUserExpiryDate=t.wrap($traceurRuntime.initGeneratorFunction(function m(e,t){var n;return $traceurRuntime.createGeneratorInstance(function(i){for(;;)switch(i.state){case 0:return i.state=2,d(e,"userExpiryDate",t);case 2:n=i.sent,i.state=4;break;case 4:r.$broadcast("connect:userExpiryDateChange",n,t),i.state=-2;break;default:return i.end()}},m,this)})),s.setUserShareUrl=function(e,t){return d(e,"shareUrl",t)},s.clearRecent=function(){return c(null)},s.getRecent=function(){return a()},s}]),angular.module("castifyExt.connect.appPermissions",["w69b.chromeStorage","w69b.spawn"]).factory("appPermissions",["chromeStorage","spawn",function(e,t){function n(e){var t=Date.now();return e.filter(function(e){return e.timeout>=t})}function r(){return e.local.getSingle(o,[]).then(n)}function i(t){return e.local.setSingle(o,t)}var o="appPermissions",a=18e5,c={};return c.hasAccess=function(e,t){return r().then(function(n){return n.some(function(n){return n.appId===e&&n.fileId===t})})},c.allowAccess=function(e,n){return t($traceurRuntime.initGeneratorFunction(function o(){var t;return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:return o.state=2,r();case 2:t=o.sent,o.state=4;break;case 4:t=t.filter(function(t){return t.appId!==e&&t.appId!==n}),t.push({appId:e,fileId:n,timeout:Date.now()+a}),o.state=10;break;case 10:return o.state=6,i(t);case 6:o.maybeThrow(),o.state=-2;break;default:return o.end()}},o,this)}))},c}]),angular.module("castifyExt.connect.connectService",["castifyExt.simpleBgServiceConsumer"]).factory("connectService",["simpleBgServiceConsumer",function(e){return e("connect",["share"])}]),angular.module("castifyExt.syncDownloaderClient",["castifyExt.backgroundTool"]).factory("syncDownloaderClient",["backgroundTool","$timeout",function(e,t){var n,r=e.portHelper("syncDownloader",!1),i=!0,o={};o.downloads={};var a={downloads:function(e){angular.copy(e,o.downloads),n&&t.cancel(n),n=null,i&&Object.keys(e).length&&(n=t(o.update,1e3))}};return r.installHandlers(a),o.update=function(){r.postMessage("update")},o}]),angular.module("castifyExt.syncStatusClient",["castifyExt.backgroundTool"]).factory("syncStatusClient",["backgroundTool",function(e){var t=e.portHelper("syncStatus",!1),n={};n.state={};var r={};return r.stateUpdate=function(e){angular.copy(e,n.state)},t.installHandlers(r),n.retry=function(){t.postMessage("retry")},t.getPort(),n}]),angular.module("castifyExt.uploader",["castifyExt.backgroundTool"]).factory("uploader",["backgroundTool",function(e){var t=e.portHelper("uploader"),n={};n.state={};var r={};return r.stateUpdate=function(e){angular.copy(e,n.state)},t.installHandlers(r),n.upload=function(e){t.postMessage("upload",e)},n.getFileState=function(e){return n.state[e]},n.getTargetState=function(e,t){var r=n.getFileState(e);return r?r[t]:null},n.isQueuedOrActive=function(e,t){var r=n.getTargetState(e,t);return r&&("uploading"===r.state||"queued"===r.state)},n}]),angular.module("castifyExt.licensing",["castifyExt.castifyAuth","w69b.chromeStorage","w69b.chromeRuntime","castifyExt.signInService","w69b.spawn","w69b.promiseTool","castifyExt.connect.connectedApps"]).factory("licensing",["castifyAuth","$http","chromeRuntime","chromeStorage","$q","$rootScope","$log","signInService","castifyConfig","promiseTool","spawn","connectedApps",function(e,t,n,r,i,o,a,c,u,s,l,f){function d(e){return c.getToken(e)}function p(){function e(){var e=window.chrome.identity,t=s.wrapChromeError(e.getAuthToken,e);return t({interactive:!1,scopes:["email","https://www.googleapis.com/auth/chromewebstore.readonly"]})}function o(){return l($traceurRuntime.initGeneratorFunction(function r(){var i,o,a,c,u;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:i=w+n.id,r.state=17;break;case 17:return r.state=2,e();case 2:o=r.sent,r.state=4;break;case 4:return r.state=6,t.get(i,{headers:{Authorization:"Bearer "+o}});case 6:a=r.sent,r.state=8;break;case 8:c=a.data,r.state=19;break;case 19:r.state=c.result&&c.createdTime?11:10;break;case 11:u=new Date(Number(c.createdTime)),r.state=12;break;case 12:r.returnValue=k>u,r.state=-2;break;case 10:r.returnValue=!1,r.state=-2;break;default:return r.end()}},r,this)}))}return T.isTester()?i.when(!0):r.sync.getSingle(C).then(function(e){return angular.isDefined(e)?e:i.reject()})["catch"](function(){return o().then(function(e){return r.sync.setSingle(C,e),e})})["catch"](function(){return!1})}function h(){return t.get(E+"/license",x).then(function(e){return e.data})}function g(){return f.getConnectedAppInfo().then(function(e){var t=Date.now(),n=e.some(function(e){return e.isPaidInstall&&(!e.userExpiryDate||e.userExpiryDate>=t)});return n?{access:"full",type:"app",maxAgeSecs:3600}:null})}function m(){return!A||b&&("tester"===b.access||"full"==b.access)}function y(e,t,n){n.isPaidInstall&&T.updateLicense()}function v(e,t,n){function r(e){return!e||e>=Date.now()}r(t)!=r(n)&&T.updateLicense()}var b,w="https://www.googleapis.com/chromewebstore/v1.1/userlicenses/",E=u.API_URL,k=1413892757176,x=c.AUTH_CONFIG,S="license",C="cws_license",$=600,A=!0,T={};return T.updateLicense=function(){function e(){return i.all([p(),h(),g()]).then(function(e){var t=e[0],n=e[1],r=e[2];return r&&"full"!==n.access?r:(t&&"full"!==n.access&&(n.access="tester",n.maxAgeSecs=3600),n)})}a.debug("updating, current state",T.hasLicense(),T.isPaid());var t=d().then(e,g).then(function(e){return e?(e.validTill=Date.now()+1e3*e.maxAgeSecs,r.sync.setSingle(S,e),a.debug("update completed for",e.user||e.type),e):i.reject("not_signed_in")});return t["catch"](function(e){a.debug("update failed",e),c.getEmail(!1).then(function(e){a.debug("update: chrome user is",e)})}),t},T.shouldLimitLength=function(){return!m()},T.shouldForceBranding=function(){return!(b&&!b.branding||m())},T.isPaid=function(){return!(!b||"full"!==b.access)},T.isTester=function(){return!(!b||"tester"!==b.access)},T.getMaxLength=function(){return m()?Number.POSITIVE_INFINITY:$},T.getVersionName=function(){var e=m()?"Full":"Free";if(b){var t=[b.access];b.type&&t.push(b.type),e+=" ("+t.join(" ")+")"}return e+" v"+n.getManifest().version},T.initialize=function(){return r.sync.getSingle(S).then(function(e){b=e,r.onChanged.addListener(function(e,t){"sync"==t&&e[S]&&(b=e[S].newValue,o.$$phase||o.$digest())}),n.getBackgroundPage(),o.$on("connect:appConnected",y),o.$on("connect:userExpiryDateChange",v)})},T.updateIfNeeded=function(){var e=b;(!e||!e.validTill||e.validTill<Date.now())&&T.updateLicense()},T.getToken=d,T.hasLicense=function(){return A&&!!b},T}]),angular.module("castifyExt.userInfo",["castifyExt.signInService","castifyExt.chromeEventPublisher"]).factory("userInfo",["$http","signInService","$rootScope",function(e,t,n){function r(){return t.getEmail().then(function(e){i.email=e,i.isSignedIn=!0},function(){i.email=null,i.isSignedIn=!1})}var i={isSignedIn:null,email:null};return i.getEmail=function(){return i.email},i.signIn=function(){t.signIn()},i.initialize=function(){r()},n.$on("event:signInChanged",function(){r()}),i}]),angular.module("castifyExt.chromeEventPublisher",[]).run(["chromeRuntime","$rootScope",function(e,t){var n="event:";e.onMessage.addListener(function(e){angular.isObject(e)&&angular.isString(e.type)&&0===e.type.lastIndexOf(n,0)&&t.$broadcast(e.type,e.data),t.$$phase||t.$digest()})}]),angular.module("castifyExt.signInService",["castifyExt.castifyAuth"]).factory("signInService",["castifyAuth","chromeRuntime","$rootScope","$log","$http",function(e,t,n,r,i){var o=["https://www.googleapis.com/auth/plus.me","email"],a={googleAuth:!0,googleAuthScopes:o},c="https://www.googleapis.com/plus/v1/people/me",u={SCOPES:o,AUTH_CONFIG:a};return u.getToken=function(t,n){var r={interactive:!!t,scopes:o,validate:n};return e.getAuthToken(r)},u.signIn=function(t){var n={interactive:"select_account",scopes:o,validate:!0};t===!1&&(n.useChromeAccount=!1);var i=e.getAuthToken(n);return i["catch"](function(e){r.warn("Sign in failed",e)}),i},u.getMe=function(){return i.get(c,a).then(function(e){return e.data})},u.getEmail=function(t){return t!==!1?u.getToken(!1).then(e.getChromeAccount):e.getChromeAccount()},u}]),angular.module("castifyExt.driveUtils",["w69b.googledrive","castifyExt.castifyAuth","w69b.es6","w69b.spawn","w69b.chromeStorage"]).factory("driveUtils",["googledrive","$q","spawn","$log","chromeStorage",function(e,t,n,r,i){function o(){return r.debug("driveUtils: creating Drive folder"),e.postFile({title:"Screencastify",mimeType:"application/vnd.google-apps.folder",description:"Screencastify uses this folder to store Screencasts that you upload. You may rename or move it, it will upload to this folder.",properties:[{key:"isScreencastifyUploadFolder",value:!0,visibility:"PRIVATE"}]})}function a(n){return e.getFile(n).then(function(e){return!e.labels.trashed},function(e){return 404===e.status?!1:(r.warn("driveUtils: checkIfExists failed",e),t.reject(e))})}function c(){var t="mimeType = 'application/vnd.google-apps.folder' and trashed = false and properties has { key='isScreencastifyUploadFolder' and value='true' and visibility='PRIVATE' }";return e.listFiles({q:t,maxResults:1}).then(function(e){return r.debug("driveUtils: findFolder items #",e.length),e.length?e[0]:null})}function u(e,t){var n=e.filter(function(e){return e.type===t});return n.length?n[0]:null}function s(e){return u(e,"anyone")}function l(e){return u(e,"domain")}function f(e){var t=s(e),n=l(e);return t?t.withLink?"unlisted":"public":n?n.withLink?"domain_unlisted":"domain_public":"private"}var d,p={},h="DRIVE_FOLDER_ID";return p.getDriveUploadParentId=function(e){return d&&!e||(d=n($traceurRuntime.initGeneratorFunction(function t(){var e,n,u,s,l,f,d,p;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:return t.state=2,i.sync.getSingle(h);case 2:e=t.sent,t.state=4;break;case 4:t.state=e?9:13;break;case 9:s=a(e),t.state=10;break;case 10:return t.state=6,s;case 6:l=t.sent,t.state=8;break;case 8:f=l,t.state=12;break;case 13:f=e,t.state=12;break;case 12:t.state=f?18:17;break;case 18:r.debug("driveUtil: using cached parent Id",e),t.state=19;break;case 19:t.returnValue=e,t.state=-2;break;case 17:return t.state=22,c();case 22:n=t.sent,t.state=24;break;case 24:t.state=n?32:29;break;case 29:d=o(),t.state=30;break;case 30:return t.state=26,d;case 26:p=t.sent,t.state=28;break;case 28:n=p,t.state=32;break;case 32:u=n.id,t.state=41;break;case 41:return t.state=35,i.sync.setSingle(h,u);case 35:t.maybeThrow(),t.state=37;break;case 37:t.returnValue=u,t.state=-2;break;default:return t.end()}},t,this)})),d["catch"](function(){d=null})),d},p.getSimplePrivacy=function(t){return e.listPermissions(t).then(f)},p.getLink=function(e){return"https://drive.google.com/file/d/"+e+"/view"},p.setSimplePrivacy=function(r,i,o){var a=i.startsWith("domain_");if(a&&!o)throw new Error;return n($traceurRuntime.initGeneratorFunction(function c(){var n,u,d,p;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:return c.state=2,e.listPermissions(r);case 2:n=c.sent,c.state=4;break;case 4:u=s(n),d=l(n),c.state=34;break;case 34:c.state=f(n)===i?5:31;break;case 5:c.returnValue=t.when(null),c.state=-2;break;case 31:c.state="private"===i?11:21;break;case 11:c.state=u?7:10;break;case 7:return c.state=8,e.removePermission(r,u.id);case 8:c.maybeThrow(),c.state=10;break;case 10:c.state=d?12:-2;break;case 12:return c.state=13,e.removePermission(r,d.id);case 13:c.maybeThrow(),c.state=-2;break;case 21:c.state=u?17:20;break;case 17:return c.state=18,e.removePermission(r,u.id);case 18:c.maybeThrow(),c.state=20;break;case 20:c.state=d?22:25;break;case 22:return c.state=23,e.removePermission(r,d.id);case 23:c.maybeThrow(),c.state=25;break;case 25:p={role:"reader",type:a?"domain":"anyone",withLink:"unlisted"===i||"domain_unlisted"===i},a&&(p.value=o),c.state=30;break;case 30:c.returnValue=e.insertPermission(r,p),c.state=-2;break;default:return c.end()}},c,this)}))},p}]),angular.module("castifyExt.youtubeUtils",["castifyExt.castifyAuth"]).factory("youtubeUtils",["$http","$q",function(e,t){function n(e){var n=e.data.items;return n.length?n[0]:t.reject("not found")}function r(t,r){return e.get(o,angular.extend({params:{id:t,part:"status,snippet"}},{youtubeAuth:r})).then(n)}function i(t,n,r){return r=angular.extend({id:t},r),e.put(o,r,angular.extend({params:{part:"status"}},{youtubeAuth:n})).then(function(e){return e.data})}var o="https://www.googleapis.com/youtube/v3/videos",a={};return a.getPrivacy=function(e,n){return r(e,n).then(function(e){return n!==e.snippet.channelId?t.reject():e.status.privacyStatus})},a.getLink=function(e){return"https://youtu.be/"+e},a.setPrivacy=function(e,t,n){return i(e,n,{status:{privacyStatus:t}})},a}]),angular.module("castifyExt.fileDbClient",["castifyExt.backgroundTool","castifyExt.appOptions","castifyExt.castifyAuth"]).factory("fileDbClient",["backgroundTool","$q","appOptions","castifyAuth","$log",function(e,t,n,r,i){function o(){return p||(p=t.defer(),l.postMessage("subscribe")),p.promise}function a(e){angular.extend(this,e),this.createdAt&&(this.createdAt=new Date(this.createdAt))}function c(e){var t=f[e.id];return t?(angular.copy(e,t),t):(f[e.id]=e,e)}function u(e){var t=f[e];t&&(t.deleted=!0,delete f[e])}function s(e,t){var n;t&&(n={},angular.forEach(f,function(e,t){n[t]=!0})),angular.forEach(e,function(e,r){c(new a(e)),t&&delete n[r]}),t&&angular.forEach(n,function(e,t){u(t)})}var l=e.portHelper("files",!1),f={},d={},p=null,h=!1,g={},m=0,y=a.prototype;y.getUrl=function(){var e=this;return e.urlRequiresAccessToken?r.getAuthToken({interactive:!1}).then(function(t){var n=e.url;return n+=n.indexOf("?")>=0?"&":"?",n+"access_token="+t}):t.when(e.url)};var v={};return v.filesUpdate=function(e){e.remove&&e.remove.forEach(u),e.add&&s(e.add,!1),e.full?(s(e.full,!0),!h&&p&&(h=!0,p.resolve())):e.error&&(h=!1,p&&(p.reject(),p=null)),m++},v.reloadSuccess=function(e){g[e]&&(g[e].resolve(),delete g[e])},v.reloadError=function(e){g[e]&&(g[e].reject(),delete g[e])},l.installHandlers(v),d.getFileDescriptor=function(e){return o().then(function(){var n=f[e];return n?n:t.reject()})},d.listFiles=function(){return o().then(function(){return f})},d.rename=function(e,t){var n=f[e];n&&(n.title=t),l.postMessage("rename",{id:e,title:t})},d.reload=function(e){return g[e]||(g[e]=t.defer(),l.postMessage("reload",e)),g[e].promise},d.remove=function(e){i.debug("fileDbClient.remove",e),u(e),l.postMessage("remove",e)},d.removeAll=function(e){i.debug("fileDbClient.removeAll"),angular.copy({},f),l.postMessage("removeAll",e)},d.isSyncEnabled=function(){return n.values.driveSync},d.getListVersionId=function(){return m},d}]),angular.module("castifyExt.syncAuthTool",["castifyExt.castifyAuth","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.driveUtils"]).factory("syncAuthTool",["castifyAuth","$http","$q","$log","appOptions","chromeRuntime","$rootScope","driveUtils",function(e,t,n,r,i,o,a,c){var u={};return u.broadcastIfSyncError=function(e){return"not_signed_in"===e?(r.debug("syncAuthTool: sync enabled but not signed in"),a.$broadcast("event:syncAuthError"),o.sendMessage({type:"event:syncAuthError"}),n.reject(e)):(i.values.driveSync&&u.checkSetup()["catch"](function(t){switch(t){case"token":r.debug("syncAuthTool: sync enabled but we do not have a valid token"),a.$broadcast("event:syncAuthError"),o.sendMessage({type:"event:syncAuthError"});break;case"forbidden":r.debug("syncAuthTool: detected drive-forbidden error",e),a.$broadcast("event:syncForbiddenError");break;default:r.warn("syncAuthTool: unhandled sync error detected",e)}}),n.reject(e))},u.isGoogleForbiddenError=function(e){return!!(angular.isObject(e)&&403===e.status&&e.data&&e.data.error)},u.hasValidAuthToken=function(){return e.getAuthToken({interactive:!1,validate:!0})},u.checkSetup=function(){function e(){return c.getDriveUploadParentId()["catch"](function(e){return u.isGoogleForbiddenError(e)?n.reject("forbidden"):n.reject("unknown")})}return u.hasValidAuthToken()["catch"](function(){return n.reject("token")}).then(e).then(function(){return!0})},u}]),angular.module("castifyExt.youtubeAuth",["w69b.uritool","castifyExt.castifyAuth"]).provider("youtubeAuth",function(){var e,t=["https://www.googleapis.com/auth/youtube"];this.setScopes=function(e){t=e},this.setClientId=function(t){e=t},this.$get=["castifyAuth","$log","uritool","$q","$http","castifyConfig",function(n,r,i,o,a,c){function u(e){return m+"?"+i.encodeQuery(e)}function s(e){return e.data}function l(){return n.getRedirectURL().then(function(i){var a={redirect_uri:i,scope:t.join(" "),response_type:"code",client_id:e,access_type:"offline",include_granted_scopes:!1,prompt:"select_account consent"},c=u(a),s={url:c,interactive:!0};return n.launchWebAuthFlow(s).then(function(e){return r.debug("youtube oauth result",e),e.code?e.code:o.reject("youtube_flow_returned_no_code")})})}function f(e){return a.post(h,{code:e,version:2},{googleAuth:!0}).then(s,function(e){return r.warn("adding youtube code failed",e),o.reject("youtube_add_code_failed")})}function d(e){return a.get(g+"/"+e,{googleAuth:!0}).then(s).then(function(e){return e.expiresAt=Number(new Date(e.expiresAt)),e.issuedAt=Number(new Date(e.issuedAt)),e})}var p=c.API_URL+"/youtube/",h=p+"channels",g=p+"tokens",m="https://accounts.google.com/o/oauth2/auth",y={},v=0,b={};return b.addChannel=function(){return n.getAuthToken({interactive:!0}).then(l).then(f)},b.listChannels=function(){return a.get(h,{googleAuth:!0}).then(s)},b.removeChannel=function(e){return a["delete"](h+"/"+e,{googleAuth:!0}).then(s)},b.getAuthToken=function(e){if(!e.channelId)throw new Error;var t,n=e.channelId,r=Math.floor(Date.now()-v)+12e4,i=y[n];return i&&i.expiresAt>r?t=o.when(i):(t=d(n),t.then(function(e){y[n]=e,e.issuedAt&&(v=Date.now()-Number(e.issuedAt))})),t.then(function(e){return e.accessToken})},b}]}).factory("youtubeHttpAuthInterceptor",["$q","$injector","$log",function(e,t,n){function r(e){var t={channelId:e};return o().getAuthToken(t)}function i(e){return{Authorization:"Bearer "+e}}function o(){return a||(a=t.get("youtubeAuth")),a}var a;return{request:function(t){return t.youtubeAuth?(t.googleAuth&&delete t.googleAuth,r(t.youtubeAuth).then(function(e){return t.headers=angular.extend(t.headers||{},i(e)),t},function(t){return n.warn("youtubeAuth failed",t),e.reject("youtubeAuth failed")})):t}}}]),angular.module("castifyExt.castifyAuth",["castifyExt.simpleBgServiceConsumer"]).factory("castifyAuth",["simpleBgServiceConsumer",function(e){return e("castifyAuth",["launchWebAuthFlow","getRedirectURL","removeCachedAuthToken","getAuthToken","getChromeAccount"])}]).factory("googleauth",["castifyAuth","$q",function(e,t){var n={};return n.loadClient=function(){return t.when()},n.getAuthToken=function(t){e.getAuthToken(angular.isObject(t)?t:{interactive:!!t})},n}]),angular.module("castifyExt.requestMicPermission",[]).factory("requestMicPermission",["$window","$q","$interval",function(e,t,n){return function(){var r=t.defer(),i=e.open("mic.html","mic",""),o=!1;i.clGotStream=function(){o=!0,r.resolve()};var a=n(function(){i.closed&&!o&&r.reject("closed mic permission window without granting permission")},200);return r.promise["finally"](function(){n.cancel(a)}),r.promise}}]),angular.module("castifyExt.commonConfig",["castifyExt.castifyAuth","w69b.chromeAnalytics","w69b.chromeRuntime","castifyExt.licensing","castifyExt.helpCenterConfig","castifyExt.appOptions"]).config(["$compileProvider","$sceDelegateProvider","analyticsProvider",function(e,t,n){n.setTrackingId("UA-23874345-14"),n.setApp("Screencastify"),t.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**","https://**"]);var r=/^\s*(https?|mailto|blob|chrome-extension|filesystem:chrome-extension):/;e.aHrefSanitizationWhitelist(r),e.imgSrcSanitizationWhitelist(r)}]).run(["$rootScope","analytics","chromeRuntime","licensing","$location","appOptions","$injector",function(e,t,n,r,i,o,a){var c=a.has("$route")?a.get("$route"):null;if(c){var u;e.$on("$viewContentLoaded",function(){var e=i.path();t.tracker.sendAppView(c.current.pageTitle||e),
u=e})}e.$watch(function(){return r.hasLicense()?r.isPaid()?"paid":r.isTester()?"tester":"trial":"unknown"},function(e){t.tracker.set("dimension1",e)}),o.loadedPromise.then(function(){t.setEnabled(o.values.enableAnalytics)})}]).value("castifyConfig",{API_URL:"https://www.screencastify.com/api",IS_E2E:window.localStorage.e2e}),angular.module("castifyExt.authConfig",["castifyExt.youtubeAuth","castifyExt.castifyAuth","w69b.chromeRuntime","w69b.googleHttpAuthInterceptor","castifyExt.youtubeAuth"]).config(["$httpProvider","youtubeAuthProvider","googleHttpAuthInterceptorProvider",function(e,t,n){var r="242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com";t.setClientId(r),e.interceptors.push("youtubeHttpAuthInterceptor"),e.interceptors.push("googleHttpAuthInterceptor"),n.enableAuthAutoRetry(!0),n.setAuthProvider("castifyAuth")}]),angular.module("castifyExt.enterprisePolicy",["w69b.chromeStorage"]).provider("enterprisePolicy",function(){var e={};this.setOverride=function(t){e=t},this.$get=["chromeStorage","$rootScope",function(t,n){var r={},i=!1,o={};angular.extend(o,e);var a=["disableSharing","disableSaveToDisk","options"];return a.forEach(function(e){Object.defineProperty(r,e,{get:function(){return o[e]}})}),r.loadedPromise=t.managed.get(a).then(function(t){angular.extend(o,t,e),i=!0}),r.isLoaded=function(){return i},r.has=function(e){return o.hasOwnProperty(e)},r.get=function(e){return o[e]},t.onChanged.addListener(function(e,t){"managed"===t&&(angular.forEach(e,function(e,t){o[t]=e.newValue}),n.$$phase||n.$digest())}),r}]}),angular.module("castifyExt.upgradeHelper",["castifyExt.licensing","w69b.chromeTabs"]).factory("upgradeHelper",["chromeTabs","licensing",function(e,t){var n={};return n.openBuy=function(t,n){n||(n=t);var r="https://www.screencastify.com/buy?utm_source=app&utm_medium="+t+"&utm_campaign="+n;e.create({url:r})},n.isPaid=function(){return t.isPaid()},n.hasLicense=function(){return t.hasLicense()},n}]),angular.module("castifyExt.helpCenter",["w69b.chromeTabs"]).factory("helpCenter",["chromeTabs",function(e){var t={};return t.tagUrls={},t.registerUrl=function(e,n){t.tagUrls[e]=n},t.hasHelpFor=function(e){return t.tagUrls.hasOwnProperty(e)},t.openHelp=function(n){var r=t.tagUrls[n];if(!r)throw new Error("No help url registered for "+n);e.create({url:r})},t.setNotifyHelp=function(e,n){e.onButtonClicked=e.onClicked=function(){t.openHelp(n),e.clear()}},t}]),angular.module("castifyExt.helpCenterConfig",["castifyExt.helpCenter"]).run(["helpCenter",function(e){e.registerUrl("load_nacl","https://screencastify.uservoice.com/knowledgebase/articles/507908"),e.registerUrl("disk_space","https://screencastify.uservoice.com/knowledgebase/articles/507914"),e.registerUrl("drive_apps","https://screencastify.uservoice.com/knowledgebase/articles/460525"),e.registerUrl("start_recording","https://screencastify.uservoice.com/knowledgebase/articles/448826"),e.registerUrl("change_account","https://screencastify.uservoice.com/knowledgebase/articles/555387"),e.registerUrl("quotaExceeded","https://screencastify.uservoice.com/knowledgebase/articles/870177"),e.registerUrl("youtubeSignupRequired","https://screencastify.uservoice.com/knowledgebase/articles/780183")}]),angular.module("castifyExt.simpleBgServiceConsumer",["w69b.chromeRuntime"]).factory("simpleBgServiceConsumer",["chromeRuntime","$q",function(e,t){function n(n,r){function i(e){return e.error?t.reject(e.error):e.data}function o(t){return function(){return e.sendMessage({type:"simpleService",fn:t,service:n,data:Array.prototype.concat.apply([],arguments)}).then(i)}}var a={};return r.forEach(function(e){a[e]=o(e)}),a}return n}]),angular.module("castifyExt.optionalPermissions",["w69b.chromePermissions"]).factory("optionalPermissions",["chromePermissions",function(e){function t(e){return e&&(!e.draw||e.draw&&!e.draw.showToolbox&&null===e.draw.tool)?i:r}var n={},r={permissions:["tabCapture","webNavigation","activeTab"],origins:["<all_urls>"]},i={permissions:["tabCapture","webNavigation","activeTab"],origins:[]};return n.hasLiteTabPermissions=function(){return e.contains(i)},n.hasTabPermissions=function(n){return e.contains(t(n))},n.requestTabPermissions=function(n){return e.request(t(n))},n}]),angular.module("w69b.chromePersistentLogger",["w69b.chromeStorage","w69b.logging","w69b.structs.CircularBuffer"]).provider("chromePersistentLogger",["$logProvider",function(e){function t(e,t){var r={level:e,args:t,timestamp:(new Date).getTime()};return n?n.add(r):i.push(r),!0}var n,r="logs",i=[],o=!1,a=1e3,c="logs_",u=!1,s=!0;this.setStorageKey=function(e){r=e},this.setMaxNumLogs=function(e){a=e},this.enableAutoLoad=function(e){o=e},this.enableAutoSave=function(e){s=e},this.enableGlobalHandler=function(e){u=e},this.install=function(){this.enableAutoLoad(!0),e.setCustomHook(t)},this.$get=["$window","$q","chromeStorage","CircularBuffer","$log",function(e,l,f,d,p){function h(e){var t=e.args.map(function(e){if(!angular.isObject(e))return e;try{return angular.toJson(e)}catch(t){return e}});return[new Date(e.timestamp).toISOString(),e.level.toUpperCase(),t.join(", ")].join(" ")}function g(e){var t=new d(a);return e.forEach(function(e){t.add(e)}),t}var m={};return m.load=function(){return f.local.getSingle(c+r).then(function(e){e&&e.length&&(n=g(e.concat(m.getEntries())))})},m.save=function(e){return f.local.setSingle(c+(e||r),m.getEntries())},m.clear=function(){n.clear()},m.getEntries=function(){return n.getValues()},m.getLogs=function(){return m.getEntries().map(h)},m.getMergedLogs=function(e){return e=e.map(function(e){return c+e}),f.local.get(e).then(function(e){var t=[];return angular.forEach(e,function(e,n){e&&e.length&&e.forEach(function(e){e.storageKey=n.substr(c.length),t.push(e)})}),t.sort(function(e,t){return e.timestamp-t.timestamp}),t.map(function(e){return"["+e.storageKey+"] "+h(e)})})},m.hookFn=t,n=g(i),i=null,o&&m.load(),u&&(e.onerror=function(e,t,n){p.error("global error",e,t,n)}),s&&e.addEventListener("unload",function(){m.save()}),m}]}]).run(["chromePersistentLogger",angular.noop]),angular.module("w69b.chromeSystem",["w69b.promiseTool"]).factory("chromeSystem",["promiseTool",function(e){var t=window.chrome&&window.chrome.system,n={};return t?(t.cpu&&(n.cpu={getInfo:e.wrapChromeError(t.cpu.getInfo,t.cpu)}),t.memory&&(n.memory={getInfo:e.wrapChromeError(t.memory.getInfo,t.memory)}),n):n}]),angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(e){var t={};return t.sendMessage=e.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),t.getBackgroundPage=e.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),t.connect=chrome.runtime.connect.bind(chrome.runtime),t.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),t.id=chrome.runtime.id,chrome.runtime.getPlatformInfo&&(t.getPlatformInfo=e.wrapChromeError(chrome.runtime.getPlatformInfo,chrome.runtime)),["onMessage","onMessageExternal","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach(function(e){t[e]={addListener:function(t){chrome.runtime[e].addListener(t)},removeListener:function(t){chrome.runtime[e].removeListener(t)}}}),t}]),angular.module("w69b.chromeStorage",["w69b.promiseTool"]).factory("chromeStorage",["promiseTool",function(e){var t=chrome.storage,n={};return["local","sync","managed"].forEach(function(r){n[r]={},["set","get","remove","clear"].forEach(function(i){n[r][i]=e.wrapChromeError(t[r][i],t[r])}),n[r].setSingle=function(e,t){var i={};return i[e]=t,n[r].set(i)},n[r].getSingle=function(e,t){return n[r].get(e).then(function(n){return n.hasOwnProperty(e)?n[e]:t})}}),n.onChanged=t.onChanged,n}]),angular.module("w69b.chromeTabs",["w69b.promiseTool"]).factory("chromeTabs",["$window","promiseTool","$q",function(e,t,n){if(!e.chrome||!e.chrome.tabs)return null;var r=e.chrome,i={};return i.query=t.wrapChromeError(r.tabs.query,r.tabs),i.getActiveTab=function(){return i.query({active:!0,windowId:r.windows.WINDOW_ID_CURRENT}).then(function(e){return e.length?e[0]:n.reject()})},i.get=t.wrapChromeError(r.tabs.get,r.tabs),i.update=t.wrapChromeError(r.tabs.update,r.tabs),i.remove=t.wrapChromeError(r.tabs.remove,r.tabs),i.create=t.wrapChromeError(r.tabs.create,r.tabs),i.connect=r.tabs.connect.bind(r.tabs),i.setZoomSettings=t.wrapChromeError(r.tabs.setZoomSettings,r.tabs),i.setZoom=t.wrapChromeError(r.tabs.setZoom,r.tabs),i.executeScript=t.wrapChromeError(r.tabs.executeScript,r.tabs),i.insertCSS=t.wrapChromeError(r.tabs.insertCSS,r.tabs),i.sendMessage=t.wrapChromeError(r.tabs.sendMessage,r.tabs),i.onUpdated=r.tabs.onUpdated,i.onActivated=r.tabs.onActivated,i.sendMessageActive=function(e,t){return i.getActiveTab().then(function(n){return i.sendMessage(n.id,e,t)})},i}]).directive("newTab",["chromeTabs",function(e){return{restrict:"A",link:function(t,n,r){n.bind("click",function(t){t.preventDefault(),e.create({url:r.href}).then(function(e){chrome.windows.update(e.windowId,{focused:!0},angular.noop)})})}}}]),angular.module("w69b.chromeWindows",[]).factory("chromeWindows",["promiseTool",function(e){var t={};return t.get=e.wrapChromeError(chrome.windows.get,chrome.windows),t.create=e.wrapChromeError(chrome.windows.create,chrome.windows),t.update=e.wrapChromeError(chrome.windows.update,chrome.windows),t.getCurrent=e.wrapChromeError(chrome.windows.getCurrent,chrome.windows),t.remove=e.wrapChromeError(chrome.windows.remove,chrome.windows),t.onRemoved=chrome.windows.onRemoved,t}]),angular.module("w69b.googleHttpAuthInterceptor",[]).provider("googleHttpAuthInterceptor",function(){var e=0,t="googleauth";this.enableAuthAutoRetry=function(t){e=t?1:0},this.setAuthProvider=function(e){t=e},this.$get=["$q","$log","$injector",function(n,r,i){function o(){return f||(f=i.get(t)),f}function a(e){return o().getAuthToken(e)}function c(e){return{Authorization:"Bearer "+e}}function u(){return l||(l=i.get("$http")),l}function s(t){var i=t.status;if(401==i&&t.config.googleAuth&&t.config.authAutoRetry!==!1){r.debug("auth error detected",t);var o=angular.copy(t.config);if(o.authRetryCount?o.authRetryCount++:o.authRetryCount=1,o.authRetryCount<=e)return a({scopes:o.googleAuthScopes,validate:!0}).then(function(){return r.debug("googleAuthHttpInterceptor: auto-retrying with validated token"),u()(o)})}return n.reject(t)}var l,f;return{request:function(e){return e.googleAuth?a({scopes:e.googleAuthScopes}).then(function(t){return e.headers=angular.extend(e.headers||{},c(t)),e},function(e){return r.warn("googleAuthHttpInterceptor: no token, aborting request",e),n.reject("googleAuthFailed")}):e},responseError:s}}]}),angular.module("w69b.logging",[]).provider("$log",function(){var e=!0,t=this,n=!1;this.debugEnabled=function(t){return angular.isDefined(t)?(e=t,this):e},this.setCustomHook=function(e){n=e},this.$get=["$window",function(r){function i(e){return e instanceof Error&&(e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}function o(e){var t=r.console||{},o=t[e]||t.log||angular.noop,a=!1;try{a=!!o.apply}catch(c){}return a?function(){var r=[];return angular.forEach(arguments,function(e){r.push(i(e))}),n&&n(e,r)?o.apply(t,r):void 0}:function(t,r){n&&n(e,[t,r])&&o(t,null===r?"":r)}}return{log:o("log"),info:o("info"),warn:o("warn"),error:o("error"),debug:function(){var n=o("debug");return function(){e&&n.apply(t,arguments)}}()}}]}),angular.module("w69b.filesHelper",["w69b.promiseTool"]).factory("filesHelper",["$window","promiseTool","$q",function(e,t,n){function r(e){var t=e.split("/"),n=t.slice(0,-1).join("/"),r=t.slice(-1)[0];return[n,r]}e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem;var i=window.PERSISTENT,o=104857600,a={},c=["readEntries","remove","getFile","getMetadata","moveTo","file","getDirectory","createWriter"];return c.forEach(function(e){a[e]=function(n){var r=[].slice.call(arguments,1);return t.wrapCallbacks(n[e],n).apply(null,r)}}),a.getFileSystem=function(n,r){return angular.isUndefined(n)&&(n=i),r=r||o,t.wrapCallbacks(e.requestFileSystem,e)(n,r)},a.getPersistentQuota=function(){var t=n.defer();return e.navigator.webkitPersistentStorage.queryUsageAndQuota(function(e,n){t.resolve({usage:e,quota:n})},function(e){t.reject(e)}),t.promise},chrome.system&&chrome.system.storage&&(a.getStorageInfo=t.wrapChromeError(chrome.system.storage.getInfo,chrome.system.storage)),a.getDirByPath=function(e,t){function r(e,i){return i.length?a.getDirectory(e,i[0],t||{}).then(function(e){return r(e,i.slice(1))}):n.when(e)}var i=e.split("/");return""===i[0]&&i.splice(0,1),a.getFileSystem().then(function(e){return r(e.root,i,t)})},a.moveFileByPath=function(e,t){var i=r(t),o=i[0],c=i[1];return n.all({file:a.getFileEntryByPath(e),targetDir:a.getDirByPath(o)}).then(function(e){return a.moveTo(e.file,e.targetDir,c)})},a.getFileEntryByPath=function(e,t,n){var i=r(e),o=i[0],c=i[1];return a.getDirByPath(o,n).then(function(e){return a.getFile(e,c,t||{})})},a.getFileByPath=function(e){return a.getFileEntryByPath(e).then(function(e){return a.file(e)})},a.removeByPath=function(e){return a.getFileEntryByPath(e).then(function(e){return a.remove(e)})},a.listByPath=function(e){return a.getDirByPath(e).then(function(e){var t=e.createReader();return a.readEntries(t)})},a.requestPersistentQuota=function(e){return t.wrapCallbacks(navigator.webkitPersistentStorage.requestQuota,navigator.webkitPersistentStorage)(e||o)},a.requestTemporaryQuota=function(e){return t.wrapCallbacks(navigator.webkitTemporaryStorage.requestQuota,navigator.webkitTemporaryStorage)(e||o)},a.writeFile=function(e,t){var r=n.defer();return e.onwriteend=r.resolve.bind(r),e.onerror=r.reject.bind(r),e.write(t),r.promise},a.isSupported=function(){return!!window.requestFileSystem},a}]),angular.module("w69b.timeutil",[]).factory("timeutil",function(){var e={};return e.formatDuration=function(e){function t(e){return 10>e?"0"+e:e}angular.isNumber(e)||(e=0);var n="";0>e&&(n="-",e=-e);var r=Math.floor(e%60),i=Math.floor(e/60%60),o=[t(i),t(r)],a=Math.floor(e/3600);return a&&o.unshift(a),n+o.join(":")},e}).filter("duration",["timeutil",function(e){return function(t){return e.formatDuration(t||0)}}]),angular.module("w69b.chromeAnalytics",[]).provider("analytics",function(){var e,t;this.setTrackingId=function(t){e=t},this.setApp=function(e,n){t=arguments},this.$get=["$window",function(n){if(!t)throw new Error("make sure to call analyticsProvider.setApp()");if(!n.analytics)throw new Error("chrome-analytics lib not loaded");var r=n.analytics,i=r.getService.apply(r,t),o=i.getTracker(e),a={};return a.tracker=o,a.eventBuilder=function(){return r.EventBuilder.builder()},a.setEnabled=function(e){i.getConfig().addCallback(function(t){t.setTrackingPermitted(e)})},a.send=function(){o.send.apply(o,arguments)},a.trackPageView=function(e){o.sendAppView(e)},a.trackEvent=function(){o.sendEvent.apply(o,arguments)},a.trackTimer=function(e,t,n){var r,i={};return i.start=function(){return r=(new Date).getTime(),i},i.send=function(a,c,u){var s=(new Date).getTime();return o.sendTiming(a||e,c||t,s-r,u||n),i},i.start(),i},a}]}),angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,t){var n={};return n.wrapChromeError=function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),i=e.defer();return r.push(function(e){chrome.runtime.lastError?i.reject(chrome.runtime.lastError):i.resolve(e)}),t.apply(n,r),i.promise}},n.wrapCallbacks=function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),i=e.defer();return r.push(i.resolve.bind(i)),r.push(i.reject.bind(i)),t.apply(n,r),i.promise}},n.serializer=function(){var t=null;return function(n){var r=e.defer();return(t||e.when())["finally"](function(){var e=n.call();r.resolve(e)}),t=r.promise,t["finally"](function(){t=null}),r.promise}},n.withTimeout=function(n,r,i){i||(i=angular.noop);var o=e.defer(),a=t(function(){var e=i();angular.isDefined(e)?o.resolve(e):o.reject("timeout"),o=null},r),c=n(),u=o.promise;return c["finally"](function(){t.cancel(a),a=null}),c.then(function(){o&&o.resolve.apply(o,arguments)},function(){o&&o.reject.apply(o,arguments)}),u},n}]),angular.module("w69b.uritool",[]).factory("uritool",function(){function e(e){return decodeURIComponent(e.replace(t," "))}var t=/\+/g,n={};return n.parseQuery=function(t,n){"?"==t[0]&&(t=t.substring(1));for(var r,i=/([^&=]+)=?([^&]*)/g,o={};r=i.exec(t);){var a=e(r[1]),c=e(r[2]);n&&o.hasOwnProperty(a)?o[a].push(c):o[a]=n?[c]:c}return o},n.parseUrl=function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,hash:t.hash,path:t.pathname}},n.encodeQuery=function(e){var t=[];return angular.forEach(e,function(e,n){angular.isArray(e)?angular.forEach(e,function(e){t.push(encodeURIComponent(n)+(e===!0?"":"="+encodeURIComponent(e)))}):t.push(encodeURIComponent(n)+(e===!0?"":"="+encodeURIComponent(e)))}),t.length?t.join("&"):""},n}),angular.module("w69b.uuid",[]).factory("uuid",["$window",function(e){function t(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}function n(){var n=new Uint16Array(8);return e.crypto.getRandomValues(n),t(n[0])+t(n[1])+"-"+t(n[2])+"-4"+t(n[3]).substring(1)+"-y"+t(n[4]).substring(1)+"-"+t(n[5])+t(n[6])+t(n[7])}return n}]),angular.module("w69b.structs.CircularBuffer",[]).factory("CircularBuffer",function(){var e=function(e){this.maxSize_=e||100,this.buff_=[]},t=e.prototype;return t.nextPtr_=0,t.add=function(e){this.buff_[this.nextPtr_]=e,this.nextPtr_=(this.nextPtr_+1)%this.maxSize_},t.get=function(e){return e=this.normalizeIndex_(e),this.buff_[e]},t.set=function(e,t){e=this.normalizeIndex_(e),this.buff_[e]=t},t.getCount=function(){return this.buff_.length},t.isEmpty=function(){return 0===this.buff_.length},t.clear=function(){this.buff_.length=0,this.nextPtr_=0},t.getValues=function(){return this.getNewestValues(this.getCount())},t.getNewestValues=function(e){for(var t=this.getCount(),n=this.getCount()-e,r=[],i=n;t>i;i++)r.push(this.get(i));return r},t.getKeys=function(){for(var e=[],t=this.getCount(),n=0;t>n;n++)e[n]=n;return e},t.containsKey=function(e){return e<this.getCount()},t.containsValue=function(e){for(var t=this.getCount(),n=0;t>n;n++)if(this.get(n)==e)return!0;return!1},t.getLast=function(){return 0===this.getCount()?null:this.get(this.getCount()-1)},t.normalizeIndex_=function(e){if(e>=this.buff_.length)throw Error("Out of bounds exception");return this.buff_.length<this.maxSize_?e:(this.nextPtr_+Number(e))%this.maxSize_},e}),angular.module("w69b.spawn",[]).factory("spawn",["$q","$log",function(e,t){function n(t,n){function r(e,t){var n;try{n=e(t)}catch(r){return i(r)}return n.done?o(n.value):o(n.value).then(c,u)}var i=n?Promise.reject.bind(Promise):e.reject.bind(e),o=n?Promise.resolve.bind(Promise):e.when.bind(e),a=t(),c=r.bind(null,a.next.bind(a)),u=r.bind(null,a["throw"].bind(a));return c()}return n.wrap=function(e){return function(){var r,i=arguments,o=n((r=e).bind.apply(r,$traceurRuntime.spread([this],i)));return o["catch"](function(e){t.error("unhandled spawn.wrap rejection:",e),e.stack&&console.error(e.stack)}),o}},n}]),angular.module("w69b.throttle",[]).factory("throttle",["$timeout",function(e){function t(t,n,r){var i,o,a;r=r!==!1;var c=function(){a=angular.copy(arguments,[]),o=function(){return i=null,o=null,t.apply(null,a)},r?(i&&e.cancel(i),i=e(o,n)):i||(i=e(o,n))};return c.flush=function(){i&&(e.cancel(i),o())},c}return t}]),angular.module("w69b.ui.pageTitle",[]).controller("titleController",["$scope","$route",function(e,t){e.$root.$on("$routeChangeSuccess",function(){e.$root.pageTitle=t.current.pageTitle})}]),angular.module("w69b.webrtc",["w69b.promiseTool"]).factory("webrtc",["promiseTool","$window","$q",function(e,t,n){function r(e){return e.some(function(e){return!!e.label})}var i={},o=t.navigator;return i.getUserMedia=e.wrapCallbacks(o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia,o),o.mediaDevices&&o.mediaDevices.enumerateDevices?i.getSources=function(){return n.when(o.mediaDevices.enumerateDevices()).then(function(e){return e.filter(function(e){return e.kind.endsWith("input")}).map(function(e){var t={id:e.deviceId,label:e.label};return t.kind=e.kind.substring(0,e.kind.length-5),t})})}:i.getSources=e.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),i.getSourcesByKind=function(e){return i.getSources().then(function(t){return t.filter(function(t){return t.kind===e})})},i.getVideoSources=function(){return i.getSourcesByKind("video")},i.getAudioSources=function(){return i.getSourcesByKind("audio")},i.hasCamera=function(){return i.getVideoSources().then(function(e){return e.length>0})},i.hasMicrophone=function(){return i.getAudioSources().then(function(e){return e.length>0})},i.hasVideoAccess=function(){return i.getVideoSources().then(r)},i.hasAudioAccess=function(){return i.getAudioSources().then(r)},i}]),angular.module("w69b.ui.focus",[]).directive("wbLoopFocus",["$document","$timeout",function(e,t){return{restrict:"A",link:function(n,r){function i(){var e=a.querySelector('input:not([tabindex^="-"]),textarea:not([tabindex^="-"]),button:not([tabindex^="-"]),*[tabindex]:not([tabindex^="-"])');e&&e.focus()}function o(e){var n=e.target;e.relatedTarget||a.contains(n)&&n!==a||t(i)}var a=r[0];r.attr("tabindex",-1);var c=e.find("body");c[0].addEventListener("focus",o,!0),r.on("$destroy",function(){c[0].removeEventListener("focus",o,!0)})}}}]).directive("wbFocus",["$timeout",function(e){return{link:function(t,n,r){t.$watch(r.wbFocus,function(t){t&&e(function(){n[0].focus(),n[0].select&&n[0].select()})},!0),n.bind("blur",function(){angular.isDefined(r.wbFocusLost)&&t.$apply(r.wbFocusLost)})}}}]).directive("wbAutoselect",["$timeout",function(e){return{link:function(t,n){n.bind("focus click",function(){e(function(){n[0].select()})})}}}]),angular.module("w69b.clipboard",[]).factory("clipboard",["$document",function(e){var t={};return t.copy=function(t){var n=angular.element("<textarea></textarea>");n.text(t),e.find("body").append(n),n[0].select(),e[0].execCommand("copy"),n.remove()},t}]),angular.module("w69b.ui.drivepicker",["w69b.googledrive"]).directive("wbDrivePickerButton",["googleauth","googledrive","$log",function(e,t,n){return{restrict:"EA",templateUrl:"components/w69b/ui/drivepicker.html",scope:{onPicked:"&",mimeTypes:"@",includeFolders:"@",selectFolderEnabled:"@",listMode:"@",title:"@"},transclude:!0,replace:!0,link:function(r){function i(e){n.debug(e);var t=google.picker;if(e[t.Response.ACTION]===t.Action.PICKED){var i=e[t.Response.DOCUMENTS],o=i.map(function(e){return e[t.Document.ID]});r.onPicked({ids:o,docs:i}),r.$apply()}}function o(t){var n=new google.picker.DocsView;r.mimeTypes&&n.setMimeTypes(r.mimeTypes),n.setIncludeFolders(!!r.includeFolders),n.setSelectFolderEnabled(!!r.selectFolderEnabled),"grid"==r.listMode?n.setMode(google.picker.DocsViewMode.GRID):"list"==r.listMode&&n.setMode(google.picker.DocsViewMode.LIST);var o=(new google.picker.PickerBuilder).setAppId(e.getAppId()).setOAuthToken(t).enableFeature(google.picker.Feature.NAV_HIDDEN).setTitle(r.title||"Open File").addView(n).setCallback(i).build();o.setVisible(!0)}r.isDisabled=!0,r.openDriveDialog=function(){e.getAuthToken(!0).then(o)},t.loadLibs().then(function(){return n.debug("drive libs loaded"),e.getAuthToken()}).then(function(){n.debug("drive authorized")})["finally"](function(){r.isDisabled=!1})}}}]),angular.module("w69b.googledrive",[]).factory("googledrive",["$q","googleauth","$location","$interval","$http",function(e,t,n,r,i){function o(e){return e.data}function a(e,t){return i.get(l+e,{googleAuth:!0,params:t}).then(o)}function c(e,t){return i.post(l+e,t,{googleAuth:!0}).then(o)}function u(e,t){return i({method:"PATCH",url:l+e,data:t,googleAuth:!0}).then(o)}var s=!1,l="https://www.googleapis.com/drive/v2/",f={};return f.isLoaded=function(){return s},f.loadLibs=function(){if(s)return e.when(null);var n=t.loadClient().then(function(){return e.all([t.gapiLoad("picker")])});return n.then(function(){s=!0})},f.getFile=function(e){return a("files/"+e)},f.listFiles=function(e){return a("files/",e).then(function(e){return e.items})},f.postFile=function(e){return c("files",e)},f.patchFile=function(e,t){return u("files/"+e,t)},f.trashFile=function(e){return c("files/"+e+"/trash")},f.getAbout=function(){return a("about")},f.showShareSettings=function(n){return t.gapiLoad("drive-share").then(function(){var i=new gapi.drive.share.ShareClient(t.getAppId());i.setItemIds([n]),i.showSettingsDialog();var o=e.defer(),a=r(function(){for(var e=!1,t=document.activeElement;t!==document.documentElement;){if(t.classList.contains("dcs-ad-dcs-c")){e=!0;break}t=t.parentNode}e||(r.cancel(a),o.resolve())},300);return o.promise})},f.listPermissions=function(e){return a("files/"+e+"/permissions").then(function(e){return e.items})},f.insertPermission=function(e,t){return i.post(l+"files/"+e+"/permissions",t,{googleAuth:!0}).then(o)},f.patchPermission=function(e,t,n){return u("files/"+e+"/permissions/"+t,n)},f.removePermission=function(e,t){return i["delete"](l+"files/"+e+"/permissions/"+t,{googleAuth:!0}).then(o)},f.getContextAction=function(){var e=n.search().state,t=null;if(angular.isString(e))try{t=JSON.parse(e)}catch(r){}if(t){var i=t.ids||[],o=t.exportIds||[];return{action:t.action,ids:i.concat(o),parentId:t.parentId,userId:t.userId}}return null},f}]),angular.module("w69b.scriptloader",[]).factory("scriptloader",["$document","$q","$rootScope","$log",function(e,t,n,r){function i(n){if(o(n))return a.hasOwnProperty(n)?a[n]:t.when(!0);var i=t.defer();a[n]=i.promise,r.debug("script loader loading "+n);var c=document.createElement("script");return c.type="text/javascript",c.src=n,c.onload=function(){delete a[n],i.resolve(),c.onload=c.onerror=null},c.onerror=function(){i.reject(),c.onload=c.onerror=null},e.find("script").eq(0).parent().prepend(c),i.promise}function o(t,n){return n?!!e[0].querySelector('script[src^="'+t+'"]'):!!e[0].querySelector('script[src="'+t+'"]')}var a={};return{isInDom:o,load:i}}]),angular.module("w69b.ui.bytesFilter",[]).filter("bytes",["$injector",function(e){function t(t,r){return n||(n=e.get("$filter")("number")),n(t,r)}var n;return function(e,n){if(!angular.isNumber(e))return"-";if(angular.isUndefined(n)&&(n=1),0>=e)return"0 B";var r=["B","KB","MB","GB","TB","PB"],i=Math.floor(Math.log(e)/Math.log(1024));return t(e/Math.pow(1024,Math.floor(i)),n)+" "+r[i]}}]),angular.module("w69b.ui.bgImg",[]).directive("wbBgImg",function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.wbBgImg,function(e){e?t.css("background-image","url('"+e+"')"):t.css("background-image","")})}}}),angular.module("w69b.ui.locationChange",[]).directive("wbLocationChange",["$parse",function(e){return{link:function(t,n,r){var i=e(r.wbLocationChange);t.$on("$locationChangeStart",function(){i(t)})}}}]),angular.module("w69b.chromePermissions",["w69b.promiseTool"]).factory("chromePermissions",["promiseTool",function(e){var t=window.chrome&&window.chrome.permissions,n={};return t?(n.contains=e.wrapChromeError(t.contains,t),n.request=e.wrapChromeError(t.request,t),n.remove=e.wrapChromeError(t.remove,t),n.getAll=e.wrapChromeError(t.getAll,t),n):n}]),angular.module("castifyExt.App").requires.push("templates")}();