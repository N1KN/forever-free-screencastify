"use strict";!function(){window.angular&&angular.module("w69b.es6",[]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,o=arguments[1],a=0;r>a;a++)if(t=n[a],e.call(o,t,a,n))return t}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===this||null===this)throw new TypeError("Cannot convert this value to object");var t=Object(this),n=parseInt(t.length,10)||0;if(0===n)return!1;var r=parseInt(arguments[1],10)||0;if(r>=n)return!1;var o;for(r>=0?o=r:(o=n+r,0>o&&(o=0));n>o;){var a=t[o];if(e===a||e!==e&&a!==a)return!0;o++}return!1}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length),t-=e.length;var r=n.indexOf(e,t);return-1!==r&&r===t}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}),angular.module("castifyExt.ui.micLevel",["w69b.webrtc","castifyExt.audioContextPool","castifyExt.appOptions","w69b.throttle","castifyExt.appOptions"]).factory("micLevelFactory",["webrtc","audioContextPool","$rootScope","appOptions","$q",function(e,t,n,r,o){function a(){function a(e){return function(){var t=arguments,n=o.defer();return(m||o.when())["finally"](function(){var r=e.apply(null,t);n.resolve(r)}),m=n.promise,m["finally"](function(){m=null}),n.promise}}function i(){var e=w.analyser;e&&(d||(d=new Uint8Array(e.frequencyBinCount)),e.getByteFrequencyData(d),y=-1)}function c(){y=Math.max.apply(null,d)/255}function u(e){if(g)throw Error();p=e,g=t.acquire();var n=g,r=n.createMediaStreamSource(e),o=n.createAnalyser(),a=n.createGain();a.gain.value=S,o.smoothingTimeConstant=.3,o.fftSize=32,o.minDecibels=-70,o.maxDecibels=-10;var c=n.createScriptProcessor(2048,2,1);c.onaudioprocess=i,r.connect(a),a.connect(o),o.connect(c),c.connect(n.destination),w.input=r,w.analyser=o,w.capture=c,w.gain=a}function s(){var t={echoCancellation:r.localValues.micAudioProcessing};return h&&(t.sourceId=h),e.getUserMedia({audio:{mandatory:t},video:!1})}function l(){p&&p.getTracks().forEach(function(e){e.stop()}),p=null}function f(e){S=e,w.gain&&(w.gain.gain.value=e)}var d,p,h,g,m,b={},w={},y=0,v=0,S=1,E=angular.noop;return b.start=a(function(){var e=null;return v||(E=n.$watch(function(){return r.localValues.micGain},f),e=s().then(u)),++v,e}),b.setSourceId=a(function(e){return h=e,l(),w.input?s().then(function(e){w.input.disconnect(),w.input=g.createMediaStreamSource(e),w.input.connect(w.gain)}):void 0}),b.stop=a(function(){v&&!--v&&(angular.forEach(w,function(e){e.disconnect()}),w={},l(),y=0,t.release(g),g=null,E())}),b.getVolume=function(){return 0>y&&c(),y},b}return a}]).directive("cfMicLevel",["micLevelFactory","$window","$timeout",function(e,t,n){function r(){var e=Object.create(HTMLCanvasElement.prototype);e.attachedCallback=function(){this.dispatchEvent(new Event("attached"))},e.detachedCallback=function(){this.dispatchEvent(new Event("detached"))},document.registerElement("cf-mic-canvas",{prototype:e,"extends":"canvas"})}function o(t){if(a.has(t))return a.get(t);var n=e();return n.setSourceId(t),a.set(t,n),n}r();var a=new Map;return{restrict:"E",replace:!0,scope:{sourceId:"=?"},template:'<canvas class="cf-mic-level" is="cf-mic-canvas"></canvas>',link:function(e,r,a){function i(){d.clearRect(0,0,f.width,f.height),p?d.fillRect(0,0,Math.round(l.getVolume()*f.width),f.height):d.fillRect(0,f.height,f.width,-Math.round(l.getVolume()*f.height)),s=t.requestAnimationFrame(i)}function c(){g||(g=!0,l.start(),s=t.requestAnimationFrame(i))}function u(){g&&(g=!1,t.cancelAnimationFrame(s),l.stop())}var s,l=o(e.sourceId),f=r[0],d=f.getContext("2d"),p="horizontal"===a.orientation,h=!1,g=!1;n(function(){h||c()},0),r.bind("attached",function(){h=!1,c()}),r.bind("detached",function(){h=!0,u()});var m;m=p?d.createLinearGradient(0,0,f.width,0):d.createLinearGradient(0,f.height,0,0),m.addColorStop(0,"#0f0"),m.addColorStop(.7,"#ff0"),m.addColorStop(1,"#f00"),d.fillStyle=m,r.bind("$destroy",u),e.$watch("sourceId",function(e,t){if(e!==t){console.log("using new id",e);var n=g;u(),l=o(e),n&&c()}})}}}]).directive("cfMicLevelSlider",["appOptions","throttle","$window",function(e,t,n){return{restrict:"E",replace:!0,scope:{},templateUrl:"components/castifyExt/ui/mic-level/mic-level-slider.html",link:function(r){function o(){a.flush()}var a=t(e.saveLocal.bind(e),1e3),i=angular.element(n);r.$watch("micGainRange",function(t){t&&(t=Math.exp(Number(t)),e.localValues.micGain=t,a())}),e.loadedPromise.then(function(){var t=e.localValues.micGain;t=Math.log(t),r.micGainRange=t}),i.bind("unload",o),r.$on("$destroy",function(){i.unbind("unload",o),o()})}}}]),angular.module("castifyExt.audioContextPool",[]).factory("audioContextPool",["$window",function(e){var t=[],n={};return n.acquire=function(){return t.length?t.pop():new e.AudioContext},n.release=function(e){t.push(e)},n}]),angular.module("castifyExt.appOptions",["w69b.chromeStorage","castifyExt.enterprisePolicy"]).factory("appOptions",["chromeStorage","$rootScope","$q","enterprisePolicy",function(e,t,n,r){var o={notifyAudio:!0,notifyFramerate:!1,notifyTabFocus:!0,uploadPrivacy:"public",autoOpen:!0,autoPlay:!0,driveSync:!1,enableDiskSpaceWatcher:!0,notifySyncProgress:!0,notifyEditProgress:!0,enableAnalytics:!0,enableCrashReports:!1,showDrawingToolsHint:!0,showEditToolsHint:!0,encoder:null,audioCodec:null},a={micGain:1,micAudioProcessing:!0},i=!1,c={},u=angular.copy(o);return c.localValues=angular.copy(a),c.loadedPromise=n.all({sync:e.sync.getSingle("options"),local:e.local.getSingle("options"),managed:r.loadedPromise}).then(function(e){angular.extend(u,e.sync),angular.extend(c.localValues,e.local),i=!0}),c.values={},Object.keys(o).forEach(function(e){Object.defineProperty(c.values,e,{enumerable:!0,get:function(){return r.has(e)?r.get(e):u[e]},set:function(t){u[e]=t}})}),c.save=function(){return e.sync.setSingle("options",u)},c.saveLocal=function(){return e.local.setSingle("options",c.localValues)},c.isLoaded=function(){return i},c.isSetByEnterprisePolicy=function(e){return r.has(e)},e.onChanged.addListener(function(e,n){"sync"==n&&e.options&&(angular.extend(u,e.options.newValue),t.$$phase||t.$digest()),"local"==n&&e.options&&(angular.extend(c.localValues,e.options.newValue),t.$$phase||t.$digest())}),c}]),angular.module("castifyExt.backgroundTool",["w69b.chromeRuntime"]).factory("backgroundTool",["chromeRuntime","$q","$log","$rootScope",function(e,t,n,r){function o(){var n=t.defer();return e.onMessage.addListener(function r(t){"bg:loaded"===t&&(e.onMessage.removeListener(r),n.resolve())}),e.sendMessage("bg:load"),n.promise}var a,i={};return i.portHelper=function(n,a){var i,c={};return c.getPort=function(){var r=a===!1?t.when():o();return r.then(function(){return i||(i=e.connect({name:n})),i})},c.postMessage=function(e,t){return c.getPort().then(function(n){return n.postMessage({type:e,data:t})})},c.installHandlers=function(e){function t(t){e.hasOwnProperty(t.type)&&e[t.type](t.data),r.$$phase||r.$apply()}function n(){c.getPort().then(function(e){e.onMessage.removeListener(t)})}return c.getPort().then(function(e){e.onMessage.addListener(t)}),n},c},i.loadBackground=function(){return a||(a=o()),a},i}]),angular.module("castifyExt.recordTool",["castifyExt.connect.connectedApps","castifyExt.connect.appRegistry","castifyExt.hdpiTool","w69b.webrtc","w69b.chromeStorage","w69b.spawn","w69b.chromeSystem"]).factory("recordTool",["chromeStorage","$window","webrtc","connectedApps","appRegistry","hdpiTool","spawn","chromeSystem",function(e,t,n,r,o,a,i,c){function u(){return t.navigator.userAgent}function s(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])}function l(){return u().indexOf("CrOS")>=0}function f(){return u().indexOf("CrOS arm")>=0}function d(){return u().indexOf("CrOS x86_64")>=0}function p(){return f()?5:(d(),30)}function h(e){return n.getSources().then(function(t){function n(e,n){return t.some(function(t){return t.kind===e&&t.label&&(!n||n===t.id)})}return e.audio.mic&&(n("audio")?e.audio.micSourceId&&!n("audio",e.audio.micSourceId)&&delete e.audio.micSourceId:e.audio.mic=!1),n("video")?e.camSourceId&&!n("video",e.camSourceId)&&delete e.camSourceId:("cam"===e.captureSource&&(e.captureSource="tab"),e.embedWebcam&&(e.embedWebcam=!1)),e})}function g(e){return e.autoShareApp?r.isConnected(e.autoShareApp.id).then(function(t){return t||delete e.autoShareApp,e}):e}var m={},b="recordConfig",w=null;m.toResolution=function(e){return{width:e.width,height:e.height}},m.scaleResolution=function(e,t){var n=Math.min(t.height/e.height,t.width/e.width,1);return{width:Math.floor(e.width*n),height:Math.floor(e.height*n)}},m.getResolutionLimit=function(e,t){return e.limitResolution?"tab"===e.captureSource?m.scaleResolution(a.toPhysicalResolution(t),e.maxResolution):e.maxResolution:null};var y=i.wrap($traceurRuntime.initGeneratorFunction(function E(){var e,t,n,r,o;return $traceurRuntime.createGeneratorInstance(function(a){for(;;)switch(a.state){case 0:a.state=w?8:5;break;case 5:e=c.cpu,t=e.getInfo,n=t.call(e),a.state=6;break;case 6:return a.state=2,n;case 2:r=a.sent,a.state=4;break;case 4:o=r.numOfProcessors,w=o,a.state=8;break;case 8:a.returnValue=w,a.state=-2;break;default:return a.end()}},E,this)})),v=i.wrap($traceurRuntime.initGeneratorFunction(function k(){var e;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:return t.state=2,y();case 2:e=t.sent,t.state=4;break;case 4:t.state=e>=4?5:7;break;case 5:t.returnValue={width:1920,height:1080},t.state=-2;break;case 7:t.returnValue={width:1280,height:720},t.state=-2;break;default:return t.end()}},k,this)})),S=i.wrap($traceurRuntime.initGeneratorFunction(function C(){var e,t,n,r;return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:e=f(),o.state=13;break;case 13:o.state=e?9:5;break;case 9:r=e,o.state=10;break;case 5:t=y(),o.state=6;break;case 6:return o.state=2,t;case 2:n=o.sent,o.state=4;break;case 4:r=4>=n,o.state=10;break;case 10:o.returnValue=r,o.state=-2;break;default:return o.end()}},C,this)}));return m.canCaptureSystemAudio=function(){return u().indexOf("Windows")>=0||l()&&s()>=46},m.getRecentlyConnectedApp=function(){return r.getRecent().then(function(e){return e?o.getAppInfo(e):null})},m.clearRecentlyConnectedApp=function(){return r.clearRecent()},m.setRecordConfig=function(t){return e.local.setSingle(b,t)},m.getRecordConfig=i.wrap($traceurRuntime.initGeneratorFunction(function x(){var t,n,r,o,a,i,c,u,s,l,f,d,w,y,E,k,C;return $traceurRuntime.createGeneratorInstance(function(x){for(;;)switch(x.state){case 0:return x.state=2,e.local.getSingle(b,{});case 2:t=x.sent,x.state=4;break;case 4:n=angular.isDefined,r=t.limitResolution,o=n.call(angular,r),x.state=17;break;case 17:x.state=o?13:9;break;case 13:a=t.limitResolution,u=a,x.state=14;break;case 9:i=S(),x.state=10;break;case 10:return x.state=6,i;case 6:c=x.sent,x.state=8;break;case 8:u=c,x.state=14;break;case 14:t.limitResolution=u,x.state=19;break;case 19:s=t.maxResolution,x.state=32;break;case 32:x.state=s?28:24;break;case 28:l=t.maxResolution,w=l,x.state=29;break;case 24:f=v(),x.state=25;break;case 25:return x.state=21,f;case 21:d=x.sent,x.state=23;break;case 23:w=d,x.state=29;break;case 29:t.maxResolution=w,x.state=34;break;case 34:t.audio=angular.isObject(t.audio)?t.audio:{mic:!0,system:!0},t.draw=t.draw||{showToolbox:!0,tool:"pointer"},t.embedWebcam=t.embedWebcam||!1,t.camPosition=t.camPosition||"bottomRight",t.captureSource=t.captureSource||"desktop",t.targetFPS=t.targetFPS||p(),"desktop"!==t.captureSource||m.canCaptureSystemAudio()||(t.audio.system=!1),x.state=54;break;case 54:y=h(t),x.state=40;break;case 40:return x.state=36,y;case 36:E=x.sent,x.state=38;break;case 38:t=E,x.state=42;break;case 42:k=g(t),x.state=48;break;case 48:return x.state=44,k;case 44:C=x.sent,x.state=46;break;case 46:t=C,x.state=50;break;case 50:x.returnValue=t,x.state=-2;break;default:return x.end()}},x,this)})),m}]),angular.module("castifyExt.recorder",["castifyExt.backgroundTool","castifyExt.optionalPermissions","w69b.spawn"]).factory("recorder",["backgroundTool","optionalPermissions","spawn","$q",function(e,t,n,r){var o=e.portHelper("recorder",!1),a={};a.info={};var i={};return i.stateUpdate=function(e){angular.copy(e,a.info)},o.installHandlers(i),a.start=n.wrap($traceurRuntime.initGeneratorFunction(function c(e){var n;return $traceurRuntime.createGeneratorInstance(function(a){for(;;)switch(a.state){case 0:a.state="tab"===e.captureSource?1:6;break;case 1:return a.state=2,t.requestTabPermissions(e);case 2:n=a.sent,a.state=4;break;case 4:a.state=n?6:5;break;case 5:a.returnValue=r.reject("tab_permissions"),a.state=-2;break;case 6:a.returnValue=o.postMessage("start",e),a.state=-2;break;default:return a.end()}},c,this)})),a.stop=function(){o.postMessage("stop")},a.pause=function(){o.postMessage("pause")},a.resume=function(){o.postMessage("resume")},a.replaceStream=function(e){o.postMessage("replaceStream",e)},a.cancelPendingStart=function(){o.postMessage("cancelPendingStart")},a.showPreview=function(e){o.postMessage("showPreview",e)},o.getPort(),a}]),angular.module("castifyExt.resizeTab",["w69b.chromeTabs","w69b.chromeWindows"]).factory("resizeTab",["chromeTabs","chromeWindows","$q",function(e,t,n){function r(r,o,a,i){function c(){return e.get(r).then(function(e){return l=e})}function u(){return t.get(l.windowId).then(function(e){if("normal"!==e.state&&i===!1)return n.reject();var r=e.width-l.width,c=e.height-l.height,u=o+r+f,s=a+c+d;return t.update(l.windowId,{width:u,height:s,state:"normal"})})}function s(e){return e.width!=o||e.height!=a?(f+=o-e.width,d+=a-e.height,u().then(c)):e}var l,f=0,d=0;return c().then(u).then(c).then(s).then(s)["catch"](function(){return l})}return r}]),angular.module("castifyExt.setupService",["castifyExt.appOptions","w69b.webrtc","w69b.chromeStorage","w69b.spawn"]).factory("setupService",["webrtc","spawn","chromeStorage","$q","appOptions","$log",function(e,t,n,r,o,a){function i(){return t($traceurRuntime.initGeneratorFunction(function e(){var t,r,a,i,c;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=n.sync.getSingle(s,!1),e.state=19;break;case 19:return e.state=2,o.loadedPromise;case 2:e.maybeThrow(),e.state=4;break;case 4:r=o.isSetByEnterprisePolicy,a=r.call(o,"driveSync"),e.state=15;break;case 15:e.state=a?11:5;break;case 11:c=a,e.state=12;break;case 5:return e.state=6,t;case 6:i=e.sent,e.state=8;break;case 8:c=i,e.state=12;break;case 12:e.returnValue=c,e.state=-2;break;default:return e.end()}},e,this)}))}function c(){return t($traceurRuntime.initGeneratorFunction(function n(){var t,r,o,a,i,c,u,s;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:t=e.hasVideoAccess(),r=e.hasMicrophone(),o=e.hasAudioAccess(),n.state=26;break;case 26:return n.state=2,t;case 2:a=n.sent,n.state=4;break;case 4:n.state=a?20:5;break;case 20:s=a,n.state=21;break;case 5:return n.state=6,r;case 6:i=n.sent,n.state=8;break;case 8:n.state=i?9:15;break;case 15:u=!i,n.state=16;break;case 9:return n.state=10,o;case 10:c=n.sent,n.state=12;break;case 12:u=c,n.state=16;break;case 16:s=u,n.state=21;break;case 21:n.returnValue=s,n.state=-2;break;default:return n.end()}},n,this)}))}var u={},s="setupService:storageDecided";return u.setStorageDecided=function(e){return n.sync.setSingle(s,e)},u.getSetupState=function(){return t($traceurRuntime.initGeneratorFunction(function e(){var t,n,r,o,a;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=c(),e.state=10;break;case 10:return e.state=2,t;case 2:n=e.sent,e.state=4;break;case 4:r=i(),e.state=12;break;case 12:return e.state=6,r;case 6:o=e.sent,e.state=8;break;case 8:a={cam:n,storage:o},e.state=14;break;case 14:e.returnValue=a,e.state=-2;break;default:return e.end()}},e,this)}))},u.isComplete=function(){return t($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:return e.state=2,u.getSetupState();case 2:t=e.sent,e.state=4;break;case 4:a.debug("setupService.isComplete state",t),e.state=8;break;case 8:e.returnValue=t.cam&&t.storage,e.state=-2;break;default:return e.end()}},e,this)}))},u}]),angular.module("castifyExt.upgradeHelper",["castifyExt.licensing","w69b.chromeTabs"]).factory("upgradeHelper",["chromeTabs","licensing",function(e,t){var n={};return n.openBuy=function(t,n){n||(n=t);var r="https://www.screencastify.com/buy?utm_source=app&utm_medium="+t+"&utm_campaign="+n;e.create({url:r})},n.isPaid=function(){return t.isPaid()},n.hasLicense=function(){return t.hasLicense()},n}]),angular.module("castifyExt.ui.recordOptions",["ngMaterial","castifyExt.recordTool","castifyExt.appOptions","castifyExt.resizeTab","castifyExt.ui.pixelResolution","castifyExt.ui.selectDropdown","castifyExt.ui.deviceChooser","castifyExt.ui.connectAppChooser","castifyExt.ui.autoShareDialog","castifyExt.connect.appRegistry","castifyExt.hdpiTool","w69b.ui.focus"]).controller("RecordOptionsCtrl",["$scope","recordTool","chromeTabs","webrtc","$mdDialog","appRegistry","$q","$mdSidenav","$mdToast","appOptions","hdpiTool",function(e,t,n,r,o,a,i,c,u,s,l){function f(){e.autoShareApp&&a.getAppInfo(e.autoShareApp.id).then(function(t){e.autoShareApp&&e.autoShareApp.id===t.id&&(e.autoShareApp=t)})}function d(){u.show(u.simple().content("Mouse cursor and drawing tools are only available on regular web sites with tab recording.").action("Got it").hideDelay(4e3)).then(function(e){"ok"===e&&(s.values.showDrawingToolsHint=!1,s.save())})}function p(e){return(e&&e.startsWith("https://")||e.startsWith("http://")||e.startsWith("file://"))&&!e.startsWith("https://chrome.google.com/webstore/")}function h(){var n=["tab","desktop","cam"];e.$watch("recordConfig.captureSource",function(t){e.captureTabIdx=n.indexOf(t)}),e.$watch("captureTabIdx",function(t){e.recordConfig.captureSource=n[t]}),e.$watch("recordConfig.embedWebcam",function(t){t&&e.hasMic&&(e.recordConfig.audio.mic=!0)}),s.values.showDrawingToolsHint&&e.$watchGroup(["recordConfig.captureSource","tab.url"],function(e){var t=e[0],n=e[1];n&&"tab"===t&&!p(n)?d():u.cancel()}),e.$watch("recordConfig.captureSource",function(n){"desktop"===n?(e.systemAudioLabel="System Audio",e.canCaptureSystemAudio=t.canCaptureSystemAudio()):"tab"===n?(e.systemAudioLabel="Tab Audio",e.canCaptureSystemAudio=!0):e.canCaptureSystemAudio=!1}),e.$watch("[tab.width, tab.height, recordConfig.maxResolution, recordConfig.captureSource, recordConfig.limitResolution]",function(){var n=e.recordConfig;n&&e.tab&&(e.recordingResolution=t.getResolutionLimit(n,e.tab),e.recordingResolution||(e.recordingResolution=l.toPhysicalResolution("tab"==n.captureSource?e.tab:l.getScreenCssResolution())))},!0),e.$watch("[recordConfig, autoShareApp]",function(){var t=e.recordConfig;if(t){var n=angular.copy(t);e.canCaptureSystemAudio||(n.audio.system=!1),n.autoShareApp=e.autoShareApp,e.config=angular.copy(n,e.config)}},!0)}function g(){n.getActiveTab().then(function(t){e.tab=t})}i.all({access:r.hasVideoAccess(),present:r.hasCamera()}).then(function(t){e.hasCam=t.access,e.camSetupRequired=t.present&&!t.access}),r.hasAudioAccess().then(function(t){e.hasMic=t}),t.getRecordConfig().then(function(n){e.recordConfig=n,e.$watch("recordConfig",function(e,n){angular.equals(e,n)||t.setRecordConfig(e)},!0),e.autoShareApp=n.autoShareApp,h(),f()}),e.toggleAdvanced=function(){c("advanced-video").toggle()},e.systemAudioLabel="Tab Audio",e.confirmApp=function(t,n){if(!t.shareUrl)return i.reject();t={title:t.title,id:t.id,isPaid:t.isPaid};var r=e.$new(!0);r.app=t,r.isRecent=n;var a=o.show({scope:r,controller:"AutoShareDialogCtrl",templateUrl:"components/castifyExt/ui/auto-share-dialog/auto-share-dialog.html"});return a.then(function(n){n&&(e.autoShareApp=t,n.remember?e.recordConfig.autoShareApp=t:delete e.recordConfig.autoShareApp)}),a},e.clearApp=function(){e.autoShareApp=null,delete e.recordConfig.autoShareApp},t.getRecentlyConnectedApp().then(function(n){n&&n.autoSharePrompt&&e.confirmApp(n,!0)["finally"](t.clearRecentlyConnectedApp)}),g()}]).directive("cfRecordOptions",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/record-options/record-options.html",replace:!0,controller:"RecordOptionsCtrl",scope:{config:"="}}}).directive("cfMicOption",function(){return{restrict:"E",scope:{audio:"="},templateUrl:"components/castifyExt/ui/record-options/mic-option.html"}}).directive("cfAdvancedVideoOptions",["resizeTab","$mdSidenav","hdpiTool",function(e,t,n){return{restrict:"E",scope:{config:"=",tab:"="},templateUrl:"components/castifyExt/ui/record-options/advanced-video-options.html",link:function(r){function o(e){var t=n.getScreenCssResolution();return e&&(t=n.toPhysicalResolution(t)),[{name:"1080p",width:1920,height:1080},{name:"720p",width:1280,height:720},{name:"480p",width:848,height:480},{name:"360p",width:640,height:360},{name:"240p",width:426,height:240}].filter(function(e){return e.width<t.width||e.height<t.height})}function a(t,n){e(r.tab.id,t,n).then(function(e){r.tab=e})}r.resolutions=o(!0),r.tabResolutions=o(!1),r.frameRates=[{value:60,help:"enough"},{value:30,help:"smooth video recording"},{value:10,help:"ok for most stuff"},{value:5,help:"for slow hardware"},{value:1,help:"for very slow hardware"}],r.$watch("!config.draw.showToolbox && hidePointer",function(e){r.config&&r.config.draw&&(e?r.config.draw.tool=null:r.config.draw.tool="pointer")}),r.$watch("!!config.draw.tool",function(e){r.hidePointer=!e}),r.close=function(){t("advanced-video").close()},r.resizeTab=function(e){a(e.width,e.height)}}}}]).directive("cfEmbedOption",function(){return{restrict:"E",scope:{config:"="},templateUrl:"components/castifyExt/ui/record-options/embed-option.html",link:function(e){e.camPositions=[{value:"topLeft",name:"top-left"},{value:"topRight",name:"top-right"},{value:"bottomLeft",name:"bottom-left"},{value:"bottomRight",name:"bottom-right"}]}}}),angular.module("castifyExt.ui.recorder",["w69b.chromeTabs","w69b.timeutil","castifyExt.ui.recordOptions","w69b.ui.bytesFilter","castifyExt.recorder","castifyExt.ui.micLevel","castifyExt.ui.licenseHint","castifyExt.ui.searchHelp","castifyExt.ui.openSetup","castifyExt.optionalPermissions"]).controller("RecorderCtrl",["$scope","recorder","$window","$log","chromeTabs","castifyConfig","$timeout","$mdToast","optionalPermissions",function(e,t,n,r,o,a,i,c,u){function s(){r.debug("recorder.start(): tab permissions denied"),c.show(c.simple().content("Hint: desktop recording works without these permissions.").hideDelay(4e3))}e.tab=null,e.showstartError=!1,e.diskQuota=null,e.recorder=t.info,e.recordConfig={},e.onShowPreview=function(){t.showPreview(t.info.previewShown)},e.record=function(){t.start(e.recordConfig).then(function(){var t=e.recordConfig.captureSource;"tab"!==t&&"desktop"!==t||a.IS_E2E||window.close()})["catch"](function(e){"tab_permissions"===e&&s()})},e.replaceStream=function(){t.replaceStream({tabId:e.tab.id,windowId:e.tab.windowId,tabTitle:e.tab.title})},e.cancelPendingStart=function(){t.cancelPendingStart()},e.stop=function(){t.stop()},e.pause=function(){t.pause()},e.resume=function(){t.resume()},e.showTab=function(){chrome.tabs.update(e.recorder.config.tabId,{active:!0})},o.getActiveTab().then(function(t){e.tab=t}),e.needsTabSetup=!1,u.hasLiteTabPermissions().then(function(t){t||e.$watch('recordConfig.captureSource == "tab"',function(t){e.needsTabSetup=t})});var l={tab:"Record Tab",desktop:"Record Desktop",cam:"Record Webcam"};e.$watch("recordConfig.captureSource",function(t){e.startRecordingLabel=l[t]}),e.setupTabPermissions=function(){u.requestTabPermissions(e.recordingConfig).then(function(e){e?c.show(c.simple().content("Tab recording is now ready to be used.").hideDelay(2e3)).then(function(){n.close()}):s()})},r.debug("popup loaded")}]).directive("cfCaptureSourceInfo",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/recorder/capture-source-info.html",replace:!0}}).directive("cfRecordCtrlButtons",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/recorder/record-ctrl-buttons.html",replace:!0}}).directive("cfMicLevelAndSlider",function(){return{restrict:"E",scope:{sourceId:"=?"},templateUrl:"components/castifyExt/ui/recorder/mic-level-and-slider.html",replace:!0}}).directive("cfMicLevelIconMenu",function(){return{restrict:"E",scope:{sourceId:"=?"},templateUrl:"components/castifyExt/ui/recorder/mic-level-icon-menu.html"}}),angular.module("castifyExt.ui.pixelResolution",[]).directive("pixelResolution",function(){return{template:'<span ng-show="resolution.width || resolution.height">{{resolution.width}}&#x2715;{{resolution.height}}</span>',restrict:"A",scope:{resolution:"=pixelResolution"}}}),angular.module("castifyExt.ui.openInAppTab",["w69b.chromeTabs","w69b.chromeWindows"]).service("openInAppTab",["chromeTabs","chromeRuntime","chromeWindows","$q",function(e,t,n,r){return function(n){var r="chrome-extension://"+t.id+"/app.html";0===n.lastIndexOf("#",0)&&(n=r+n),e.create({active:!0,url:n})}}]).directive("openInAppTab",["$window","openInAppTab",function(e,t){return{restrict:"A",link:function(n,r,o){r.bind("click",function(n){var r=angular.element(n.target),a=o.href||r.attr("href");a&&(n.preventDefault(),t(a).then(function(){e.close()}))})}}}]),angular.module("castifyExt.ui.licenseHint",["castifyExt.ui.upgradeButton","castifyExt.licensing"]).directive("cfLicenseHint",["licensing","$window","$mdToast",function(e,t,n){return{restrict:"E",scope:{},templateUrl:"components/castifyExt/ui/license-hint/license-hint.html",link:function(t){t.licensing=e,t.showHelp=function(){var t="Recording length is limited to 10 minutes. ";e.shouldForceBranding()&&(t+="A Screencastify logo is embedded in the top-right corner."),n.show(n.simple({hideDelay:5e3}).content(t))}}}}]),angular.module("castifyExt.ui.selectDropdown",[]).directive("cfSelectDropdown",function(){return{restrict:"E",replace:!0,templateUrl:"components/castifyExt/ui/select-dropdown/select-dropdown.html",scope:{ngModel:"=",options:"=",label:"@"}}}),angular.module("castifyExt.ui.deviceChooser",["w69b.webrtc","castifyExt.ui.selectDropdown"]).directive("cfDeviceChooser",["webrtc",function(e){return{restrict:"E",scope:{ngModel:"=",label:"@"},templateUrl:"components/castifyExt/ui/device-chooser/device-chooser.html",link:function(t,n,r){t.sources=[],e.getSourcesByKind(r.inputType).then(function(e){t.sources=e.map(function(e){return{name:e.label,value:e.id}})})}}}]),angular.module("castifyExt.ui.searchHelp",["castifyExt.helpCenter"]).directive("cfSearchHelp",["chromeTabs","helpCenter",function(e,t){var n="https://screencastify.uservoice.com/search?filter=articles";return{link:function(r,o,a){o.bind("click",function(r){var o=n,i=a.cfSearchHelp;r.preventDefault(),i&&t.hasHelpFor(i)?t.openHelp(i):(i&&(o=n+"&query="+encodeURIComponent(i)),e.create({url:o}))})}}}]),angular.module("castifyExt.ui.autoShareDialog",[]).controller("AutoShareDialogCtrl",["$scope","$mdDialog",function(e,t){e.opt={remember:!0},e.$mdDialog=t,e.confirm=function(){t.hide({remember:e.opt.remember})}}]),angular.module("castifyExt.ui.openSetup",["castifyExt.setupService","castifyExt.ui.openInAppTab"]).directive("cfOpenSetup",["setupService","openInAppTab","castifyConfig","$log",function(e,t,n,r){return{restrict:"E",link:function(){n.IS_E2E||e.isComplete().then(function(e){e||(r.info("cfOpenSetup: not complete yet, opening welcome"),t("#/welcome").then(function(){window.close()}))})}}}]),angular.module("castifyExt.ui.themeConfig",["ngMaterial"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("orange",{"default":"800","hue-1":"300","hue-2":"600","hue-3":"900"}).accentPalette("pink")}]).config(["$mdIconProvider",function(e){e.defaultIconSet("gen/icons.svg")}]),angular.module("castifyExt.ui.loadingOverlay",[]).directive("cfLoadingBackdrop",function(){return{restrict:"E",template:'<md-progress-circular md-mode="indeterminate"></md-progress-circular>'}}).directive("cfLoadingOverlay",["$compile",function(e){return{restrict:"A",link:function(t,n,r){var o=null;t.$watch(r.cfLoadingOverlay,function(r){r?(o=e("<cf-loading-backdrop></cf-loading-backdrop>")(t),n.append(o)):o&&(o.remove(),o=null)})}}}]),angular.module("castifyExt.ui.sidenav",["castifyExt.userInfo","castifyExt.licensing","castifyExt.connect.connectedApps","castifyExt.upgradeHelper","castifyExt.ui.openInAppTab","w69b.chromeTabs"]).directive("cfSidenav",["licensing","connectedApps","$location","upgradeHelper","$window","$mdSidenav","openInAppTab","chromeTabs","userInfo",function(e,t,n,r,o,a,i,c,u){return{restrict:"E",scope:{isOpen:"=?"},templateUrl:"components/castifyExt/ui/sidenav/sidenav.html",link:function(s,l,f){f.hasOwnProperty("popupMode")&&(s.popupMode=!0),s.licensing=e,s.hasApps=!1,s.userInfo=u,t.getConnected().then(function(e){s.hasApps=e.length>0}),s.upgradeHelper=r,s.open=function(e){s.popupMode?i("#"+e).then(function(){o.close()}):(n.path(e),a("main-menu").close())},s.closeMenu=function(){s.isOpen=!1};var d={feedback:"http://screencastify.uservoice.com/",gplus:"https://google.com/+ScreencastifyChrome"};s.openExternal=function(e){c.create({url:d[e]})}}}}]),angular.module("castifyExt.ui.topnav",["ngRoute","ngMaterial"]).directive("cfTopnav",["$mdSidenav",function(e){return{restrict:"E",scope:{},transclude:!0,templateUrl:"components/castifyExt/ui/topnav/topnav.html",link:function(t,n,r){r.hasOwnProperty("popupMode")&&(t.popupMode=!0),t.openMenu=function(){t.popupMode?t.$root.isAppMenuOpen=!0:e("main-menu").toggle()}}}}]),angular.module("castifyExt.ui.upgradeButton",["castifyExt.upgradeHelper","w69b.chromeRuntime"]).directive("cfUpgradeButton",["upgradeHelper","chromeRuntime",function(e,t){return{restrict:"E",scope:{},template:'<md-button ng-click="action()" ng-disabled="loading">{{text}}</md-button>',link:function(n,r,o){n.loading=!1,n.$watch(e.isPaid,function(e){r.toggleClass("ng-hide",e)}),r.children().addClass(o["class"]),n.$watch(e.hasLicense,function(e){e?n.text="Upgrade":n.text="Sign In"}),n.action=function(){e.hasLicense()?e.openBuy(o.medium,o.campain):t.sendMessage(null,"bg:signInLicense",{}).then(function(){n.loading=!0,n.$apply()})}}}}]),angular.module("castifyExt.uploader",["castifyExt.backgroundTool"]).factory("uploader",["backgroundTool",function(e){var t=e.portHelper("uploader"),n={};n.state={};var r={};return r.stateUpdate=function(e){angular.copy(e,n.state)},t.installHandlers(r),n.upload=function(e){t.postMessage("upload",e)},n.getFileState=function(e){return n.state[e]},n.getTargetState=function(e,t){var r=n.getFileState(e);return r?r[t]:null},n.isQueuedOrActive=function(e,t){var r=n.getTargetState(e,t);return r&&("uploading"===r.state||"queued"===r.state)},n}]),angular.module("castifyExt.licensing",["castifyExt.castifyAuth","w69b.chromeStorage","w69b.chromeRuntime","castifyExt.signInService","w69b.spawn","w69b.promiseTool","castifyExt.connect.connectedApps"]).factory("licensing",["castifyAuth","$http","chromeRuntime","chromeStorage","$q","$rootScope","$log","signInService","castifyConfig","promiseTool","spawn","connectedApps",function(e,t,n,r,o,a,i,c,u,s,l,f){function d(e){return c.getToken(e)}function p(){function e(){var e=window.chrome.identity,t=s.wrapChromeError(e.getAuthToken,e);return t({interactive:!1,scopes:["email","https://www.googleapis.com/auth/chromewebstore.readonly"]})}function a(){return l($traceurRuntime.initGeneratorFunction(function r(){var o,a,i,c,u;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:o=v+n.id,r.state=17;break;case 17:return r.state=2,e();case 2:a=r.sent,r.state=4;
break;case 4:return r.state=6,t.get(o,{headers:{Authorization:"Bearer "+a}});case 6:i=r.sent,r.state=8;break;case 8:c=i.data,r.state=19;break;case 19:r.state=c.result&&c.createdTime?11:10;break;case 11:u=new Date(Number(c.createdTime)),r.state=12;break;case 12:r.returnValue=E>u,r.state=-2;break;case 10:r.returnValue=!1,r.state=-2;break;default:return r.end()}},r,this)}))}return T.isTester()?o.when(!0):r.sync.getSingle(x).then(function(e){return angular.isDefined(e)?e:o.reject()})["catch"](function(){return a().then(function(e){return r.sync.setSingle(x,e),e})})["catch"](function(){return!1})}function h(){return t.get(S+"/license",k).then(function(e){return e.data})}function g(){return f.getConnectedAppInfo().then(function(e){var t=Date.now(),n=e.some(function(e){return e.isPaidInstall&&(!e.userExpiryDate||e.userExpiryDate>=t)});return n?{access:"full",type:"app",maxAgeSecs:3600}:null})}function m(){return!A||y&&("tester"===y.access||"full"==y.access)}function b(e,t,n){n.isPaidInstall&&T.updateLicense()}function w(e,t,n){function r(e){return!e||e>=Date.now()}r(t)!=r(n)&&T.updateLicense()}var y,v="https://www.googleapis.com/chromewebstore/v1.1/userlicenses/",S=u.API_URL,E=1413892757176,k=c.AUTH_CONFIG,C="license",x="cws_license",$=600,A=!0,T={};return T.updateLicense=function(){function e(){return o.all([p(),h(),g()]).then(function(e){var t=e[0],n=e[1],r=e[2];return r&&"full"!==n.access?r:(t&&"full"!==n.access&&(n.access="tester",n.maxAgeSecs=3600),n)})}i.debug("updating, current state",T.hasLicense(),T.isPaid());var t=d().then(e,g).then(function(e){return e?(e.validTill=Date.now()+1e3*e.maxAgeSecs,r.sync.setSingle(C,e),i.debug("update completed for",e.user||e.type),e):o.reject("not_signed_in")});return t["catch"](function(e){i.debug("update failed",e),c.getEmail(!1).then(function(e){i.debug("update: chrome user is",e)})}),t},T.shouldLimitLength=function(){return!m()},T.shouldForceBranding=function(){return!(y&&!y.branding||m())},T.isPaid=function(){return!(!y||"full"!==y.access)},T.isTester=function(){return!(!y||"tester"!==y.access)},T.getMaxLength=function(){return m()?Number.POSITIVE_INFINITY:$},T.getVersionName=function(){var e=m()?"Full":"Free";if(y){var t=[y.access];y.type&&t.push(y.type),e+=" ("+t.join(" ")+")"}return e+" v"+n.getManifest().version},T.initialize=function(){return r.sync.getSingle(C).then(function(e){y=e,r.onChanged.addListener(function(e,t){"sync"==t&&e[C]&&(y=e[C].newValue,a.$$phase||a.$digest())}),n.getBackgroundPage(),a.$on("connect:appConnected",b),a.$on("connect:userExpiryDateChange",w)})},T.updateIfNeeded=function(){var e=y;(!e||!e.validTill||e.validTill<Date.now())&&T.updateLicense()},T.getToken=d,T.hasLicense=function(){return A&&!!y},T}]),angular.module("castifyExt.userInfo",["castifyExt.signInService","castifyExt.chromeEventPublisher"]).factory("userInfo",["$http","signInService","$rootScope",function(e,t,n){function r(){return t.getEmail().then(function(e){o.email=e,o.isSignedIn=!0},function(){o.email=null,o.isSignedIn=!1})}var o={isSignedIn:null,email:null};return o.getEmail=function(){return o.email},o.signIn=function(){t.signIn()},o.initialize=function(){r()},n.$on("event:signInChanged",function(){r()}),o}]),angular.module("castifyExt.chromeEventPublisher",[]).run(["chromeRuntime","$rootScope",function(e,t){var n="event:";e.onMessage.addListener(function(e){angular.isObject(e)&&angular.isString(e.type)&&0===e.type.lastIndexOf(n,0)&&t.$broadcast(e.type,e.data),t.$$phase||t.$digest()})}]),angular.module("castifyExt.signInService",["castifyExt.castifyAuth"]).factory("signInService",["castifyAuth","chromeRuntime","$rootScope","$log","$http",function(e,t,n,r,o){var a=["https://www.googleapis.com/auth/plus.me","email"],i={googleAuth:!0,googleAuthScopes:a},c="https://www.googleapis.com/plus/v1/people/me",u={SCOPES:a,AUTH_CONFIG:i};return u.getToken=function(t,n){var r={interactive:!!t,scopes:a,validate:n};return e.getAuthToken(r)},u.signIn=function(t){var n={interactive:"select_account",scopes:a,validate:!0};t===!1&&(n.useChromeAccount=!1);var o=e.getAuthToken(n);return o["catch"](function(e){r.warn("Sign in failed",e)}),o},u.getMe=function(){return o.get(c,i).then(function(e){return e.data})},u.getEmail=function(t){return t!==!1?u.getToken(!1).then(e.getChromeAccount):e.getChromeAccount()},u}]),angular.module("castifyExt.enterprisePolicy",["w69b.chromeStorage"]).provider("enterprisePolicy",function(){var e={};this.setOverride=function(t){e=t},this.$get=["chromeStorage","$rootScope",function(t,n){var r={},o=!1,a={};angular.extend(a,e);var i=["disableSharing","disableSaveToDisk","options"];return i.forEach(function(e){Object.defineProperty(r,e,{get:function(){return a[e]}})}),r.loadedPromise=t.managed.get(i).then(function(t){angular.extend(a,t,e),o=!0}),r.isLoaded=function(){return o},r.has=function(e){return a.hasOwnProperty(e)},r.get=function(e){return a[e]},t.onChanged.addListener(function(e,t){"managed"===t&&(angular.forEach(e,function(e,t){a[t]=e.newValue}),n.$$phase||n.$digest())}),r}]}),angular.module("castifyExt.commonConfig",["castifyExt.castifyAuth","w69b.chromeAnalytics","w69b.chromeRuntime","castifyExt.licensing","castifyExt.helpCenterConfig","castifyExt.appOptions"]).config(["$compileProvider","$sceDelegateProvider","analyticsProvider",function(e,t,n){n.setTrackingId("UA-23874345-14"),n.setApp("Screencastify"),t.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**","https://**"]);var r=/^\s*(https?|mailto|blob|chrome-extension|filesystem:chrome-extension):/;e.aHrefSanitizationWhitelist(r),e.imgSrcSanitizationWhitelist(r)}]).run(["$rootScope","analytics","chromeRuntime","licensing","$location","appOptions","$injector",function(e,t,n,r,o,a,i){var c=i.has("$route")?i.get("$route"):null;if(c){var u;e.$on("$viewContentLoaded",function(){var e=o.path();t.tracker.sendAppView(c.current.pageTitle||e),u=e})}e.$watch(function(){return r.hasLicense()?r.isPaid()?"paid":r.isTester()?"tester":"trial":"unknown"},function(e){t.tracker.set("dimension1",e)}),a.loadedPromise.then(function(){t.setEnabled(a.values.enableAnalytics)})}]).value("castifyConfig",{API_URL:"https://www.screencastify.com/api",IS_E2E:window.localStorage.e2e}),angular.module("castifyExt.helpCenter",["w69b.chromeTabs"]).factory("helpCenter",["chromeTabs",function(e){var t={};return t.tagUrls={},t.registerUrl=function(e,n){t.tagUrls[e]=n},t.hasHelpFor=function(e){return t.tagUrls.hasOwnProperty(e)},t.openHelp=function(n){var r=t.tagUrls[n];if(!r)throw new Error("No help url registered for "+n);e.create({url:r})},t.setNotifyHelp=function(e,n){e.onButtonClicked=e.onClicked=function(){t.openHelp(n),e.clear()}},t}]),angular.module("castifyExt.helpCenterConfig",["castifyExt.helpCenter"]).run(["helpCenter",function(e){e.registerUrl("load_nacl","https://screencastify.uservoice.com/knowledgebase/articles/507908"),e.registerUrl("disk_space","https://screencastify.uservoice.com/knowledgebase/articles/507914"),e.registerUrl("drive_apps","https://screencastify.uservoice.com/knowledgebase/articles/460525"),e.registerUrl("start_recording","https://screencastify.uservoice.com/knowledgebase/articles/448826"),e.registerUrl("change_account","https://screencastify.uservoice.com/knowledgebase/articles/555387"),e.registerUrl("quotaExceeded","https://screencastify.uservoice.com/knowledgebase/articles/870177"),e.registerUrl("youtubeSignupRequired","https://screencastify.uservoice.com/knowledgebase/articles/780183")}]),angular.module("castifyExt.castifyAuth",["castifyExt.simpleBgServiceConsumer"]).factory("castifyAuth",["simpleBgServiceConsumer",function(e){return e("castifyAuth",["launchWebAuthFlow","getRedirectURL","removeCachedAuthToken","getAuthToken","getChromeAccount"])}]).factory("googleauth",["castifyAuth","$q",function(e,t){var n={};return n.loadClient=function(){return t.when()},n.getAuthToken=function(t){e.getAuthToken(angular.isObject(t)?t:{interactive:!!t})},n}]),angular.module("castifyExt.simpleBgServiceConsumer",["w69b.chromeRuntime"]).factory("simpleBgServiceConsumer",["chromeRuntime","$q",function(e,t){function n(n,r){function o(e){return e.error?t.reject(e.error):e.data}function a(t){return function(){return e.sendMessage({type:"simpleService",fn:t,service:n,data:Array.prototype.concat.apply([],arguments)}).then(o)}}var i={};return r.forEach(function(e){i[e]=a(e)}),i}return n}]),angular.module("castifyExt.ui.connectAppChooser",["castifyExt.connect.connectedApps","castifyExt.connect.appRegistry"]).directive("cfConnectAppChooser",["connectedApps","appRegistry","$q",function(e,t,n){return{restrict:"E",transclude:!0,require:"?ngModel",templateUrl:"components/castifyExt/ui/connect-app-chooser/connect-app-chooser.html",scope:{onSelected:"&",onDisconnected:"&"},link:function(r,o,a,i){function c(){var e=(r.apps||[]).filter(function(e){return i.$viewValue&&e.id===i.$viewValue.id});return e.length?e[0]:null}function u(e){return r.loading=!0,e["finally"](function(){r.loading=!1}),e}function s(){return e.getConnected({hasShareUrl:!0}).then(t.getApps).then(function(e){r.apps=e,i&&i.$setViewValue(c())})}function l(){e.getConnected({hasShareUrl:!0}).then(function(e){r.hasApps=e.length>0})}function f(){return d?n.when():(d=!0,u(s()))}i&&(i.$render=angular.noop),r.select=function(e){r.selected=e,i&&i.$setViewValue(e),r.onSelected({app:e})},r.showMenu=function(e,t){f().then(function(){t(e)})},r.apps=[],r.loading=!1;var d=!1;l()}}}]),angular.module("castifyExt.connect.connectedApps",["w69b.chromeStorage","w69b.spawn","castifyExt.connect.appRegistry"]).factory("connectedApps",["chromeStorage","spawn","appRegistry","$rootScope",function(e,t,n,r){function o(){return e.sync.getSingle(l,[]).then(function(e){return e.map(function(e){return angular.isObject(e)?e:{id:e,hasShareUrl:!0}})})}function a(t){return e.sync.setSingle(l,t)}function i(){return e.sync.getSingle(f)}function c(t){return e.sync.setSingle(f,t)}function u(e,t){return e.some(function(e){return e.id===t})}var s={},l="connectedAppIds",f="connectedAppRecentId";s.getConnected=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,o();case 2:t=n.sent,n.state=4;break;case 4:e&&(t=t.filter(function(t){var n=!0;return angular.forEach(e,function(e,r){n=n&&t[r]===e}),n})),n.state=8;break;case 8:n.returnValue=t.map(function(e){return e.id}),n.state=-2;break;default:return n.end()}},n,this)}))},s.getConnectedAppInfo=t.wrap($traceurRuntime.initGeneratorFunction(function p(){var e,t;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,o();case 2:e=r.sent,r.state=4;break;case 4:return r.state=6,n.getApps(e.map(function(e){return e.id}));case 6:t=r.sent,r.state=8;break;case 8:t=angular.copy(t),t.forEach(function(t){var n=e.find(function(e){return e.id===t.id});angular.extend(t,n)}),r.state=12;break;case 12:r.returnValue=t,r.state=-2;break;default:return r.end()}},p,this)})),s.getConnectedAppInfoForApp=t.wrap($traceurRuntime.initGeneratorFunction(function h(e){var t,n;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,s.getConnectedAppInfo();case 2:t=r.sent,r.state=4;break;case 4:n=t.find(function(t){return t.id===e}),r.state=11;break;case 11:r.state=n?6:5;break;case 5:r.returnValue=null,r.state=-2;break;case 6:r.returnValue=n,r.state=-2;break;default:return r.end()}},h,this)})),s.isConnected=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,o();case 2:t=n.sent,n.state=4;break;case 4:n.returnValue=u(t,e),n.state=-2;break;default:return n.end()}},n,this)}))},s.disconnect=function(e){return t($traceurRuntime.initGeneratorFunction(function n(){var t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,o();case 2:t=n.sent,n.state=4;break;case 4:t=t.filter(function(t){return t.id!==e}),n.state=14;break;case 14:return n.state=6,c(null);case 6:n.maybeThrow(),n.state=8;break;case 8:return n.state=10,a(t);case 10:n.maybeThrow(),n.state=12;break;case 12:r.$broadcast("connect:appDisconnected",e),n.state=-2;break;default:return n.end()}},n,this)}))},s.connect=function(e){return t($traceurRuntime.initGeneratorFunction(function i(){var t,s;return $traceurRuntime.createGeneratorInstance(function(i){for(;;)switch(i.state){case 0:return i.state=2,o();case 2:t=i.sent,i.state=4;break;case 4:return i.state=6,n.getAppInfo(e);case 6:s=i.sent,i.state=8;break;case 8:i.state=u(t,e)?12:14;break;case 14:t.push({id:e,hasShareUrl:!!s.shareUrl}),i.state=15;break;case 15:i.state=s.shareUrl?9:12;break;case 9:return i.state=10,c(e);case 10:i.maybeThrow(),i.state=12;break;case 12:return i.state=18,a(t);case 18:i.maybeThrow(),i.state=20;break;case 20:r.$broadcast("connect:appConnected",e,s),i.state=-2;break;default:return i.end()}},i,this)}))};var d=t.wrap($traceurRuntime.initGeneratorFunction(function g(e,t,n){var r,i,c;return $traceurRuntime.createGeneratorInstance(function(u){for(;;)switch(u.state){case 0:return u.state=2,o();case 2:r=u.sent,u.state=4;break;case 4:if(i=r.find(function(t){return t.id===e}),!i)throw new Error("Cannot set user data for non-connected app");c=i[t],null===n||angular.isUndefined(n)?delete i[t]:i[t]=n,u.state=12;break;case 12:return u.state=6,a(r);case 6:u.maybeThrow(),u.state=8;break;case 8:u.returnValue=c,u.state=-2;break;default:return u.end()}},g,this)}));return s.setUserExpiryDate=t.wrap($traceurRuntime.initGeneratorFunction(function m(e,t){var n;return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:return o.state=2,d(e,"userExpiryDate",t);case 2:n=o.sent,o.state=4;break;case 4:r.$broadcast("connect:userExpiryDateChange",n,t),o.state=-2;break;default:return o.end()}},m,this)})),s.setUserShareUrl=function(e,t){return d(e,"shareUrl",t)},s.clearRecent=function(){return c(null)},s.getRecent=function(){return i()},s}]),angular.module("castifyExt.connect.appRegistry",["w69b.spawn","w69b.chromeStorage"]).factory("appRegistry",["castifyConfig","$http","$q","spawn","chromeStorage",function(e,t,n,r,o){function a(){return o.local.getSingle(h,[])}function i(e){return o.local.setSingle(h,e)}function c(e){return a().then(function(t){return t.filter(function(t){return e.includes(t.id)})})}function u(e,t){var n=Date.now(),r=e.some(function(e){return n>e._fetchTimestamp+g});return!r&&t.length===e.length}function s(e){return e.forEach(function(e){delete e._fetchTimestamp}),e}function l(e,t){return r($traceurRuntime.initGeneratorFunction(function n(){var r;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:e=new Set(e||[]),n.state=10;break;case 10:return n.state=2,a();case 2:r=n.sent,n.state=4;break;case 4:t.forEach(function(t){e.add(t.id)}),r=r.filter(function(t){return!e.has(t.id)}),t.forEach(function(e){e._fetchTimestamp=Date.now()}),r=r.concat(t),n.state=12;break;case 12:return n.state=6,i(r);case 6:n.maybeThrow(),n.state=-2;break;default:return n.end()}},n,this)}))}function f(e){return r($traceurRuntime.initGeneratorFunction(function o(){var r,a,i,f;return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:o.state=e&&0!==e.length?2:1;break;case 1:o.returnValue=n.when([]),o.state=-2;break;case 2:return o.state=5,c(e);case 5:a=o.sent,o.state=7;break;case 7:o.state=u(a,e)?8:9;break;case 8:o.returnValue=s(a),o.state=-2;break;case 9:o.pushTry(19,null),o.state=22;break;case 22:return o.state=12,t.get(d,{params:{ids:e}});case 12:i=o.sent,o.state=14;break;case 14:r=i.data,o.state=16;break;case 16:o.popTry(),o.state=24;break;case 19:o.popTry(),o.maybeUncatchable(),f=o.storedException,o.state=17;break;case 17:o.returnValue=s(a),o.state=-2;break;case 24:return o.state=27,l(e,r);case 27:o.maybeThrow(),o.state=29;break;case 29:o.returnValue=s(r),o.state=-2;break;default:return o.end()}},o,this)}))}var d=e.API_URL+"/apps",p={},h="appRegistry:cache",g=6e4;return p.getApps=function(e){return f(e)},p.getAppInfo=function(e){return f([e]).then(function(e){return e.length?e[0]:n.reject()})},p}]),angular.module("castifyExt.optionalPermissions",["w69b.chromePermissions"]).factory("optionalPermissions",["chromePermissions",function(e){function t(e){return e&&(!e.draw||e.draw&&!e.draw.showToolbox&&null===e.draw.tool)?o:r}var n={},r={permissions:["tabCapture","webNavigation","activeTab"],origins:["<all_urls>"]},o={permissions:["tabCapture","webNavigation","activeTab"],origins:[]};return n.hasLiteTabPermissions=function(){return e.contains(o)},n.hasTabPermissions=function(n){return e.contains(t(n))},n.requestTabPermissions=function(n){return e.request(t(n))},n}]),angular.module("castifyExt.hdpiTool",[]).factory("hdpiTool",["$window",function(e){var t={};return t.devicePixelRatio=e.devicePixelRatio,t.toPhysicalResolution=function(e){return{width:Math.floor(e.width*t.devicePixelRatio),height:Math.floor(e.height*t.devicePixelRatio)}},t.toCssResolution=function(e){return{width:Math.round(e.width/t.devicePixelRatio),height:Math.round(e.height/t.devicePixelRatio)}},t.getScreenCssResolution=function(){return{width:e.screen.width,height:e.screen.height}},t}]),angular.module("castifyExt.PopupApp",["ngRoute","ngAnimate","castifyExt.commonConfig","castifyExt.ui.recorder","w69b.chromePersistentLogger","ngMaterial","castifyExt.ui.themeConfig","castifyExt.ui.openInAppTab","castifyExt.licensing","castifyExt.ui.topnav","castifyExt.ui.sidenav","castifyExt.ui.loadingOverlay"]).config(["$routeProvider",function(e){e.when("/recorder",{templateUrl:"components/castifyExt/ui/recorder/recorder.html",pageTitle:"Recorder",controller:"RecorderCtrl"}).when("/nonacl",{templateUrl:"components/castifyExt/ui/nonacl.html"}).otherwise({redirectTo:function(){return angular.isDefined(window.navigator.mimeTypes["application/x-nacl"])?"/recorder":"/nonacl"}})}]).config(["analyticsProvider","chromePersistentLoggerProvider",function(e,t){t.setStorageKey("popup"),t.enableGlobalHandler(!0),t.install()}]).run(["licensing","userInfo",function(e,t){e.initialize(),t.initialize()}]),angular.module("w69b.chromeAnalytics",[]).provider("analytics",function(){var e,t;this.setTrackingId=function(t){e=t},this.setApp=function(e,n){t=arguments},this.$get=["$window",function(n){if(!t)throw new Error("make sure to call analyticsProvider.setApp()");if(!n.analytics)throw new Error("chrome-analytics lib not loaded");var r=n.analytics,o=r.getService.apply(r,t),a=o.getTracker(e),i={};return i.tracker=a,i.eventBuilder=function(){return r.EventBuilder.builder()},i.setEnabled=function(e){o.getConfig().addCallback(function(t){t.setTrackingPermitted(e)})},i.send=function(){a.send.apply(a,arguments)},i.trackPageView=function(e){a.sendAppView(e)},i.trackEvent=function(){a.sendEvent.apply(a,arguments)},i.trackTimer=function(e,t,n){var r,o={};return o.start=function(){return r=(new Date).getTime(),o},o.send=function(i,c,u){var s=(new Date).getTime();return a.sendTiming(i||e,c||t,s-r,u||n),o},o.start(),o},i}]}),angular.module("w69b.chromeCapture",["w69b.promiseTool","w69b.webrtc"]).factory("chromeCapture",["promiseTool","webrtc","$q",function(e,t,n){var r={};return r.tabCapture=function(){return chrome.tabCapture?e.wrapChromeError(chrome.tabCapture.capture,chrome.tabCapture).apply(null,arguments):n.reject("tabCapture permission missing")},chrome.desktopCapture&&(r.chooseDesktopMedia=function(){function t(e){chrome.desktopCapture.cancelChooseDesktopMedia(a),o.reject(e||"cancelled")}e.wrapChromeError(chrome.desktopCapture.chooseDesktopMedia,chrome.desktopCapture);var r=Array.prototype.slice.call(arguments,0),o=n.defer();r.push(function(e){chrome.runtime.lastError?o.reject(chrome.runtime.lastError):o.resolve(e)});var a=chrome.desktopCapture.chooseDesktopMedia.apply(chrome.desktopCapture,r);return{promise:o.promise,cancel:t}}),r.desktopCapture=function(e){var n={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920,maxHeight:1200}}};return t.getUserMedia(n)},r}]),angular.module("w69b.chromePersistentLogger",["w69b.chromeStorage","w69b.logging","w69b.structs.CircularBuffer"]).provider("chromePersistentLogger",["$logProvider",function(e){function t(e,t){var r={level:e,args:t,timestamp:(new Date).getTime()};return n?n.add(r):o.push(r),!0}var n,r="logs",o=[],a=!1,i=1e3,c="logs_",u=!1,s=!0;this.setStorageKey=function(e){r=e},this.setMaxNumLogs=function(e){i=e},this.enableAutoLoad=function(e){a=e},this.enableAutoSave=function(e){s=e},this.enableGlobalHandler=function(e){u=e},this.install=function(){this.enableAutoLoad(!0),e.setCustomHook(t)},this.$get=["$window","$q","chromeStorage","CircularBuffer","$log",function(e,l,f,d,p){function h(e){var t=e.args.map(function(e){if(!angular.isObject(e))return e;try{return angular.toJson(e)}catch(t){return e}});return[new Date(e.timestamp).toISOString(),e.level.toUpperCase(),t.join(", ")].join(" ")}function g(e){var t=new d(i);return e.forEach(function(e){t.add(e)}),t}var m={};return m.load=function(){return f.local.getSingle(c+r).then(function(e){e&&e.length&&(n=g(e.concat(m.getEntries())))})},m.save=function(e){return f.local.setSingle(c+(e||r),m.getEntries())},m.clear=function(){n.clear()},m.getEntries=function(){return n.getValues()},m.getLogs=function(){return m.getEntries().map(h)},m.getMergedLogs=function(e){return e=e.map(function(e){return c+e}),f.local.get(e).then(function(e){var t=[];return angular.forEach(e,function(e,n){e&&e.length&&e.forEach(function(e){e.storageKey=n.substr(c.length),t.push(e)})}),t.sort(function(e,t){return e.timestamp-t.timestamp}),t.map(function(e){return"["+e.storageKey+"] "+h(e)})})},m.hookFn=t,n=g(o),o=null,a&&m.load(),u&&(e.onerror=function(e,t,n){p.error("global error",e,t,n)}),s&&e.addEventListener("unload",function(){m.save()}),m}]}]).run(["chromePersistentLogger",angular.noop]),angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(e){var t={};return t.sendMessage=e.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),t.getBackgroundPage=e.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),t.connect=chrome.runtime.connect.bind(chrome.runtime),t.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),t.id=chrome.runtime.id,chrome.runtime.getPlatformInfo&&(t.getPlatformInfo=e.wrapChromeError(chrome.runtime.getPlatformInfo,chrome.runtime)),["onMessage","onMessageExternal","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach(function(e){t[e]={addListener:function(t){chrome.runtime[e].addListener(t)},removeListener:function(t){chrome.runtime[e].removeListener(t)}}}),t}]),angular.module("w69b.chromeStorage",["w69b.promiseTool"]).factory("chromeStorage",["promiseTool",function(e){var t=chrome.storage,n={};return["local","sync","managed"].forEach(function(r){n[r]={},["set","get","remove","clear"].forEach(function(o){n[r][o]=e.wrapChromeError(t[r][o],t[r])}),n[r].setSingle=function(e,t){var o={};return o[e]=t,n[r].set(o)},n[r].getSingle=function(e,t){return n[r].get(e).then(function(n){return n.hasOwnProperty(e)?n[e]:t})}}),n.onChanged=t.onChanged,n}]),angular.module("w69b.chromeTabs",["w69b.promiseTool"]).factory("chromeTabs",["$window","promiseTool","$q",function(e,t,n){if(!e.chrome||!e.chrome.tabs)return null;var r=e.chrome,o={};return o.query=t.wrapChromeError(r.tabs.query,r.tabs),o.getActiveTab=function(){return o.query({active:!0,windowId:r.windows.WINDOW_ID_CURRENT}).then(function(e){return e.length?e[0]:n.reject()})},o.get=t.wrapChromeError(r.tabs.get,r.tabs),o.update=t.wrapChromeError(r.tabs.update,r.tabs),o.remove=t.wrapChromeError(r.tabs.remove,r.tabs),o.create=t.wrapChromeError(r.tabs.create,r.tabs),o.connect=r.tabs.connect.bind(r.tabs),o.setZoomSettings=t.wrapChromeError(r.tabs.setZoomSettings,r.tabs),o.setZoom=t.wrapChromeError(r.tabs.setZoom,r.tabs),o.executeScript=t.wrapChromeError(r.tabs.executeScript,r.tabs),o.insertCSS=t.wrapChromeError(r.tabs.insertCSS,r.tabs),o.sendMessage=t.wrapChromeError(r.tabs.sendMessage,r.tabs),o.onUpdated=r.tabs.onUpdated,o.onActivated=r.tabs.onActivated,o.sendMessageActive=function(e,t){return o.getActiveTab().then(function(n){return o.sendMessage(n.id,e,t)})},o}]).directive("newTab",["chromeTabs",function(e){return{restrict:"A",link:function(t,n,r){n.bind("click",function(t){t.preventDefault(),e.create({url:r.href}).then(function(e){chrome.windows.update(e.windowId,{focused:!0},angular.noop)})})}}}]),angular.module("w69b.chromeWindows",[]).factory("chromeWindows",["promiseTool",function(e){var t={};return t.get=e.wrapChromeError(chrome.windows.get,chrome.windows),t.create=e.wrapChromeError(chrome.windows.create,chrome.windows),t.update=e.wrapChromeError(chrome.windows.update,chrome.windows),t.getCurrent=e.wrapChromeError(chrome.windows.getCurrent,chrome.windows),t.remove=e.wrapChromeError(chrome.windows.remove,chrome.windows),t.onRemoved=chrome.windows.onRemoved,t}]),angular.module("w69b.googleHttpAuthInterceptor",[]).provider("googleHttpAuthInterceptor",function(){var e=0,t="googleauth";this.enableAuthAutoRetry=function(t){e=t?1:0},this.setAuthProvider=function(e){t=e},this.$get=["$q","$log","$injector",function(n,r,o){function a(){return f||(f=o.get(t)),f}function i(e){return a().getAuthToken(e)}function c(e){return{Authorization:"Bearer "+e}}function u(){return l||(l=o.get("$http")),l}function s(t){var o=t.status;if(401==o&&t.config.googleAuth&&t.config.authAutoRetry!==!1){r.debug("auth error detected",t);var a=angular.copy(t.config);if(a.authRetryCount?a.authRetryCount++:a.authRetryCount=1,a.authRetryCount<=e)return i({scopes:a.googleAuthScopes,validate:!0}).then(function(){return r.debug("googleAuthHttpInterceptor: auto-retrying with validated token"),u()(a)})}return n.reject(t)}var l,f;return{request:function(e){return e.googleAuth?i({scopes:e.googleAuthScopes}).then(function(t){return e.headers=angular.extend(e.headers||{},c(t)),e},function(e){return r.warn("googleAuthHttpInterceptor: no token, aborting request",e),n.reject("googleAuthFailed")}):e},responseError:s}}]}),angular.module("w69b.filesHelper",["w69b.promiseTool"]).factory("filesHelper",["$window","promiseTool","$q",function(e,t,n){function r(e){var t=e.split("/"),n=t.slice(0,-1).join("/"),r=t.slice(-1)[0];return[n,r]}e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem;var o=window.PERSISTENT,a=104857600,i={},c=["readEntries","remove","getFile","getMetadata","moveTo","file","getDirectory","createWriter"];return c.forEach(function(e){i[e]=function(n){var r=[].slice.call(arguments,1);return t.wrapCallbacks(n[e],n).apply(null,r)}}),i.getFileSystem=function(n,r){return angular.isUndefined(n)&&(n=o),r=r||a,t.wrapCallbacks(e.requestFileSystem,e)(n,r)},i.getPersistentQuota=function(){var t=n.defer();return e.navigator.webkitPersistentStorage.queryUsageAndQuota(function(e,n){t.resolve({usage:e,quota:n})},function(e){t.reject(e)}),t.promise},chrome.system&&chrome.system.storage&&(i.getStorageInfo=t.wrapChromeError(chrome.system.storage.getInfo,chrome.system.storage)),i.getDirByPath=function(e,t){function r(e,o){return o.length?i.getDirectory(e,o[0],t||{}).then(function(e){return r(e,o.slice(1))}):n.when(e)}var o=e.split("/");return""===o[0]&&o.splice(0,1),i.getFileSystem().then(function(e){return r(e.root,o,t)})},i.moveFileByPath=function(e,t){var o=r(t),a=o[0],c=o[1];return n.all({file:i.getFileEntryByPath(e),targetDir:i.getDirByPath(a)}).then(function(e){return i.moveTo(e.file,e.targetDir,c)})},i.getFileEntryByPath=function(e,t,n){var o=r(e),a=o[0],c=o[1];return i.getDirByPath(a,n).then(function(e){return i.getFile(e,c,t||{})})},i.getFileByPath=function(e){return i.getFileEntryByPath(e).then(function(e){return i.file(e)})},i.removeByPath=function(e){return i.getFileEntryByPath(e).then(function(e){return i.remove(e)})},i.listByPath=function(e){return i.getDirByPath(e).then(function(e){var t=e.createReader();return i.readEntries(t)})},i.requestPersistentQuota=function(e){return t.wrapCallbacks(navigator.webkitPersistentStorage.requestQuota,navigator.webkitPersistentStorage)(e||a)},i.requestTemporaryQuota=function(e){return t.wrapCallbacks(navigator.webkitTemporaryStorage.requestQuota,navigator.webkitTemporaryStorage)(e||a)},i.writeFile=function(e,t){var r=n.defer();return e.onwriteend=r.resolve.bind(r),e.onerror=r.reject.bind(r),e.write(t),r.promise},i.isSupported=function(){return!!window.requestFileSystem},i}]),angular.module("w69b.logging",[]).provider("$log",function(){var e=!0,t=this,n=!1;this.debugEnabled=function(t){return angular.isDefined(t)?(e=t,this):e},this.setCustomHook=function(e){n=e},this.$get=["$window",function(r){function o(e){return e instanceof Error&&(e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}function a(e){var t=r.console||{},a=t[e]||t.log||angular.noop,i=!1;try{i=!!a.apply}catch(c){}return i?function(){var r=[];return angular.forEach(arguments,function(e){r.push(o(e))}),n&&n(e,r)?a.apply(t,r):void 0}:function(t,r){n&&n(e,[t,r])&&a(t,null===r?"":r)}}return{log:a("log"),info:a("info"),warn:a("warn"),error:a("error"),debug:function(){var n=a("debug");return function(){e&&n.apply(t,arguments)}}()}}]}),angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,t){var n={};return n.wrapChromeError=function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),o=e.defer();return r.push(function(e){chrome.runtime.lastError?o.reject(chrome.runtime.lastError):o.resolve(e)}),t.apply(n,r),o.promise}},n.wrapCallbacks=function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),o=e.defer();return r.push(o.resolve.bind(o)),r.push(o.reject.bind(o)),t.apply(n,r),o.promise}},n.serializer=function(){var t=null;return function(n){var r=e.defer();return(t||e.when())["finally"](function(){var e=n.call();r.resolve(e)}),t=r.promise,t["finally"](function(){t=null}),r.promise}},n.withTimeout=function(n,r,o){o||(o=angular.noop);var a=e.defer(),i=t(function(){var e=o();angular.isDefined(e)?a.resolve(e):a.reject("timeout"),a=null},r),c=n(),u=a.promise;return c["finally"](function(){t.cancel(i),i=null}),c.then(function(){a&&a.resolve.apply(a,arguments)},function(){a&&a.reject.apply(a,arguments)}),u},n}]),angular.module("w69b.structs.CircularBuffer",[]).factory("CircularBuffer",function(){var e=function(e){this.maxSize_=e||100,this.buff_=[]},t=e.prototype;return t.nextPtr_=0,t.add=function(e){this.buff_[this.nextPtr_]=e,this.nextPtr_=(this.nextPtr_+1)%this.maxSize_},t.get=function(e){return e=this.normalizeIndex_(e),this.buff_[e]},t.set=function(e,t){e=this.normalizeIndex_(e),this.buff_[e]=t},t.getCount=function(){return this.buff_.length},t.isEmpty=function(){return 0===this.buff_.length},t.clear=function(){this.buff_.length=0,this.nextPtr_=0},t.getValues=function(){return this.getNewestValues(this.getCount())},t.getNewestValues=function(e){for(var t=this.getCount(),n=this.getCount()-e,r=[],o=n;t>o;o++)r.push(this.get(o));return r},t.getKeys=function(){for(var e=[],t=this.getCount(),n=0;t>n;n++)e[n]=n;return e},t.containsKey=function(e){return e<this.getCount()},t.containsValue=function(e){for(var t=this.getCount(),n=0;t>n;n++)if(this.get(n)==e)return!0;return!1},t.getLast=function(){return 0===this.getCount()?null:this.get(this.getCount()-1)},t.normalizeIndex_=function(e){if(e>=this.buff_.length)throw Error("Out of bounds exception");return this.buff_.length<this.maxSize_?e:(this.nextPtr_+Number(e))%this.maxSize_},e}),angular.module("w69b.spawn",[]).factory("spawn",["$q","$log",function(e,t){function n(t,n){function r(e,t){var n;try{n=e(t)}catch(r){return o(r)}return n.done?a(n.value):a(n.value).then(c,u)}var o=n?Promise.reject.bind(Promise):e.reject.bind(e),a=n?Promise.resolve.bind(Promise):e.when.bind(e),i=t(),c=r.bind(null,i.next.bind(i)),u=r.bind(null,i["throw"].bind(i));
return c()}return n.wrap=function(e){return function(){var r,o=arguments,a=n((r=e).bind.apply(r,$traceurRuntime.spread([this],o)));return a["catch"](function(e){t.error("unhandled spawn.wrap rejection:",e),e.stack&&console.error(e.stack)}),a}},n}]),angular.module("w69b.throttle",[]).factory("throttle",["$timeout",function(e){function t(t,n,r){var o,a,i;r=r!==!1;var c=function(){i=angular.copy(arguments,[]),a=function(){return o=null,a=null,t.apply(null,i)},r?(o&&e.cancel(o),o=e(a,n)):o||(o=e(a,n))};return c.flush=function(){o&&(e.cancel(o),a())},c}return t}]),angular.module("w69b.timeutil",[]).factory("timeutil",function(){var e={};return e.formatDuration=function(e){function t(e){return 10>e?"0"+e:e}angular.isNumber(e)||(e=0);var n="";0>e&&(n="-",e=-e);var r=Math.floor(e%60),o=Math.floor(e/60%60),a=[t(o),t(r)],i=Math.floor(e/3600);return i&&a.unshift(i),n+a.join(":")},e}).filter("duration",["timeutil",function(e){return function(t){return e.formatDuration(t||0)}}]),angular.module("w69b.uritool",[]).factory("uritool",function(){function e(e){return decodeURIComponent(e.replace(t," "))}var t=/\+/g,n={};return n.parseQuery=function(t,n){"?"==t[0]&&(t=t.substring(1));for(var r,o=/([^&=]+)=?([^&]*)/g,a={};r=o.exec(t);){var i=e(r[1]),c=e(r[2]);n&&a.hasOwnProperty(i)?a[i].push(c):a[i]=n?[c]:c}return a},n.parseUrl=function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,hash:t.hash,path:t.pathname}},n.encodeQuery=function(e){var t=[];return angular.forEach(e,function(e,n){angular.isArray(e)?angular.forEach(e,function(e){t.push(encodeURIComponent(n)+(e===!0?"":"="+encodeURIComponent(e)))}):t.push(encodeURIComponent(n)+(e===!0?"":"="+encodeURIComponent(e)))}),t.length?t.join("&"):""},n}),angular.module("w69b.uuid",[]).factory("uuid",["$window",function(e){function t(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}function n(){var n=new Uint16Array(8);return e.crypto.getRandomValues(n),t(n[0])+t(n[1])+"-"+t(n[2])+"-4"+t(n[3]).substring(1)+"-y"+t(n[4]).substring(1)+"-"+t(n[5])+t(n[6])+t(n[7])}return n}]),angular.module("w69b.ui.bytesFilter",[]).filter("bytes",["$injector",function(e){function t(t,r){return n||(n=e.get("$filter")("number")),n(t,r)}var n;return function(e,n){if(!angular.isNumber(e))return"-";if(angular.isUndefined(n)&&(n=1),0>=e)return"0 B";var r=["B","KB","MB","GB","TB","PB"],o=Math.floor(Math.log(e)/Math.log(1024));return t(e/Math.pow(1024,Math.floor(o)),n)+" "+r[o]}}]),angular.module("w69b.webrtc",["w69b.promiseTool"]).factory("webrtc",["promiseTool","$window","$q",function(e,t,n){function r(e){return e.some(function(e){return!!e.label})}var o={},a=t.navigator;return o.getUserMedia=e.wrapCallbacks(a.getUserMedia||a.webkitGetUserMedia||a.mozGetUserMedia||a.msGetUserMedia,a),a.mediaDevices&&a.mediaDevices.enumerateDevices?o.getSources=function(){return n.when(a.mediaDevices.enumerateDevices()).then(function(e){return e.filter(function(e){return e.kind.endsWith("input")}).map(function(e){var t={id:e.deviceId,label:e.label};return t.kind=e.kind.substring(0,e.kind.length-5),t})})}:o.getSources=e.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),o.getSourcesByKind=function(e){return o.getSources().then(function(t){return t.filter(function(t){return t.kind===e})})},o.getVideoSources=function(){return o.getSourcesByKind("video")},o.getAudioSources=function(){return o.getSourcesByKind("audio")},o.hasCamera=function(){return o.getVideoSources().then(function(e){return e.length>0})},o.hasMicrophone=function(){return o.getAudioSources().then(function(e){return e.length>0})},o.hasVideoAccess=function(){return o.getVideoSources().then(r)},o.hasAudioAccess=function(){return o.getAudioSources().then(r)},o}]),angular.module("w69b.ui.focus",[]).directive("wbLoopFocus",["$document","$timeout",function(e,t){return{restrict:"A",link:function(n,r){function o(){var e=i.querySelector('input:not([tabindex^="-"]),textarea:not([tabindex^="-"]),button:not([tabindex^="-"]),*[tabindex]:not([tabindex^="-"])');e&&e.focus()}function a(e){var n=e.target;e.relatedTarget||i.contains(n)&&n!==i||t(o)}var i=r[0];r.attr("tabindex",-1);var c=e.find("body");c[0].addEventListener("focus",a,!0),r.on("$destroy",function(){c[0].removeEventListener("focus",a,!0)})}}}]).directive("wbFocus",["$timeout",function(e){return{link:function(t,n,r){t.$watch(r.wbFocus,function(t){t&&e(function(){n[0].focus(),n[0].select&&n[0].select()})},!0),n.bind("blur",function(){angular.isDefined(r.wbFocusLost)&&t.$apply(r.wbFocusLost)})}}}]).directive("wbAutoselect",["$timeout",function(e){return{link:function(t,n){n.bind("focus click",function(){e(function(){n[0].select()})})}}}]),angular.module("w69b.chromePermissions",["w69b.promiseTool"]).factory("chromePermissions",["promiseTool",function(e){var t=window.chrome&&window.chrome.permissions,n={};return t?(n.contains=e.wrapChromeError(t.contains,t),n.request=e.wrapChromeError(t.request,t),n.remove=e.wrapChromeError(t.remove,t),n.getAll=e.wrapChromeError(t.getAll,t),n):n}]),angular.module("w69b.chromeSystem",["w69b.promiseTool"]).factory("chromeSystem",["promiseTool",function(e){var t=window.chrome&&window.chrome.system,n={};return t?(t.cpu&&(n.cpu={getInfo:e.wrapChromeError(t.cpu.getInfo,t.cpu)}),t.memory&&(n.memory={getInfo:e.wrapChromeError(t.memory.getInfo,t.memory)}),n):n}]),angular.module("castifyExt.PopupApp").requires.push("templates")}();