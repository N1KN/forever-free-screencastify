"use strict";!function(){function e(){var e=document.createElement("div");document.body.appendChild(e),angular.bootstrap(e,["castifyExt.bgApp"],{strictDi:!1})}!function(e){function t(e,t,r,n){if("string"!=typeof e)throw"System.register provided no module name";t="boolean"==typeof r?{declarative:!1,deps:t,execute:n,executingRequire:r}:{declarative:!0,deps:t,declare:r},t.name=e,e in s||(s[e]=t),e=t.deps,r=[],n=0;for(var a=e.length;a>n;n++)-1==u.call(r,e[n])&&r.push(e[n]);t.deps=r,t.normalizedDeps=t.deps}function r(e,t){if(t[e.groupIndex]=t[e.groupIndex]||[],-1==u.call(t[e.groupIndex],e)){t[e.groupIndex].push(e);for(var n=0,a=e.normalizedDeps.length;a>n;n++){var o=s[e.normalizedDeps[n]];if(o&&!o.evaluated){var i=e.groupIndex+(o.declarative!=e.declarative);if(void 0===o.groupIndex||o.groupIndex<i){if(void 0!==o.groupIndex&&(t[o.groupIndex].splice(u.call(t[o.groupIndex],o),1),0==t[o.groupIndex].length))throw new TypeError("Mixed dependency cycle detected");o.groupIndex=i}r(o,t)}}}}function n(e){return l[e]||(l[e]={name:e,dependencies:[],exports:{},importers:[]})}function a(t){if(!t.module){var r=t.module=n(t.name),o=t.module.exports,i=t.declare.call(e,function(e,t){r.locked=!0,o[e]=t;for(var n=0,a=r.importers.length;a>n;n++){var i=r.importers[n];if(!i.locked){var c=u.call(i.dependencies,r);i.setters[c](o)}}return r.locked=!1,t});if(r.setters=i.setters,r.execute=i.execute,!r.setters||!r.execute)throw new TypeError("Invalid System.register form for "+t.name);for(var i=0,d=t.normalizedDeps.length;d>i;i++){var f=t.normalizedDeps[i],h=s[f],p=l[f];p?f=p.exports:h&&!h.declarative?f=h.module.exports&&h.module.exports.__esModule?h.module.exports:{"default":h.module.exports,__useDefault:!0}:h?(a(h),p=h.module,f=p.exports):f=c(f),p&&p.importers?(p.importers.push(r),r.dependencies.push(p)):r.dependencies.push(null),r.setters[i]&&r.setters[i](f)}}}function o(t){if(!t.module){var r={},n=t.module={exports:r,id:t.name};if(!t.executingRequire)for(var a=0,u=t.normalizedDeps.length;u>a;a++){var l=s[t.normalizedDeps[a]];l&&o(l)}t.evaluated=!0,(r=t.execute.call(e,function(e){for(var r=0,n=t.deps.length;n>r;r++)if(t.deps[r]==e){if(e=t.normalizedDeps[r],r=void 0,n=s[e])n.declarative?i(e,[]):n.evaluated||o(n),r=n.module.exports;else if(r=c(e),!r)throw Error("Unable to load dependency "+e+".");return e=(!n||n.declarative)&&r&&r.__useDefault?r["default"]:r}throw new TypeError("Module "+e+" not declared as a dependency.")},r,n))&&(n.exports=r)}}function i(t,r){var n=s[t];if(n&&!n.evaluated&&n.declarative){r.push(t);for(var a=0,o=n.normalizedDeps.length;o>a;a++){var l=n.normalizedDeps[a];-1==u.call(r,l)&&(s[l]?i(l,r):c(l))}n.evaluated||(n.evaluated=!0,n.module.execute.call(e))}}function c(e){if(d[e])return d[e];var t=s[e];if(!t)throw"Module "+e+" not present.";var n=s[e];n.groupIndex=0;var c=[];r(n,c);for(var n=!!n.declarative==c.length%2,u=c.length-1;u>=0;u--){for(var l=c[u],f=0;f<l.length;f++){var h=l[f];n?a(h):o(h)}n=!n}return i(e,[]),s[e]=void 0,c=t.module.exports,c&&(t.declarative||!0===c.__esModule)||(c={"default":c,__useDefault:!0}),d[e]=c}var s={},u=Array.prototype.indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(this[t]===e)return t;return-1},l={},d={};return function(r,n){var a;for(a={register:t,get:c,set:function(e,t){d[e]=t},newModule:function(e){return e},global:e},a.set("@empty",{}),n(a),a=0;a<r.length;a++)c(r[a])}}("undefined"!=typeof window?window:global)(["background-exports"],function(e){e.register("crypto",[],function(e){var t;return e("generateKey",function(){return t.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}),e("exportKey",function(e){return t.subtle.exportKey("jwk",e)}),e("importKey",function(e){return t.subtle.importKey("jwk",e,{name:"AES-GCM"},!0,["encrypt","decrypt"])}),e("encrypt",function(e,r){var n=window.crypto.getRandomValues(new Uint8Array(16)),a=new Uint8Array(0);return t.subtle.encrypt({name:"AES-GCM",iv:n,additionalData:a,tagLength:128},r,e).then(function(e){return[n,a,e]})}),e("decrypt",function(e,r){return t.subtle.decrypt({name:"AES-GCM",iv:e[0],additionalData:e[1],tagLength:128},r,e[2])}),{setters:[],execute:function(){t=window.crypto}}}),e.register("bg-storage-service",[],function(e){function t(){return a||(a=new n),a}var r,n,a;return{setters:[],execute:function(){r={set:function(e,t){return new Promise(function(r,n){var a;chrome.storage.local.set((a={},Object.defineProperty(a,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),a),function(){return chrome.runtime.lastError?n(chrome.runtime.lastError):void r()})})},get:function(e,t){return new Promise(function(r,n){chrome.storage.local.get(e,function(a){return chrome.runtime.lastError?n(chrome.runtime.lastError):void r(a.hasOwnProperty(e)?a[e]:t)})})}},n=function(){function e(){return $traceurRuntime.asyncWrap(function(e){for(;;)switch(e.state){case 0:i=r.get("cfDraw_store",{}),e.state=5;break;case 5:return void Promise.resolve(i).then(e.createCallback(3),e.errback);case 3:n=e.value,e.state=-2;break;default:return e.end()}},this)}function t(e){return e&&"castifyDrawStore"===e.type&&(n=e.data,r.set("cfDraw_store",n)),!1}var n,a={},o=!1,i=null;return a.getData=function(){return $traceurRuntime.asyncWrap(function(e){for(;;)switch(e.state){case 0:return void Promise.resolve(i).then(e.createCallback(2),e.errback);case 2:e.returnValue=n,e.state=4;break;case 4:e.state=-2;break;default:return e.end()}},this)},a.start=function(){o||(o=!0,chrome.runtime.onMessage.addListener(t),e())},a.stop=function(){o&&(o=!1,chrome.runtime.onMessage.removeListener(t))},a},a=null,e("getBgStorageService",t)}}}),e.register("chrome-messaging",[],function(e){function t(e){return e instanceof Error?Promise.reject(e.toString()):Promise.reject(e)}return e("sendMessage",function(e,t){return new Promise(function(r,n){chrome.runtime.sendMessage({type:e,data:t},function(e){chrome.runtime.lastError?n(chrome.runtime.lastError):e?"result"===e.type?r(e.data):"error"===e.type&&n(e.data):n()})})}),e("respond",function(e,r){Promise.resolve(r)["catch"](t).then(function(t){e({type:"result",data:t})},function(t){e({type:"error",data:t})})}),{setters:[],execute:function(){}}}),e.register("w69b/q",[],function(e){var t;return{setters:[],execute:function(){t={defer:function(){var e={};return e.promise=new Promise(function(t,r){e.resolve=t,e.reject=r}),e}},t.when=Promise.resolve.bind(Promise),t.all=Promise.all.bind(Promise),t.reject=Promise.reject.bind(Promise),Promise.prototype["finally"]||(Promise.prototype["finally"]=function(e){var t=this.constructor;return this.then(function(r){return t.resolve(e()).then(function(){return r})},function(r){return t.resolve(e()).then(function(){throw r})})}),e("default",t)}}}),e.register("throttle",[],function(e){function t(e,t,r){var n,a,o;r=!1!==r;var i=function(){o=Object.assign([],arguments),a=function(){return a=n=null,e.apply(null,o)},r?(n&&window.clearTimeout(n),n=window.setTimeout(a,t)):n||(n=window.setTimeout(a,t))};return i.flush=function(){n&&(window.clearTimeout(n),a())},i.cancel=function(){n&&window.clearTimeout(n)},i}return{setters:[],execute:function(){e("default",t)}}}),e.register("bg-message-service",["crypto"],function(e){function t(){return a||(a=new n),a}var r,n,a;return{setters:[function(e){r=e}],execute:function(){n=function(){function e(e,r,n){if(!e)return!1;if("castifyDrawGetMsgKey"===e.type){if(r.tab.url.startsWith("https://"))return t.then(function(e){n(e)})["catch"](function(){n(null)}),!0;n("plain")}else if("castifyDrawFrameBroadcast"===e.type&&r.tab)chrome.tabs.sendMessage(r.tab.id,e.data);else if("castifyDrawFrameMsgWithResult"===e.type&&r.tab)return chrome.tabs.sendMessage(r.tab.id,e.data,n),!0;return!1}var t=r.generateKey().then(r.exportKey),n={},a=!1;return n.start=function(){a||(chrome.runtime.onMessage.addListener(e),a=!0)},n.stop=function(){a&&(a=!1,chrome.runtime.onMessage.removeListener(e))},n},a=null,e("getBgMessageService",t)}}}),e.register("w69b/promise-tool",["w69b/q"],function(e){var t,r;return{setters:[function(e){t=e["default"]}],execute:function(){r={wrapChromeError:function(e,r){return function(){var n=Array.prototype.slice.call(arguments,0),a=t.defer();return n.push(function(e){chrome.runtime.lastError?a.reject(chrome.runtime.lastError):a.resolve(e)}),e.apply(r,n),a.promise}},wrapCallbacks:function(e,r){return function(){var n=Array.prototype.slice.call(arguments,0),a=t.defer();return n.push(a.resolve.bind(a)),n.push(a.reject.bind(a)),e.apply(r,n),a.promise}}},e("default",r)}}}),e.register("w69b/webrtc",["w69b/promise-tool","w69b/q"],function(e){function t(e){return e.some(function(e){return!!e.label})}var r,n,a,o;return{setters:[function(e){r=e["default"]},function(e){n=e["default"]}],execute:function(){a={},o=window.navigator,a.getUserMedia=o.mediaDevices&&o.mediaDevices.getUserMedia?o.mediaDevices.getUserMedia.bind(o.mediaDevices):r.wrapCallbacks(o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia,o),a.getSources=o.mediaDevices&&o.mediaDevices.enumerateDevices?function(){return n.when(o.mediaDevices.enumerateDevices()).then(function(e){return e.filter(function(e){return e.kind.endsWith("input")}).map(function(e){var t={id:e.deviceId,label:e.label};return t.kind=e.kind.substring(0,e.kind.length-5),t})})}:window.MediaStreamTrack&&MediaStreamTrack.getSources?r.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack):function(){return Promise.resolve([])},a.getSourcesByKind=function(e){return a.getSources().then(function(t){return t.filter(function(t){return t.kind===e})})},a.getVideoSources=function(){return a.getSourcesByKind("video")},a.getAudioSources=function(){return a.getSourcesByKind("audio")},a.hasCamera=function(){return a.getVideoSources().then(function(e){return 0<e.length})},a.hasMicrophone=function(){return a.getAudioSources().then(function(e){return 0<e.length})},a.hasVideoAccess=function(){return a.getVideoSources().then(t)},a.hasAudioAccess=function(){return a.getAudioSources().then(t)},e("default",a)}}}),e.register("bg-cam-sustain-service",["chrome-messaging","w69b/webrtc"],function(e){function t(){return o||(o=new a),o}var r,n,a,o;return{setters:[function(e){r=e},function(e){n=e["default"]}],execute:function(){a=function(){function e(){a&&(a.getTracks().forEach(function(e){e.stop()}),o=a=null)}function t(e,t,n){return e&&"castifyDrawCamSustainMsg"===e.type&&(e=e.data)&&s.hasOwnProperty(e.type)?(r.respond(n,s[e.type](e.data)),!0):!1}var a,o,i={},c=!1,s={start:function(t){return $traceurRuntime.asyncWrap(function(r){for(;;)switch(r.state){case 0:r.state=a?4:6;break;case 4:r.state=JSON.stringify(o)===JSON.stringify(t)?1:3;break;case 1:r.returnValue=void 0,r.state=2;break;case 2:r.state=-2;break;case 3:e(),r.state=6;break;case 6:return void Promise.resolve(n.getUserMedia({video:t})).then(r.createCallback(10),r.errback);case 10:a=r.value,r.state=9;break;case 9:o=t,r.state=-2;break;default:return r.end()}},this)},stop:function(){e()}};return i.start=function(){c||(chrome.runtime.onMessage.addListener(t),c=!0)},i.stop=function(){c&&(c=!1,e(),chrome.runtime.onMessage.removeListener(t))},i},o=null,e("getBgCamSustainService",t)}}}),e.register("bg-castify-draw-service",["bg-message-service","bg-storage-service","bg-cam-sustain-service","throttle"],function(e){function t(e,t){return function(){var r=Array.prototype.slice.call(arguments,0);return new Promise(function(n,a){r.push(function(e){chrome.runtime.lastError?a(chrome.runtime.lastError):n(e)}),e.apply(t,r)})}}function r(e,t,r){function s(t){var n=[c.executeScript(e,{file:t?y:v,allFrames:!0,matchAboutBlank:!0,runAt:"document_start"})];return t&&n.push(c.insertCSS(e,{file:r,allFrames:!0,matchAboutBlank:!0,runAt:"document_start"})),Promise.all(n)}function u(){if(!m){var t=s(!0).then(function(){return g=c.connect(e,{name:"castifyDraw"}),g.onDisconnect.addListener(function(){m===t&&(m=null)}),g.onMessage.addListener(function(e){k.hasOwnProperty(e.type)&&k[e.type](g,e.data)}),g});t["catch"](function(e){console.error("BgCastifyDrawServiceError",e)}),m=t}return m}function l(e){var r,n;return $traceurRuntime.asyncWrap(function(o){for(;;)switch(o.state){case 0:r=new Promise(function(e){k.initializeDone=function(){k.initializeDone=null,e()}}),e=Object.assign({bundlesPath:t},e),o.state=9;break;case 9:return void Promise.resolve(u()).then(o.createCallback(2),o.errback);case 2:return void Promise.resolve(a().getData()).then(o.createCallback(5),o.errback);case 5:n=o.value,o.state=4;break;case 4:h("initialize",{config:e,storage:n}),o.state=11;break;case 11:return void Promise.resolve(r).then(o.createCallback(7),o.errback);case 7:k.initializeDone=null,b=void 0,o.state=-2;break;default:return o.end()}},this)}function d(t){t.tabId==e&&(0===t.frameId?(S.cancel(),p(),l(b)):S())}function f(t){t.replacedTabId===e&&(e=t.tabId,p(),l(b))}function h(e,t){return u().then(function(r){r.postMessage({type:e,data:t})})}function p(){m&&(m.then(function(e){e.disconnect()}),m=null)}var g,m,b,y=t+"content-script.js",v=t+"content-script-frame.js",w={},k={},S=i(function(){s()},1e3);return w.initialize=function(e){return $traceurRuntime.asyncWrap(function(t){for(;;)switch(t.state){case 0:b=e,t.state=5;break;case 5:t.returnValue=l(e),t.state=2;break;case 2:t.state=-2;break;default:return t.end()}},this)},w.dispose=function(){p(),chrome.webNavigation.onCommitted.removeListener(d),chrome.webNavigation.onTabReplaced.removeListener(f),o().stop()},n().start(),a().start(),o().start(),u(),chrome.webNavigation.onCommitted.addListener(d),chrome.webNavigation.onTabReplaced.addListener(f),w}var n,a,o,i,c;return{setters:[function(e){n=e.getBgMessageService},function(e){a=e.getBgStorageService},function(e){o=e.getBgCamSustainService},function(e){i=e["default"]}],execute:function(){c={executeScript:t(chrome.tabs.executeScript,chrome.tabs),insertCSS:t(chrome.tabs.insertCSS,chrome.tabs),connect:chrome.tabs.connect.bind(chrome.tabs)},e("BgCastifyDrawService",r)}}}),e.register("background-exports",["bg-castify-draw-service"],function(e){var t;return{setters:[function(e){t=e.BgCastifyDrawService}],execute:function(){window.BgCastifyDrawService=t}}})}),window.angular&&angular.module("w69b.es6",[]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,r=Object(this),n=r.length>>>0,a=arguments[1],o=0;n>o;o++)if(t=r[o],e.call(a,t,o,r))return t}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===this||null===this)throw new TypeError("Cannot convert this value to object");var t=Object(this),r=parseInt(t.length,10)||0;if(0===r)return!1;var n=parseInt(arguments[1],10)||0;if(n>=r)return!1;var a;for(n>=0?a=n:(a=r+n,0>a&&(a=0));r>a;){var o=t[a];if(e===o||e!==e&&o!==o)return!0;a++}return!1}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var r=this.toString();(void 0===t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return-1!==n&&n===t}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}),angular.module("castifyExt.commonConfig",["castifyExt.castifyAuth","w69b.chromeAnalytics","w69b.chromeRuntime","castifyExt.licensing","castifyExt.helpCenterConfig","castifyExt.appOptions"]).config(["$compileProvider","$sceDelegateProvider","analyticsProvider",function(e,t,r){r.setTrackingId("UA-23874345-14"),r.setApp("Screencastify"),t.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**","https://**"]);var n=/^\s*(https?|mailto|blob|chrome-extension|filesystem:chrome-extension):/;e.aHrefSanitizationWhitelist(n),e.imgSrcSanitizationWhitelist(n)}]).run(["$rootScope","analytics","chromeRuntime","licensing","$location","appOptions","$injector",function(e,t,r,n,a,o,i){var c=i.has("$route")?i.get("$route"):null;if(c){var s;e.$on("$viewContentLoaded",function(){var e=a.path();t.tracker.sendAppView(c.current.pageTitle||e),s=e})}e.$watch(function(){return n.hasLicense()?n.isPaid()?"paid":n.isTester()?"tester":"trial":"unknown"},function(e){t.tracker.set("dimension1",e)}),o.loadedPromise.then(function(){t.setEnabled(o.values.enableAnalytics)})}]).value("castifyConfig",{API_URL:"https://www.screencastify.com/api",IS_E2E:window.localStorage.e2e}),angular.module("castifyExt.authConfig",["castifyExt.youtubeAuth","castifyExt.castifyAuth","w69b.chromeRuntime","w69b.googleHttpAuthInterceptor","castifyExt.youtubeAuth"]).config(["$httpProvider","youtubeAuthProvider","googleHttpAuthInterceptorProvider",function(e,t,r){var n="242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com";t.setClientId(n),e.interceptors.push("youtubeHttpAuthInterceptor"),e.interceptors.push("googleHttpAuthInterceptor"),r.enableAuthAutoRetry(!0),r.setAuthProvider("castifyAuth")}]),angular.module("castiy.audioStreamMixer",["castifyExt.audioContextPool"]).factory("audioStreamMixer",["audioContextPool",function(e){function t(){var t=e.acquire(),r=t.createMediaStreamDestination(),n={},a={},o={};return o.addStream=function(e,o){var i=t.createMediaStreamSource(o),c=t.createGain();a[e]=i,n[e]=c,i.connect(c),c.connect(r)},o.replaceStream=function(e,r){var i=a[e];i||o.addStream(e,r),i.disconnect();var c=t.createMediaStreamSource(r);c.connect(n[e])},o.setGain=function(e,t){n[e].gain.value=t},o.outStream=r.stream,o.dispose=function(){o.outStream.getTracks().forEach(function(e){e.stop()}),r.disconnect(),angular.forEach(n,function(e){e.disconnect()}),angular.forEach(a,function(e){e.disconnect()}),e.release(t)},o}return t}]),angular.module("castifyExt.chromeVideoRecorder",["w69b.pnaclVideoEncoder","w69b.webrtc","w69b.chromeCapture","w69b.chromeTabs","w69b.promiseTool","w69b.spawn","castifyExt.optionalPermissions","castifyExt.castifyDrawService","castifyExt.resizeTab","castiy.audioStreamMixer","castifyExt.requestMicPermission","castifyExt.webrtcRecorder","castifyExt.hdpiTool"]).provider("chromeVideoRecorder",function(){var e="/components/castify/pnacl/manifest_pnacl.nmf",t=!0;this.setEncoderUrl=function(r,n){e=r,t=!!n},this.$get=["$log","pnaclVideoEncoder","webrtc","chromeCapture","$q","castifyDrawService","resizeTab","chromeTabs","audioStreamMixer","$interval","$rootScope","requestMicPermission","promiseTool","optionalPermissions","spawn","hdpiTool","webrtcRecorder",function(r,n,a,o,i,c,s,u,l,d,f,h,p,g,m,b,y){function v(){r.warn("video stream ended while still recording"),f.$broadcast("chromeVideoRecorder:streamEnded")}function w(e){e.getTracks().forEach(function(e){e.stop()})}function k(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])}function S(){V&&V.dispose(),V=null,q.video&&q.video.removeEventListener("inactive",v),angular.forEach(q,function(e){w(e)}),q={},U&&(B.pause(),B.src="",URL.revokeObjectURL(U),U=null),M&&(URL.revokeObjectURL(M),M=null)}function E(e){q.video&&(q.video.removeEventListener("inactive",v),w(q.video)),q.video=e,e.addEventListener("inactive",v),U&&URL.revokeObjectURL(U),U=URL.createObjectURL(e)}function T(e){M&&URL.revokeObjectURL(M),M=URL.createObjectURL(e)}function R(e){function t(){var t=[],r=N.filter(function(e){return e.height<=o.height});e.resolution&&(r=r.filter(function(e){return e.height!==o.height}),r.unshift(o)),r.forEach(function(e){t.push({minHeight:e.height})});var n={audio:C(e),video:{optional:t,mandatory:{maxWidth:o.width,maxHeight:o.height}}};return e.camSourceId&&(n.video.mandatory.sourceId=e.camSourceId),a.getUserMedia(n)}function n(){return t()["catch"](function(e){return!e||"PermissionDeniedError"!==e.name&&"MediaDeviceFailedDueToShutdown"!==e.name&&"InvalidStateError"!==e.name?(r.warn("failed to get webcam stream",e),i.reject(e)):(r.debug("webcam permission error detected"),h().then(function(){return n()}))})}var o=e.resolution;return o||(o={width:4096,height:4096}),n()}function $(e){return e?e:i.reject("stream is null")}function x(e){var t=e.resolution;t||(t={width:4096,height:4096});var r=e.audio.system;if(G&&G.cancelled)return i.reject("cancelled");if("desktop"==e.captureSource||"screen"==e.captureSource){var n="desktop"==e.captureSource?["screen","window"]:["screen"];k()>=50&&e.audio.system&&n.push("audio"),W=o.chooseDesktopMedia(n);var c=W.promise.then(function(n){if(!n)return i.reject("cancelled");var o={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxWidth:t.width,maxHeight:t.height,maxFrameRate:e.targetFPS}}};return r&&(o.audio={mandatory:{chromeMediaSource:"system"}}),a.getUserMedia(o).then($)});return c["finally"](function(){W=!1}),c}if("tab"==e.captureSource){var s={video:!0,videoConstraints:{mandatory:{maxWidth:t.width,maxHeight:t.height,maxFrameRate:e.targetFPS}},audio:r};return r&&(s.audioConstraints={mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}}),o.tabCapture(s).then($)}if("cam"==e.captureSource)return R(e).then($);throw Error()}function C(e){if(e.audio.mic){var t={echoCancellation:e.audio.micAudioProcessing!==!1};return e.audio.micSourceId&&(t.sourceId=e.audio.micSourceId),{mandatory:t}}return!1}function I(e){function t(){return a.getUserMedia({audio:C(e),video:n})["catch"](function(e){return r.debug("capture mic failed",e&&e.name),i.reject(e)})}var n=!!e.embedWebcam;return n&&e.camSourceId&&(n={mandatory:{sourceId:e.camSourceId}}),t()["catch"](function(){return r.debug("requesting mic permission"),h().then(t)})}function A(){j&&(j.dispose(),j=null),S()}function P(e){return r.warn("chromeVideoRecorder: could not get video stream",e),i.reject(e)}function F(){O.onCrash=function(e){r.warn("video encoder crashed",e),A(),f.$broadcast("chromeVideoRecorder:crash",e)},O.onError=function(e){"start_timeout"!==e&&(A(),f.$broadcast("chromeVideoRecorder:error",e))}}function _(e){var t=e.audio.system&&"tab"==e.captureSource;t&&(B.src=U,B.volume=1,B.play())}function D(e){for(var t=2,r=t,n=1;n<Math.floor(16/b.devicePixelRatio);++n)if(r=Math.round(100*b.devicePixelRatio*n)/100,r%2===0){t=r;break}var a=e.width%t,o=e.height%t;return a||o?(e.width-=a,e.height-=o,!0):!1}var L,j,U,M,O,V,G,q={},B=document.createElement("video"),N=[{width:1920,height:1080},{width:1280,height:720},{width:854,height:480},{width:640,height:360},{width:320,height:240},{width:320,height:180}],H=1e4,W=null,z={};return z.start=function(o){function d(){return r.debug("chromeVideoRecorder: loading castifyDraw..."),j=c(o.tabId),p.withTimeout(function(){return i.when(j.initialize(o.draw))},H)}function h(){if("webrtc"==o.codec){if(y.isSupported())return y();U.codec=null}return n(e,t)}function v(){return"tab"===o.captureSource?u.get(o.tabId).then(function(e){U.originalMainSize={width:e.width,height:e.height}}):null}function w(){return o.audio.mic||o.embedWebcam?"cam"===o.captureSource?S:I(o):null}function k(){if(o.draw=o.draw||{showToolbox:!0},"tab"===o.captureSource&&(o.draw.hasOwnProperty("tool")||(o.draw.tool="pointer"),o.draw.allowWebcam=!1,o.draw.embedWebcam=o.embedWebcam,o.draw.camSourceId=o.camSourceId,o.draw.camPosition=o.camPosition),o.targetFPS=o.targetFPS||30,"cam"===o.captureSource&&(o.audio.system=!1,o.embedWebcam=!1),L=o,!o.filename)throw new Error("filename required");o.audio||(o.audio={}),o.brandingFilename&&(U.brandingFilename="/html5_persistent/"+o.brandingFilename),o.codec&&(U.codec=o.codec),o.audioCodec&&(U.audioCodec=o.audioCodec),o.startDelay&&(U.startDelay=o.startDelay),G={cancelled:!1,cancel:function(){G.cancelled=!0,W&&W.cancel("cancelled")}},O=h(),F()}var S,R=m.wrap($traceurRuntime.initGeneratorFunction(function B(){var e,t,r,n,a,i,c,l;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:d.state="tab"!==o.captureSource?1:2;break;case 1:d.returnValue=null,d.state=-2;break;case 2:r=b.toPhysicalResolution,n=u.get,a=o.tabId,i=n.call(u,a),d.state=9;break;case 9:return d.state=5,i;case 5:c=d.sent,d.state=7;break;case 7:l=r.call(b,c),e=l,d.state=11;break;case 11:o.resolution||(o.resolution=angular.copy(e)),D(o.resolution),d.state=22;break;case 22:d.state=D(e)?16:15;break;case 16:t=b.toCssResolution(e),d.state=17;break;case 17:return d.state=13,s(o.tabId,t.width,t.height,!1);case 13:d.maybeThrow(),d.state=15;break;case 15:d.returnValue=null,d.state=-2;break;default:return d.end()}},B,this)})),$=m.wrap($traceurRuntime.initGeneratorFunction(function N(){var e;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:t.state="tab"!==o.captureSource?1:2;break;case 1:t.state=-2;break;case 2:return t.state=5,g.hasTabPermissions(o);case 5:e=t.sent,t.state=7;break;case 7:t.state=e?9:8;break;case 8:t.returnValue=i.reject("tab_permissions_denied"),t.state=-2;break;case 9:t.returnValue=null,t.state=-2;break;default:return t.end()}},N,this)})),C=m.wrap($traceurRuntime.initGeneratorFunction(function z(){var e,t,n,c,s,u,h,p,g,m,b,y,k,C,I;return $traceurRuntime.createGeneratorInstance(function(A){for(;;)switch(A.state){case 0:return A.state=2,i.all([O.load(),R(),$()]);case 2:A.maybeThrow(),A.state=4;break;case 4:r.debug("chromeVideoRecorder: getting video stream"),A.state=57;break;case 57:t=x(o),n=t["catch"],c=n.call(t,P),A.state=10;break;case 10:return A.state=6,c;case 6:s=A.sent,A.state=8;break;case 8:S=s,A.state=12;break;case 12:r.debug("chromeVideoRecorder: got video stream"),E(S),A.state=59;break;case 59:return A.state=14,v();case 14:A.maybeThrow(),A.state=16;break;case 16:A.state="tab"===o.captureSource?28:41;break;case 28:u=o.draw,h=o.audio,p=h.mic,p?m=p:(g=o.embedWebcam,m=g),A.state=29;break;case 29:A.state=m?21:25;break;case 21:b=a.hasVideoAccess,y=b.call(a),A.state=22;break;case 22:return A.state=18,y;case 18:k=A.sent,A.state=20;break;case 20:C=k,A.state=24;break;case 25:C=m,A.state=24;break;case 24:u.allowWebcam=C,A.state=31;break;case 31:o.embedWebcam=!1,A.state=46;break;case 46:A.pushTry(36,null),A.state=39;break;case 39:return A.state=33,d();case 33:A.maybeThrow(),A.state=35;break;case 35:A.popTry(),A.state=41;break;case 36:A.popTry(),A.maybeUncatchable(),I=A.storedException,A.state=42;break;case 42:r.warn("chromeVideoRecorder: failed to initialize draw",I),A.state=41;break;case 41:return A.state=49,w();case 49:e=A.sent,A.state=51;break;case 51:r.debug("chromeVideoRecorder: got all streams"),U.videoTrack=S.getVideoTracks()[0],o.audio.system&&!S.getAudioTracks().length&&(o.audio.system=!1,r.warn("failed to capture system audio - stream has no audio track."),f.$broadcast("chromeVideoRecorder:systemAudioUnsupported")),(o.audio.system||o.audio.mic)&&(V=l(),U.audioTrack=V.outStream.getAudioTracks()[0]),e&&(q.mic=e),e&&o.audio.mic&&(V.addStream("mic",e),V.setGain("mic",o.audio.micGain||1)),o.audio.system&&V.addStream("system",S),o.embedWebcam&&e&&e.getVideoTracks().length&&(U.camTrack=e.getVideoTracks()[0],U.camPosition=o.camPosition,T(e)),_(o),r.debug("chromeVideoRecorder: staring encoder..."),A.state=61;break;case 61:return A.state=53,O.start(o.filename,U);case 53:A.maybeThrow(),A.state=55;break;case 55:r.debug("chromeVideoRecorder: recording started"),A.state=-2;break;default:return A.end()}},z,this)})),U={};k();var M=C()["catch"](function(e){return r.error("chromeVideoRecorder: start error",e),A(),i.reject(e)});return G.promise=M,M["finally"](function(){G=null}),M},z.stop=function(){return j&&(j.dispose(),j=null),O.stop()["finally"](function(){S()})},z.pause=function(){return O.pause()},z.resume=function(){return O.resume()},z.setMicGain=function(e){V&&V.setGain("mic",e)},z.getState=function(){return z.getStateObj().state},z.getStateObj=function(){var e;return e=O?O.getStateObj():{state:"inactive",time:0},angular.extend({},e,{videoUrl:U,cameraUrl:M,isDesktopDialogShown:!!W})},z.cancelPendingStart=function(){return G?(G.cancel(),!0):!1},z.getCurrentTime=function(){return O.getCurrentTime()},z.getRecordingConfig=function(){return L},z.replaceStream=function(e){var t=L.audio.system,n=angular.extend({},L,e);return O.replaceTracks?x(n).then(function(e){L=n,j&&(j.dispose(),j=c(n.tabId),j.initialize());var r={videoTrack:e.getVideoTracks()[0]};return t&&V.replaceStream("system",e),O.replaceTracks(r).then(function(){E(e),_(n)})},function(e){return r.warn("could not get replacement stream",e),i.reject(e)}):i.reject("chromeVideoRecorder: replaceTracks not supported by chosen recorder")},z}],this.$get.$inject=["$log","pnaclVideoEncoder","webrtc","chromeCapture","$q","castifyDrawService","resizeTab","chromeTabs","audioStreamMixer","$interval","$rootScope","requestMicPermission","promiseTool","optionalPermissions","spawn","hdpiTool","webrtcRecorder"]}),angular.module("castifyExt.fileNameGenerator",["w69b.filesHelper","w69b.uuid"]).factory("fileNameGenerator",["uuid","filesHelper",function(e,t){return function(r,n){function a(){return r+e()+n}function o(){var e=a();return t.getFileEntryByPath(e).then(function(){return o()},function(){return e})}return r||(r=""),n||(n=""),o()}}]),angular.module("castifyExt.appOptions",["w69b.chromeStorage","castifyExt.enterprisePolicy"]).factory("appOptions",["chromeStorage","$rootScope","$q","enterprisePolicy",function(e,t,r,n){var a={notifyAudio:!0,notifyFramerate:!1,notifyTabFocus:!0,uploadPrivacy:"public",autoOpen:!0,autoPlay:!0,driveSync:!1,enableDiskSpaceWatcher:!0,notifySyncProgress:!0,notifyEditProgress:!0,enableAnalytics:!0,enableCrashReports:!1,showDrawingToolsHint:!0,showEditToolsHint:!0,encoder:null,audioCodec:null},o={micGain:1,micAudioProcessing:!0},i=!1,c={},s=angular.copy(a);return c.localValues=angular.copy(o),c.loadedPromise=r.all({sync:e.sync.getSingle("options"),local:e.local.getSingle("options"),managed:n.loadedPromise}).then(function(e){angular.extend(s,e.sync),angular.extend(c.localValues,e.local),i=!0}),c.values={},Object.keys(a).forEach(function(e){Object.defineProperty(c.values,e,{enumerable:!0,get:function(){return n.has(e)?n.get(e):s[e]},set:function(t){s[e]=t}})}),c.save=function(){return e.sync.setSingle("options",s)},c.saveLocal=function(){return e.local.setSingle("options",c.localValues)},c.isLoaded=function(){return i},c.isSetByEnterprisePolicy=function(e){return n.has(e)},e.onChanged.addListener(function(e,r){"sync"==r&&e.options&&(angular.extend(s,e.options.newValue),t.$$phase||t.$digest()),"local"==r&&e.options&&(angular.extend(c.localValues,e.options.newValue),t.$$phase||t.$digest())}),c}]),angular.module("castifyExt.bgRecord",["w69b.chromeTabs","w69b.chromeAnalytics","w69b.chromeCommands","w69b.chromeStorage","w69b.chromeWindows","w69b.chromeNotifications","w69b.filesHelper","w69b.spawn","castifyExt.chromeVideoRecorder","castifyExt.bgFiles","castifyExt.appOptions","castifyExt.recordTool","castifyExt.fileNameGenerator","castifyExt.crashReporter","castifyExt.helpCenter","castifyExt.branding","castifyExt.connect.appRegistry","castifyEdit.bgEditJobScheduler"]).factory("bgRecordService",["chromeVideoRecorder","$rootScope","$q","$log","chromeRuntime","chromeTabs","$window","analytics","appOptions","recordTool","fileNameGenerator","chromeCommands","bgFiles","chromeStorage","chromeWindows","crashReporter","chromeNotifications","helpCenter","branding","appRegistry","filesHelper","spawn","bgEditJobScheduler",function(e,t,r,n,a,o,i,c,s,u,l,d,f,h,p,g,m,b,y,v,w,k,S){function E(e){return{path:{19:"images/"+e+"19.png",38:"images/"+e+"38.png"}}}function T(){return w.getDirByPath(X,{create:!0})}function R(e){if(Y)throw new Error("already blocked");Y=!0;var t=r.defer();return Q=t.promise,e["finally"](function(){Y=!1,t.resolve()}),e}function $(e,t){n.warn("bgRecord: recorder_fatal_error",t),c.trackEvent("recorder","fatal_error",t),F(),"out_of_disk_space"===t?b.setNotifyHelp(m.simple.create({priority:1,title:"Out of disk space",message:"Recording was stopped forcefully. Your recording might be corrupted.",buttons:[{title:"Help"}]},"disk_space")):m.simple.create({priority:1,title:"Oops, something went wrong",message:"Please try to restart Chrome if this problem persists."
})}function x(e,t){if("load_timeout"===e)b.setNotifyHelp(m.simple.create({priority:1,title:"Failed to load NaCl module",message:"Click for help",buttons:[{title:"Help"}]}),"load_nacl");else if("tab_permissions_denied"===e)m.simple.create({priority:1,title:"Tab recording requires additional permissions.",message:"Please use the Screencastify Icon to start recording."});else{var r="tab"===t.captureSource?"Please try to re-open the tab you are trying to record.":"Please try to restart your computer if this problem persists";b.setNotifyHelp(m.simple.create({priority:1,title:"Failed to start recording",message:r,buttons:[{title:"Help"}]}),"start_recording")}}function C(e,t){s.values.enableCrashReports&&g.report("encoder",t),c.trackEvent("recorder","fatal_error","crash"),F(),m.simple.create({priority:2,title:"Encoder crashed",message:"Oops, the video encoder crashed. This should not have happened. Please submit a bug report."},"crash")}function I(e,t){K.forEach(function(r){r.postMessage({type:e,data:t})})}function A(t){var r;t||(t=e.getState()),r="paused"===t?"icon_paused":"recording"===t?"icon_recording":"icon",chrome.browserAction.setIcon(E(r))}function P(t){if(K.length){var r=angular.copy(e.getStateObj());angular.extend(r,t),r.config=e.getRecordingConfig(),r.previewShown=!!W,r.isBlocked=Y,I("stateUpdate",r)}}function F(){n.debug("bgRecord: cleaning up after fatal error stop"),o.onActivated.removeListener(V),B(),Y=!1,re()}function _(e){return o.getActiveTab().then(function(t){e.tabId=t.id,e.windowId=t.windowId,e.tabTitle=t.title,e.resolution=u.getResolutionLimit(e,t)})}function D(){c.trackEvent("recorder","notify","streamEnded"),te.stop()}function L(){c.trackEvent("recorder","notify","streamEnded"),m.simple.create({priority:1,title:"Not recording system audio",message:"Capturing system audio is only supported for full-screen or tab recording."},"noSystemAudio")}function j(t){if(!Y){if(n.debug("bgRecord: replacing stream...",t),"inactive"===e.getState())return void n.error("bgRecord: cannot replace tab while not recording");m.clear("activeTab"),c.trackEvent("recorder","control","replaceStream"),R(e.replaceStream(t))}}function U(e){if("recorder"==e.name){K.push(e),P(),e.onDisconnect.addListener(function(){var t=K.indexOf(e);t>=0&&K.splice(t,1)});var r={start:te.start,stop:te.stop,replaceStream:j,pause:te.pause,resume:te.resume,cancelPendingStart:te.cancelPendingStart,showPreview:function(e){e?N():B()}};e.onMessage.addListener(function(e){r.hasOwnProperty(e.type)&&r[e.type](e.data),t.$$phase||t.$digest()})}}function M(){m.clear("audioDropped"),m.clear("lowFrameRate"),m.clear("activeTab"),m.clear("noSystemAudio")}function O(t){if(!Y){var r=e.getState();if("toggle-recording"==t)"recording"===r||"paused"===r?te.stop():u.getRecordConfig().then(function(e){te.start(e)});else if("toggle-pause"==t)"paused"===r?te.resume():"recording"===r&&te.pause();else if("focus-tab"==t){var n=e.getRecordingConfig();if("inactive"===r||"tab"!==n.captureSource)return;o.getActiveTab().then(function(e){n.tabId!=e.id&&j({tabId:e.id,windowId:e.windowId,tabTitle:e.title})})}}}function V(t){var r=e.getRecordingConfig();"recording"===e.getState()&&s.values.notifyTabFocus&&"tab"==r.captureSource&&t.windowId==r.windowId&&(t.tabId!==r.tabId?(n.debug("bgRecord: recording tab lost focus"),d.getAll().then(function(e){for(var t=0;t<e.length;++t)if("focus-tab"==e[t].name)return e[t];return null}).then(function(e){var t="Screencastify is recording a tab in the background. Use the extension icon to switch the record focus to your current tab.";e&&e.shortcut&&(t+=" You can also use the keyboard shortcut "+e.shortcut+"."),m.simple.create({priority:2,title:"Recording a background tab",message:t},"activeTab")})):(n.debug("bgRecord: recording tab got focus"),m.clear("activeTab")))}function G(){var t=!1;z.$watchCollection(e.getStateObj,function(){P()}),z.$watch(function(){return Y},function(e,t){e!==t&&P()}),z.$watch(e.getState,function(){A()}),z.$watch(function(){return Math.floor(e.getStateObj().droppedAudioTime)},function(e){if(s.values.notifyAudio&&e){var r={type:"basic",priority:2,title:"Dropping Audio Frames",message:"Screencastify dropped "+e+" seconds audio. Audio will be choppy. Try to restart recording with a lower resolution or frame rate.",iconUrl:"images/icon128.png"};t?m.update("audioDropped",r):m.create("audioDropped",r),t=!0}}),z.$watch(function(){return s.localValues.micGain},function(t,r){t!==r&&e.setMicGain(t)}),z.$on("chromeVideoRecorder:streamEnded",D),z.$on("chromeVideoRecorder:crash",C),z.$on("chromeVideoRecorder:error",$),z.$on("chromeVideoRecorder:systemAudioUnsupported",L)}function q(){(Y||"inactive"!==e.getState())&&(n.info("bgRecord: onSuspend() while recorder is active, preventing unloading"),a.getBackgroundPage())}function B(){W&&p.remove(W),P()}function N(){if(!W){n.debug("bgRecord: opening preview window");var e=Math.ceil(i.screen.width/4),t=Math.ceil(i.screen.height/4);p.create({url:"livepreview.html",type:"panel",width:e,height:t,top:i.screen.height-t,left:i.screen.width-e}).then(function(e){W=e.id,P(),p.onRemoved.addListener(function t(r){e.id==r&&(p.onRemoved.removeListener(t),n.debug("bgRecord: closed preview window"),W=null,P())})})}}var H,W,z,J,K=[],Y=!1,Q=r.when(),X="/_recording",Z="bgRecord:pendingConfig",ee=k.wrap($traceurRuntime.initGeneratorFunction(function ne(){var r,a,o,i;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:n.debug("bgRecord: stopped"),r=e.getRecordingConfig(),a=r.filename,h.local.remove(Z),o=a.split("/").slice(-1)[0],i=f.localFilenameToId(o),c.state=6;break;case 6:return c.state=2,w.moveFileByPath(a,o);case 2:c.maybeThrow(),c.state=4;break;case 4:t.$broadcast("recorder:stopped",i,r),c.state=-2;break;default:return c.end()}},ne,this)})),te={};te.stop=function(){if(Y||"inactive"===e.getState())return r.reject();o.onActivated.removeListener(V),B(),n.debug("bgRecord: stopping...");var t=e.stop();return R(t)["finally"](ee),M(),H.send(),c.trackEvent("recorder","control","stop"),t},te.pause=function(){if(Y||"recording"!==e.getState())return r.reject();n.debug("bgRecord: pausing...");var t=e.pause();return R(t),t["finally"](function(){n.debug("bgRecord: paused")}),m.clear("activeTab"),c.trackEvent("recorder","control","pause"),t},te.resume=function(){Y||"paused"!==e.getState()||(n.debug("bgRecord: resuming..."),R(e.resume())["finally"](function(){n.debug("bgRecord: resumed")}),o.getActiveTab().then(function(e){V({tabId:e.id,windowId:e.windowId})}),c.trackEvent("recorder","control","resume"))},te.start=function(t){function a(){return t.autoShareApp?v.getAppInfo(t.autoShareApp.id).then(function(e){t.autoShareApp=e}):r.when()}function i(){var e=[];return e.push(T()),e.push(l(X+"/",".webm").then(function(e){t.filename=e})),e.push(_(t)),t.autoShareApp&&t.autoShareApp.isPaid||e.push(y.getFilename().then(function(e){e&&(t.brandingFilename=e)})),r.all(e)}if(Y||"inactive"!==e.getState())return r.reject();o.onActivated.addListener(V),c.trackEvent("recorder","control","start"),c.trackEvent("recorder","captureSource",t.captureSource),H=c.trackTimer("recorder","duration"),t.audio.micGain=s.localValues.micGain,t.audio.micAudioProcessing=s.localValues.micAudioProcessing,s.values.encoder&&(t.codec=s.values.encoder),t.audioCodec=s.values.audioCodec,n.debug("bgRecord: starting...",t),J={cancelled:!1,cancel:function(){J.cancelled=!0,e.cancelPendingStart()}};var u=a().then(i).then(function(){return J.cancelled?r.reject("cancelled"):e.start(t)});return R(u),u["finally"](function(){J=null}),u.then(function(){n.debug("bgRecord: started recording"),h.local.setSingle(Z,t),t.showPreview&&N()},function(e){return"cancelled"!==e?(P({startError:e}),c.trackEvent("recorder","startError",e),x(e,t),r.reject(e)):void 0}),u};var re=k.wrap($traceurRuntime.initGeneratorFunction(function ae(){var e,r,a,o,i,c,s,u,l,d,p,g,m,b,y;return $traceurRuntime.createGeneratorInstance(function(v){for(;;)switch(v.state){case 0:return v.state=2,w.listByPath(X)["catch"](function(){return null});case 2:e=v.sent,v.state=4;break;case 4:v.state=e?6:5;break;case 5:v.state=-2;break;case 6:return v.state=9,h.local.getSingle(Z);case 9:r=v.sent,v.state=11;break;case 11:a=!0,o=!1,i=void 0,v.state=50;break;case 50:v.pushTry(36,37),v.state=39;break;case 39:c=void 0,s=e[Symbol.iterator](),v.state=35;break;case 35:v.state=(a=(c=s.next()).done)?33:31;break;case 30:a=!0,v.state=35;break;case 31:u=c.value,v.state=32;break;case 32:l=u.fullPath,d=l.split("/").slice(-1)[0],p=f.localFilenameToId(d),n.debug("bgRecord: adding fix job for incomplete recording",l),g=S.addJob({type:"fixWebm",inPath:l,fileId:p,outPath:d}),v.state=28;break;case 28:v.pushTry(18,null),v.state=21;break;case 21:return v.state=13,g.promise;case 13:v.maybeThrow(),v.state=15;break;case 15:n.debug("bgRecord: fixed incomplete recording",l),v.state=17;break;case 17:v.popTry(),v.state=23;break;case 18:v.popTry(),v.maybeUncatchable(),b=v.storedException,v.state=24;break;case 24:n.warn("bgRecord: failed to fix incomplete recording",l,b),w.moveFileByPath(l,d),v.state=23;break;case 23:m={},r&&r.filename!==l&&(m=r),t.$broadcast("recorder:fixedFile",p,m),v.state=30;break;case 33:v.popTry(),v.state=37,v.finallyFallThrough=-2;break;case 36:v.popTry(),v.maybeUncatchable(),y=v.storedException,v.state=42;break;case 42:o=!0,i=y,v.state=37,v.finallyFallThrough=-2;break;case 37:v.popTry(),v.state=48;break;case 48:try{a||null==s["return"]||s["return"]()}finally{if(o)throw i}v.state=46;break;case 46:v.state=v.finallyFallThrough;break;default:return v.end()}},ae,this)}));return te.install=function(){z=t.$new(!0),G(),re(),a.onConnect.addListener(U),a.onSuspend.addListener(q),chrome.commands.onCommand.addListener(O)},te.uninstall=function(){z.$destroy(),a.onConnect.removeListener(U),chrome.commands.onCommand.removeListener(O)},te.getRecorderState=function(){return e.getStateObj()},te.cancelPendingStart=function(){return J?(J.cancel(),!0):!1},te.getConfig=function(){return e.getRecordingConfig()},te.isBlocked=function(){return Y},te.waitWhileBlocked=function(){return Q},te}]),angular.module("castifyExt.upload.uploadBase",["castifyExt.bgFiles","w69b.filesHelper"]).factory("UploadBase",["$q","$log","bgFiles","filesHelper",function(e,t,r,n){function a(e){return n.getFileByPath(r.idToLocalFilename(e))}function o(e){this.config=e,this.minStartTime=0,this.numErrors=0}o.targetClasses_={},o.register_=function(e,t){o.targetClasses_[e]=t},o.create=function(e){var t=o.targetClasses_[e.target];if(!t)throw new Error("unknown target "+e.target);return new t(e)},o.CancelledError={reason:"cancelled",isCancelled:!0},o.cancelReject=e.reject(o.CancelledError);var i=o.prototype;return o.unserialize=function(e){var t=e[0],r=e[1],n=o.targetClasses_[t];if(!n)throw new Error("unknown target "+t);return n.fromObject(r)},i.serialize=function(){return[this.config.target,this.toObject()]},i.fromObject=function(e){throw new Error},i.toObject=function(){throw new Error},i.start=function(){},i.cancel=function(){return!1},i.onProgress=function(){},i.onComplete=function(){},i.onError=function(e){},i.handleComplete_=function(e){t.debug("upload complete",e),this.responseData=e},i.handleError_=function(t){return e.reject(t)},i.handleProgress_=function(e){return e},i.loadFile_=function(){var t=this.config,n=a(t.fileId);return e.all({file:n,fileDesc:r.getFileDescriptor(t.fileId)})["catch"](function(r){return t.isSyncUpload?o.cancelReject:e.reject(r)})},i.toString=function(){var e=this.config;return"Upload of file "+e.fileId+" to "+e.target},o}]),angular.module("castifyExt.upload.googleUpload",["castifyExt.upload.uploadBase","castifyExt.driveUtils","w69b.googledrive","w69b.googleUploader","castifyExt.bgFiles","castifyExt.youtubeAuth"]).run(["UploadBase","driveUtils","googledrive","googleUploader","bgFiles","$q","$log","$http","$timeout","youtubeAuth","castifyConfig",function(e,t,r,n,a,o,i,c,s,u,l){function d(e){if(angular.isObject(e)&&angular.isNumber(e.status)){var t=e.status;if(0>=t||t>=500&&600>t||e.config&&e.config.authAutoRetry===!1&&401===t)return!0;var r=h.getErrorReason(e);if(["userRateLimitExceeded"].includes(r))return!0}return!1}function f(e){return{id:e.id,channelId:e.snippet.channelId}}function h(t,r){e.call(this,t),this.uploadUrl=r,this.cancelled=!1}function p(){h.apply(this,arguments)}function g(e){h.apply(this,arguments)}function m(t,r){e.call(this,t),this.pollTimer_=null,this.jobId=r}function b(t,r){if(!t.channelId)throw Error("channelId required");e.call(this,t),r&&this.setupDelegate_(r)}var y=l.API_URL+"/upload";h.prototype=Object.create(e.prototype),h.prototype.constructor=e;var v=h.prototype;v.handleProgress_=function(e){e.uploadUrl?this.uploadUrl=e.uploadUrl:(this.loadedBytes_=e.loaded,this.progress=e.loaded/e.total)},v.handleError_=function(t){return t===e.CancelledError||this.cancelled?o.reject(e.CancelledError):(i.debug("googleUploader: handling error",t),o.reject({isTransient:d(t),reason:h.getErrorReason(t)}))},v.resumeUpload_=function(e){return this.uploader_=n.resumeUpload(e,this.uploadUrl),this.uploader_.promise},v.start=function(){this.cancelled=!1;var t=this;this.loadFile_().then(function(r){return t.totalBytes_=r.file.size,t.cancelled?e.cancelReject:t.uploadUrl?t.resumeUpload_(r.file,r.fileDesc):t.startUpload_(r.file,r.fileDesc)}).then(this.handleComplete_.bind(this),this.handleError_.bind(this),this.handleProgress_.bind(this)).then(function(e){t.onComplete(e)},function(e){t.onError(e)},function(e){t.onProgress(e)})},h.getErrorReason=function(e){if(angular.isString(e))return e;if(e&&e.data){var t,r=e.data;if(r.error&&r.error.errors&&r.error.errors.length&&(t=r.error.errors[0]),t)return t.reason}else if(e&&e.message)return e.message;return"unknown"},v.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},v.cancel=function(){return this.cancelled?!0:this.loadedBytes_&&this.totalBytes_-this.loadedBytes_<512e3?(i.debug("googleUploader: refusing to cancel almost complete upload"),!1):(this.cancelled=!0,this.uploader_&&this.uploader_.cancel(),!0)},p.prototype=Object.create(h.prototype),p.prototype.constructor=h,e.register_("drive",p),v=p.prototype,v.handleComplete_=function(e){return h.prototype.handleComplete_.call(this,e),a.updateLocalInfo(this.config.fileId,{driveInfo:e}),this.openLink=e.alternateLink,this.setDrivePrivacy_(e.id,this.config.privacy,this.config.domain)},p.doesFileExistInParent=function(e,t){return r.getFile(e).then(function(e){return e.parents&&e.parents.some(function(e){return e.id===t})&&(!e.labels||!e.labels.trashed)},function(e){return 404==e.status?!1:o.reject(e)})},v.startUpload_=function(a,o){function i(){if(u.cancelled)return e.cancelReject;var t={title:l,description:s.description||"",mimeType:"video/webm",properties:p.toDrivePropertyList_(f),parents:[{id:d}]};return u.uploader_=n.driveUpload(a,t),u.uploader_.promise}function c(t){return u.cancelled?e.cancelReject:r.patchFile(t,{properties:p.toDrivePropertyList_(f)})}var s=this.config,u=this,l=s.title;/\.webm$/i.test(l)||(l+=".webm");var d,f={duration:o.duration,width:o.width,height:o.height,uuid:o.id,recordingDate:o.createdAt.getTime(),isScreencastifySyncFile:!0};return t.getDriveUploadParentId().then(function(t){if(u.cancelled)return e.cancelReject;if(d=t,o.driveInfo&&o.driveInfo.id){var r=o.driveInfo.id;return p.doesFileExistInParent(r,d).then(function(e){return e?c(r):i()})}return i()})},v.setDrivePrivacy_=function(r,n,a){return"private"===n?o.when(null):this.cancelled?e.cancelReject:t.setSimplePrivacy(r,n,a)},p.toDrivePropertyList_=function(e){var t=[];return angular.forEach(e,function(e,r){t.push({key:r,value:e,visibility:"PRIVATE"})}),t},v.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},p.fromObject=function(e){return new p(e.config,e.uploadUrl)},g.prototype=Object.create(h.prototype),g.prototype.constructor=h,e.register_("_youtube_local",g),v=g.prototype,v.handleComplete_=function(e){return h.prototype.handleComplete_.call(this,e),a.updateYoutubeInfo(this.config.fileId,f(e)),this.openLink="http://youtu.be/"+e.id,e},v.startUpload_=function(e){var t=this.config,r={title:t.title,privacy:t.privacy,description:t.description||""};return this.uploader_=n.youtubeUpload(e,r,{youtubeAuth:t.channelId}),this.uploader_.promise},v.resumeUpload_=function(e){return this.uploader_=n.resumeUpload(e,this.uploadUrl,{youtubeAuth:this.config.channelId}),this.uploader_.promise},v.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},g.fromObject=function(e){return new g(e.config,e.uploadUrl)},m.prototype=Object.create(e.prototype),m.prototype.constructor=e,e.register_("_youtube_remote",m),v=m.prototype,v.start=function(){var e=this,t=this.config;this.jobId?this.pollAndHandle_():a.getFileDescriptor(t.fileId).then(function(e){return c.post(y,{driveId:e.driveInfo.id,privacy:t.privacy,channelId:t.channelId},{googleAuth:!0})}).then(function(t){var r=t.data;i.debug("RemoteYoutubeUpload: job created",r),e.jobId=r.id,e.startPollTimer_()},this.handleError_.bind(this))},v.handleComplete_=function(t){e.prototype.handleComplete_.call(this,t),a.updateYoutubeInfo(this.config.fileId,f(t)),this.openLink="http://youtu.be/"+t.id,this.onComplete()},v.pollJob_=function(){return c.get(y+"/"+this.jobId,{googleAuth:!0}).then(function(e){return e.data})},v.handleError_=function(e){this.onError({isTransient:d(e),reason:h.getErrorReason(e)})},v.pollAndHandle_=function(){var e=this;this.pollJob_().then(function(t){i.debug("remote upload job is ",t);var r=t.state;if("completed"===r)e.handleComplete_(t.result);else if("failed"===r){var n=null;if(t.result&&t.result.error)try{n=JSON.parse(t.result.error)}catch(a){}n?e.handleError_({data:n}):e.handleError_("remote job failed")}else e.progress=t.progress,e.onProgress(),e.startPollTimer_()},this.handleError_.bind(this))},v.startPollTimer_=function(){var e=this;this.pollTimer_&&s.cancel(this.pollTimer_),s(function(){e.pollTimer_=null,e.pollAndHandle_()},3e3)},v.toObject=function(){return{config:this.config,jobId:this.jobId}},m.fromObject=function(e){return new m(e.config,e.jobId)},b.prototype=Object.create(e.prototype),b.prototype.constructor=e,e.register_("youtube",b),v=b.prototype,v.toObject=function(){var e=null;return this.delegate_&&(e=this.delegate_.serialize()),{config:this.config,serializedDelegate:e}},b.fromObject=function(t){var r=null;return t.serializedDelegate&&(r=e.unserialize(t.serializedDelegate)),new b(t.config,r)},v.handleError_=function(e){i.warn("YoutubeUploadProxy error",e),this.onError({isTransient:!1,reason:"unknown"})},v.start=function(){var t=this;a.getFileDescriptor(this.config.fileId).then(function(r){var n;if(n=r.driveInfo&&r.driveInfo.id?"_youtube_remote":"_youtube_local",!t.delegate_||t.delegate_.config.target!==n){var a=angular.copy(t.config);a.target=n,t.setupDelegate_(e.create(a))}t.delegate_.start()},this.handleError_.bind(this))},["progress"].forEach(function(e){Object.defineProperty(v,e,{get:function(){var t=this.delegate_;return t?t[e]:null}})}),v.setupDelegate_=function(e){var t=this;if(t.delegate_){var r=t.delegate_;delete r.onError,delete r.onProgress,delete r.onError}t.delegate_=e,e.onError=function(e){t.onError(e)},e.onProgress=function(){t.onProgress()},e.onComplete=function(){t.onComplete()}},v.cancel=function(){return this.delegate_?this.delegate_.cancel():!1}}]),angular.module("castifyExt.bgUpload",["w69b.chromeStorage","w69b.chromeRuntime","w69b.chromeAnalytics","castifyExt.upload.uploadBase","castifyExt.upload.googleUpload","w69b.throttle","castifyExt.offline","castifyExt.syncAuthTool"]).factory("bgUploadService",["chromeStorage","chromeRuntime","$log","analytics","$rootScope","UploadBase","throttle","onlineState","syncAuthTool","$timeout",function(e,t,r,n,a,o,i,c,s,u){function l(e){if("uploader"==e.name){H.push(e),K(),e.onDisconnect.addListener(function(){var t=H.indexOf(e);t>=0&&H.splice(t,1)});var t={upload:z.upload,cancel:z.cancel};e.onMessage.addListener(function(e){t.hasOwnProperty(e.type)&&t[e.type](e.data)})}}function d(){B.length&&(r.info("onSuspend() while upload queue is not empty, preventing unloading"),t.getBackgroundPage()),J.flush()}function f(){function e(e,r){var n=e.fileId,a=e.target;r.fileId=n,r.target=a,r.isSyncUpload=e.isSyncUpload,t[n]=t[n]||{},t[n][a]=r}if(H.length){var t={};N.forEach(function(t){e(t.config,{state:"error",error:t.error,config:t.config})}),B.forEach(function(t){e(t.config,{state:"queued",config:t.config})}),q.forEach(function(t){var r={state:"uploading",progress:t.progress};e(t.config,r)}),h("stateUpdate",t)}}function h(e,t){H.forEach(function(r){r.postMessage({type:e,data:t})})}function p(){var t=q.concat(B).map(function(e){return e.serialize()});e.local.setSingle(D,{queued:t,recentErrors:N})}function g(){J(),K(),W++}function m(){return e.local.getSingle(D).then(function(e){e&&(N=e.recentErrors||[],B=(e.queued||[]).map(function(e){return o.unserialize(e)}))})}function b(e){delete e.onProgress,delete e.onComplete,delete e.onError;var t=q.indexOf(e);q.splice(t,1),I(),g()}function y(e){var t=B.indexOf(e);B.splice(t,1)}function v(e,t){N=N.filter(function(r){return r.config.target!==t||r.config.fileId!==e})}function w(e,t){for(v(e.fileId,e.target),N.push({config:e,error:t});N.length>L;)N.shift()}function k(e){b(e),a.$broadcast("uploader:complete",{config:e.config,data:e.responseData,link:e.openLink}),n.trackEvent("uploader","complete")}function S(e){r.debug("transient upload error, re-queuing",e.toString()),e.numErrors++;var t=Math.min(V,Math.pow(2,e.numErrors-1)*O);e.minStartTime=Date.now()+t+Math.random()*G,A(e)}function E(e,t){if(r.warn("upload error",t),b(e),t===o.CancelledError)r.debug("upload was cancelled",e.toString());else if(t.isTransient)S(e),c.check();else{s.broadcastIfSyncError(t);var i=e.config;a.$broadcast("uploader:failed",{config:i,error:t}),w(i,t),t.reason&&n.trackEvent("uploader","failed",t.reason)}g()}function T(e){g()}function R(e){e.onComplete=k.bind(null,e),e.onError=E.bind(null,e),e.onProgress=T.bind(null,e)}function $(e){return B.filter(function(t){return t.config.fileId===e.fileId&&t.config.target===e.target})[0]}function x(e){return q.filter(function(t){return t.config.fileId===e.fileId&&t.config.target===e.target})[0]}function C(e){return $(e)||x(e)}function I(){function e(){var e=q.length<U&&B.length;if(!e)return!1;var t=B[0],r=t.minStartTime<=Date.now();if(!r)return!1;var n=q.length<M;return!t.config.isSyncUpload||n}if(_&&(u.cancel(_),_=null),c.isOnline()&&B.length)if(B[0].minStartTime<=Date.now()){for(;e();){var t=B.shift();r.debug("starting queued upload",t.toString()),R(t),q.push(t),t.start()}g()}else{var n=B[0],a=n.minStartTime-Date.now();r.debug("scheduling upload queue start in "+a),_=u(I,a)}else;}function A(e){r.debug("queuing upload",e.toString()),B.push(e),B.sort(function(e,t){var r=e.minStartTime-t.minStartTime;if(0===r){if(e.config.isSyncUpload&&!t.config.isSyncUpload)return 1;if(t.config.isSyncUpload&&!e.config.isSyncUpload)return-1}return r}),g(),I()}function P(e,t){if(r.debug("online state changed to ",t),t)I();else{for(var n=q.concat([]);n.length;){var a=n.pop();a.cancel()&&(b(a),A(o.unserialize(a.serialize())))}g()}}var F,_,D="uploadsPending",L=5,j=3,U=5,M=U-j,O=2e3,V=12e4,G=1e3,q=[],B=[],N=[],H=[],W=0,z={},J=i(p,2e3,!1),K=i(f,300,!1);return z.cancelSyncUploads=function(){var e=B.filter(function(e){return e.config.isSyncUpload}),t=e.length;e.forEach(function(e){r.debug("bgUpload: cancelling queued sync upload",e.toString()),y(e)}),q.forEach(function(e){e.config.isSyncUpload&&(r.debug("bgUpload: cancelling active sync upload",e.toString()),e.cancel(),++t)}),t&&(r.debug("bgUpload: cancelled %s sync uploads",t),g())},z.upload=function(e){var t=e.fileId;return C(e)?void r.info("upload already pending "+t):(v(e.fileId,e.target),n.trackEvent("uploader","start",e.target),void A(o.create(e)))},z.cancel=function(e){if(!e.fileId||!e.target)throw new Error;var t=$(e);t?y(t):(t=x(e),t&&t.cancel()),t?(r.debug("cancelled upload",t.toString()),g()):r.debug("no queued or active upload found to cancel",e)},z.getTargetFileState=function(e,t){function r(r){return r.config.fileId===e&&r.config.target===t}var n=q.find(r);if(n)return{state:"uploading",config:n.config,progress:n.progress};var a=B.find(r);return a?{state:"queued",config:a.config}:null},z.isOnline=function(){return c.isOnline()},z.getWatcherStateId=function(){return W},z.install=function(){return F=a.$new(!0),m().then(function(){I(),t.onConnect.addListener(l),t.onSuspend.addListener(d),F.$on("onlineState:changed",P)})},z.uninstall=function(){t.onConnect.removeListener(l),t.onSuspend.removeListener(d),F.$destroy()},z.STORAGE_KEY=D,z}]),angular.module("castifyExt.localFileDb",["w69b.chromeStorage","w69b.filesHelper","w69b.chromeRuntime","castifyExt.chromeEventPublisher"]).factory("localFileDb",["$rootScope","chromeStorage","$q","filesHelper",function(e,t,r,n){function a(e){return l+e}function o(e){var t=a(e),r=u.getSingle(t).then(function(e){return e=i(e)});return r}function i(e){return e||(e={}),e.title||(e.title="Untitled Screencast"),e}function c(e){angular.extend(this,e)}var s={},u=t.local,l="filedb_",d=c.prototype;return c.createFromIdOrFileEntry=function(e){var t,a,i=angular.isString(e)?n.getFileEntryByPath(s.idToFilename(e)):r.when(e);return i.then(function(e){return t=e,a=s.filenameToId(e.name),r.all({metadata:n.getMetadata(t),info:o(a)}).then(function(e){var r=t.toURL(),n={id:a,uuid:a,url:r,createdAt:e.metadata.modificationTime,title:e.info.title,size:e.metadata.size};if(e.info.videoInfo){var o=e.info.videoInfo;angular.extend(n,{duration:o.duration,width:o.size.width,height:o.size.height})}if(e.info.previewImages&&(n.thumbnailUrl=e.info.previewImages[0].url),e.info.driveInfo&&(n.driveInfo=e.info.driveInfo),e.info.youtubeInfo){var i=e.info.youtubeInfo;n.youtubeInfo={id:i.id,channelId:i.channelId}}return e.info.autoShare&&(n.autoShare=e.info.autoShare),new c(n)})})},d.rename=function(e){return s.updateInfo(this.id,{title:e})},d.remove=function(){var e=this.id;return r.all({result:n.removeByPath(s.idToFilename(e)),info:o(e)}).then(function(e){return e.info.previewImages?r.all(e.info.previewImages.map(function(e){return n.removeByPath(e.path)})):void 0}).then(function(){return u.remove(a(e))})},d.updateYoutubeInfo=function(e){return s.updateInfo(this.id,{youtubeInfo:e})},s.listFiles=function(){return n.listByPath("/").then(function(e){var t=[];return e.forEach(function(e){e.isFile&&"."!==e.name[0]&&t.push(c.createFromIdOrFileEntry(e))}),r.all(t).then(function(e){var t={};return e.forEach(function(e){t[e.id]=e}),t})})},s.filenameToId=function(e){if(/\.webm/i.test(e))return e.slice(0,-5);throw new Error("invalid filename: "+e)},s.idToFilename=function(e){return e+".webm"},s.getFileDescriptor=function(e){return c.createFromIdOrFileEntry(e)},s.updateInfo=function(e,t,n){var o,i=a(e);return o=n?r.when(t):u.get(i).then(function(e){return angular.extend(e[i]||{},t)}),o.then(function(e){var t={};return t[i]=e,u.set(t),e})},s}]),angular.module("castifyExt.recordTool",["castifyExt.connect.connectedApps","castifyExt.connect.appRegistry","castifyExt.hdpiTool","w69b.webrtc","w69b.chromeStorage","w69b.spawn","w69b.chromeSystem"]).factory("recordTool",["chromeStorage","$window","webrtc","connectedApps","appRegistry","hdpiTool","spawn","chromeSystem",function(e,t,r,n,a,o,i,c){function s(){return t.navigator.userAgent}function u(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])}function l(){return s().indexOf("CrOS")>=0}function d(){return s().indexOf("CrOS arm")>=0}function f(){return s().indexOf("CrOS x86_64")>=0}function h(){return d()?5:(f(),30)}function p(e){return r.getSources().then(function(t){function r(e,r){return t.some(function(t){return t.kind===e&&t.label&&(!r||r===t.id)})}return e.audio.mic&&(r("audio")?e.audio.micSourceId&&!r("audio",e.audio.micSourceId)&&delete e.audio.micSourceId:e.audio.mic=!1),r("video")?e.camSourceId&&!r("video",e.camSourceId)&&delete e.camSourceId:("cam"===e.captureSource&&(e.captureSource="tab"),e.embedWebcam&&(e.embedWebcam=!1)),e})}function g(e){return e.autoShareApp?n.isConnected(e.autoShareApp.id).then(function(t){return t||delete e.autoShareApp,e}):e}var m={},b="recordConfig",y=null;m.toResolution=function(e){return{width:e.width,height:e.height}},m.scaleResolution=function(e,t){var r=Math.min(t.height/e.height,t.width/e.width,1);return{width:Math.floor(e.width*r),height:Math.floor(e.height*r)}},m.getResolutionLimit=function(e,t){return e.limitResolution?"tab"===e.captureSource?m.scaleResolution(o.toPhysicalResolution(t),e.maxResolution):e.maxResolution:null};var v=i.wrap($traceurRuntime.initGeneratorFunction(function S(){var e,t,r,n,a;return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:o.state=y?8:5;break;case 5:e=c.cpu,t=e.getInfo,r=t.call(e),o.state=6;break;case 6:return o.state=2,r;case 2:n=o.sent,o.state=4;break;case 4:a=n.numOfProcessors,y=a,o.state=8;break;case 8:o.returnValue=y,o.state=-2;break;default:return o.end()}},S,this)})),w=i.wrap($traceurRuntime.initGeneratorFunction(function E(){var e;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:return t.state=2,v();case 2:e=t.sent,t.state=4;break;case 4:t.state=e>=4?5:7;break;case 5:t.returnValue={width:1920,height:1080},t.state=-2;break;case 7:t.returnValue={width:1280,height:720},t.state=-2;break;default:return t.end()}},E,this)})),k=i.wrap($traceurRuntime.initGeneratorFunction(function T(){var e,t,r,n;return $traceurRuntime.createGeneratorInstance(function(a){for(;;)switch(a.state){case 0:e=d(),a.state=13;break;case 13:a.state=e?9:5;break;case 9:n=e,a.state=10;break;case 5:t=v(),a.state=6;break;case 6:return a.state=2,t;case 2:r=a.sent,a.state=4;break;case 4:n=4>=r,a.state=10;break;case 10:a.returnValue=n,a.state=-2;break;default:return a.end()}},T,this)}));return m.canCaptureSystemAudio=function(){return s().indexOf("Windows")>=0||l()&&u()>=46},m.getRecentlyConnectedApp=function(){return n.getRecent().then(function(e){return e?a.getAppInfo(e):null})},m.clearRecentlyConnectedApp=function(){return n.clearRecent()},m.setRecordConfig=function(t){return e.local.setSingle(b,t)},m.getRecordConfig=i.wrap($traceurRuntime.initGeneratorFunction(function R(){var t,r,n,a,o,i,c,s,u,l,d,f,y,v,S,E,T;return $traceurRuntime.createGeneratorInstance(function(R){for(;;)switch(R.state){case 0:return R.state=2,e.local.getSingle(b,{});case 2:t=R.sent,R.state=4;break;case 4:r=angular.isDefined,n=t.limitResolution,a=r.call(angular,n),R.state=17;break;case 17:R.state=a?13:9;break;case 13:o=t.limitResolution,s=o,R.state=14;break;case 9:i=k(),R.state=10;break;case 10:return R.state=6,i;case 6:c=R.sent,R.state=8;break;case 8:s=c,R.state=14;break;case 14:t.limitResolution=s,R.state=19;break;case 19:u=t.maxResolution,R.state=32;break;case 32:R.state=u?28:24;break;case 28:l=t.maxResolution,y=l,R.state=29;break;case 24:d=w(),R.state=25;break;case 25:return R.state=21,d;case 21:f=R.sent,R.state=23;break;case 23:y=f,R.state=29;break;case 29:t.maxResolution=y,R.state=34;break;case 34:t.audio=angular.isObject(t.audio)?t.audio:{mic:!0,system:!0},t.draw=t.draw||{showToolbox:!0,tool:"pointer"},t.embedWebcam=t.embedWebcam||!1,t.camPosition=t.camPosition||"bottomRight",t.captureSource=t.captureSource||"desktop",t.targetFPS=t.targetFPS||h(),"desktop"!==t.captureSource||m.canCaptureSystemAudio()||(t.audio.system=!1),R.state=54;break;case 54:v=p(t),R.state=40;break;case 40:return R.state=36,v;case 36:S=R.sent,R.state=38;break;case 38:t=S,R.state=42;break;case 42:E=g(t),R.state=48;break;case 48:return R.state=44,E;case 44:T=R.sent,R.state=46;break;case 46:t=T,R.state=50;break;case 50:R.returnValue=t,R.state=-2;break;default:return R.end()}},R,this)})),m}]),angular.module("castifyExt.resizeTab",["w69b.chromeTabs","w69b.chromeWindows"]).factory("resizeTab",["chromeTabs","chromeWindows","$q",function(e,t,r){function n(n,a,o,i){function c(){return e.get(n).then(function(e){return l=e})}function s(){return t.get(l.windowId).then(function(e){
if("normal"!==e.state&&i===!1)return r.reject();var n=e.width-l.width,c=e.height-l.height,s=a+n+d,u=o+c+f;return t.update(l.windowId,{width:s,height:u,state:"normal"})})}function u(e){return e.width!=a||e.height!=o?(d+=a-e.width,f+=o-e.height,s().then(c)):e}var l,d=0,f=0;return c().then(s).then(c).then(u).then(u)["catch"](function(){return l})}return n}]),angular.module("castifyExt.castifyDrawService",[]).factory("castifyDrawService",function(){return function(e){return window.BgCastifyDrawService(e,"components/castifyDraw/release/","components/castifyDraw/release/global-ext.css")}}),angular.module("castifyExt.recordingHooks",["w69b.chromeTabs","castifyExt.videoPreviewRenderer","castifyExt.appOptions","w69b.clipboard","castifyExt.ui.openInAppTab","w69b.chromeRuntime","castifyExt.bgFiles","w69b.spawn","castifyExt.connect.bgConnectService"]).factory("recordingHooks",["$rootScope","videoPreviewRenderer","chromeTabs","appOptions","bgFiles","clipboard","openInAppTab","chromeRuntime","$q","$log","$timeout","filesHelper","spawn","bgConnectService",function(e,t,r,n,a,o,i,c,s,u,l,d,f,h){function p(e){l(function(){i("app.html#/files/"+encodeURIComponent(e))},500)}function g(e){if(0===e.lastIndexOf(E,0)){var t=e.substr(E.length);r.create({url:t}),chrome.notifications.clear(e)}}function m(e,t){if(!t.config.isSyncUpload){var r=t.config,n=t.link;if(/https?:\/\//.test(n)){var a='Your screencast "'+r.title+'" has been uploaded. Click here to open it.';r.copyLinkToClipboard&&(o.copy(n),a+=" The link was copied to your clipboard.");var i={type:"basic",priority:0,title:"Upload complete",message:a,iconUrl:"images/icon128.png"};r.showNotification&&chrome.notifications.create(E+n,i,angular.noop)}}}function b(e){return d.getFileEntryByPath(e).then(function(e){return d.getMetadata(e)}).then(function(e){return e.size})}function y(e){return t.renderPreview(e)["catch"](function(t){u.warn("rendering preview image failed",e);var r=a.idToLocalFilename(e);return b(r).then(function(e){return T>e?(u.warn("file is empty, removing it"),d.removeByPath(r),s.reject(t)):null})})}function v(e,t){return f($traceurRuntime.initGeneratorFunction(function r(){var n,o,i;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:n=t.autoShareApp.id,o=t.connectMeta&&t.connectMeta.shareUrl,i=t.connectMeta&&t.connectMeta.payload,r.state=14;break;case 14:return r.state=2,a.updateLocalInfo(e,{autoShare:{appId:n,shareUrl:o,payload:i,timestamp:Date.now()}});case 2:r.maybeThrow(),r.state=4;break;case 4:return r.state=6,a.registerLocalFile(e);case 6:r.maybeThrow(),r.state=8;break;case 8:return r.state=10,h.share(n,e,o);case 10:r.maybeThrow(),r.state=-2;break;default:return r.end()}},r,this)}))}function w(e,t,r){f($traceurRuntime.initGeneratorFunction(function o(){return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:return o.state=2,y(t);case 2:o.maybeThrow(),o.state=4;break;case 4:o.state=r.autoShareApp?5:9;break;case 5:return o.state=6,v(t,r);case 6:o.maybeThrow(),o.state=8;break;case 9:return o.state=10,a.registerLocalFile(t);case 10:o.maybeThrow(),o.state=12;break;case 12:n.values.autoOpen&&"recorder:fixedFile"!==e.name&&p(t),o.state=8;break;case 8:u.debug("recording hooks completed for",t),o.state=-2;break;default:return o.end()}},o,this)}))}var k=[],S={},E="upload:",T=1e4;return S.install=function(){k=[e.$on("recorder:stopped",w),e.$on("recorder:fixedFile",w),e.$on("uploader:complete",m)],chrome.notifications.onClicked.addListener(g)},S.uninstall=function(){k.forEach(function(e){e()}),k=[],chrome.notifications.onClicked.removeListener(g)},S}]),angular.module("castifyExt.videoPreviewRenderer",["castifyExt.bgFiles","w69b.filesHelper"]).factory("videoPreviewRenderer",["bgFiles","filesHelper","$q",function(e,t,r){function n(e){return t.getFileEntryByPath(u+"/"+e,{create:!0},{create:!0})}function a(e,t){var r=Math.max(t.width/e.width,t.height/e.height);return{width:e.width*r,height:e.height*r}}function o(e){function t(){a.resolve(o)}function n(){a.reject("failed to load video")}var a=r.defer(),o=document.createElement("video");return o.src=e,o.addEventListener("canplay",t),o.addEventListener("error",n),a.promise["finally"](function(){o.removeEventListener("canplay",t),o.removeEventListener("error",n)}),a.promise}function i(e){for(var t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length)),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}function c(e){var t=e.toDataURL(),n="data:image/png;base64,";if(0!==t.lastIndexOf(n,0))throw Error();var a=t.substring(n.length);return a=new Uint8Array(i(a)),r.when(new Blob([a],{type:"image/png"}))}function s(e,t){var r=document.createElement("canvas");r.width=t.width,r.height=t.height;var n=r.getContext("2d");return n.drawImage(e,0,0,t.width,t.height),c(r)}var u="_previewImages",l={width:640,height:360},d={};return d.renderPreview=function(r){var i,c,d,f=r+".png",h={};return t.getFileEntryByPath(e.idToLocalFilename(r)).then(function(e){return o(e.toURL())}).then(function(e){var t={width:e.videoWidth,height:e.videoHeight};return h.size=t,h.duration=e.duration,d=a(t,l),s(e,d)}).then(function(e){return i=e,n(f)}).then(function(e){return c=e,t.createWriter(c)}).then(function(e){return t.writeFile(e,i)}).then(function(){var t={path:u+"/"+f,size:d,url:c.toURL()};return e.updateLocalInfo(r,{previewImages:[t],videoInfo:h})}).then(function(){return c})},d}]),angular.module("castifyExt.updateMigrationService",["w69b.chromeRuntime","w69b.chromeVersionOrder","castifyExt.setupService"]).factory("updateMigrationService",["chromeRuntime","$log","chromeVersionOrder","chromeTabs","setupService",function(e,t,r,n,a){function o(e,o){e!==o&&(t.info("updating from "+e+" to "+o),r.isLess(e,"1.8.3")&&(chrome.storage.local.remove("castifyAuth:cache"),n.create({url:"app.html#/update-notice"})),r.isLess(e,"1.8.16")&&a.setStorageDecided(!0))}function i(){}function c(r){t.debug("installed",r),"update"===r.reason&&o(r.previousVersion,e.getManifest().version),"install"===r.reason&&i()}var s={};return s.install=function(){e.onInstalled.addListener(c)},s}]),angular.module("castifyExt.setupService",["castifyExt.appOptions","w69b.webrtc","w69b.chromeStorage","w69b.spawn"]).factory("setupService",["webrtc","spawn","chromeStorage","$q","appOptions","$log",function(e,t,r,n,a,o){function i(){return t($traceurRuntime.initGeneratorFunction(function e(){var t,n,o,i,c;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=r.sync.getSingle(u,!1),e.state=19;break;case 19:return e.state=2,a.loadedPromise;case 2:e.maybeThrow(),e.state=4;break;case 4:n=a.isSetByEnterprisePolicy,o=n.call(a,"driveSync"),e.state=15;break;case 15:e.state=o?11:5;break;case 11:c=o,e.state=12;break;case 5:return e.state=6,t;case 6:i=e.sent,e.state=8;break;case 8:c=i,e.state=12;break;case 12:e.returnValue=c,e.state=-2;break;default:return e.end()}},e,this)}))}function c(){return t($traceurRuntime.initGeneratorFunction(function r(){var t,n,a,o,i,c,s,u;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:t=e.hasVideoAccess(),n=e.hasMicrophone(),a=e.hasAudioAccess(),r.state=26;break;case 26:return r.state=2,t;case 2:o=r.sent,r.state=4;break;case 4:r.state=o?20:5;break;case 20:u=o,r.state=21;break;case 5:return r.state=6,n;case 6:i=r.sent,r.state=8;break;case 8:r.state=i?9:15;break;case 15:s=!i,r.state=16;break;case 9:return r.state=10,a;case 10:c=r.sent,r.state=12;break;case 12:s=c,r.state=16;break;case 16:u=s,r.state=21;break;case 21:r.returnValue=u,r.state=-2;break;default:return r.end()}},r,this)}))}var s={},u="setupService:storageDecided";return s.setStorageDecided=function(e){return r.sync.setSingle(u,e)},s.getSetupState=function(){return t($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,a,o;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=c(),e.state=10;break;case 10:return e.state=2,t;case 2:r=e.sent,e.state=4;break;case 4:n=i(),e.state=12;break;case 12:return e.state=6,n;case 6:a=e.sent,e.state=8;break;case 8:o={cam:r,storage:a},e.state=14;break;case 14:e.returnValue=o,e.state=-2;break;default:return e.end()}},e,this)}))},s.isComplete=function(){return t($traceurRuntime.initGeneratorFunction(function e(){var t;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:return e.state=2,s.getSetupState();case 2:t=e.sent,e.state=4;break;case 4:o.debug("setupService.isComplete state",t),e.state=8;break;case 8:e.returnValue=t.cam&&t.storage,e.state=-2;break;default:return e.end()}},e,this)}))},s}]),angular.module("castifyExt.diskSpaceWatcher",["castifyExt.bgRecord","w69b.filesHelper","w69b.ui.bytesFilter","castifyExt.appOptions","w69b.chromeNotifications","castifyExt.helpCenter"]).factory("diskSpaceWatcher",["bgRecordService","$timeout","filesHelper","$rootScope","$filter","appOptions","chromeNotifications","helpCenter",function(e,t,r,n,a,o,i,c){function s(){return g}function u(){return r.getPersistentQuota().then(function(e){return e.quota-e.usage})}function l(t){var r={priority:2,title:"Critically low disk space",message:"You have less than 1GB left. Recording was paused automatically.",buttons:[{title:"Help"}]};i.clear("diskSpaceCritical")["finally"](function(){c.setNotifyHelp(i.simple.create(r,"diskSpaceCritical"),"disk_space")}),e.pause()}function d(e){e+=1073741824;var t={priority:2,title:"Low disk space",message:"You have only "+a("bytes")(e)+" left. Recording will be paused automatically soon.",buttons:[{title:"Help"}]};c.setNotifyHelp(i.simple.create(t,"diskSpaceLow"),"disk_space")}function f(){h(),o.values.enableDiskSpaceWatcher&&u().then(function(e){e<=s()?l(e):m>=e&&d(e),e>s()&&(p=t(f,b))})}function h(){p&&(t.cancel(p),p=null)}var p,g=0,m=104857600,b=1e4,y={};return y.install=function(){n.$watch(function(){return"recording"===e.getRecorderState().state&&!e.isBlocked()},function(e,t){e!==t&&(e?f():h())}),n.$on("recorder:stopped",function(){i.clear("diskSpaceCritical"),i.clear("diskSpaceLow")})},y.setThresholds=function(e,t){g=t,m=e},y}]),angular.module("castifyExt.audioContextPool",[]).factory("audioContextPool",["$window",function(e){var t=[],r={};return r.acquire=function(){return t.length?t.pop():new e.AudioContext},r.release=function(e){t.push(e)},r}]),angular.module("castifyExt.ui.openInAppTab",["w69b.chromeTabs","w69b.chromeWindows"]).service("openInAppTab",["chromeTabs","chromeRuntime","chromeWindows","$q",function(e,t,r,n){return function(r){var n="chrome-extension://"+t.id+"/app.html";0===r.lastIndexOf("#",0)&&(r=n+r),e.create({active:!0,url:r})}}]).directive("openInAppTab",["$window","openInAppTab",function(e,t){return{restrict:"A",link:function(r,n,a){n.bind("click",function(r){var n=angular.element(r.target),o=a.href||n.attr("href");o&&(r.preventDefault(),t(o).then(function(){e.close()}))})}}}]),angular.module("castifyExt.licensing",["castifyExt.castifyAuth","w69b.chromeStorage","w69b.chromeRuntime","castifyExt.signInService","w69b.spawn","w69b.promiseTool","castifyExt.connect.connectedApps"]).factory("licensing",["castifyAuth","$http","chromeRuntime","chromeStorage","$q","$rootScope","$log","signInService","castifyConfig","promiseTool","spawn","connectedApps",function(e,t,r,n,a,o,i,c,s,u,l,d){function f(e){return c.getToken(e)}function h(){function e(){var e=window.chrome.identity,t=u.wrapChromeError(e.getAuthToken,e);return t({interactive:!1,scopes:["email","https://www.googleapis.com/auth/chromewebstore.readonly"]})}function o(){return l($traceurRuntime.initGeneratorFunction(function n(){var a,o,i,c,s;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:a=w+r.id,n.state=17;break;case 17:return n.state=2,e();case 2:o=n.sent,n.state=4;break;case 4:return n.state=6,t.get(a,{headers:{Authorization:"Bearer "+o}});case 6:i=n.sent,n.state=8;break;case 8:c=i.data,n.state=19;break;case 19:n.state=c.result&&c.createdTime?11:10;break;case 11:s=new Date(Number(c.createdTime)),n.state=12;break;case 12:n.returnValue=S>s,n.state=-2;break;case 10:n.returnValue=!1,n.state=-2;break;default:return n.end()}},n,this)}))}return C.isTester()?a.when(!0):n.sync.getSingle(R).then(function(e){return angular.isDefined(e)?e:a.reject()})["catch"](function(){return o().then(function(e){return n.sync.setSingle(R,e),e})})["catch"](function(){return!1})}function p(){return t.get(k+"/license",E).then(function(e){return e.data})}function g(){return d.getConnectedAppInfo().then(function(e){var t=Date.now(),r=e.some(function(e){return e.isPaidInstall&&(!e.userExpiryDate||e.userExpiryDate>=t)});return r?{access:"full",type:"app",maxAgeSecs:3600}:null})}function m(){return!x||v&&("tester"===v.access||"full"==v.access)}function b(e,t,r){r.isPaidInstall&&C.updateLicense()}function y(e,t,r){function n(e){return!e||e>=Date.now()}n(t)!=n(r)&&C.updateLicense()}var v,w="https://www.googleapis.com/chromewebstore/v1.1/userlicenses/",k=s.API_URL,S=1413892757176,E=c.AUTH_CONFIG,T="license",R="cws_license",$=600,x=!0,C={};return C.updateLicense=function(){function e(){return a.all([h(),p(),g()]).then(function(e){var t=e[0],r=e[1],n=e[2];return n&&"full"!==r.access?n:(t&&"full"!==r.access&&(r.access="tester",r.maxAgeSecs=3600),r)})}i.debug("updating, current state",C.hasLicense(),C.isPaid());var t=f().then(e,g).then(function(e){return e?(e.validTill=Date.now()+1e3*e.maxAgeSecs,n.sync.setSingle(T,e),i.debug("update completed for",e.user||e.type),e):a.reject("not_signed_in")});return t["catch"](function(e){i.debug("update failed",e),c.getEmail(!1).then(function(e){i.debug("update: chrome user is",e)})}),t},C.shouldLimitLength=function(){return!m()},C.shouldForceBranding=function(){return!(v&&!v.branding||m())},C.isPaid=function(){return!(!v||"full"!==v.access)},C.isTester=function(){return!(!v||"tester"!==v.access)},C.getMaxLength=function(){return m()?Number.POSITIVE_INFINITY:$},C.getVersionName=function(){var e=m()?"Full":"Free";if(v){var t=[v.access];v.type&&t.push(v.type),e+=" ("+t.join(" ")+")"}return e+" v"+r.getManifest().version},C.initialize=function(){return n.sync.getSingle(T).then(function(e){v=e,n.onChanged.addListener(function(e,t){"sync"==t&&e[T]&&(v=e[T].newValue,o.$$phase||o.$digest())}),r.getBackgroundPage(),o.$on("connect:appConnected",b),o.$on("connect:userExpiryDateChange",y)})},C.updateIfNeeded=function(){var e=v;(!e||!e.validTill||e.validTill<Date.now())&&C.updateLicense()},C.getToken=f,C.hasLicense=function(){return x&&!!v},C}]),angular.module("castifyExt.signInService",["castifyExt.castifyAuth"]).factory("signInService",["castifyAuth","chromeRuntime","$rootScope","$log","$http",function(e,t,r,n,a){var o=["https://www.googleapis.com/auth/plus.me","email"],i={googleAuth:!0,googleAuthScopes:o},c="https://www.googleapis.com/plus/v1/people/me",s={SCOPES:o,AUTH_CONFIG:i};return s.getToken=function(t,r){var n={interactive:!!t,scopes:o,validate:r};return e.getAuthToken(n)},s.signIn=function(t){var r={interactive:"select_account",scopes:o,validate:!0};t===!1&&(r.useChromeAccount=!1);var a=e.getAuthToken(r);return a["catch"](function(e){n.warn("Sign in failed",e)}),a},s.getMe=function(){return a.get(c,i).then(function(e){return e.data})},s.getEmail=function(t){return t!==!1?s.getToken(!1).then(e.getChromeAccount):e.getChromeAccount()},s}]),angular.module("castifyExt.bgLicensing",["castifyExt.licensing","w69b.chromeRuntime","castifyExt.chromeEventPublisher"]).factory("bgLicensing",["licensing","$rootScope",function(e,t){function r(){e.updateLicense()}var n={};return n.install=function(){e.initialize().then(function(){e.updateIfNeeded()}),t.$on("event:signInChanged",r)},n}]),angular.module("castifyExt.driveFileDb",["w69b.chromeStorage","w69b.spawn","castifyExt.driveUtils","castifyExt.offline","castifyExt.castifyAuth"]).factory("driveFileDb",["googledrive","driveUtils","castifyAuth","$q","onlineState","chromeStorage","spawn",function(e,t,r,n,a,o,i){function c(e,t){if(e){var r=e.match(/(.*)=s\d+$/);if(r)return r[1]+"=s"+t}return e}function s(e){var t=[];return angular.forEach(e,function(e,r){angular.isObject(e)?angular.forEach(e,function(e,n){t.push({key:r+"_"+n,value:e,visibility:"PRIVATE"})}):t.push({key:r,value:e,visibility:"PRIVATE"})}),t}function u(e){var t={};return e.forEach(function(e){if("PRIVATE"===e.visibility){if(e.key.indexOf("_")>0){var r=e.key.split("_",2),n=r[0],a=r[1];t[n]||(t[n]={}),t[n][a]=e.value}t[e.key]=e.value}}),t}function l(e){this.updateFromDriveResource_(e)}function d(){return n.when(o.local.getSingle(p,[]))}function f(e){o.local.setSingle(p,e)}var h=400,p="drive_files",g={},m=l.prototype;return m.updateFromDriveResource_=function(e){var t=u(e.properties),r={id:t.uuid,driveId:e.id,thumbnailUrl:c(e.thumbnailLink,h),createdAt:new Date(t.recordingDate?Number(t.recordingDate):e.createdDate),url:e.downloadUrl,urlRequiresAccessToken:!0,size:Number(e.fileSize),duration:Number(t.duration),width:Number(t.width),height:Number(t.height),driveInfo:e},n="."+e.fileExtension;e.fileExtension&&-1!==e.title.indexOf(n,e.title.length-n.length)?r.title=e.title.slice(0,-n.length):r.title=e.title,t.youtubeInfo&&(r.youtubeInfo=t.youtubeInfo),angular.extend(this,r)},m.remove=function(){return e.trashFile(this.driveId)},m.rename=function(t){var r=this.driveInfo.fileExtension;return r&&(r="."+r,t.indexOf(r,t.length-r.length)<0&&(t+=r)),e.patchFile(this.driveId,{title:t}).then(this.updateFromDriveResource_.bind(this))},m.updateYoutubeInfo=function(t){var r=u(this.driveInfo.properties);return r.youtubeInfo=t,e.patchFile(this.driveId,{properties:s({youtubeInfo:t})})},g.getFileDescriptor=function(t){var r="trashed = false and properties has { key='uuid' and value='"+t+"' and visibility='PRIVATE' }";return e.listFiles({maxResults:1,q:r}).then(function(e){return e.length?e[0]:n.reject()}).then(function(e){return new l(e)})},g.listFiles=function(){return i($traceurRuntime.initGeneratorFunction(function r(){var n,o,i,c,s,u,h,p,g,m,b,y,v;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:r.state=a.isOnline()?24:33;break;case 24:r.pushTry(22,null),r.state=25;break;case 25:i=t.getDriveUploadParentId,c=i.call(t),s=c.then,u=function(t){var r="'"+t+"' in parents and trashed = false and properties has { key='isScreencastifySyncFile' and value='true' and visibility='PRIVATE' }";return e.listFiles({maxResults:1e3,q:r})},h=s.call(c,u),r.state=6;break;case 6:return r.state=2,h;case 2:p=r.sent,r.state=4;break;case 4:n=p,r.state=8;break;case 8:f(n),r.state=10;break;case 10:r.popTry(),r.state=27;break;case 22:r.popTry(),r.maybeUncatchable(),b=r.storedException,r.state=21;break;case 21:r.state=b&&(b.status<=0||b.status>=500)?15:19;break;case 15:g=d(),r.state=16;break;case 16:return r.state=12,g;case 12:m=r.sent,r.state=14;break;case 14:n=m,r.state=27;break;case 19:throw b;case 33:y=d(),r.state=34;break;case 34:return r.state=30,y;case 30:v=r.sent,r.state=32;break;case 32:n=v,r.state=27;break;case 27:o={},n.forEach(function(e){var t=new l(e);o[t.id]=t}),r.state=41;break;case 41:r.returnValue=o,r.state=-2;break;default:return r.end()}},r,this)}))},g}]),angular.module("castifyExt.bgFiles",["castifyExt.localFileDb","castifyExt.driveFileDb","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.syncAuthTool","castifyExt.offline","w69b.spawn"]).factory("bgFiles",["localFileDb","driveFileDb","$q","$rootScope","chromeRuntime","appOptions","$log","syncAuthTool","$interval","onlineState","spawn",function(e,t,r,n,a,o,i,c,s,u,l){function d(e,t){this.$localDesc=e,this.$driveDesc=t,this.ownProperties_={}}function f(e){this.port=e}function h(e){return c.broadcastIfSyncError(e)}function p(){return o.values.driveSync}function g(e){var t={};return P.forEach(function(r){var n=e[r];angular.isDefined(n)&&(n instanceof Date&&(n=n.getTime()),t[r]=n)}),t}function m(e){var t={};return angular.forEach(e,function(e,r){t[r]=g(e)}),t}function b(){I++,x.listFiles().then(function(e){var t={full:m(e)};y("filesUpdate",t)})}function y(e,t){C.forEach(function(r){r.subscribed&&r.postMessage(e,t)})}function v(e){I++;var t=$[e],r={};t?(r.add={},r.add[e]=g(t)):r.remove=[e],y("filesUpdate",r)}function w(e){if("files"==e.name){var t=new f(e);C.push(t),e.onDisconnect.addListener(function(){var e=C.indexOf(t);e>=0&&C.splice(e,1)});var r={remove:x.remove,reload:function(e){x.reload(e).then(function(){t.postMessage("reloadSuccess",e)},function(){t.postMessage("reloadError",e)})},rename:function(e){x.rename(e.id,e.title)},removeAll:x.removeAll,subscribe:function(){t.subscribed=!0,t.postFiles()}};e.onMessage.addListener(function(e){r.hasOwnProperty(e.type)&&r[e.type](e.data)})}}function k(){return null}function S(e){i.debug("bgFiles: sync setting changed to "+e+" clearing cache"),x.clearCache(),C.length&&b(),n.$broadcast("bgFiles:syncSettingChanged",e)}function E(e){e&&T()}function T(){x.clearCache(),b()}var R,$={},x={},C=[],I=0,A=["id","size","width","height","duration","title","thumbnailUrl","createdAt","url","driveInfo","youtubeInfo","urlRequiresAccessToken","autoShare"],P=A.concat(["isSynced","isLocal"]),F=d.prototype;return F.preferDriveDelegate_=function(){return this.$driveDesc?this.$driveDesc:this.$localDesc},F.preferLocalDelegate_=function(){return this.$localDesc?this.$localDesc:this.$driveDesc},F.getDelegate_=function(e){return this.ownProperties_.hasOwnProperty(e)?this.ownProperties_:"thumbnailUrl"===e||"urlRequiresAccessToken"===e||"url"===e?this.preferLocalDelegate_():this.preferDriveDelegate_()},F.callOnBoth_=function(e,t){t=Array.prototype.slice.call(arguments,1);var n,a=this;return n=a.$driveDesc?a.$driveDesc[e].apply(a.$driveDesc,t)["catch"](h):r.when(),n.then(function(){return a.$localDesc?a.$localDesc[e].apply(a.$localDesc,t):void 0})},F.reload=function(){var n=[],a=this;a.$driveDesc&&n.push(t.getFileDescriptor(a.id).then(function(e){a.$driveDesc=e})),a.$localDesc&&n.push(e.getFileDescriptor(a.id).then(function(e){a.$localDesc=e}));var o=r.all(n).then(function(){a.ownProperties_={}});return o["finally"](function(){v(a.id)}),o},F.rename=function(e){var t=this,r=t.title;t.title=e;var n=t.callOnBoth_("rename",e);return n["catch"](function(){t.title=r}),n["finally"](function(){v(t.id)}),n},F.remove=function(){i.debug("bgFiles.remove",this.id);var e=this,t=e.callOnBoth_("remove");return t.then(function(){delete $[e.id],n.$broadcast("bgFiles:fileRemoved",e.id)}),t["finally"](function(){v(e.id)}),t},F.updateYoutubeInfo=function(e){var t=this,r=t.youtubeInfo;t.youtubeInfo=e;var n=t.callOnBoth_("updateYoutubeInfo",e);n["catch"](function(){t.youtubeInfo=r}),n["finally"](function(){v(t.id)})},A.forEach(function(e){Object.defineProperty(F,e,{get:function(){var t=this.getDelegate_(e);return t?t[e]:null},set:function(t){this.ownProperties_[e]=t}})}),Object.defineProperty(F,"isSynced",{get:function(){return!!this.$driveDesc}}),Object.defineProperty(F,"isLocal",{get:function(){return!!this.$localDesc}}),F=f.prototype,F.postMessage=function(e,t){C.indexOf(this)<0||this.port.postMessage({type:e,data:t})},F.postFiles=function(){var e=this;x.listFiles().then(function(t){e.postMessage("filesUpdate",{full:m(t)})},function(t){i.warn("initial MessageClient subscribe postFiles failed",t),e.postMessage("filesUpdate",{error:!0})})},x.getFileDescriptor=function(e){return $[e]?r.when($[e]):x.listFiles().then(function(t){return t[e]?t[e]:r.reject()})},x.listFiles=function(){if(!R){var n=o.loadedPromise.then(function(){return p()?t.listFiles():r.when({})});R=r.all({local:e.listFiles(),drive:n}).then(function(e){var t=Object.keys(e.local).concat(Object.keys(e.drive));return t.forEach(function(t){var r=e.local[t],n=e.drive[t],a=new d(r,n);$[a.id]=a}),$}),R["catch"](h),R["catch"](function(){R=null})}return R},x.removeAll=function(){var e=x.listFiles().then(function(e){return r.all(Object.keys(e).map(function(e){return x.remove(e)}))});return e["catch"](b),e},x.remove=function(e){return x.getFileDescriptor(e).then(function(e){return e.remove()})},x.rename=function(e,t){return x.getFileDescriptor(e).then(function(e){return e.rename(t)})},x.reload=function(e){return x.getFileDescriptor(e).then(function(e){return e.reload()})},x.clearCache=function(){R=null,angular.copy({},$)},x.idToLocalFilename=function(t){return e.idToFilename(t)},x.localFilenameToId=function(t){return e.filenameToId(t)},x.updateLocalInfo=function(t,r){return e.updateInfo(t,r).then(function(){x.reload(t).then(function(){v(t)})})},x.updateYoutubeInfo=function(e,t){return x.getFileDescriptor(e).then(function(e){return e.updateYoutubeInfo(t)})},x.getListVersionId=function(){return I},x.isSyncEnabled=p,x.registerLocalFile=function(t){return l($traceurRuntime.initGeneratorFunction(function r(){var a,o;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,e.getFileDescriptor(t);case 2:a=r.sent,r.state=4;break;case 4:return r.state=6,x.getFileDescriptor(t)["catch"](function(){return new d(a,null)});case 6:o=r.sent,r.state=8;break;case 8:$[o.id]=o,v(t),n.$broadcast("bgFiles:localFileCreated",t),r.state=-2;break;default:return r.end()}},r,this)}))},x.refresh=function(n){return r.all({proxy:x.getFileDescriptor(n)["catch"](k),drive:t.getFileDescriptor(n)["catch"](k),local:e.getFileDescriptor(n)["catch"](k)}).then(function(e){var t=e.proxy;if(!t){if(!e.drive&&!e.local)return r.reject();t=new d(e.local,e.drive),$[t.id]=t}t.$driveDesc=e.drive,t.$localDesc=e.local,t.$driveDesc||t.$localDesc||(t.deleted=!0,delete $[n]),v(n)})},x.install=function(){s(T,3e5),n.$on("onlineState:changed",E),n.$on("event:signInChanged",T),o.loadedPromise.then(function(){n.$watch(p,function(e,t){t!==e&&S(e)})}),a.onConnect.addListener(w)},x}]),angular.module("castifyExt.licenseEnforcer",["castifyExt.bgRecord","castifyExt.licensing","w69b.chromeTabs"]).factory("licenseEnforcer",["bgRecordService","$rootScope","licensing","chromeTabs","$log","analytics",function(e,t,r,n,a,o){function i(e){var t="https://www.screencastify.com/buy?utm_source=app&utm_medium="+e+"&utm_campaign=recording_length";n.create({url:t})}function c(){a.debug("recordLimitReached"),o.trackEvent("recording_limit","notify");var t={type:"basic",priority:2,title:"Recording stopped",message:"You have reached the recording limit of Screencastify Lite. Please upgrade to record longer screencasts",iconUrl:"images/icon128.png"};chrome.notifications.clear("recordLimitInfo",angular.noop),chrome.notifications.clear("recordLimitReached",angular.noop),chrome.notifications.create("recordLimitReached",t,angular.noop),e.stop(),i("auto")}function s(e){a.debug("recordLimitApproaching");var t={type:"basic",priority:2,title:"Approaching free recording limit",message:"Recording will be stopped automatically in "+e+" seconds. Please upgrade Screencastify to record longer screencasts.",iconUrl:"images/icon128.png"};chrome.notifications.create("recordLimitInfo",t,angular.noop)}function u(e){"recordLimitReached"!==e&&"recordLimitInfo"!==e||(i("notify"),chrome.notifications.clear(e,angular.noop))}var l=30,d={};return d.install=function(){function n(){var t=e.getConfig();return t.autoShareApp&&t.autoShareApp.isPaid}t.$watch(function(){return e.getRecorderState().time>=r.getMaxLength()},function(e){e&&!n()&&c()}),t.$watch(function(){return r.getMaxLength()-Math.ceil(e.getRecorderState().time)},function(e){e>0&&l>=e&&!n()&&s(e)}),t.$on("recorder:stopped",function(){chrome.notifications.clear("recordLimitInfo",angular.noop)})},chrome.notifications.onClicked.addListener(u),d}]),angular.module("castifyExt.bgMessages",["castifyExt.ui.openInAppTab","castifyExt.signInService","castifyExt.licensing","castifyExt.connect.connectedApps"]).factory("bgMessages",["chromeRuntime","chromePersistentLogger","openInAppTab","chromeTabs","signInService","licensing","connectedApps",function(e,t,r,n,a,o,i){function c(r,n,i){if("bg:load"===r&&l)e.sendMessage("bg:loaded");else{if("bg:flushLogs"===r)return t.save().then(function(){i(!0)}),!0;if("bg:signInLicense"===r)return a.getToken(!1,!0).then(function(){return o.updateLicense()},function(){return a.signIn()})["finally"](function(){i()}),!0;if(["bg:launchApp","bg:getSignInToken","bg:updateLicense","bg:getLicenseInfo"].includes(r))return u(r,n,i)}return!1}function s(t){return"chrome-extension://"+e.id+"/app.html#"+t}function u(t,r,c){if("bg:launchApp"===t)r.tab&&r.tab.id&&n.update(r.tab.id,{url:s("/")});else if("bg:launchSupport"===t)n.create({url:s("/support")});else{if("bg:getSignInToken"===t)return a.signIn().then(function(e){c(e)},function(){c(!1)}),!0;if("bg:updateLicense"===t)o.updateLicense();else if("bg:isInstalled"===t)c(e.getManifest().version);else{if(t&&"bg:connectApp"===t.type)return i.connect(t.data).then(function(){c(!0)},function(){c(!1)}),!0;if("bg:getLicenseInfo"===t){var u=null;return a.getEmail().then(function(e){u=e})["finally"](function(){c({isPaid:o.isPaid(),isTester:o.isTester(),email:u})}),!0}}}return!1}var l=!1,d={};return d.install=function(){e.onMessage.addListener(c),e.onMessageExternal.addListener(u)},d.initializationCompleted=function(){e.sendMessage("bg:loaded"),l=!0},d}]),angular.module("castifyExt.chromeEventPublisher",[]).run(["chromeRuntime","$rootScope",function(e,t){var r="event:";e.onMessage.addListener(function(e){angular.isObject(e)&&angular.isString(e.type)&&0===e.type.lastIndexOf(r,0)&&t.$broadcast(e.type,e.data),t.$$phase||t.$digest()})}]),angular.module("castifyExt.driveUtils",["w69b.googledrive","castifyExt.castifyAuth","w69b.es6","w69b.spawn","w69b.chromeStorage"]).factory("driveUtils",["googledrive","$q","spawn","$log","chromeStorage",function(e,t,r,n,a){function o(){return n.debug("driveUtils: creating Drive folder"),e.postFile({title:"Screencastify",mimeType:"application/vnd.google-apps.folder",description:"Screencastify uses this folder to store Screencasts that you upload. You may rename or move it, it will upload to this folder.",properties:[{key:"isScreencastifyUploadFolder",value:!0,visibility:"PRIVATE"}]})}function i(r){return e.getFile(r).then(function(e){return!e.labels.trashed},function(e){return 404===e.status?!1:(n.warn("driveUtils: checkIfExists failed",e),t.reject(e))})}function c(){var t="mimeType = 'application/vnd.google-apps.folder' and trashed = false and properties has { key='isScreencastifyUploadFolder' and value='true' and visibility='PRIVATE' }";return e.listFiles({q:t,maxResults:1}).then(function(e){return n.debug("driveUtils: findFolder items #",e.length),e.length?e[0]:null})}function s(e,t){var r=e.filter(function(e){return e.type===t});return r.length?r[0]:null}function u(e){return s(e,"anyone")}function l(e){return s(e,"domain")}function d(e){var t=u(e),r=l(e);return t?t.withLink?"unlisted":"public":r?r.withLink?"domain_unlisted":"domain_public":"private"}var f,h={},p="DRIVE_FOLDER_ID";return h.getDriveUploadParentId=function(e){return f&&!e||(f=r($traceurRuntime.initGeneratorFunction(function t(){var e,r,s,u,l,d,f,h;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:return t.state=2,a.sync.getSingle(p);case 2:e=t.sent,t.state=4;break;case 4:t.state=e?9:13;break;case 9:u=i(e),t.state=10;break;case 10:return t.state=6,u;case 6:l=t.sent,t.state=8;break;case 8:d=l,t.state=12;break;case 13:d=e,t.state=12;break;case 12:t.state=d?18:17;break;case 18:n.debug("driveUtil: using cached parent Id",e),t.state=19;break;case 19:t.returnValue=e,t.state=-2;break;case 17:return t.state=22,c();case 22:r=t.sent,t.state=24;break;case 24:t.state=r?32:29;break;case 29:f=o(),t.state=30;break;case 30:return t.state=26,f;case 26:h=t.sent,t.state=28;break;case 28:r=h,t.state=32;break;case 32:s=r.id,t.state=41;break;case 41:return t.state=35,a.sync.setSingle(p,s);case 35:t.maybeThrow(),t.state=37;break;case 37:t.returnValue=s,t.state=-2;break;default:return t.end()}},t,this)})),f["catch"](function(){f=null})),f},h.getSimplePrivacy=function(t){return e.listPermissions(t).then(d)},h.getLink=function(e){return"https://drive.google.com/file/d/"+e+"/view"},h.setSimplePrivacy=function(n,a,o){var i=a.startsWith("domain_");if(i&&!o)throw new Error;return r($traceurRuntime.initGeneratorFunction(function c(){
var r,s,f,h;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:return c.state=2,e.listPermissions(n);case 2:r=c.sent,c.state=4;break;case 4:s=u(r),f=l(r),c.state=34;break;case 34:c.state=d(r)===a?5:31;break;case 5:c.returnValue=t.when(null),c.state=-2;break;case 31:c.state="private"===a?11:21;break;case 11:c.state=s?7:10;break;case 7:return c.state=8,e.removePermission(n,s.id);case 8:c.maybeThrow(),c.state=10;break;case 10:c.state=f?12:-2;break;case 12:return c.state=13,e.removePermission(n,f.id);case 13:c.maybeThrow(),c.state=-2;break;case 21:c.state=s?17:20;break;case 17:return c.state=18,e.removePermission(n,s.id);case 18:c.maybeThrow(),c.state=20;break;case 20:c.state=f?22:25;break;case 22:return c.state=23,e.removePermission(n,f.id);case 23:c.maybeThrow(),c.state=25;break;case 25:h={role:"reader",type:i?"domain":"anyone",withLink:"unlisted"===a||"domain_unlisted"===a},i&&(h.value=o),c.state=30;break;case 30:c.returnValue=e.insertPermission(n,h),c.state=-2;break;default:return c.end()}},c,this)}))},h}]),angular.module("castifyExt.youtubeUtils",["castifyExt.castifyAuth"]).factory("youtubeUtils",["$http","$q",function(e,t){function r(e){var r=e.data.items;return r.length?r[0]:t.reject("not found")}function n(t,n){return e.get(o,angular.extend({params:{id:t,part:"status,snippet"}},{youtubeAuth:n})).then(r)}function a(t,r,n){return n=angular.extend({id:t},n),e.put(o,n,angular.extend({params:{part:"status"}},{youtubeAuth:r})).then(function(e){return e.data})}var o="https://www.googleapis.com/youtube/v3/videos",i={};return i.getPrivacy=function(e,r){return n(e,r).then(function(e){return r!==e.snippet.channelId?t.reject():e.status.privacyStatus})},i.getLink=function(e){return"https://youtu.be/"+e},i.setPrivacy=function(e,t,r){return a(e,r,{status:{privacyStatus:t}})},i}]),angular.module("castifyExt.driveFileWatcher",["w69b.googledrive","w69b.chromeStorage","w69b.chromeAlarms","castifyExt.castifyAuth"]).factory("driveFileWatcher",["googledrive","chromeStorage","$rootScope","$log","chromeAlarms",function(e,t,r,n,a){function o(){return t.local.setSingle(f,{ids:Object.keys(b),lastCheckedAt:g})}function i(e,t){r.$broadcast("driveFileWatcher:"+e,t)}function c(e){delete b[e]}function s(t){return e.getFile(t).then(function(e){e.labels&&e.labels.trashed?(n.debug("file was trashed",t),i("removed",t),c(t)):e.thumbnailLink&&(n.debug("detected drive processing complete for file",t),i("processed",t),c(t))},function(e){n.debug("failed to check drive file",t,e),404==e.status?(n.debug("file was removed"),i("removed",t),c(t)):n.debug("we will try again later")})}function u(){function e(){return t.length?s(t.pop()).then(e,e):null}var t=Object.keys(b);t.length&&!p&&(n.debug("checking watched drive files",t),p=!0,e()["finally"](function(){p=!1,g=Date.now(),o(),l()}))}function l(e){Object.keys(b).length&&(!e&&Date.now()-g>=6e4*m?u():a.get(h).then(function(e){e||a.create(h,{delayInMinutes:m})}))}function d(e){e.name===h&&l()}var f="driveFileWatcher",h=f,p=!1,g=0,m=2,b={},y={};return y.watchFile=function(e){n.debug("watching drive file",e),b[e]=!0,o(),l(!0)},y.install=function(){t.local.getSingle(f).then(function(e){e&&(e.ids.forEach(function(e){b[e]=!0}),g=e.lastCheckedAt||0),l()}),a.onAlarm.addListener(d)},y}]),angular.module("castifyExt.bgSyncManager",["castifyExt.appOptions","castifyExt.bgUpload","w69b.chromeRuntime","castifyExt.driveFileWatcher","w69b.googledrive","castifyExt.localFileDb","castifyExt.chromeEventPublisher","castifyExt.bgFiles","w69b.spawn","castifyExt.bgSyncDownloader"]).factory("bgSyncManager",["$rootScope","appOptions","bgUploadService","localFileDb","googledrive","chromeRuntime","$q","driveFileWatcher","$log","bgFiles","spawn","bgSyncDownloader",function(e,t,r,n,a,o,i,c,s,u,l,d){function f(e){return s.debug("bgSyncManager: staring sync upload",e.id),r.upload({fileId:e.id,target:"drive",privacy:"private",title:e.title,isSyncUpload:!0})}function h(e,t){function r(e){if(e.title!==o.title){s.debug("bgSyncManager: title changed, applying post-upload changes");var t=e.title;return/\.webm/i.test(t)||(t+=".webm"),a.patchFile(l,{title:t})}return i.when()}if(t.config.isSyncUpload){var o=t.config,l=t.data.id;s.debug("bgSyncManager: sync upload of file %s complete, driveId %s",o.fileId,l),n.getFileDescriptor(o.fileId).then(function(e){return r(e)})["catch"](function(e){s.warn("bgSyncManager: sync upload hook failed",e)}).then(function(){u.refresh(o.fileId),c.watchFile(l)})}}function p(e){return n.listFiles().then(function(t){for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];if(n.driveInfo&&n.driveInfo.id===e)return n}return i.reject()})}function g(e){return n.getFileDescriptor(e).then(function(e){return e.remove().then(function(){return s.debug("bgSyncManager: removed local file",e.id),u.refresh(e.id)})})}function m(e,t){w()&&(s.debug("bgSyncManager: drive file %s processed",t),p(t).then(function(e){return u.refresh(e.id).then(function(){T(e.id)})}))}function b(e,r){t.values.driveSync&&(s.debug("bgSyncManager: drive file %s remove detected, removing local file",r),p(r).then(function(e){g(e.id).then(function(){T(e.id)})}))}function y(e){var t=A.get(e.id);if(t&&!t.downloadPending){var r=d.startDownload(e.id);t.downloadPending=!0,r.done.then(t.deferred.resolve.bind(t.deferred),t.deferred.reject.bind(t.deferred)),r.done["finally"](function(){t.downloadPending=!1,t.timestamp=Date.now()})}}function v(e,t){T(t)}function w(){return t.isLoaded()&&t.values.driveSync}function k(e){var t=A.get(e.id),r=e.isSynced&&!!e.driveInfo.thumbnailLink,n=t&&(t.downloadPending||t.timestamp+P>=Date.now());return e.isLocal&&r&&!n}function S(e){var t=e.autoShare;return t&&t.timestamp+P<Date.now()}function E(){return l($traceurRuntime.initGeneratorFunction(function e(){var t,r,a,o,i,c,s,l,d,f,h,p,g,m,b,y;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=!0,r=!1,a=void 0,e.state=37;break;case 37:e.pushTry(21,22),e.state=24;break;case 24:o=void 0,l=Object.keys,d=n.listFiles,f=d.call(n),e.state=6;break;case 6:return e.state=2,f;case 2:h=e.sent,e.state=4;break;case 4:p=l.call(Object,h),g=Symbol.iterator,m=p[g],b=m.call(p),i=b,e.state=8;break;case 8:e.state=20;break;case 20:e.state=(t=(o=i.next()).done)?18:16;break;case 14:t=!0,e.state=20;break;case 16:c=o.value,e.state=17;break;case 17:return e.state=10,u.getFileDescriptor(c);case 10:s=e.sent,e.state=12;break;case 12:e.state=s.isSynced||s.autoShare?14:13;break;case 13:e.returnValue=!1,e.state=22,e.finallyFallThrough=-2;break;case 18:e.popTry(),e.state=22,e.finallyFallThrough=26;break;case 21:e.popTry(),e.maybeUncatchable(),y=e.storedException,e.state=27;break;case 27:r=!0,a=y,e.state=22,e.finallyFallThrough=26;break;case 22:e.popTry(),e.state=33;break;case 33:try{t||null==i["return"]||i["return"]()}finally{if(r)throw a}e.state=31;break;case 26:e.returnValue=!0,e.state=-2;break;case 31:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))}function T(e){l($traceurRuntime.initGeneratorFunction(function t(){var r,n,a,o;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:return t.state=2,u.getFileDescriptor(e);case 2:r=t.sent,t.state=4;break;case 4:t.state=w()?17:20;break;case 17:r.isSynced||r.autoShare||f(r),t.state=18;break;case 18:t.state=k(r)?9:12;break;case 9:a=E(),t.state=10;break;case 10:return t.state=6,a;case 6:o=t.sent,t.state=8;break;case 8:t.state=o?11:13;break;case 11:g(r.id),t.state=12;break;case 13:F.add(r.id),t.state=12;break;case 12:n=A.get(r.id),n&&!n.isDone&&(r.isLocal?n.deferred.resolve():y(r)),t.state=20;break;case 20:r.autoShare&&S(r)&&g(r.id),t.state=-2;break;default:return t.end()}},t,this)}))["catch"](function(t){s.error("bgSyncManager.syncFile("+e+") failed : ",t)})}function R(e,t){e={id:t,deferred:i.defer(),isDone:!1},A.set(t,e);var r=e.deferred.promise;return r.then(function(){e.isDone=!0}),r["catch"](function(){A["delete"](t)}),e}function $(e,t){t||r.cancelSyncUploads(),I.syncFiles()}function x(){var e=!0,t=!1,r=void 0;try{for(var n=void 0,a=F[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var o=n.value;T(o)}}catch(i){t=!0,r=i}finally{try{e||null==a["return"]||a["return"]()}finally{if(t)throw r}}}function C(e,n){t.values.driveSync&&r.cancel({target:"drive",fileId:n})}var I={},A=new Map,P=18e5,F=new Set;return I.syncFiles=function(){l($traceurRuntime.initGeneratorFunction(function e(){var t,r,a,o,i,c,s,u,l,d,f,h,p,g,m,b,y,v,w,k,S,E,R,$,x,C,I,P;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:t=new Set,r=!0,a=!1,o=void 0,e.state=28;break;case 28:e.pushTry(14,15),e.state=17;break;case 17:i=void 0,k=Object.keys,S=n.listFiles,E=S.call(n),e.state=6;break;case 6:return e.state=2,E;case 2:R=e.sent,e.state=4;break;case 4:$=k.call(Object,R),x=Symbol.iterator,C=$[x],I=C.call($),c=I,e.state=8;break;case 8:e.state=13;break;case 13:e.state=(r=(i=c.next()).done)?11:9;break;case 10:r=!0,e.state=13;break;case 9:s=i.value,t.add(s),e.state=10;break;case 11:e.popTry(),e.state=15,e.finallyFallThrough=19;break;case 14:e.popTry(),e.maybeUncatchable(),P=e.storedException,e.state=20;break;case 20:a=!0,o=P,e.state=15,e.finallyFallThrough=19;break;case 15:e.popTry(),e.state=26;break;case 26:try{r||null==c["return"]||c["return"]()}finally{if(a)throw o}e.state=24;break;case 19:u=!0,l=!1,d=void 0;try{for(f=void 0,h=A.keys()[Symbol.iterator]();!(u=(f=h.next()).done);u=!0)p=f.value,t.add(p)}catch(F){l=!0,d=F}finally{try{u||null==h["return"]||h["return"]()}finally{if(l)throw d}}g=!0,m=!1,b=void 0;try{for(y=void 0,v=t[Symbol.iterator]();!(g=(y=v.next()).done);g=!0)w=y.value,T(w)}catch(_){m=!0,b=_}finally{try{g||null==v["return"]||v["return"]()}finally{if(m)throw b}}e.state=-2;break;case 24:e.state=e.finallyFallThrough;break;default:return e.end()}},e,this)}))},I.requestSyncLocal=function(e){if(!w())return i.when();var t=A.get(e)||R(t,e);return t.timestamp=Date.now(),T(e),t.deferred.promise},I.syncFile=T,I.areAllLocalFilesSynced=E,I.install=function(){e.$on("uploader:complete",h),e.$on("driveFileWatcher:processed",m),e.$on("driveFileWatcher:removed",b),e.$on("bgFiles:localFileCreated",v),e.$on("bgFiles:fileRemoved",C),e.$on("event:syncSetupComplete",I.syncFiles),e.$on("bgFiles:syncSettingChanged",$),e.$on("bgSyncStatus:syncComplete",x),I.syncFiles()},I}]),angular.module("castifyExt.bgSyncDownloader",["castifyExt.bgFiles","w69b.filesHelper","w69b.chromeRuntime","castifyExt.simplePortService","w69b.spawn"]).factory("fetchTool",["spawn","castifyAuth","filesHelper","$q",function(e,t,r,n){function a(e){return t.getAuthToken({interactive:!1}).then(function(t){e.headers.append("Authorization","Bearer "+t)})}function o(e,t){return new Promise(function(r,n){e.onwriteend=r,e.onerror=n,e.write(t)})}function i(t,i){function c(){return e($traceurRuntime.initGeneratorFunction(function n(){var e,c,d,f,h,p,g,m,b,y;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:e=new Request(t),n.state=55;break;case 55:return n.state=2,a(e);case 2:n.maybeThrow(),n.state=4;break;case 4:return n.state=6,r.getFileEntryByPath(i,{create:!0});case 6:c=n.sent,n.state=8;break;case 8:return n.state=10,r.getMetadata(c);case 10:d=n.sent,n.state=12;break;case 12:e.headers.append("range","bytes = "+d.size+" -"),n.state=57;break;case 57:return n.state=14,fetch(e,{mode:"cors"});case 14:f=n.sent,n.state=16;break;case 16:if(!f.ok)throw new Error("fetch failed");n.state=59;break;case 59:n.state=l?17:18;break;case 17:n.state=-2;break;case 18:s=f.body.getReader(),n.state=61;break;case 61:return n.state=21,s.read();case 21:h=n.sent,n.state=23;break;case 23:n.pushTry(45,null),n.state=48;break;case 48:u.bytesLoaded=d.size,n.state=44;break;case 44:return n.state=25,r.createWriter(c);case 25:p=n.sent,n.state=27;break;case 27:n.state=h.done?42:28;break;case 28:return n.state=29,o(p,new Blob([h.value]));case 29:n.maybeThrow(),n.state=31;break;case 31:u.bytesLoaded+=h.value.length,n.state=41;break;case 41:g=s.read,m=g.call(s),n.state=37;break;case 37:return n.state=33,m;case 33:b=n.sent,n.state=35;break;case 35:h=b,n.state=27;break;case 42:n.popTry(),n.state=-2;break;case 45:n.popTry(),n.maybeUncatchable(),y=n.storedException,n.state=51;break;case 51:throw s.cancel(),y;default:return n.end()}},n,this)}),!0)}var s,u={},l=!1;return u.path=i,u.cancel=function(){s&&s.cancel(),l=!0},u.done=n.when(c()),u}return{downloadUrlToFile:i}}]).factory("bgSyncDownloader",["bgFiles","spawn","castifyAuth","$window","filesHelper","fetchTool","$log","$q","simplePortService",function(e,t,r,n,a,o,i,c,s){function u(){return a.getDirByPath(g,{create:!0})}function l(){return t($traceurRuntime.initGeneratorFunction(function e(){var t,r,n,o,i,s,l,d;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:return e.state=2,u();case 2:e.maybeThrow(),e.state=4;break;case 4:return e.state=6,a.listByPath(g);case 6:t=e.sent,e.state=8;break;case 8:r=[],n=!0,o=!1,i=void 0;try{for(s=void 0,l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)d=s.value,r.push(a.remove(d))}catch(f){o=!0,i=f}finally{try{n||null==l["return"]||l["return"]()}finally{if(o)throw i}}e.state=14;break;case 14:return e.state=10,c.all(r);case 10:e.maybeThrow(),e.state=-2;break;default:return e.end()}},e,this)}))["catch"](function(e){i.error("bgSyncDownloader.cleanup failed",e)})}function d(r){function n(){return t($traceurRuntime.initGeneratorFunction(function n(){var t,i,l,d;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,h;case 2:n.maybeThrow(),n.state=4;break;case 4:i=e.getFileDescriptor,l=i.call(e,r),n.state=10;break;case 10:return n.state=6,l;case 6:d=n.sent,n.state=8;break;case 8:s=d,n.state=12;break;case 12:n.state=u?13:14;break;case 13:n.state=-2;break;case 14:t=g+"/"+s.id,c=o.downloadUrlToFile(s.url,t),n.state=29;break;case 29:return n.state=17,c.done;case 17:n.maybeThrow(),n.state=19;break;case 19:return n.state=21,a.moveFileByPath(t,e.idToLocalFilename(s.id));case 21:n.maybeThrow(),n.state=23;break;case 23:return n.state=25,e.registerLocalFile(s.id);case 25:n.maybeThrow(),n.state=-2;break;default:return n.end()}},n,this)}))}var c,s,u=!1,l={get bytesLoaded(){return c?c.bytesLoaded:0},get progress(){return s&&s.size?l.bytesLoaded/s.size:0}};return l.cancel=function(){c&&c.cancel(),u=!0},l.done=n(),l.done["catch"](function(e){i.warn("bgSyncDownloader: download failed",e)}),l}function f(){var e={},t=!0,r=!1,n=void 0;try{for(var a=void 0,o=m.entries()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value,c=i[0],s=i[1];e[c]={progress:s.progress}}}catch(u){r=!0,n=u}finally{try{t||null==o["return"]||o["return"]()}finally{if(r)throw n}}b.postMessage("downloads",e)}var h,p={},g="_dl",m=new Map,b=s("syncDownloader");return p.getDownload=function(e){return m.get(e)},p.startDownload=function(e){var t=m.get(e);return t||(i.debug("bgSyncDownloader.startDownload("+e+")"),t=d(e),m.set(e,t),f(),t.done["finally"](function(){m["delete"](e),f()})),t},p.install=function(){h=l(),b.install()},b.handlers.update=function(){f()},p}]),angular.module("castifyExt.offline",[]).factory("onlineState",["$rootScope","$window","$http","$timeout","$log",function(e,t,r,n,a){function o(){if(f)return f;var e=Math.random().toString(36).substr(2,36),t=s+e;return f=r.get(t,{responseType:"arraybuffer",timeout:u}).then(function(){return f=null,a.debug("checkNetwork result is online"),!0},function(){return a.debug("checkNetwork result is offline"),f=null,!1}),f.then(i),f}function i(t){h!==t&&(a.debug("verified network state is ",t),h=t,e.$broadcast("onlineState:changed",t)),!t&&d.isNavigatorOnline()&&c(!0)}function c(e){function t(){return p=n(angular.noop,l),p.then(r)}function r(){return o().then(function(e){return!e&&d.isNavigatorOnline()&&g?t():void 0})}g||(g=!0,(e?t():r())["finally"](function(){g=!1}))}var s="https://www.screencastify.com/images/cleardot.gif?",u=1e4,l=1e4,d={},f=null,h=!0,p=null,g=!1;return d.check=function(){return o()},d.isOnline=function(){return h},d.isNavigatorOnline=function(){return t.navigator.onLine!==!1},t.addEventListener("online",function(){d.check()}),t.addEventListener("offline",function(){i(!1),n.cancel(p),g=!1}),d}]),angular.module("castifyExt.syncAuthTool",["castifyExt.castifyAuth","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.driveUtils"]).factory("syncAuthTool",["castifyAuth","$http","$q","$log","appOptions","chromeRuntime","$rootScope","driveUtils",function(e,t,r,n,a,o,i,c){var s={};return s.broadcastIfSyncError=function(e){return"not_signed_in"===e?(n.debug("syncAuthTool: sync enabled but not signed in"),i.$broadcast("event:syncAuthError"),o.sendMessage({type:"event:syncAuthError"}),r.reject(e)):(a.values.driveSync&&s.checkSetup()["catch"](function(t){switch(t){case"token":n.debug("syncAuthTool: sync enabled but we do not have a valid token"),i.$broadcast("event:syncAuthError"),o.sendMessage({type:"event:syncAuthError"});break;case"forbidden":n.debug("syncAuthTool: detected drive-forbidden error",e),i.$broadcast("event:syncForbiddenError");break;default:n.warn("syncAuthTool: unhandled sync error detected",e)}}),r.reject(e))},s.isGoogleForbiddenError=function(e){return!!(angular.isObject(e)&&403===e.status&&e.data&&e.data.error)},s.hasValidAuthToken=function(){return e.getAuthToken({interactive:!1,validate:!0})},s.checkSetup=function(){function e(){return c.getDriveUploadParentId()["catch"](function(e){return s.isGoogleForbiddenError(e)?r.reject("forbidden"):r.reject("unknown")})}return s.hasValidAuthToken()["catch"](function(){return r.reject("token")}).then(e).then(function(){return!0})},s}]),angular.module("castifyExt.requestMicPermission",[]).factory("requestMicPermission",["$window","$q","$interval",function(e,t,r){return function(){var n=t.defer(),a=e.open("mic.html","mic",""),o=!1;a.clGotStream=function(){o=!0,n.resolve()};var i=r(function(){a.closed&&!o&&n.reject("closed mic permission window without granting permission")},200);return n.promise["finally"](function(){r.cancel(i)}),n.promise}}]),angular.module("castifyExt.bgSyncStatus",["castifyExt.bgFiles","castifyExt.bgUpload","w69b.throttle","castifyExt.syncAuthTool","w69b.chromeRuntime","castifyExt.bgSyncManager"]).factory("bgSyncStatus",["bgFiles","bgUploadService","$rootScope","$log","throttle","syncAuthTool","chromeRuntime","bgSyncManager",function(e,t,r,n,a,o,i,c){function s(e){if("syncStatus"==e.name){j.push(e),l(),e.onDisconnect.addListener(function(){var t=j.indexOf(e);t>=0&&j.splice(t,1)});var t={retry:P.retry};e.onMessage.addListener(function(e){t.hasOwnProperty(e.type)&&t[e.type](e.data)})}}function u(e,t){j.forEach(function(r){r.postMessage({type:e,data:t})})}function l(){u("stateUpdate",_)}function d(e){f({type:"synced",numTotalFiles:e}),l()}function f(e){e.type!==_.type&&(n.debug("syncStatus: changing state to ",e),"synced"===e.type&&"unknown"!==_.type&&r.$broadcast("bgSyncStatus:syncComplete")),_=e,"uploading"!==e.type&&(D={})}function h(){"uploading"!==_.type&&f({type:"uploading"});var e=0,t=0,r=0;angular.forEach(D,function(n){e+=n,++t,n>=1&&++r}),_.progress=e/t,_.numTotalFiles=t,_.numCompleteFiles=r,l()}function p(e){"waiting"!==_.type&&f({type:"waiting"}),_.numTotalFiles=e,l()}function g(e){"offline"!==_.type&&f({type:"offline"}),_.numTotalFiles=e,l()}function m(){c.areAllLocalFilesSynced()["catch"](function(){return!1}).then(function(e){e?(n.debug("syncStatus: treating auth error with no local files as synced"),d(0)):(f({type:"error",errorReason:"token"}),l())})}function b(){f({type:"error",errorReason:"forbidden"}),l()}function y(){var e=null,t=!0,r=!1,n=void 0;try{for(var a=void 0,o=L.values()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;i&&(e=i)}}catch(c){r=!0,n=c}finally{try{t||null==o["return"]||o["return"]()}finally{if(r)throw n}}f({type:"error",numTotalFiles:L.size,errorReason:e}),l()}function v(){o.checkSetup().then(y,function(e){"token"===e?m():"forbidden"===e?b():y()})}function w(e){var r=t.getTargetFileState(e,"drive");return r&&r.config.isSyncUpload?r:null}function k(e){var r=0,n=0;angular.forEach(e,function(e,t){D[t]=e&&e.progress||D[t]||0,e?"uploading"===e.state?++r:"queued"===e.state&&++n:n++}),r?h():n&&(t.isOnline()?p(n):g(n))}function S(){t.isOnline()?v():g(0)}function E(){return L.size>0?void S():void e.listFiles().then(function(e){if(F){var t={},r=!1,n=0;angular.forEach(e,function(e){e.autoShare||(e.isSynced?D.hasOwnProperty(e.id)&&(D[e.id]=1):(t[e.id]=w(e.id),r=!0),++n)}),angular.forEach(D,function(t,r){e[r]||delete D[r]}),r?k(t):d(n)}},function(e){n.debug("syncStatus list err",e),S()})}function T(e,t){var r=t.config,a=t.error;r.isSyncUpload&&(n.debug("sync error detected",a),L.has(r.fileId)&&L["delete"](r.fileId),L.set(r.fileId,a&&a.reason),E())}function R(){return"error"==_.type}function $(){R()||m()}function x(){R()||b()}function C(){L.clear(),E()}function I(){f({type:"unknown"}),l(),F=r.$new(!0);var n=a(E,300,!1);F.$watchGroup([e.getListVersionId,t.getWatcherStateId,t.isOnline],function(){n()}),F.$on("uploader:failed",T),F.$on("event:syncAuthError",$),F.$on("event:syncForbiddenError",x),F.$on("event:syncSetupComplete",C)}function A(){F&&F.$destroy(),F=null,f({type:"disabled"}),l()}var P={},F=null,_={type:"unknown"},D={},L=new Map,j=[];return P.retry=function(){L.clear(),c.syncFiles()},P.getState=function(){return _},P.install=function(){r.$watch(e.isSyncEnabled,function(e){e?I():A()}),i.onConnect.addListener(s)},P}]),angular.module("castifyExt.syncNotifications",["castifyExt.bgSyncStatus","w69b.throttle","w69b.chromeNotifications","castifyExt.ui.openInAppTab","castifyExt.appOptions","w69b.promiseTool","castifyExt.helpCenter"]).factory("syncNotifications",["$rootScope","bgSyncStatus","$log","throttle","chromeNotifications","$q","openInAppTab","appOptions","helpCenter","promiseTool",function(e,t,r,n,a,o,i,c,s,u){function l(e,t){k(function(){e=v+e;var r,n=!w;return w&&w!==e?(r=a.clear(w),n=!0):r=o.when(),t=angular.extend({type:"basic",priority:0,eventTime:Date.now(),isClickable:!1,title:"Saving on Drive",iconUrl:"images/icon128.png"},t),w=e,n?r.then(function(){return a.create(e,t)}):r.then(function(){return a.update(e,t)})})}function d(e){c.values.notifySyncProgress&&l("progress",{type:"progress",priority:0,message:"Your recording(s) are being saved "+e.numCompleteFiles+" / "+e.numTotalFiles,progress:Math.floor(100*e.progress)})}function f(e){c.values.notifySyncProgress&&l("waiting",{priority:-1,message:e.numTotalFiles+" recording(s) are waiting to get saved on Drive."})}function h(e){l("offline",{title:"You are offline",priority:1,message:e.numTotalFiles+" recording(s) are not saved on Drive yet."})}function p(e){"token"===e.errorReason?l("auth",{priority:2,title:"Drive Authentication Problem",message:"Screencastify cannot save to Drive.",buttons:[{title:"Setup Access"}]}):"forbidden"===e.errorReason?l("forbidden",{priority:2,title:"Drive Access Problem",message:"Drive Apps are probably disabled for your domain.",buttons:[{title:"Help"}]}):"quotaExceeded"===e.errorReason?l("quotaExceeded",{priority:2,title:"Out of Drive storage space",message:"You have reached your storage limit on Drive. Screencastify cannot store save to Drive anymore.",buttons:[{title:"Help"}]}):l("error",{priority:2,title:"Failed to save recordings on Drive.",message:"We failed to save "+e.numTotalFiles>0?e.numTotalFiles:"some recording(s) on Drive. Please contact support if this problem persists.",buttons:[{title:"Retry"}]})}function g(){k(function(){if(w){var e=a.clear(w);return w=null,e}})}function m(e,r){function n(t,n){return e===v+t&&r===(n||0)}n("error")?t.retry():n("auth")?i("#/sync-setup/"):n("forbidden")?s.openHelp("drive_apps"):n("quotaExceeded")&&s.openHelp("quotaExceeded")}function b(){var e=t.getState(),r=S[e.type];r&&r(e)}var y={},v="sync_state_",w=null,k=u.serializer(),S={uploading:d,waiting:f,offline:h,error:p,synced:g,disabled:g};return y.install=function(){t.install();var r=n(b,1e3,!1);e.$watchCollection(t.getState,function(){r()}),a.onButtonClicked.addListener(m)},y}]),angular.module("castifyExt.youtubeAuth",["w69b.uritool","castifyExt.castifyAuth"]).provider("youtubeAuth",function(){var e,t=["https://www.googleapis.com/auth/youtube"];this.setScopes=function(e){t=e},this.setClientId=function(t){e=t},this.$get=["castifyAuth","$log","uritool","$q","$http","castifyConfig",function(r,n,a,o,i,c){function s(e){return m+"?"+a.encodeQuery(e)}function u(e){return e.data}function l(){return r.getRedirectURL().then(function(a){var i={redirect_uri:a,scope:t.join(" "),response_type:"code",client_id:e,access_type:"offline",include_granted_scopes:!1,prompt:"select_account consent"},c=s(i),u={url:c,interactive:!0};return r.launchWebAuthFlow(u).then(function(e){return n.debug("youtube oauth result",e),e.code?e.code:o.reject("youtube_flow_returned_no_code")})})}function d(e){return i.post(p,{code:e,version:2},{googleAuth:!0}).then(u,function(e){return n.warn("adding youtube code failed",e),o.reject("youtube_add_code_failed")})}function f(e){return i.get(g+"/"+e,{googleAuth:!0}).then(u).then(function(e){return e.expiresAt=Number(new Date(e.expiresAt)),e.issuedAt=Number(new Date(e.issuedAt)),e})}var h=c.API_URL+"/youtube/",p=h+"channels",g=h+"tokens",m="https://accounts.google.com/o/oauth2/auth",b={},y=0,v={};return v.addChannel=function(){return r.getAuthToken({interactive:!0}).then(l).then(d)},v.listChannels=function(){return i.get(p,{googleAuth:!0}).then(u)},v.removeChannel=function(e){return i["delete"](p+"/"+e,{googleAuth:!0}).then(u)},v.getAuthToken=function(e){if(!e.channelId)throw new Error;var t,r=e.channelId,n=Math.floor(Date.now()-y)+12e4,a=b[r];return a&&a.expiresAt>n?t=o.when(a):(t=f(r),t.then(function(e){b[r]=e,e.issuedAt&&(y=Date.now()-Number(e.issuedAt))})),t.then(function(e){return e.accessToken})},v}]}).factory("youtubeHttpAuthInterceptor",["$q","$injector","$log",function(e,t,r){function n(e){var t={channelId:e};return o().getAuthToken(t)}function a(e){return{Authorization:"Bearer "+e}}function o(){return i||(i=t.get("youtubeAuth")),i}var i;return{request:function(t){return t.youtubeAuth?(t.googleAuth&&delete t.googleAuth,n(t.youtubeAuth).then(function(e){return t.headers=angular.extend(t.headers||{},a(e)),t},function(t){return r.warn("youtubeAuth failed",t),e.reject("youtubeAuth failed")})):t}}}]),angular.module("castifyExt.enterprisePolicy",["w69b.chromeStorage"]).provider("enterprisePolicy",function(){var e={};this.setOverride=function(t){e=t},this.$get=["chromeStorage","$rootScope",function(t,r){var n={},a=!1,o={};angular.extend(o,e);var i=["disableSharing","disableSaveToDisk","options"];return i.forEach(function(e){Object.defineProperty(n,e,{get:function(){return o[e]}})}),n.loadedPromise=t.managed.get(i).then(function(t){angular.extend(o,t,e),a=!0}),n.isLoaded=function(){return a},n.has=function(e){return o.hasOwnProperty(e)},n.get=function(e){return o[e]},t.onChanged.addListener(function(e,t){"managed"===t&&(angular.forEach(e,function(e,t){o[t]=e.newValue}),r.$$phase||r.$digest())}),n}]}),angular.module("castifyExt.crashReporter",["w69b.chromePersistentLogger","w69b.chromeRuntime"]).factory("crashReporter",["castifyConfig","chromeRuntime","$http","chromePersistentLogger",function(e,t,r,n){function a(){return t.getManifest().version}function o(){return n.save().then(function(){return n.getMergedLogs(["popup","background","app"])})}var i=e.API_URL+"/crash",c={};return c.report=function(e,t){o().then(function(n){return r.post(i,{module:e,version:a(),logs:n.join("\n"),core:t})})},c}]),angular.module("castifyExt.helpCenter",["w69b.chromeTabs"]).factory("helpCenter",["chromeTabs",function(e){var t={};return t.tagUrls={},t.registerUrl=function(e,r){t.tagUrls[e]=r},t.hasHelpFor=function(e){return t.tagUrls.hasOwnProperty(e)},t.openHelp=function(r){var n=t.tagUrls[r];if(!n)throw new Error("No help url registered for "+r);e.create({url:n})},t.setNotifyHelp=function(e,r){e.onButtonClicked=e.onClicked=function(){t.openHelp(r),e.clear()}},t}]),angular.module("castifyExt.helpCenterConfig",["castifyExt.helpCenter"]).run(["helpCenter",function(e){e.registerUrl("load_nacl","https://screencastify.uservoice.com/knowledgebase/articles/507908"),e.registerUrl("disk_space","https://screencastify.uservoice.com/knowledgebase/articles/507914"),e.registerUrl("drive_apps","https://screencastify.uservoice.com/knowledgebase/articles/460525"),e.registerUrl("start_recording","https://screencastify.uservoice.com/knowledgebase/articles/448826"),e.registerUrl("change_account","https://screencastify.uservoice.com/knowledgebase/articles/555387"),e.registerUrl("quotaExceeded","https://screencastify.uservoice.com/knowledgebase/articles/870177"),e.registerUrl("youtubeSignupRequired","https://screencastify.uservoice.com/knowledgebase/articles/780183")}]),angular.module("castifyExt.oauthTokenCache",["w69b.chromeStorage"]).factory("oauthTokenCache",["chromeStorage","$q",function(e,t){function r(r){function n(){return e.local.getSingle(r).then(function(e){return e||{}})}function a(e){var t=o();angular.forEach(e,function(r,n){(!n.expiresAt||n.expiresAt<=t)&&delete e[r]})}function o(){return Math.floor(Date.now()-i)+12e4}var i=0,c={};return c.get=function(e){return n().then(function(r){var n=r[e];return n&&n.expiresAt>o()?t.when(n):t.reject()})},c.put=function(t,o){return n().then(function(n){return n[t]=o,o.issuedAt&&(i=Date.now()-Number(o.issuedAt)),a(n),e.local.setSingle(r,n)})},c.removeByToken=function(t){return n().then(function(n){return angular.forEach(n,function(e,r){e.accessToken===t&&delete n[r]}),e.local.setSingle(r,n)})},c.remove=function(t){return n().then(function(n){return delete n[t],e.local.setSingle(r,n)})},c.withCache=function(e,t){return c.get(e)["catch"](function(){return t().then(function(t){return c.put(e,t).then(function(){return t})})})},c}return r}]),angular.module("castifyExt.castifyAuth",["castifyExt.simpleBgServiceConsumer"]).factory("castifyAuth",["simpleBgServiceConsumer",function(e){return e("castifyAuth",["launchWebAuthFlow","getRedirectURL","removeCachedAuthToken","getAuthToken","getChromeAccount"])}]).factory("googleauth",["castifyAuth","$q",function(e,t){var r={};return r.loadClient=function(){return t.when()},r.getAuthToken=function(t){e.getAuthToken(angular.isObject(t)?t:{interactive:!!t})},r}]),angular.module("castifyExt.bgCastifyAuth",["w69b.chromeStorage","w69b.uritool","w69b.es6","w69b.chromeRuntime","w69b.uuid","w69b.promiseTool","castifyExt.oauthTokenCache","w69b.spawn","w69b.chromeNotifications","castifyExt.helpCenter","castifyExt.simpleBgServicePublisher"]).provider("bgCastifyAuth",function(){var e,t=[],r="",n=!1;this.setScopes=function(e){t=e},this.setClientId=function(t){e=t},this.setRedirectUri=function(e){r=e},this.useChromeAccount=function(e){n=e},this.$get=["$q","uritool","$rootElement","$window","chromeRuntime","$interval","castifyConfig","$http","chromeStorage","oauthTokenCache","uuid","promiseTool","$log","$rootScope","spawn","chromeNotifications","helpCenter","simpleBgServicePublisher",function(a,o,i,c,s,u,l,d,f,h,p,g,m,b,y,v,w,k){function S(){c.chrome.tabs.create({url:"chrome://chrome-signin/"},angular.noop)}function E(e){return d.get(N,{params:{access_token:e}})}function T(e){return E(e.accessToken).then(function(){return!0},function(e){return 400!==e.status})}function R(){return $().then(E).then(function(e){return e.data.user_id})}function $(){var e=window.chrome.identity,t=g.wrapChromeError(e.getAuthToken,e);return t({interactive:!1,scopes:X})}function x(t){return t=angular.extend({redirect_uri:r,response_type:"code",client_id:e,access_type:"offline",include_granted_scopes:"true"},t),B+"?"+o.encodeQuery(t)}function C(e){var t=a.defer(),r=function(r){if("oauth2AuthResult"===r.type){var n=r.data,a=o.parseUrl(n),i=o.parseQuery((a.hash||a.query).substring(1));if(!i||i.state!==e)return;i.error?t.reject({error:i.error||"immediate_failed"}):t.resolve(i)}};return s.onMessageExternal.addListener(r),t.promise["finally"](function(){s.onMessageExternal.removeListener(r)}),t}function I(e){
e.expiresAt=Number(new Date(e.expiresAt)),e.issuedAt=Number(new Date(e.issuedAt))}function A(e){return y($traceurRuntime.initGeneratorFunction(function t(){var r,n;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:return t.state=2,d.post(H,{code:e})["catch"](U);case 2:r=t.sent,t.state=4;break;case 4:n=r.data,I(n.token),t.state=8;break;case 8:t.returnValue=n,t.state=-2;break;default:return t.end()}},t,this)}))}function P(e,t){var r=c.open(e),n=!1,a=C(t);a.promise.then(function(){n=!0});var o=u(function(){r.closed&&!n&&(m.debug("castifyAuth: user closed oauth window"),a.reject("auth_window_closed"))},200),i=g.withTimeout(function(){return a.promise},9e4);return i["finally"](function(){u.cancel(o)}),i}function F(t){var r=p(),n={scope:t.scope,response_type:"code",client_id:e,access_type:"offline",state:r},a=[];t.email?n.login_hint=t.email:a.push("select_account"),t.forceConsent&&a.push("consent"),n.prompt=a.join(" ");var o=x(n),i=P(o,r);return i.then(function(e){return e.code})}function _(e){function t(e){return y($traceurRuntime.initGeneratorFunction(function r(){var n,a,o,i,c,s,u,l,d,f,h,p,g,b;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,F(e).then(A);case 2:n=r.sent,r.state=4;break;case 4:a=n.token,r.state=26;break;case 26:o=e.email,o?(i=a.email,c=O(i),s=e.email,u=O(s),l=c!==u):l=o,r.state=17;break;case 17:r.state=l?9:13;break;case 9:d=R(),f=d["catch"],h=f.call(d,V),r.state=10;break;case 10:return r.state=6,h;case 6:p=r.sent,r.state=8;break;case 8:g=a.user_id,b=p!==g,r.state=12;break;case 13:b=l,r.state=12;break;case 12:r.state=b?20:19;break;case 20:m.debug("castifyAuth : signed in as "+a.email+" expected "+e.email),j(e.email),r.state=21;break;case 21:r.returnValue=t(angular.extend({},e,{forceConsent:!0})),r.state=-2;break;case 19:r.returnValue=n,r.state=-2;break;default:return r.end()}},r,this)}))}var r=t(e)["catch"](function(r){return r&&r.data&&"no_refresh_code"===r.data.error?t(angular.extend({},e,{forceConsent:!0})):a.reject(r)});return r}function D(e){return f.sync.getSingle(J,{}).then(function(t){return t[e]})}function L(e,t){var r={};return r[e]=t,f.sync.setSingle(J,r)}function j(e){y($traceurRuntime.initGeneratorFunction(function t(){return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:t.state=q?1:4;break;case 1:return t.state=2,q.clear();case 2:t.maybeThrow(),t.state=4;break;case 4:q=v.simple.create({priority:2,title:"Please sign in as '"+e+"'",message:"Screencastify uses the same account that you use to sign in to Chrome.",buttons:[{title:"Help"}]}),w.setNotifyHelp(q,"change_account"),t.state=-2;break;default:return t.end()}},t,this)}))}function U(e){return m.debug("castifyAuth: handling HTTP error",e),401===e.status?a.reject(Q.NotSignedInError):e.status<=0||e.status>=500&&e.status<=599?a.reject(Q.NetworkError):a.reject(e)}function M(e){return y($traceurRuntime.initGeneratorFunction(function t(){var r,n,o,i;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:return t.state=2,D(e.email);case 2:r=t.sent,t.state=4;break;case 4:t.state=r?6:5;break;case 5:t.returnValue=a.reject(Q.NotSignedInError),t.state=-2;break;case 6:n=null,e.scope&&(n=e.scope.split(" ")),t.state=15;break;case 15:return t.state=9,d.get(H,{headers:{Authorization:r},params:{scopes:n}})["catch"](U)["catch"](function(t){return t===Q.NotSignedInError?L(e.email,null).then(function(){return a.reject(t)}):a.reject(t)});case 9:o=t.sent,t.state=11;break;case 11:i=o.data,I(i.token),t.state=17;break;case 17:t.returnValue=i,t.state=-2;break;default:return t.end()}},t,this)}))}function O(e){return e.toLowerCase().replace(/\./g,"")}function V(){return null}function G(){b.$broadcast("event:signInChanged"),s.sendMessage({type:"event:signInChanged"})}var q,B="https://accounts.google.com/o/oauth2/auth",N="https://www.googleapis.com/oauth2/v1/tokeninfo",H=l.API_URL+"/client_auth",W="castifyAuth:account",z="castifyAuth:cache",J="castifyAuth:clientToken",K=h(z),Y=g.serializer(),Q={},X=["email","https://www.googleapis.com/auth/plus.me"];return Q.NotSignedInError="not_signed_in",Q.NetworkError="network_error",Q.getChromeAccount=function(){var e=c.chrome.identity;return g.wrapChromeError(e.getProfileUserInfo,e)().then(function(e){return e.email?e.email:a.reject()})},Q.getAccount=function(){return f.local.getSingle(W).then(function(e){return e?e:a.reject()})},Q.setAccount=function(e){return f.local.setSingle(W,e)},Q.getAuthToken=function(e){function r(e){return e+":"+u.scope}function o(t){return y($traceurRuntime.initGeneratorFunction(function n(){var a,o,i,c,s,d,f,h,p,g,m,b,y;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:u.email=t,a=r(t),n.state=59;break;case 59:return n.state=2,K.get(a)["catch"](V);case 2:o=n.sent,n.state=4;break;case 4:o?(c=e.validate,s=c):s=o,n.state=17;break;case 17:n.state=s?9:13;break;case 9:d=T(o),n.state=10;break;case 10:return n.state=6,d;case 6:f=n.sent,n.state=8;break;case 8:h=!f,n.state=12;break;case 13:h=s,n.state=12;break;case 12:n.state=h?18:19;break;case 18:o=null,K.remove(a),n.state=19;break;case 19:n.state=o?21:22;break;case 21:n.returnValue={token:o},n.state=-2;break;case 22:n.pushTry(45,null),n.state=48;break;case 48:p=M(u),n.state=29;break;case 29:return n.state=25,p;case 25:g=n.sent,n.state=27;break;case 27:i=g,n.state=31;break;case 31:n.popTry(),n.state=50;break;case 45:n.popTry(),n.maybeUncatchable(),y=n.storedException,n.state=44;break;case 44:n.state=e.interactive?36:42;break;case 36:m=_(u),n.state=37;break;case 37:return n.state=33,m;case 33:b=n.sent,n.state=35;break;case 35:i=b,n.state=39;break;case 39:l=!0,n.state=50;break;case 42:throw y;case 50:return n.state=53,K.put(a,i.token);case 53:n.maybeThrow(),n.state=55;break;case 55:n.returnValue=i,n.state=-2;break;default:return n.end()}},n,this)}))}function i(){return!e.interactive||e.useChromeAccount?a.reject(Q.NotSignedInError):y($traceurRuntime.initGeneratorFunction(function t(){var n,o;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:return t.state=2,_(u);case 2:n=t.sent,t.state=4;break;case 4:l=!0,o=n.token,t.state=12;break;case 12:return t.state=6,a.all([K.put(r(o.email),o),e.useChromeAccount?null:Q.setAccount(o.email)]);case 6:t.maybeThrow(),t.state=8;break;case 8:t.returnValue=n,t.state=-2;break;default:return t.end()}},t,this)}))}function c(){return e.useChromeAccount?Q.getChromeAccount()["catch"](Q.getAccount):"select_account"===e.interactive?a.reject():Q.getAccount()}function s(){var t=y($traceurRuntime.initGeneratorFunction(function r(){var t,n,a,s,u,d,f;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,c()["catch"](V);case 2:t=r.sent,r.state=4;break;case 4:r.state=t?9:21;break;case 9:s=o(t),r.state=10;break;case 10:return r.state=6,s;case 6:u=r.sent,r.state=8;break;case 8:n=u,r.state=12;break;case 21:e.useChromeAccount&&e.interactive&&S(),r.state=22;break;case 22:d=i(),r.state=18;break;case 18:return r.state=14,d;case 14:f=r.sent,r.state=16;break;case 16:n=f,r.state=12;break;case 12:a=n.clientToken,r.state=32;break;case 32:r.state=a?24:27;break;case 24:return r.state=25,L(t||n.token.email,a);case 25:r.maybeThrow(),r.state=27;break;case 27:l&&G(),r.state=34;break;case 34:r.returnValue=n.token.accessToken,r.state=-2;break;default:return r.end()}},r,this)}));return t}e=angular.extend({interactive:!1,scopes:t,useChromeAccount:n},e),e.scopes||(e.scopes=t);var u={scope:e.scopes.join(" ")},l=!1;return Y(s)},Q.removeCachedAuthToken=function(e){return K.removeByToken(e.token)},Q.launchWebAuthFlow=function(e){return e.interactive?P(e.url,e.state):P(e.url,e.state)},Q.getRedirectURL=function(){return a.when(r)},Q.install=function(){k("castifyAuth",Q,["install"]),n&&c.chrome.identity.onSignInChanged.addListener(G)},Q}]}).factory("castifyAuth",["bgCastifyAuth",function(e){return e}]),angular.module("castifyExt.branding",["castifyExt.licensing","w69b.filesHelper","w69b.spawn"]).factory("branding",["licensing","$http","filesHelper","spawn","$log",function(e,t,r,n,a){function o(){return r.getDirByPath(c,{create:!0})}var i="/images/branding.png",c="_branding",s=c+"/_branding.png",u={};return u.getFilename=function(){return n($traceurRuntime.initGeneratorFunction(function c(){var n,u,l,d,f;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:c.pushTry(35,null),c.state=38;break;case 38:c.state=e.shouldForceBranding()?2:1;break;case 1:c.returnValue=null,c.state=-2;break;case 2:return c.state=5,o();case 5:c.maybeThrow(),c.state=7;break;case 7:return c.state=9,r.getFileEntryByPath(s,{create:!0});case 9:n=c.sent,c.state=11;break;case 11:return c.state=13,r.getMetadata(n);case 13:u=c.sent,c.state=15;break;case 15:c.state=u.size?27:16;break;case 16:return c.state=17,r.createWriter(n);case 17:l=c.sent,c.state=19;break;case 19:return c.state=21,t.get(i,{responseType:"blob"});case 21:d=c.sent,c.state=23;break;case 23:return c.state=25,r.writeFile(l,d.data);case 25:c.maybeThrow(),c.state=27;break;case 27:c.returnValue=s,c.state=-2;break;case 30:c.popTry(),c.state=-2;break;case 35:c.popTry(),c.maybeUncatchable(),f=c.storedException,c.state=33;break;case 33:a.error("failed to prepare branding file",f),c.state=34;break;case 34:c.returnValue=null,c.state=-2;break;default:return c.end()}},c,this)}))},u}]),angular.module("castifyExt.simpleBgServicePublisher",["w69b.chromeRuntime"]).factory("simpleBgServicePublisher",["chromeRuntime","$q","$log",function(e,t,r){function n(n,a,o){function i(e,o,i){if(e&&"simpleService"===e.type&&e.service===n&&a.hasOwnProperty(e.fn)&&!s[e.fn]){var c=t.when(a[e.fn].apply(a,e.data));return c.then(function(e){i({data:e})},function(t){r.debug("simpleService("+n+")."+e.fn+" failed : ",t),i({error:t})}),!0}return!1}function c(){e.onMessage.removeListener(i)}var s={};return(o||[]).forEach(function(e){s[e]=!0}),e.onMessage.addListener(i),c}return n}]),angular.module("castifyExt.simpleBgServiceConsumer",["w69b.chromeRuntime"]).factory("simpleBgServiceConsumer",["chromeRuntime","$q",function(e,t){function r(r,n){function a(e){return e.error?t.reject(e.error):e.data}function o(t){return function(){return e.sendMessage({type:"simpleService",fn:t,service:r,data:Array.prototype.concat.apply([],arguments)}).then(a)}}var i={};return n.forEach(function(e){i[e]=o(e)}),i}return r}]),angular.module("castifyExt.simplePortService",["w69b.chromeRuntime"]).factory("simplePortService",["chromeRuntime",function(e){function t(t){function r(e){e.name===t&&(n.add(e),e.onDisconnect.addListener(function(){n["delete"](e)}),e.onMessage.addListener(function(e){a.handlers.hasOwnProperty(e.type)&&a.handlers[e.type](e.data)}))}var n=new Set,a={handlers:{}};return a.postMessage=function(e,t){var r=!0,a=!1,o=void 0;try{for(var i=void 0,c=n[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var s=i.value;s.postMessage({type:e,data:t})}}catch(u){a=!0,o=u}finally{try{r||null==c["return"]||c["return"]()}finally{if(a)throw o}}},a.install=function(){e.onConnect.addListener(r)},a}return t}]),angular.module("castifyExt.connect.connectedApps",["w69b.chromeStorage","w69b.spawn","castifyExt.connect.appRegistry"]).factory("connectedApps",["chromeStorage","spawn","appRegistry","$rootScope",function(e,t,r,n){function a(){return e.sync.getSingle(l,[]).then(function(e){return e.map(function(e){return angular.isObject(e)?e:{id:e,hasShareUrl:!0}})})}function o(t){return e.sync.setSingle(l,t)}function i(){return e.sync.getSingle(d)}function c(t){return e.sync.setSingle(d,t)}function s(e,t){return e.some(function(e){return e.id===t})}var u={},l="connectedAppIds",d="connectedAppRecentId";u.getConnected=function(e){return t($traceurRuntime.initGeneratorFunction(function r(){var t;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,a();case 2:t=r.sent,r.state=4;break;case 4:e&&(t=t.filter(function(t){var r=!0;return angular.forEach(e,function(e,n){r=r&&t[n]===e}),r})),r.state=8;break;case 8:r.returnValue=t.map(function(e){return e.id}),r.state=-2;break;default:return r.end()}},r,this)}))},u.getConnectedAppInfo=t.wrap($traceurRuntime.initGeneratorFunction(function h(){var e,t;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,a();case 2:e=n.sent,n.state=4;break;case 4:return n.state=6,r.getApps(e.map(function(e){return e.id}));case 6:t=n.sent,n.state=8;break;case 8:t=angular.copy(t),t.forEach(function(t){var r=e.find(function(e){return e.id===t.id});angular.extend(t,r)}),n.state=12;break;case 12:n.returnValue=t,n.state=-2;break;default:return n.end()}},h,this)})),u.getConnectedAppInfoForApp=t.wrap($traceurRuntime.initGeneratorFunction(function p(e){var t,r;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:return n.state=2,u.getConnectedAppInfo();case 2:t=n.sent,n.state=4;break;case 4:r=t.find(function(t){return t.id===e}),n.state=11;break;case 11:n.state=r?6:5;break;case 5:n.returnValue=null,n.state=-2;break;case 6:n.returnValue=r,n.state=-2;break;default:return n.end()}},p,this)})),u.isConnected=function(e){return t($traceurRuntime.initGeneratorFunction(function r(){var t;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,a();case 2:t=r.sent,r.state=4;break;case 4:r.returnValue=s(t,e),r.state=-2;break;default:return r.end()}},r,this)}))},u.disconnect=function(e){return t($traceurRuntime.initGeneratorFunction(function r(){var t;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:return r.state=2,a();case 2:t=r.sent,r.state=4;break;case 4:t=t.filter(function(t){return t.id!==e}),r.state=14;break;case 14:return r.state=6,c(null);case 6:r.maybeThrow(),r.state=8;break;case 8:return r.state=10,o(t);case 10:r.maybeThrow(),r.state=12;break;case 12:n.$broadcast("connect:appDisconnected",e),r.state=-2;break;default:return r.end()}},r,this)}))},u.connect=function(e){return t($traceurRuntime.initGeneratorFunction(function i(){var t,u;return $traceurRuntime.createGeneratorInstance(function(i){for(;;)switch(i.state){case 0:return i.state=2,a();case 2:t=i.sent,i.state=4;break;case 4:return i.state=6,r.getAppInfo(e);case 6:u=i.sent,i.state=8;break;case 8:i.state=s(t,e)?12:14;break;case 14:t.push({id:e,hasShareUrl:!!u.shareUrl}),i.state=15;break;case 15:i.state=u.shareUrl?9:12;break;case 9:return i.state=10,c(e);case 10:i.maybeThrow(),i.state=12;break;case 12:return i.state=18,o(t);case 18:i.maybeThrow(),i.state=20;break;case 20:n.$broadcast("connect:appConnected",e,u),i.state=-2;break;default:return i.end()}},i,this)}))};var f=t.wrap($traceurRuntime.initGeneratorFunction(function g(e,t,r){var n,i,c;return $traceurRuntime.createGeneratorInstance(function(s){for(;;)switch(s.state){case 0:return s.state=2,a();case 2:n=s.sent,s.state=4;break;case 4:if(i=n.find(function(t){return t.id===e}),!i)throw new Error("Cannot set user data for non-connected app");c=i[t],null===r||angular.isUndefined(r)?delete i[t]:i[t]=r,s.state=12;break;case 12:return s.state=6,o(n);case 6:s.maybeThrow(),s.state=8;break;case 8:s.returnValue=c,s.state=-2;break;default:return s.end()}},g,this)}));return u.setUserExpiryDate=t.wrap($traceurRuntime.initGeneratorFunction(function m(e,t){var r;return $traceurRuntime.createGeneratorInstance(function(a){for(;;)switch(a.state){case 0:return a.state=2,f(e,"userExpiryDate",t);case 2:r=a.sent,a.state=4;break;case 4:n.$broadcast("connect:userExpiryDateChange",r,t),a.state=-2;break;default:return a.end()}},m,this)})),u.setUserShareUrl=function(e,t){return f(e,"shareUrl",t)},u.clearRecent=function(){return c(null)},u.getRecent=function(){return i()},u}]),angular.module("castifyExt.connect.bgConnectService",["castifyExt.connect.appPermissions","castifyExt.connect.connectedApps","castifyExt.connect.appRecorder","castifyExt.simpleBgServicePublisher","castifyExt.bgSyncManager","w69b.chromeTabs","w69b.chromeWindows","w69b.asyncResponse","w69b.chromeRuntime","w69b.spawn","w69b.uritool","w69b.promiseTool"]).factory("bgConnectService",["connectedApps","appPermissions","$q","chromeTabs","spawn","uritool","simpleBgServicePublisher","chromeRuntime","asyncResponse","$log","chromeWindows","promiseTool","bgSyncManager","appRecorder",function(e,t,r,n,a,o,i,c,s,u,l,d,f,h){function p(e,t){return a($traceurRuntime.initGeneratorFunction(function r(){function a(e){return d.withTimeout(function(){return e.sendWithResponse("shareFiles",t)},S)}var o,i,c,s,f,h,p,g,m,b,y,v,k,E,T;return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:o=!0,i=!1,c=void 0,t.state=51;break;case 51:t.pushTry(35,36),t.state=38;break;case 38:s=void 0,f=w.entries()[Symbol.iterator](),t.state=34;break;case 34:t.state=(o=(s=f.next()).done)?32:30;break;case 19:o=!0,t.state=34;break;case 30:h=s.value,t.state=31;break;case 31:p=h[0],g=h[1],t.state=27;break;case 27:t.state=g.app.id!==e?19:24;break;case 24:m=g.sender,b=void 0,t.state=29;break;case 29:t.pushTry(9,null),t.state=12;break;case 12:v=a(m),t.state=6;break;case 6:return t.state=2,v;case 2:k=t.sent,t.state=4;break;case 4:b=k,t.state=8;break;case 8:t.popTry(),t.state=14;break;case 9:t.popTry(),t.maybeUncatchable(),E=t.storedException,t.state=15;break;case 15:u.debug("connect: shareFiles handler rejected with",E),b=!1,t.state=14;break;case 14:t.state=b?20:19;break;case 20:y=p.sender.tab,u.debug("connect: shareFiles handled directly, focusing",y),n.update(y.id,{active:!0}),l.update(y.windowId,{focused:!0}),t.state=21;break;case 21:t.returnValue=!0,t.state=36,t.finallyFallThrough=-2;break;case 32:t.popTry(),t.state=36,t.finallyFallThrough=40;break;case 35:t.popTry(),t.maybeUncatchable(),T=t.storedException,t.state=41;break;case 41:i=!0,c=T,t.state=36,t.finallyFallThrough=40;break;case 36:t.popTry(),t.state=47;break;case 47:try{o||null==f["return"]||f["return"]()}finally{if(i)throw c}t.state=45;break;case 40:t.returnValue=!1,t.state=-2;break;case 45:t.state=t.finallyFallThrough;break;default:return t.end()}},r,this)}))}function g(e,t,r){var n=!0,a=!1,o=void 0;try{for(var i=void 0,c=w.values()[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var s=i.value;s.app.id===t&&s.sender.send(e,r)}}catch(u){a=!0,o=u}finally{try{n||null==c["return"]||c["return"]()}finally{if(a)throw o}}}function m(e){var t=!0,r=!1,n=void 0;try{for(var a=void 0,o=w.values()[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;if(i.app.id===e)return!0}}catch(c){r=!0,n=c}finally{try{t||null==o["return"]||o["return"]()}finally{if(r)throw n}}return!1}function b(e){return k&&k.appId===e.id}function y(e){"connectFrame"===e.name&&e.onMessage.addListener(function t(r){if("connect"===r.type){var n=r.data,a=s.createSender(function(t){e.postMessage(t)}),o=s.createRespond(e.postMessage.bind(e));e.onMessage.addListener(function(t){if(!a.handleResult(t)&&T.hasOwnProperty(t.type)){var r=T[t.type](n,t.data,e.sender);o(r,t)}}),e.onDisconnect.addListener(function(){var t=w.get(e);t&&b(t.app)&&(u.debug("connect: cancelling start due to port disconnect"),k.cancelPendingStart()),w["delete"](e)}),w.set(e,{app:n,sender:a}),e.onMessage.removeListener(t)}})}var v={},w=new Map,k=null,S=5e3,E="busy";v.share=function(i,c,s){return a($traceurRuntime.initGeneratorFunction(function l(){var a,d,h,g,m,b,y;return $traceurRuntime.createGeneratorInstance(function(l){for(;;)switch(l.state){case 0:return l.state=2,f.requestSyncLocal(c);case 2:l.maybeThrow(),l.state=4;break;case 4:a=t.allowAccess(i,c),l.state=33;break;case 33:l.state=s?10:5;break;case 5:return l.state=6,e.getConnectedAppInfoForApp(i);case 6:d=l.sent,l.state=8;break;case 8:s=d&&d.shareUrl,l.state=15;break;case 15:l.state=s?10:11;break;case 11:u.warn("connect.share() called for app without shareUrl",d),l.state=12;break;case 12:l.returnValue=r.reject("no_share_url"),l.state=-2;break;case 10:return l.state=18,a;case 18:l.maybeThrow(),l.state=20;break;case 20:h=[c],l.state=35;break;case 35:b=p(i,h),l.state=26;break;case 26:return l.state=22,b;case 22:y=l.sent,l.state=24;break;case 24:l.state=y?27:28;break;case 27:l.state=-2;break;case 28:g=JSON.stringify({ids:h}),m=s+"?"+o.encodeQuery({state:g}),l.state=37;break;case 37:l.returnValue=n.create({url:m}),l.state=-2;break;default:return l.end()}},l,this)}))};var T={};return T.startRecording=function(e,t,n){return a($traceurRuntime.initGeneratorFunction(function o(){var a,i,c,s;return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:t=t||{},u.debug("connect: startRecording",e,t),o.state=26;break;case 26:o.state=k&&k.appId!==e.id?1:2;break;case 1:o.returnValue=r.reject(E),o.state=-2;break;case 2:o.state=k?8:12;break;case 8:a=k.cancelPendingStart,i=a.call(k),o.state=9;break;case 9:return o.state=5,i;case 5:c=o.sent,o.state=7;break;case 7:s=!c,o.state=11;break;case 12:s=k,o.state=11;break;case 11:o.state=s?17:16;break;case 17:u.debug("connect: could not cancel pending start"),o.state=18;break;case 18:o.returnValue=r.reject(E),o.state=-2;break;case 16:o.state=k||!m(e.id)?20:21;break;case 20:o.returnValue=r.reject(E),o.state=-2;break;case 21:k=h(e),k.ended.then(function(){g("recordingStateChanged",e.id,"inactive"),k=null}),k.onStateChanged=function(t){g("recordingStateChanged",e.id,t)},k.onTimeChanged=function(t){g("recordingTimeChanged",e.id,t)},t.tabId=n.tab.id,o.state=28;break;case 28:o.returnValue=k.start(t),o.state=-2;break;default:return o.end()}},o,this)}))},T.stopRecording=function(e){return b(e)?k.stop():r.reject(E)},T.pauseRecording=function(e){return b(e)?k.pause():r.reject(E)},T.resumeRecording=function(e){return b(e)?k.resume():r.reject(E)},T.getRecordingState=function(e){return b(e)?k.getState():"inactive"},T.getRecordingTime=function(e){return b(e)?k.getTime():0},v.install=function(){c.onConnect.addListener(y),i("connect",v,["install"])},v}]),angular.module("castifyExt.connect.appRegistry",["w69b.spawn","w69b.chromeStorage"]).factory("appRegistry",["castifyConfig","$http","$q","spawn","chromeStorage",function(e,t,r,n,a){function o(){return a.local.getSingle(p,[])}function i(e){return a.local.setSingle(p,e)}function c(e){return o().then(function(t){return t.filter(function(t){return e.includes(t.id)})})}function s(e,t){var r=Date.now(),n=e.some(function(e){return r>e._fetchTimestamp+g});return!n&&t.length===e.length}function u(e){return e.forEach(function(e){delete e._fetchTimestamp}),e}function l(e,t){return n($traceurRuntime.initGeneratorFunction(function r(){var n;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:e=new Set(e||[]),r.state=10;break;case 10:return r.state=2,o();case 2:n=r.sent,r.state=4;break;case 4:t.forEach(function(t){e.add(t.id)}),n=n.filter(function(t){return!e.has(t.id)}),t.forEach(function(e){e._fetchTimestamp=Date.now()}),n=n.concat(t),r.state=12;break;case 12:return r.state=6,i(n);case 6:r.maybeThrow(),r.state=-2;break;default:return r.end()}},r,this)}))}function d(e){return n($traceurRuntime.initGeneratorFunction(function a(){var n,o,i,d;return $traceurRuntime.createGeneratorInstance(function(a){for(;;)switch(a.state){case 0:a.state=e&&0!==e.length?2:1;break;case 1:a.returnValue=r.when([]),a.state=-2;break;case 2:return a.state=5,c(e);case 5:o=a.sent,a.state=7;break;case 7:a.state=s(o,e)?8:9;break;case 8:a.returnValue=u(o),a.state=-2;break;case 9:a.pushTry(19,null),a.state=22;break;case 22:return a.state=12,t.get(f,{params:{ids:e}});case 12:i=a.sent,a.state=14;break;case 14:n=i.data,a.state=16;break;case 16:a.popTry(),a.state=24;break;case 19:a.popTry(),a.maybeUncatchable(),d=a.storedException,a.state=17;break;case 17:a.returnValue=u(o),a.state=-2;break;case 24:return a.state=27,l(e,n);case 27:a.maybeThrow(),a.state=29;break;case 29:a.returnValue=u(n),a.state=-2;break;default:return a.end()}},a,this)}))}var f=e.API_URL+"/apps",h={},p="appRegistry:cache",g=6e4;return h.getApps=function(e){return d(e)},h.getAppInfo=function(e){return d([e]).then(function(e){return e.length?e[0]:r.reject()})},h}]),angular.module("castifyExt.connect.appPermissions",["w69b.chromeStorage","w69b.spawn"]).factory("appPermissions",["chromeStorage","spawn",function(e,t){function r(e){var t=Date.now();return e.filter(function(e){return e.timeout>=t})}function n(){return e.local.getSingle(o,[]).then(r)}function a(t){return e.local.setSingle(o,t)}var o="appPermissions",i=18e5,c={};return c.hasAccess=function(e,t){return n().then(function(r){return r.some(function(r){return r.appId===e&&r.fileId===t})})},c.allowAccess=function(e,r){return t($traceurRuntime.initGeneratorFunction(function o(){var t;return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:return o.state=2,n();case 2:t=o.sent,o.state=4;break;case 4:t=t.filter(function(t){return t.appId!==e&&t.appId!==r}),t.push({appId:e,fileId:r,timeout:Date.now()+i}),o.state=10;break;case 10:return o.state=6,a(t);case 6:o.maybeThrow(),o.state=-2;break;default:return o.end()}},o,this)}))},c}]),angular.module("castifyExt.connect.appRecorder",["castifyExt.bgRecord","castifyExt.recordTool","w69b.spawn"]).factory("appRecorder",["bgRecordService","recordTool","spawn","$q","$rootScope",function(e,t,r,n,a){function o(o){function i(){u.resolve()}function c(){var e=[];e.push(a.$watch(l.getState,function(e,t){e!==t&&l.onStateChanged&&l.onStateChanged(e)})),e.push(a.$watch(l.getTime,function(e,t){e!==t&&l.onTimeChanged&&l.onTimeChanged(e)})),l.ended.then(function(){e.forEach(function(e){e()})})}function s(a){return r($traceurRuntime.initGeneratorFunction(function i(){var r,c,s,u,l,d;return $traceurRuntime.createGeneratorInstance(function(i){for(;;)switch(i.state){case 0:a=a||{},a.recordConfig=a.recordConfig||{},r=a.recordConfig,angular.isObject(r)||n.reject("invalid recordConfig"),r.audio=r.audio||{},angular.isObject(r.audio)||n.reject("invalid recordConfig.audio"),r.captureSource=r.captureSource||"desktop",i.state=17;break;case 17:i.state=["desktop","screen","tab"].includes(r.captureSource)?2:1;break;case 1:i.returnValue=n.reject("invalid captureSource"),i.state=-2;break;case 2:c=t.canCaptureSystemAudio(),s=a.payload,i.state=19;break;case 19:i.state=a.shareUrl||o.shareUrl?5:4;break;case 4:i.returnValue=n.reject("shareUrl required"),i.state=-2;break;case 5:i.state=a.shareUrl&&!/https?:\/\//.test(a.shareUrl)?7:8;break;case 7:i.returnValue=n.reject("invalid shareUrl"),i.state=-2;break;case 8:return i.state=11,t.getRecordConfig();case 11:u=i.sent,i.state=13;break;case 13:l={},"tab"===r.captureSource&&(c=!0,angular.isObject(r.draw)&&(d=r.draw,l.draw={showToolbox:!!d.showToolbox},[null,"pointer"].includes(d.tool)&&(l.draw.tool=d.tool))),angular.extend(l,{captureSource:r.captureSource,tabId:a.tabId,audio:{mic:!!r.audio.mic,micSourceId:r.audio.micSourceId||u.audio.micSourceId,system:c&&r.audio.system},autoShareApp:{id:o.id},connectMeta:{appId:o.id,shareUrl:a.shareUrl,payload:s}}),i.state=21;break;case 21:i.returnValue=e.start(l),i.state=-2;break;default:return i.end()}},i,this)}))}var u=n.defer(),l={};l.appId=o.id,l.ended=u.promise;var d=null;return l.start=function(e){var t=s(e);d=t["finally"](function(){d=null}),t["catch"](i);var r=a.$on("recorder:stopped",function(){i(),r()});return t},l.pause=function(){return e.pause()},l.resume=function(){return e.resume()},l.stop=function(){return e.stop()},l.getState=function(){return e.getRecorderState().state},l.getTime=function(){return e.getRecorderState().time},l.cancelPendingStart=function(){if(d&&e.cancelPendingStart()){var t=d.then(function(){return!1},function(){return!0});return d=null,t}return n.when(!1)},c(),l}return o}]),angular.module("castifyExt.webrtcRecorder",["w69b.spawn","w69b.filesHelper","w69b.asyncResponse","castifyExt.pausableTimer"]).factory("webrtcRecorder",["$log","filesHelper","spawn","asyncResponse","PausableTriggeringTimer","$rootScope","$q",function(e,t,r,n,a,o,i){function c(){function c(t){return $=$.then(function(){if(t||P>x){var e=new Blob(A);return A.length=0,P=0,k.sendWithResponse("write",e)}})["catch"](function(t){e.error("webrtcRecoder: flushQueue failed",t)})}function h(e){A.push(e),P+=e.size,c()}function p(e){var t=e.data;h(t)}function g(){if(R.state!=v.state){switch(R.state=v.state,v.state){case"paused":F.pause();break;case"recording":F.paused?F.resume():F.start()}E.onStateChanged&&E.onStateChanged(R.state)}}function m(){R.time=F.time,D(),E.onTimeChanged&&E.onTimeChanged(R.time),o.$$phase||o.$apply()}function b(){T.forEach(function(e){v.addEventListener(e,g)})}function y(e,t){v.addEventListener(e,function r(){v.removeEventListener(e,r),t.apply(this,arguments)})}var v,w,k,S,E={},T=["start","stop","pause","resume","error"],R={state:"inactive",time:0},$=Promise.resolve(),x=65536,C=500,I=500,A=[],P=0,F=new a(m,I),_=d,D=r.wrap($traceurRuntime.initGeneratorFunction(function L(){var e,t,r;return $traceurRuntime.createGeneratorInstance(function(n){for(;;)switch(n.state){case 0:n.state=k?5:-2;break;case 5:e=k.sendWithResponse,t=e.call(k,"getFps"),n.state=6;break;case 6:return n.state=2,t;case 2:r=n.sent,n.state=4;break;case 4:R.fps=r,n.state=-2;break;default:return n.end()}},L,this)}));return E.onStateChanged=null,E.onTimeChanged=null,E.start=r.wrap($traceurRuntime.initGeneratorFunction(function j(r,a){return $traceurRuntime.createGeneratorInstance(function(o){for(;;)switch(o.state){case 0:e.debug("webrtcRecorder: onStart",r,a),w=new u,w.addTrack(a.videoTrack),a.audioTrack&&w.addTrack(a.audioTrack);try{v=new s(w,{BitRate:f,mimeType:l,videoBitsPerSecond:f})}catch(c){throw e.error("failed to create MediaRecorder",c),c}o.state=9;break;case 9:o.state=t.isSupported()?1:4;break;case 1:return o.state=2,t.removeByPath(r)["catch"](function(){return null});case 2:o.maybeThrow(),o.state=4;break;case 4:S=new Worker(_),k=n.createSender(function(e){return S.postMessage(e)}),S.addEventListener("message",function(e){return k.handleResult(e.data)}),k.send("init",{path:r,fsType:"PERSISTENT"}),v.addEventListener("dataavailable",p),o.state=11;break;case 11:o.returnValue=i.when(new Promise(function(t){y("start",function(){e.debug("webrtcEncoder: onStart"),t()}),b(),v.start(C)})),o.state=-2;break;default:return o.end()}},j,this)})),E.pause=function(){return v.pause(),g(),i.when()},E.resume=function(){return v.resume(),g(),i.when()},E.getStateObj=function(){return R},E.load=function(){return i.when()},E.stop=r.wrap($traceurRuntime.initGeneratorFunction(function U(){var e,t;return $traceurRuntime.createGeneratorInstance(function(r){for(;;)switch(r.state){case 0:e=new Promise(function(e){y("stop",function(){e()})}),v.stop(),r.state=16;break;case 16:return r.state=2,e;case 2:r.maybeThrow(),r.state=4;break;case 4:F.pause(),r.state=18;break;case 18:return r.state=6,c(!0);case 6:r.maybeThrow(),r.state=8;break;case 8:return r.state=10,k.sendWithResponse("end");case 10:t=r.sent,r.state=12;break;case 12:S.terminate(),S=null,k=null,F.reset(),r.state=20;break;case 20:r.returnValue=t,r.state=-2;break;default:return r.end()}},U,this)})),E}var s=window.MediaRecorder,u=window.webkitMediaStream||window.MediaStream,l='video/webm; codecs="vp9, opus"',d="/components/castifyMediawriter/dist/mediawriter.worker.min.js",f=497664e3;return c.isSupported=function(){function e(){var e=navigator.userAgent,t=e.match(/Firefox\/(\d+)/);return t&&t[1]>=44&&e.indexOf("Android")<0}function t(){var e=/Chrome\/(\d+)/.exec(window.navigator.userAgent);return e&&e[1]<51}return"undefined"!=typeof s&&(s.isTypeSupported&&s.isTypeSupported(l)||e())&&!t()},c}]),function(){var e=function(){function e(){this.reset()}return $traceurRuntime.createClass(e,{get time(){return this.started?this.paused?this._pausedAtTimestamp-this._firstTimestamp+this._offset:this._now()-this._firstTimestamp+this._offset:0},get started(){return this._firstTimestamp>=0},get paused(){return this._pausedAtTimestamp>=0},_now:function(){return Date.now()/1e3},start:function(){this.reset(),this._firstTimestamp=this._now()},reset:function(){
this._firstTimestamp=-1,this._pausedAtTimestamp=-1,this._offset=0},pause:function(){this.paused||(this._pausedAtTimestamp=this._now())},resume:function(){if(!this.paused)throw new Error;this._offset-=this._now()-this._pausedAtTimestamp,this._pausedAtTimestamp=-1}},{})}(),t=function(e){function t(e,r){$traceurRuntime.superConstructor(t).call(this),this._interval=r,this._listener=e}return $traceurRuntime.createClass(t,{_fireChange:function(){this._listener&&this._listener(this.time)},_startInterval:function(){this._listener&&this._interval&&(this._intervalId=setInterval(this._fireChange.bind(this),this._interval))},_stopInterval:function(){this._intervalId&&clearInterval(this._intervalId),this._intervalId=0,this._fireChange()},reset:function(){$traceurRuntime.superGet(this,t.prototype,"reset").call(this),this._stopInterval()},start:function(){$traceurRuntime.superGet(this,t.prototype,"start").call(this),this._startInterval()},pause:function(){$traceurRuntime.superGet(this,t.prototype,"pause").call(this),this._stopInterval()},resume:function(){$traceurRuntime.superGet(this,t.prototype,"resume").call(this),this._startInterval()}},{},e)}(e);angular.module("castifyExt.pausableTimer",[]).value("PausableTimer",e).value("PausableTriggeringTimer",t)}(),angular.module("castifyExt.optionalPermissions",["w69b.chromePermissions"]).factory("optionalPermissions",["chromePermissions",function(e){function t(e){return e&&(!e.draw||e.draw&&!e.draw.showToolbox&&null===e.draw.tool)?a:n}var r={},n={permissions:["tabCapture","webNavigation","activeTab"],origins:["<all_urls>"]},a={permissions:["tabCapture","webNavigation","activeTab"],origins:[]};return r.hasLiteTabPermissions=function(){return e.contains(a)},r.hasTabPermissions=function(r){return e.contains(t(r))},r.requestTabPermissions=function(r){return e.request(t(r))},r}]),angular.module("castifyExt.hdpiTool",[]).factory("hdpiTool",["$window",function(e){var t={};return t.devicePixelRatio=e.devicePixelRatio,t.toPhysicalResolution=function(e){return{width:Math.floor(e.width*t.devicePixelRatio),height:Math.floor(e.height*t.devicePixelRatio)}},t.toCssResolution=function(e){return{width:Math.round(e.width/t.devicePixelRatio),height:Math.round(e.height/t.devicePixelRatio)}},t.getScreenCssResolution=function(){return{width:e.screen.width,height:e.screen.height}},t}]),angular.module("castifyEdit.pnaclVideoEditor",["w69b.pnaclModule","w69b.promiseTool"]).factory("pnaclVideoEditor",["pnaclModule","$q","$log","$rootScope","promiseTool",function(e,t,r,n,a){function o(o,i){function c(){b={state:"inactive",time:0}}function s(){y.unload(),c()}function u(e){b=e,"done"!==e.state&&"cancelled"!==e.state||y.unload()}function l(e){s(),v&&v.reject(e),v=null}function d(e){r.error("pnaclVideoEditorError",e),l(e),S.onError&&S.onError(e)}function f(e,t){y.postMessage({type:e,data:t||{}})}function h(e,r){if(v)throw new Error("there is still a pending operation");return v=t.defer(),e&&f(e,r),v.promise}function p(e){if(!/^\/html5_(temporary|persistent)\//.test(e))throw new Error("invalid filename")}function g(e){l(),S.onCrash&&S.onCrash(e)}function m(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])}var b,y=e(o,i),v=null,w=8e5,k=["start","cancel"],S={};return y.onMessage=function(e){if(e=e.data,k.indexOf(e.type)>=0){if(!v)return;e.data?v.reject(e.data):v.resolve(),v=null}else if("error"==e.type)d(e.data),n.$$phase||n.$digest();else if("state"==e.type)u(e.data),n.$$phase||n.$digest();else if("stack_trace"==e.type)g(e.data);else{var t;e.data&&(t=e.data,t.trim&&(t=t.trim())),r.debug(e.type,t)}},S.onCrash=void 0,y.onCrash=g,S.load=function(){return y.load()},S.getStateObj=function(){return b},S.cancel=function(){return a.withTimeout(function(){return h("cancel")},1e3)["catch"](function(){return null}).then(function(){l()})},S.hasPendingOperation=function(){return!!v},S.start=function(e){return p(e.inFilename),p(e.outFilename),a.withTimeout(function(){return y.load().then(function(){return h("start",{config:JSON.stringify(e),chromeVersion:m()})})},w,function(){return d("start_timeout"),t.reject("start_timeout")})},c(),S}return o}]),angular.module("castifyEdit.localEditJob",["castifyEdit.pnaclVideoEditor","w69b.filesHelper"]).factory("startLocalEditJob",["pnaclVideoEditor","$q","$log","$rootScope",function(e,t,r,n){function a(o){function i(){l=n.$watch(function(){return u.getStateObj().state},function(e){"done"===e?s.resolve():"error"===e&&s.resolve(u.getStateObj().errorReason)})}function c(){return u=e(a.NACL_URL),s=t.defer(),u.start(o).then(i,function(e){r.error("failed to start local edit job",e),s.reject("start_error")}),u.onCrash=function(e){r.error("startLocalEditJob crashed",e),s.reject("crash")},u.onError=function(e){r.error("localEditJob error: ",e),s.reject(e)},s.promise["finally"](l),s.promise}var s,u,l=angular.noop,d={};return d.getProgress=function(){var e=u.getStateObj();return e.totalMs&&e.progressMs?e.progressMs/e.totalMs:0},d.cancel=function(){return u.cancel()},d.promise=c(),d}return a}]),angular.module("castifyEdit.remoteEditJob",["castifyEdit.pnaclVideoEditor"]).factory("startRemoteEditJob",["$q","$log","$timeout","$http","castifyConfig",function(e,t,r,n,a){function o(a){function o(){g&&r.cancel(g),r(function(){g=null,d()},c)}function s(){return n.get(i+"/"+p,{googleAuth:!0}).then(function(e){return e.data})}function u(e){h.reject(e)}function l(e){var t;t="gif"===a.outFormat?{url:i+"/export/"+e.id+"/"+e.result.gcsFile}:e.result,h.resolve(t)}function d(){s().then(function(e){var r=e.state;"completed"===r?l(e):"failed"===r?u(e.result&&e.result.error?e.result.error:"remote_failed"):"cancelled"===r?t.debug("remote edit job was cancelled",p):(m=e.progress,o())},function(e){e.status>=400&&e.status<500?u(e):o()})}function f(){return h=e.defer(),n.post(i,{config:a,version:2},{googleAuth:!0}).then(function(e){var r=e.data;t.debug("startRemoteEditJob: job created",r.id),p=r.id,o()},u),h.promise}var h,p,g,m=0,b={};return b.getProgress=function(){return m},b.cancel=function(){return p?n["delete"](i+"/"+p,{googleAuth:!0}):e.reject()},b.promise=f(),b}var i=a.API_URL+"/edit",c=3e3;return o}]),angular.module("castifyEdit.bgEditJobScheduler",["castifyEdit.startEditJob","castifyEdit.fixWebmJob","castifyExt.bgFiles","castifyExt.simplePortService"]).factory("ScheduledEditJob",["startEditJob","bgFiles","startFixWebmJob","$q",function(e,t,r,n){function a(e){this.config=e,this.state="queued",this.id=o++,this._doneDeferred=n.defer(),this.promise=this._doneDeferred.promise,e.meta&&e.meta.fileId&&t.getFileDescriptor(e.meta.fileId).then(function(e){this.fileDesc=e}.bind(this))}var o=1,i=a.prototype;return i.start=function(){var t=this;t.state="running";var n="fixWebm"===this.config.type?r:e,a=n(t.config);return a=a.then(function(e){return t.editJob=e,e.promise}),a.then(t.onComplete_.bind(t),t.onError_.bind(t)),a.then(this._doneDeferred.resolve.bind(this._doneDeferred),this._doneDeferred.reject.bind(this._doneDeferred)),a},i.getProgress=function(){return"done"===this.state?1:"running"===this.state&&this.editJob?this.editJob.getProgress():0},i.onComplete_=function(e){this.result=e,this.state="done"},i.onError_=function(){this.state="error"},i.cancel=function(){return this.editJob&&this.editJob.cancel?(this.editJob.cancel(),this.state="cancelled",!0):!1},i.toJSON=function(){var e={id:this.id,result:this.result,state:this.state,progress:this.getProgress()};return e.cancelable=!(!this.editJob||!this.cancel),this.config.meta&&this.config.meta.fileId&&(e.fileId=this.config.meta.fileId),this.fileDesc&&(e.fileTitle=this.fileDesc.title),e},a}]).factory("bgEditJobScheduler",["simplePortService","$rootScope","ScheduledEditJob","$log","chromeRuntime",function(e,t,r,n,a){function o(e){return g.filter(function(t){return t.state===e})}function i(e){return g.find(function(t){return t.id===e})}function c(){return o("running")}function s(){return o("queued")}function u(){if(!(c().length>0)){var e=o("queued");if(e.length){var r=e[0],n=r.start();t.$broadcast("editJob:started",r.id),n.then(d.bind(null,r),l.bind(null,r))}}}function l(e,r){n.warn("scheduled edit job failed",e,r),u(),t.$broadcast("editJob:failed",e.id,r)}function d(e,r){n.debug("scheduled edit job completed",e,r),u(),t.$broadcast("editJob:completed",e.id,r)}function f(){function r(){o.postMessage("jobsList",p.getJobs())}function n(){p.clearComplete(),r()}function a(){t.$on("editJob:completed",r),t.$on("editJob:started",r),t.$on("editJob:failed",r),t.$on("editJob:cancelled",r),o.install()}var o=e("editor");o.handlers={addJob:p.addJob,cancel:p.cancel,getJobs:r,clearComplete:n},a()}function h(){(s().length||c().length)&&(n.info("onSuspend() while editing is active, preventing unloading"),a.getBackgroundPage())}var p={},g=[];return p.addJob=function(e){var t=new r(e);return g.push(t),u(),t},p.cancel=function(e){n.debug("trying to cancel edit job",e);var r=i(e);r&&r.cancel()&&t.$broadcast("editJob:cancelled",r.id)},p.getJob=function(e){return i(e)},p.getJobs=function(){return g},p.clearComplete=function(){g=g.filter(function(e){return"done"!==e.state})},p.install=function(){f(),a.onSuspend.addListener(h)},p}]),angular.module("castifyEdit.startEditJob",["castifyEdit.localEditJob","castifyEdit.remoteEditJob","castifyExt.bgFiles","castifyExt.videoPreviewRenderer","castifyExt.fileNameGenerator","w69b.filesHelper","w69b.spawn"]).factory("startEditJob",["startLocalEditJob","startRemoteEditJob","bgFiles","filesHelper","videoPreviewRenderer","$log","fileNameGenerator","$q","spawn",function(e,t,r,n,a,o,i,c,s){function u(u){function g(){return n.getDirByPath(d,{create:!0})}function m(){var t="gif"===u.outFormat?h:f;return g().then(function(){var n=angular.extend({inFilename:l+r.idToLocalFilename(I.id),outFilename:l+t},u);return delete n.meta,e(n)})}function b(){return o.debug("running local post edit steps"),"gif"===u.outFormat?y():v()}function y(){return o.info("gif export complete"),n.getFileEntryByPath(h).then(function(e){return{url:e.toURL()}})}function v(){var e;return i("",".webm").then(function(t){return e=r.localFilenameToId(t),n.moveFileByPath(f,t)["catch"](function(e){return o.error("failed to move edited file to ",t),c.reject(e)})}).then(function(){return o.debug("rendering preview"),a.renderPreview(e)["catch"](function(){return o.info("rendering preview image for edit failed"),null})}).then(function(){return r.registerLocalFile(e)}).then(function(){var t=I.title;return u.meta.copy&&(t+=p),r.rename(e,t),{fileId:e}})}function w(e){return o.debug("running local post edit steps"),c.reject(e)}function k(){n.removeByPath(f),n.removeByPath(h)}function S(){var e=angular.extend({},u,{meta:angular.extend(u.meta,{driveId:I.driveInfo.id})});return t(e)}function E(e){return o.debug("running drive post edit steps for",e),r.refresh(e.id),e.id}function T(e){return e}function R(e){return o.debug("remote edit job completed"),"gif"===u.outFormat?T(e):E(e)}function $(e){return c.reject(e)}function x(e){return s($traceurRuntime.initGeneratorFunction(function t(){return $traceurRuntime.createGeneratorInstance(function(t){for(;;)switch(t.state){case 0:t.state=u.meta.copy||"gif"===u.outFormat?4:1;break;case 1:return t.state=2,r.remove(I.id)["catch"](angular.noop);case 2:t.maybeThrow(),t.state=4;break;case 4:t.returnValue=e,t.state=-2;break;default:return t.end()}},t,this)}))}function C(){return s($traceurRuntime.initGeneratorFunction(function e(){var t,n,a,o,i,c;return $traceurRuntime.createGeneratorInstance(function(e){for(;;)switch(e.state){case 0:return e.state=2,r.getFileDescriptor(u.meta.fileId);case 2:t=e.sent,e.state=4;break;case 4:I=t,e.state=21;break;case 21:e.state=t.isSynced?15:9;break;case 15:n=S(),a=n.promise.then(R,$),e.state=16;break;case 9:i=m(t),e.state=10;break;case 10:return e.state=6,i;case 6:c=e.sent,e.state=8;break;case 8:n=c,e.state=12;break;case 12:a=n.promise.then(b,w),o=n.cancel.bind(n),n.cancel=function(){return o().then(k)},e.state=16;break;case 16:a=a.then(x),n.promise=a,e.state=23;break;case 23:e.returnValue=n,e.state=-2;break;default:return e.end()}},e,this)}))}var I;return C()}e.NACL_URL="manifest_editor.nmf";var l="/html5_persistent/",d="_tmp",f=d+"/edited.webm",h=d+"/exported.gif",p=" - Edited";return u}]),angular.module("castifyEdit.editNotifications",["castifyEdit.bgEditJobScheduler","w69b.chromeNotifications","castifyExt.ui.openInAppTab","castifyExt.appOptions","w69b.promiseTool"]).factory("editNotifications",["$rootScope","$log","chromeNotifications","$q","openInAppTab","appOptions","chromeTabs","promiseTool","$interval","bgEditJobScheduler",function(e,t,r,n,a,o,i,c,s,u){function l(e){function t(t,a){d(function(){var o,i=y+e+":"+t,c=!l;return l&&l!==i?(o=r.clear(l),c=!0):o=n.when(),a=angular.extend({type:"basic",priority:0,eventTime:Date.now(),isClickable:!1,title:"Processing Video",iconUrl:"images/icon128.png"},a),l=i,c?o.then(function(){return r.create(i,a)}):o.then(function(){return r.update(i,a)})})}function a(){t("progress",{type:"progress",message:"We are currently processing your video.",progress:Math.floor(100*h.getProgress())})}var i,l=null,d=c.serializer(),f={},h=u.getJob(e);return f.hide=function(){s.cancel(i),d(function(){if(l){var e=r.clear(l);return l=null,e}})},f.start=function(){o.values.notifyEditProgress&&(a(),i=s(a,1e3))},f.complete=function(e){o.values.notifyEditProgress&&(s.cancel(i),e.fileId?t("complete:"+e.fileId,{type:"basic",title:"Processing Complete",message:"Your video is ready",buttons:[{title:"Show File"}]}):f.hide())},f.failure=function(){s.cancel(i),t("failed",{type:"basic",title:"Failed to process Video",message:"Please contact support if this problem persists"})},f}function d(e){var t=v[e];return t||(t=l(e),v[e]=t),t}function f(e,t){d(t).start()}function h(e,t,r){d(t).failure(r),delete v[t]}function p(e,t,r){d(t).complete(r),delete v[t]}function g(e,t){d(t).hide(),delete v[t]}function m(e,t){function n(r,n){if(e.startsWith(y)){var a=e.split(":").slice(2,3)[0];return a===r&&t===(n||0)}return!1}if(n("complete")){var o=e.split(":").slice(-1)[0];a("app.html#/files/"+encodeURIComponent(o)),r.clear(e)}}var b={},y="edit:",v={};return b.install=function(){e.$on("editJob:started",f),e.$on("editJob:failed",h),e.$on("editJob:completed",p),e.$on("editJob:cancelled",g),r.onButtonClicked.addListener(m)},b}]),angular.module("castifyEdit.fixWebmJob",["w69b.asyncResponse","w69b.spawn","w69b.filesHelper"]).factory("startFixWebmJob",["asyncResponse","spawn","filesHelper",function(e,t,r){function n(){return r.getDirByPath(i,{create:!0})}function a(e){this.config=e,this.progress=0}var o="/components/castifyMediawriter/dist/mediawriter.worker.min.js",i="_tmp",c=i+"/edited.webm",s=a.prototype;return s.start=function(){return this.promise=this._doStart(),this.promise},s._doStart=t.wrap($traceurRuntime.initGeneratorFunction(function u(){var t,a,i;return $traceurRuntime.createGeneratorInstance(function(s){for(;;)switch(s.state){case 0:t=this.config,a=new Worker(o),s.state=20;break;case 20:return s.state=2,n();case 2:s.maybeThrow(),s.state=4;break;case 4:i=e.createSender(function(e){return a.postMessage(e)}),a.addEventListener("message",function(e){var t=e.data;i.handleResult(t)||"progress"===t.type&&(this.progress=t.data)}.bind(this)),i.send("init",{path:c,fsType:"PERSISTENT"}),s.state=22;break;case 22:return s.state=6,i.sendWithResponse("readChromeFile",{path:t.inPath,fsType:"PERSISTENT"});case 6:s.maybeThrow(),s.state=8;break;case 8:a.terminate(),s.state=24;break;case 24:return s.state=10,r.moveFileByPath(c,t.outPath);case 10:s.maybeThrow(),s.state=12;break;case 12:return s.state=14,r.removeByPath(t.inPath);case 14:s.maybeThrow(),s.state=16;break;case 16:s.returnValue={fileId:this.config.fileId},s.state=-2;break;default:return s.end()}},u,this)})),s.getProgress=function(){return this.progress},function(e){var t=new a(e);return t.start(),Promise.resolve(t)}}]),angular.module("w69b.chromeAnalytics",[]).provider("analytics",function(){var e,t;this.setTrackingId=function(t){e=t},this.setApp=function(e,r){t=arguments},this.$get=["$window",function(r){if(!t)throw new Error("make sure to call analyticsProvider.setApp()");if(!r.analytics)throw new Error("chrome-analytics lib not loaded");var n=r.analytics,a=n.getService.apply(n,t),o=a.getTracker(e),i={};return i.tracker=o,i.eventBuilder=function(){return n.EventBuilder.builder()},i.setEnabled=function(e){a.getConfig().addCallback(function(t){t.setTrackingPermitted(e)})},i.send=function(){o.send.apply(o,arguments)},i.trackPageView=function(e){o.sendAppView(e)},i.trackEvent=function(){o.sendEvent.apply(o,arguments)},i.trackTimer=function(e,t,r){var n,a={};return a.start=function(){return n=(new Date).getTime(),a},a.send=function(i,c,s){var u=(new Date).getTime();return o.sendTiming(i||e,c||t,u-n,s||r),a},a.start(),a},i}]}),angular.module("w69b.chromeCapture",["w69b.promiseTool","w69b.webrtc"]).factory("chromeCapture",["promiseTool","webrtc","$q",function(e,t,r){var n={};return n.tabCapture=function(){return chrome.tabCapture?e.wrapChromeError(chrome.tabCapture.capture,chrome.tabCapture).apply(null,arguments):r.reject("tabCapture permission missing")},chrome.desktopCapture&&(n.chooseDesktopMedia=function(){function t(e){chrome.desktopCapture.cancelChooseDesktopMedia(o),a.reject(e||"cancelled")}e.wrapChromeError(chrome.desktopCapture.chooseDesktopMedia,chrome.desktopCapture);var n=Array.prototype.slice.call(arguments,0),a=r.defer();n.push(function(e){chrome.runtime.lastError?a.reject(chrome.runtime.lastError):a.resolve(e)});var o=chrome.desktopCapture.chooseDesktopMedia.apply(chrome.desktopCapture,n);return{promise:a.promise,cancel:t}}),n.desktopCapture=function(e){var r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920,maxHeight:1200}}};return t.getUserMedia(r)},n}]),angular.module("w69b.chromeCommands",["w69b.promiseTool"]).factory("chromeCommands",["promiseTool",function(e){var t={};return t.getAll=e.wrapChromeError(chrome.commands.getAll,chrome.commands),t.onCommand=chrome.commands.onCommand,t}]),angular.module("w69b.chromePersistentLogger",["w69b.chromeStorage","w69b.logging","w69b.structs.CircularBuffer"]).provider("chromePersistentLogger",["$logProvider",function(e){function t(e,t){var n={level:e,args:t,timestamp:(new Date).getTime()};return r?r.add(n):a.push(n),!0}var r,n="logs",a=[],o=!1,i=1e3,c="logs_",s=!1,u=!0;this.setStorageKey=function(e){n=e},this.setMaxNumLogs=function(e){i=e},this.enableAutoLoad=function(e){o=e},this.enableAutoSave=function(e){u=e},this.enableGlobalHandler=function(e){s=e},this.install=function(){this.enableAutoLoad(!0),e.setCustomHook(t)},this.$get=["$window","$q","chromeStorage","CircularBuffer","$log",function(e,l,d,f,h){function p(e){var t=e.args.map(function(e){if(!angular.isObject(e))return e;try{return angular.toJson(e)}catch(t){return e}});return[new Date(e.timestamp).toISOString(),e.level.toUpperCase(),t.join(", ")].join(" ")}function g(e){var t=new f(i);return e.forEach(function(e){t.add(e)}),t}var m={};return m.load=function(){return d.local.getSingle(c+n).then(function(e){e&&e.length&&(r=g(e.concat(m.getEntries())))})},m.save=function(e){return d.local.setSingle(c+(e||n),m.getEntries())},m.clear=function(){r.clear()},m.getEntries=function(){return r.getValues()},m.getLogs=function(){return m.getEntries().map(p)},m.getMergedLogs=function(e){return e=e.map(function(e){return c+e}),d.local.get(e).then(function(e){var t=[];return angular.forEach(e,function(e,r){e&&e.length&&e.forEach(function(e){e.storageKey=r.substr(c.length),t.push(e)})}),t.sort(function(e,t){return e.timestamp-t.timestamp}),t.map(function(e){return"["+e.storageKey+"] "+p(e)})})},m.hookFn=t,r=g(a),a=null,o&&m.load(),s&&(e.onerror=function(e,t,r){h.error("global error",e,t,r)}),u&&e.addEventListener("unload",function(){m.save()}),m}]}]).run(["chromePersistentLogger",angular.noop]),angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(e){var t={};return t.sendMessage=e.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),t.getBackgroundPage=e.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),t.connect=chrome.runtime.connect.bind(chrome.runtime),t.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),t.id=chrome.runtime.id,chrome.runtime.getPlatformInfo&&(t.getPlatformInfo=e.wrapChromeError(chrome.runtime.getPlatformInfo,chrome.runtime)),["onMessage","onMessageExternal","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach(function(e){t[e]={addListener:function(t){chrome.runtime[e].addListener(t)},removeListener:function(t){chrome.runtime[e].removeListener(t)}}}),t}]),angular.module("w69b.chromeStorage",["w69b.promiseTool"]).factory("chromeStorage",["promiseTool",function(e){var t=chrome.storage,r={};return["local","sync","managed"].forEach(function(n){r[n]={},["set","get","remove","clear"].forEach(function(a){r[n][a]=e.wrapChromeError(t[n][a],t[n])}),r[n].setSingle=function(e,t){var a={};return a[e]=t,r[n].set(a)},r[n].getSingle=function(e,t){return r[n].get(e).then(function(r){return r.hasOwnProperty(e)?r[e]:t})}}),r.onChanged=t.onChanged,r}]),angular.module("w69b.chromeTabs",["w69b.promiseTool"]).factory("chromeTabs",["$window","promiseTool","$q",function(e,t,r){if(!e.chrome||!e.chrome.tabs)return null;var n=e.chrome,a={};return a.query=t.wrapChromeError(n.tabs.query,n.tabs),a.getActiveTab=function(){return a.query({active:!0,windowId:n.windows.WINDOW_ID_CURRENT}).then(function(e){return e.length?e[0]:r.reject()})},a.get=t.wrapChromeError(n.tabs.get,n.tabs),a.update=t.wrapChromeError(n.tabs.update,n.tabs),a.remove=t.wrapChromeError(n.tabs.remove,n.tabs),a.create=t.wrapChromeError(n.tabs.create,n.tabs),a.connect=n.tabs.connect.bind(n.tabs),a.setZoomSettings=t.wrapChromeError(n.tabs.setZoomSettings,n.tabs),a.setZoom=t.wrapChromeError(n.tabs.setZoom,n.tabs),a.executeScript=t.wrapChromeError(n.tabs.executeScript,n.tabs),a.insertCSS=t.wrapChromeError(n.tabs.insertCSS,n.tabs),a.sendMessage=t.wrapChromeError(n.tabs.sendMessage,n.tabs),a.onUpdated=n.tabs.onUpdated,a.onActivated=n.tabs.onActivated,a.sendMessageActive=function(e,t){return a.getActiveTab().then(function(r){return a.sendMessage(r.id,e,t)})},a}]).directive("newTab",["chromeTabs",function(e){return{restrict:"A",link:function(t,r,n){r.bind("click",function(t){t.preventDefault(),e.create({url:n.href}).then(function(e){chrome.windows.update(e.windowId,{focused:!0},angular.noop)})})}}}]),angular.module("w69b.chromeWindows",[]).factory("chromeWindows",["promiseTool",function(e){var t={};return t.get=e.wrapChromeError(chrome.windows.get,chrome.windows),t.create=e.wrapChromeError(chrome.windows.create,chrome.windows),t.update=e.wrapChromeError(chrome.windows.update,chrome.windows),t.getCurrent=e.wrapChromeError(chrome.windows.getCurrent,chrome.windows),t.remove=e.wrapChromeError(chrome.windows.remove,chrome.windows),t.onRemoved=chrome.windows.onRemoved,t}]),angular.module("w69b.filesHelper",["w69b.promiseTool"]).factory("filesHelper",["$window","promiseTool","$q",function(e,t,r){function n(e){var t=e.split("/"),r=t.slice(0,-1).join("/"),n=t.slice(-1)[0];return[r,n]}e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem;var a=window.PERSISTENT,o=104857600,i={},c=["readEntries","remove","getFile","getMetadata","moveTo","file","getDirectory","createWriter"];return c.forEach(function(e){i[e]=function(r){var n=[].slice.call(arguments,1);return t.wrapCallbacks(r[e],r).apply(null,n)}}),i.getFileSystem=function(r,n){return angular.isUndefined(r)&&(r=a),n=n||o,t.wrapCallbacks(e.requestFileSystem,e)(r,n)},i.getPersistentQuota=function(){var t=r.defer();return e.navigator.webkitPersistentStorage.queryUsageAndQuota(function(e,r){t.resolve({usage:e,quota:r})},function(e){t.reject(e)}),t.promise},chrome.system&&chrome.system.storage&&(i.getStorageInfo=t.wrapChromeError(chrome.system.storage.getInfo,chrome.system.storage)),i.getDirByPath=function(e,t){function n(e,a){return a.length?i.getDirectory(e,a[0],t||{}).then(function(e){return n(e,a.slice(1))}):r.when(e)}var a=e.split("/");return""===a[0]&&a.splice(0,1),i.getFileSystem().then(function(e){return n(e.root,a,t)})},i.moveFileByPath=function(e,t){var a=n(t),o=a[0],c=a[1];return r.all({file:i.getFileEntryByPath(e),targetDir:i.getDirByPath(o)}).then(function(e){return i.moveTo(e.file,e.targetDir,c)})},i.getFileEntryByPath=function(e,t,r){var a=n(e),o=a[0],c=a[1];return i.getDirByPath(o,r).then(function(e){return i.getFile(e,c,t||{})})},i.getFileByPath=function(e){return i.getFileEntryByPath(e).then(function(e){return i.file(e)})},i.removeByPath=function(e){return i.getFileEntryByPath(e).then(function(e){return i.remove(e)})},i.listByPath=function(e){return i.getDirByPath(e).then(function(e){var t=e.createReader();return i.readEntries(t)})},i.requestPersistentQuota=function(e){return t.wrapCallbacks(navigator.webkitPersistentStorage.requestQuota,navigator.webkitPersistentStorage)(e||o)},i.requestTemporaryQuota=function(e){return t.wrapCallbacks(navigator.webkitTemporaryStorage.requestQuota,navigator.webkitTemporaryStorage)(e||o)},i.writeFile=function(e,t){var n=r.defer();return e.onwriteend=n.resolve.bind(n),e.onerror=n.reject.bind(n),e.write(t),n.promise},i.isSupported=function(){return!!window.requestFileSystem},i}]),angular.module("w69b.googleHttpAuthInterceptor",[]).provider("googleHttpAuthInterceptor",function(){var e=0,t="googleauth";this.enableAuthAutoRetry=function(t){e=t?1:0},this.setAuthProvider=function(e){t=e},this.$get=["$q","$log","$injector",function(r,n,a){function o(){return d||(d=a.get(t)),d}function i(e){return o().getAuthToken(e)}function c(e){return{Authorization:"Bearer "+e}}function s(){return l||(l=a.get("$http")),l}function u(t){var a=t.status;if(401==a&&t.config.googleAuth&&t.config.authAutoRetry!==!1){n.debug("auth error detected",t);var o=angular.copy(t.config);if(o.authRetryCount?o.authRetryCount++:o.authRetryCount=1,o.authRetryCount<=e)return i({scopes:o.googleAuthScopes,validate:!0}).then(function(){return n.debug("googleAuthHttpInterceptor: auto-retrying with validated token"),s()(o)})}return r.reject(t)}var l,d;return{request:function(e){return e.googleAuth?i({scopes:e.googleAuthScopes}).then(function(t){return e.headers=angular.extend(e.headers||{},c(t)),e},function(e){return n.warn("googleAuthHttpInterceptor: no token, aborting request",e),r.reject("googleAuthFailed")}):e},responseError:u}}]}),angular.module("w69b.uuid",[]).factory("uuid",["$window",function(e){function t(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}function r(){var r=new Uint16Array(8);return e.crypto.getRandomValues(r),t(r[0])+t(r[1])+"-"+t(r[2])+"-4"+t(r[3]).substring(1)+"-y"+t(r[4]).substring(1)+"-"+t(r[5])+t(r[6])+t(r[7])}return r}]),angular.module("w69b.uritool",[]).factory("uritool",function(){function e(e){return decodeURIComponent(e.replace(t," "))}var t=/\+/g,r={};return r.parseQuery=function(t,r){"?"==t[0]&&(t=t.substring(1));for(var n,a=/([^&=]+)=?([^&]*)/g,o={};n=a.exec(t);){var i=e(n[1]),c=e(n[2]);r&&o.hasOwnProperty(i)?o[i].push(c):o[i]=r?[c]:c}return o},r.parseUrl=function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,hash:t.hash,path:t.pathname}},r.encodeQuery=function(e){var t=[];return angular.forEach(e,function(e,r){angular.isArray(e)?angular.forEach(e,function(e){t.push(encodeURIComponent(r)+(e===!0?"":"="+encodeURIComponent(e)))}):t.push(encodeURIComponent(r)+(e===!0?"":"="+encodeURIComponent(e)))}),t.length?t.join("&"):""},r}),angular.module("w69b.googleUploader",["w69b.ngProgressHttp"]).factory("googleUploader",["$progressHttp","$http","$q","$timeout","$log",function(e,t,r,n,a){function o(e,t){var a=e.headers("Retry-After");if(a&&f)a=Math.min(l,1e3*Number(a));else{if(!t)return r.when(e);a=t}return n(angular.noop,a).then(function(){return e})}function i(e){return e.data}function c(n,a){function c(e){return!g&&l&&308===e.status?u():d&&!g&&l&&(e.status<=0||e.status>=500&&e.status<=599||e.config&&e.config.authAutoRetry===!1&&401===e.status)?o(e,2e3).then(u):r.reject(e)}function s(t){if(308==t.status){var o,i=t.headers("Range");o=i?Number(i.match(/bytes=0-(\d+)/)[1])+1:0;var c=Math.min(n.size,p),s=Math.min(o+c,n.size)-1,u="bytes "+o+"-"+s+"/"+n.size,d=angular.extend({},a,{url:l,method:"PUT",progressEvents:"upload",transformRequest:null,data:n.slice(o,s+1),googleAuth:!0,authAutoRetry:!1,timeout:h});return d.headers=angular.extend({},d.headers,{"Content-Type":n.type,"Content-Range":u}),e(d).then(null,null,function(e){return e=e.event,{loaded:e.loaded+o,total:n.size}})}return 200==t.status?t:r.reject(t)}function u(){var e=angular.extend({},a,{timeout:h,googleAuth:!0});return e.headers=angular.extend({},e.headers,{"Content-Range":"bytes */"+n.size}),t.put(l,"",e).then(o,o).then(s)["catch"](c)}var l=null,f=r.defer(),h=f.promise,g=!1,m={};return m.start=function(e,o,s){s=angular.extend({},a,s),angular.extend(s.headers||{},{"X-Upload-Content-Length":n.size,"X-Upload-Content-Type":"video/*"}),s.googleAuth=!0,s.timeout=h;var d=r.defer();return t.post(e,o,s).then(function(e){return l=e.headers("Location"),d.notify({uploadUrl:l}),u()})["catch"](c).then(d.resolve.bind(d),d.reject.bind(d),d.notify.bind(d)),m.promise=d.promise.then(i),m.promise},m.resume=function(e){return l=e,m.promise=u().then(i),m.promise},m.cancel=function(){g=!0,f.resolve()},m}var s="https://www.googleapis.com/upload/youtube/v3/videos",u="https://www.googleapis.com/upload/drive/v2/files?uploadType=resumable",l=6e4,d=!0,f=!0,h=1073741824,p=1*h,g={};return g.setAutoResumeEnabled=function(e){d=e},g.setRespectRetryAfterHeader=function(e){f=e},g.setMaxChunkSize=function(e){p=e},g.resumeUpload=function(e,t,r){var n=c(e,r);return n.resume(t),n},g.youtubeUpload=function(e,t,r){t=t||{},t.privacy||(t.privacy="public");var n={snippet:{title:t.title||e.name,description:t.description||""},status:{privacyStatus:t.privacy}},a={params:{part:Object.keys(n).join(","),uploadType:"resumable"}};return g.upload(s,e,n,r,a)},g.driveUpload=function(e,t,r){return g.upload(u,e,t,r)},g.upload=function(e,t,r,n,a){var o=c(t,n);return o.start(e,r,a),o},g}]),angular.module("w69b.logging",[]).provider("$log",function(){var e=!0,t=this,r=!1;this.debugEnabled=function(t){return angular.isDefined(t)?(e=t,this):e},this.setCustomHook=function(e){r=e},this.$get=["$window",function(n){function a(e){return e instanceof Error&&(e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}function o(e){var t=n.console||{},o=t[e]||t.log||angular.noop,i=!1;try{i=!!o.apply}catch(c){}return i?function(){var n=[];return angular.forEach(arguments,function(e){n.push(a(e))}),r&&r(e,n)?o.apply(t,n):void 0}:function(t,n){r&&r(e,[t,n])&&o(t,null===n?"":n)}}return{log:o("log"),info:o("info"),warn:o("warn"),error:o("error"),debug:function(){var r=o("debug");return function(){e&&r.apply(t,arguments)}}()}}]}),angular.module("w69b.ngProgressHttp",[]).service("$progressHttp",["$http","$q",function(e,t){function r(r){r.headers=r.headers||{},r.method=r.method||"POST";var n,a=t.defer();r.headers.__setXHR__=function i(){return function(e){return e?(n=e,r.progressEvents&&"download"!==r.progressEvents||(n.addEventListener("progress",function(e){a.notify({type:"download",event:e})},!1),n.addEventListener("load",function(e){e.lengthComputable&&a.notify({type:"download",event:e})},!1)),void(r.progressEvents&&"upload"!==r.progressEvents||(n.upload.addEventListener("progress",function(e){a.notify({type:"upload",event:e})},!1),n.upload.addEventListener("load",function(e){e.lengthComputable&&a.notify({type:"upload",event:e})},!1)))):i()}},e(r).then(a.resolve.bind(a),a.reject.bind(a),a.notify.bind(a));var o=a.promise;return o.abort=function(){return n&&n.abort(),o},o}return r}]).config(function(){window.XMLHttpRequest=function(e){return function(){var t=new e;return t.setRequestHeader=function(e){return function(r,n){"__setXHR__"===r?n(t):e.apply(t,arguments);
}}(t.setRequestHeader),t}}(window.XMLHttpRequest)}),angular.module("w69b.pnaclModule",[]).factory("pnaclModule",["$q","$log","$timeout",function(e,t,r){function n(n,o,i){function c(){g.addEventListener("crash",u,!0),g.addEventListener("message",l,!0)}function s(){g.removeEventListener("message",l,!0),g.removeEventListener("crash",u,!0)}function u(){t.error("pnacl module crashed",b.lastError),m.onCrash&&m.onCrash(b.lastError)}function l(e){m.onMessage&&m.onMessage(e)}var d=o?"pnacl":"nacl",f=["<embed ","width=0 height=0 ",'src="'+n+'" ','ps_tty_prefix="ps:" ps_stdout="/dev/tty" ps_stderr="/dev/tty" type="application/x-'+d+'" />'].join("");i||(i=document.body);var h,p,g=document.createElement("div"),m={isLoaded:!1};m.onMessage=void 0,m.onCrash=void 0;var b;return m.load=function(){function t(){g.removeEventListener("load",n,!0),g.removeEventListener("error",o,!0)}function n(){t(),s.resolve()}function o(){t(),s.reject(b.lastError)}if(h)return h;var s=e.defer();g.addEventListener("load",n,!0),g.addEventListener("error",o,!0),c(),p=r(function(){s.reject("load_timeout")},a),g.innerHTML=f,b=g.children[0],i.appendChild(g),g.focus(),h=s.promise,h["finally"](function(){r.cancel(p),p=null});var u=h;return h["catch"](function(){m.unload()}),u},m.unload=function(){m.isLoaded=!1,s(),g.innerHTML="",i.removeChild(g),b=null,h=null},m.getElement=function(){return b},m.postMessage=function(e){if(!b)throw new Error("not loaded");b.postMessage(e)},m}var a=15e3;return n}]),angular.module("w69b.pnaclVideoEncoder",["w69b.pnaclModule"]).factory("pnaclVideoEncoder",["pnaclModule","$q","$log","$rootScope","$timeout",function(e,t,r,n,a){function o(o,i){function c(){m={state:"inactive",time:0}}function s(){y.unload(),c()}function u(e){m=e}function l(e){s(),v&&v.reject(e),v=null}function d(e){r.error("pnaclVideoEncoderError",e),l(e),S.onError&&S.onError(e)}function f(e){l(),S.onCrash&&S.onCrash(e)}function h(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])}function p(e,t){y.postMessage({type:e,data:t||{}})}function g(e,r){if(v)throw new Error("there is still a pending operation");return v=t.defer(),e&&p(e,r),v.promise}var m,b,y=e(o,i),v=null,w=8e3,k=["start","stop","pause","resume","replaceTracks"],S={};return y.onMessage=function(e){if(e=e.data,k.indexOf(e.type)>=0){if(!v)return;e.data?v.reject(e.data):v.resolve(),v=null}else if("error"==e.type)d(e.data),n.$$phase||n.$digest();else if("state"==e.type)u(e.data),n.$$phase||n.$digest();else if("stack_trace"==e.type)f(e.data);else{var t;e.data&&(t=e.data,t.trim&&(t=t.trim())),r.debug(e.type,t)}},S.onCrash=void 0,y.onCrash=f,S.stop=function(){return g("stop").then(function(){s()})},S.load=function(){return y.load()},S.getState=function(){return m.state},S.getStateObj=function(){return m},S.getFPS=function(){return m.fps},S.getCurrentTime=function(){return m.time},S.replaceTracks=function(e){return g("replaceTracks",e)},S.pause=function(){return g("pause")},S.resume=function(){return g("resume")},S.hasPendingOperation=function(){return!!v},S.start=function(e,t){if(!e)throw new Error("invalid filename");e="/html5_persistent/"+e;var r=g();return b=a(function(){d("start_timeout")},w),y.load().then(function(){var n=angular.extend({},t,{filename:e,chromeVersion:h()});return p("start",n),r})["finally"](function(){a.cancel(b),b=null})},c(),S}return o}]),angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,t){var r={};return r.wrapChromeError=function(t,r){return function(){var n=Array.prototype.slice.call(arguments,0),a=e.defer();return n.push(function(e){chrome.runtime.lastError?a.reject(chrome.runtime.lastError):a.resolve(e)}),t.apply(r,n),a.promise}},r.wrapCallbacks=function(t,r){return function(){var n=Array.prototype.slice.call(arguments,0),a=e.defer();return n.push(a.resolve.bind(a)),n.push(a.reject.bind(a)),t.apply(r,n),a.promise}},r.serializer=function(){var t=null;return function(r){var n=e.defer();return(t||e.when())["finally"](function(){var e=r.call();n.resolve(e)}),t=n.promise,t["finally"](function(){t=null}),n.promise}},r.withTimeout=function(r,n,a){a||(a=angular.noop);var o=e.defer(),i=t(function(){var e=a();angular.isDefined(e)?o.resolve(e):o.reject("timeout"),o=null},n),c=r(),s=o.promise;return c["finally"](function(){t.cancel(i),i=null}),c.then(function(){o&&o.resolve.apply(o,arguments)},function(){o&&o.reject.apply(o,arguments)}),s},r}]),angular.module("w69b.streamedVideo",[]).factory("streamedVideo",["$q",function(e){return function(){function t(){i.onEnded&&i.onEnded()}var r,n,a,o=document.createElement("video"),i={onEnded:null};return i.stop=function(){n&&(o.pause(),o.src="",window.URL.revokeObjectURL(r),n.removeEventListener("ended",t),n.stop(),n=null,a=!1)},i.load=function(c){if(n)throw new Error;n=c;var s=e.defer();return c.addEventListener("ended",t),r=window.URL.createObjectURL(c),o.addEventListener("canplay",function u(){o.removeEventListener("canplay",u),o.play(),0===o.videoHeight||0===o.videoWidth?(i.stop(),s.reject("loading video failed")):(a=!0,s.resolve())}),o.addEventListener("error",function l(){o.removeEventListener("error",l),i.stop(),s.reject(o.error)}),o.src=r,o.volume=0,s.promise},i.isLoaded=function(){return a},i.getVideoElement=function(){return o},i}}]),angular.module("w69b.structs.CircularBuffer",[]).factory("CircularBuffer",function(){var e=function(e){this.maxSize_=e||100,this.buff_=[]},t=e.prototype;return t.nextPtr_=0,t.add=function(e){this.buff_[this.nextPtr_]=e,this.nextPtr_=(this.nextPtr_+1)%this.maxSize_},t.get=function(e){return e=this.normalizeIndex_(e),this.buff_[e]},t.set=function(e,t){e=this.normalizeIndex_(e),this.buff_[e]=t},t.getCount=function(){return this.buff_.length},t.isEmpty=function(){return 0===this.buff_.length},t.clear=function(){this.buff_.length=0,this.nextPtr_=0},t.getValues=function(){return this.getNewestValues(this.getCount())},t.getNewestValues=function(e){for(var t=this.getCount(),r=this.getCount()-e,n=[],a=r;t>a;a++)n.push(this.get(a));return n},t.getKeys=function(){for(var e=[],t=this.getCount(),r=0;t>r;r++)e[r]=r;return e},t.containsKey=function(e){return e<this.getCount()},t.containsValue=function(e){for(var t=this.getCount(),r=0;t>r;r++)if(this.get(r)==e)return!0;return!1},t.getLast=function(){return 0===this.getCount()?null:this.get(this.getCount()-1)},t.normalizeIndex_=function(e){if(e>=this.buff_.length)throw Error("Out of bounds exception");return this.buff_.length<this.maxSize_?e:(this.nextPtr_+Number(e))%this.maxSize_},e}),angular.module("w69b.spawn",[]).factory("spawn",["$q","$log",function(e,t){function r(t,r){function n(e,t){var r;try{r=e(t)}catch(n){return a(n)}return r.done?o(r.value):o(r.value).then(c,s)}var a=r?Promise.reject.bind(Promise):e.reject.bind(e),o=r?Promise.resolve.bind(Promise):e.when.bind(e),i=t(),c=n.bind(null,i.next.bind(i)),s=n.bind(null,i["throw"].bind(i));return c()}return r.wrap=function(e){return function(){var n,a=arguments,o=r((n=e).bind.apply(n,$traceurRuntime.spread([this],a)));return o["catch"](function(e){t.error("unhandled spawn.wrap rejection:",e),e.stack&&console.error(e.stack)}),o}},r}]),angular.module("w69b.throttle",[]).factory("throttle",["$timeout",function(e){function t(t,r,n){var a,o,i;n=n!==!1;var c=function(){i=angular.copy(arguments,[]),o=function(){return a=null,o=null,t.apply(null,i)},n?(a&&e.cancel(a),a=e(o,r)):a||(a=e(o,r))};return c.flush=function(){a&&(e.cancel(a),o())},c}return t}]),angular.module("w69b.webrtc",["w69b.promiseTool"]).factory("webrtc",["promiseTool","$window","$q",function(e,t,r){function n(e){return e.some(function(e){return!!e.label})}var a={},o=t.navigator;return a.getUserMedia=e.wrapCallbacks(o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia,o),o.mediaDevices&&o.mediaDevices.enumerateDevices?a.getSources=function(){return r.when(o.mediaDevices.enumerateDevices()).then(function(e){return e.filter(function(e){return e.kind.endsWith("input")}).map(function(e){var t={id:e.deviceId,label:e.label};return t.kind=e.kind.substring(0,e.kind.length-5),t})})}:a.getSources=e.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),a.getSourcesByKind=function(e){return a.getSources().then(function(t){return t.filter(function(t){return t.kind===e})})},a.getVideoSources=function(){return a.getSourcesByKind("video")},a.getAudioSources=function(){return a.getSourcesByKind("audio")},a.hasCamera=function(){return a.getVideoSources().then(function(e){return e.length>0})},a.hasMicrophone=function(){return a.getAudioSources().then(function(e){return e.length>0})},a.hasVideoAccess=function(){return a.getVideoSources().then(n)},a.hasAudioAccess=function(){return a.getAudioSources().then(n)},a}]),angular.module("w69b.clipboard",[]).factory("clipboard",["$document",function(e){var t={};return t.copy=function(t){var r=angular.element("<textarea></textarea>");r.text(t),e.find("body").append(r),r[0].select(),e[0].execCommand("copy"),r.remove()},t}]),angular.module("w69b.googledrive",[]).factory("googledrive",["$q","googleauth","$location","$interval","$http",function(e,t,r,n,a){function o(e){return e.data}function i(e,t){return a.get(l+e,{googleAuth:!0,params:t}).then(o)}function c(e,t){return a.post(l+e,t,{googleAuth:!0}).then(o)}function s(e,t){return a({method:"PATCH",url:l+e,data:t,googleAuth:!0}).then(o)}var u=!1,l="https://www.googleapis.com/drive/v2/",d={};return d.isLoaded=function(){return u},d.loadLibs=function(){if(u)return e.when(null);var r=t.loadClient().then(function(){return e.all([t.gapiLoad("picker")])});return r.then(function(){u=!0})},d.getFile=function(e){return i("files/"+e)},d.listFiles=function(e){return i("files/",e).then(function(e){return e.items})},d.postFile=function(e){return c("files",e)},d.patchFile=function(e,t){return s("files/"+e,t)},d.trashFile=function(e){return c("files/"+e+"/trash")},d.getAbout=function(){return i("about")},d.showShareSettings=function(r){return t.gapiLoad("drive-share").then(function(){var a=new gapi.drive.share.ShareClient(t.getAppId());a.setItemIds([r]),a.showSettingsDialog();var o=e.defer(),i=n(function(){for(var e=!1,t=document.activeElement;t!==document.documentElement;){if(t.classList.contains("dcs-ad-dcs-c")){e=!0;break}t=t.parentNode}e||(n.cancel(i),o.resolve())},300);return o.promise})},d.listPermissions=function(e){return i("files/"+e+"/permissions").then(function(e){return e.items})},d.insertPermission=function(e,t){return a.post(l+"files/"+e+"/permissions",t,{googleAuth:!0}).then(o)},d.patchPermission=function(e,t,r){return s("files/"+e+"/permissions/"+t,r)},d.removePermission=function(e,t){return a["delete"](l+"files/"+e+"/permissions/"+t,{googleAuth:!0}).then(o)},d.getContextAction=function(){var e=r.search().state,t=null;if(angular.isString(e))try{t=JSON.parse(e)}catch(n){}if(t){var a=t.ids||[],o=t.exportIds||[];return{action:t.action,ids:a.concat(o),parentId:t.parentId,userId:t.userId}}return null},d}]),angular.module("w69b.chromeVersionOrder",[]).factory("chromeVersionOrder",function(){var e=[];return e.isLess=function(e,t){function r(e){return e.split(".").map(function(e){return Number(e)})}for(var n=r(e),a=r(t),o=0;o<Math.max(n.length,a.length);++o){if((n[o]||0)<(a[o]||0))return!0;if((n[o]||0)>(a[o]||0))return!1}return!1},e.isEqual=function(t,r){return!e.isLess(t,r)&&!e.isLess(r,t)},e.isLessOrEqual=function(t,r){return e.isLess(t,r)||e.isEqual(t,r)},e}),angular.module("w69b.chromeAlarms",["w69b.promiseTool"]).factory("chromeAlarms",["promiseTool",function(e){var t={};return t.create=chrome.alarms.create.bind(chrome.alarms),["get","getAll","clear","clearAll"].forEach(function(r){t[r]=e.wrapChromeError(chrome.alarms[r],chrome.alarms)}),t.onAlarm=chrome.alarms.onAlarm,t}]),angular.module("w69b.chromeNotifications",["w69b.promiseTool"]).factory("chromeNotifications",["promiseTool",function(e){function t(e){var t=c[e];t&&t.onClicked&&t.onClicked()}function r(e,t){var r=c[e];r&&r.onButtonClicked&&r.onButtonClicked(t)}function n(e,t){var r=c[e];r&&(r.onClosed&&r.onClosed(t),delete c[e],Object.keys(c).length||o())}function a(){i.onClicked.addListener(t),i.onButtonClicked.addListener(r),i.onClosed.addListener(n)}function o(){i.onClicked.removeListener(t),i.onButtonClicked.removeListener(r),i.onClosed.removeListener(n)}var i={},c={};return i.simple={},i.simple.defaultOptions={},i.simple.create=function(t,r){var n=e.serializer(),o={};return t=angular.extend({},i.simple.defaultOptions,t),n(function(){return i.create(r||"",t).then(function(e){o.id=e,Object.keys(c).length||a(),c[e]=o})}),o.clear=function(){n(function(){return i.clear(o.id)})},o.update=function(e){n(function(){return i.update(o.id,e)})},o.onClicked=angular.noop,o.onButtonClicked=angular.noop,o.onClosed=angular.noop,o},["clear","create","update","getAll","getPermissionLevel"].forEach(function(t){i[t]=e.wrapChromeError(chrome.notifications[t],chrome.notifications)}),["onClosed","onClicked","onButtonClicked","onPermissionLevelChanged","onShowSettings"].forEach(function(e){i[e]=chrome.notifications[e]}),i}]),angular.module("w69b.asyncResponse",[]).factory("asyncResponse",["$q",function(e){var t={};return t.createSender=function(t){var r={},n=0,a={};return r.sendWithResponse=function(r,o){var i=++n,c=e.defer();return a[i]=c,t({type:r,data:o,msgId:i}),c.promise},r.send=function(e,r){t({type:e,data:r})},r.handleResult=function(e){if(e&&"result"===e.type){var t=a[e.msgId];return delete a[e.msgId],e.hasOwnProperty("error")||e.isError?t.reject(e.error):t.resolve(e.data),!0}return!1},r},t.createRespond=function(t){return function(r,n){e.when(r).then(function(e){t({type:"result",msgId:n.msgId,data:e})},function(e){t({type:"result",msgId:n.msgId,error:e,isError:!0})})}},t}]),angular.module("w69b.ui.bytesFilter",[]).filter("bytes",["$injector",function(e){function t(t,n){return r||(r=e.get("$filter")("number")),r(t,n)}var r;return function(e,r){if(!angular.isNumber(e))return"-";if(angular.isUndefined(r)&&(r=1),0>=e)return"0 B";var n=["B","KB","MB","GB","TB","PB"],a=Math.floor(Math.log(e)/Math.log(1024));return t(e/Math.pow(1024,Math.floor(a)),r)+" "+n[a]}}]),angular.module("w69b.chromePermissions",["w69b.promiseTool"]).factory("chromePermissions",["promiseTool",function(e){var t=window.chrome&&window.chrome.permissions,r={};return t?(r.contains=e.wrapChromeError(t.contains,t),r.request=e.wrapChromeError(t.request,t),r.remove=e.wrapChromeError(t.remove,t),r.getAll=e.wrapChromeError(t.getAll,t),r):r}]),angular.module("w69b.chromeSystem",["w69b.promiseTool"]).factory("chromeSystem",["promiseTool",function(e){var t=window.chrome&&window.chrome.system,r={};return t?(t.cpu&&(r.cpu={getInfo:e.wrapChromeError(t.cpu.getInfo,t.cpu)}),t.memory&&(r.memory={getInfo:e.wrapChromeError(t.memory.getInfo,t.memory)}),r):r}]),angular.module("castifyExt.bgApp",["w69b.es6","castifyExt.commonConfig","castifyExt.bgRecord","castifyExt.bgUpload","w69b.chromePersistentLogger","castifyExt.recordingHooks","castifyExt.updateMigrationService","castifyExt.diskSpaceWatcher","castifyExt.bgLicensing","castifyExt.licenseEnforcer","castifyExt.bgMessages","castifyExt.driveFileWatcher","castifyExt.bgFiles","castifyExt.bgSyncManager","castifyExt.syncNotifications","castifyExt.authConfig","castifyEdit.bgEditJobScheduler","castifyEdit.editNotifications","w69b.chromeNotifications","castifyExt.connect.bgConnectService","castifyExt.bgSyncDownloader","castifyExt.bgCastifyAuth"]).config(["analyticsProvider","chromePersistentLoggerProvider","chromeVideoRecorderProvider","bgCastifyAuthProvider",function(e,t,r,n){r.setEncoderUrl("manifest_encoder.nmf",!1),t.setStorageKey("background"),t.enableGlobalHandler(!0),t.enableAutoSave(!1),t.install();var a="242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com";n.setClientId(a),n.setScopes(chrome.runtime.getManifest().oauth2.scopes),n.useChromeAccount(!0),n.setRedirectUri("https://www.screencastify.com/oauth2postback")}]).run(["bgRecordService","bgUploadService","analytics","$log","bgMessages","$q","recordingHooks","updateMigrationService","diskSpaceWatcher","bgLicensing","licenseEnforcer","driveFileWatcher","bgFiles","googleUploader","chromePersistentLogger","chromeRuntime","bgSyncManager","syncNotifications","onlineState","bgEditJobScheduler","editNotifications","chromeNotifications","bgConnectService","bgSyncDownloader","bgCastifyAuth",function(e,t,r,n,a,o,i,c,s,u,l,d,f,h,p,g,m,b,y,v,w,k,S,E,T){k.simple.defaultOptions={type:"basic",priority:2,iconUrl:"images/icon128.png"},h.setAutoResumeEnabled(!1),h.setRespectRetryAfterHeader(!1),i.install(),T.install(),o.all([m.install(),e.install(),t.install(),c.install(),s.install(),u.install(),l.install(),a.install(),d.install(),f.install(),b.install(),v.install(),w.install(),S.install(),E.install()])["finally"](function(){a.initializationCompleted()}),y.check(),g.onSuspend.addListener(function(){"inactive"===e.getRecorderState().state&&p.save()})}]),e()}();
